!function(t,i){if("object"==typeof exports&&"object"==typeof module)module.exports=i(require("long"),require("protobufjs/minimal"),require("zego-express-logger"),require("localforage"),require("pako/lib/deflate"));else if("function"==typeof define&&define.amd)define(["long","protobufjs/minimal","zego-express-logger","localforage","pako/lib/deflate"],i);else{var n,e="object"==typeof exports?i(require("long"),require("protobufjs/minimal"),require("zego-express-logger"),require("localforage"),require("pako/lib/deflate")):i(t.long,t["protobufjs/minimal"],t["zego-express-logger"],t.localforage,t["pako/lib/deflate"]);for(n in e)("object"==typeof exports?exports:t)[n]=e[n]}}("undefined"!=typeof self?self:this,(function(t,i,n,e,s){return o=[function(t,i,n){"use strict";function e(t){return"number"==typeof t}function s(t){return"string"==typeof t}function r(t){return"boolean"==typeof t}function o(t){return void 0===t}function u(t){return null!==t&&t instanceof Object}function h(t){return"function"==typeof t}function c(t){return t instanceof Array}n.d(i,"d",(function(){return e})),n.d(i,"f",(function(){return s})),n.d(i,"b",(function(){return r})),n.d(i,"g",(function(){return o})),n.d(i,"e",(function(){return u})),n.d(i,"c",(function(){return h})),n.d(i,"a",(function(){return c}))},function(i,n){i.exports=t},function(t,i,n){(function(i){var e;t.exports=(e=function(t){var e;if("undefined"!=typeof window&&window.crypto&&(e=window.crypto),"undefined"!=typeof self&&self.crypto&&(e=self.crypto),!(e=!(e=!(e="undefined"!=typeof globalThis&&globalThis.crypto?globalThis.crypto:e)&&"undefined"!=typeof window&&window.msCrypto?window.msCrypto:e)&&void 0!==i&&i.crypto?i.crypto:e))try{e=n(15)}catch(o){}var s=Object.create||function(t){return r.prototype=t,t=new r,r.prototype=null,t};function r(){}var o={},u=o.lib={},h=u.Base={extend:function(t){var i=s(this);return t&&i.mixIn(t),i.hasOwnProperty("init")&&this.init!==i.init||(i.init=function(){i.$super.init.apply(this,arguments)}),(i.init.prototype=i).$super=this,i},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var i in t)t.hasOwnProperty(i)&&(this[i]=t[i]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},c=u.WordArray=h.extend({init:function(t,i){t=this.words=t||[],this.sigBytes=null!=i?i:4*t.length},toString:function(t){return(t||f).stringify(this)},concat:function(t){var i=this.words,n=t.words,e=this.sigBytes,s=t.sigBytes;if(this.clamp(),e%4)for(var r=0;r<s;r++){var o=n[r>>>2]>>>24-r%4*8&255;i[e+r>>>2]|=o<<24-(e+r)%4*8}else for(var u=0;u<s;u+=4)i[e+u>>>2]=n[u>>>2];return this.sigBytes+=s,this},clamp:function(){var i=this.words,n=this.sigBytes;i[n>>>2]&=4294967295<<32-n%4*8,i.length=t.ceil(n/4)},clone:function(){var t=h.clone.call(this);return t.words=this.words.slice(0),t},random:function(t){for(var i=[],n=0;n<t;n+=4)i.push(function(){if(e){if("function"==typeof e.getRandomValues)try{return e.getRandomValues(new Uint32Array(1))[0]}catch(t){}if("function"==typeof e.randomBytes)try{return e.randomBytes(4).readInt32LE()}catch(t){}}throw new Error("Native crypto module could not be used to get secure random number.")}());return new c.init(i,t)}}),a=o.enc={},f=a.Hex={stringify:function(t){for(var i=t.words,n=t.sigBytes,e=[],s=0;s<n;s++){var r=i[s>>>2]>>>24-s%4*8&255;e.push((r>>>4).toString(16)),e.push((15&r).toString(16))}return e.join("")},parse:function(t){for(var i=t.length,n=[],e=0;e<i;e+=2)n[e>>>3]|=parseInt(t.substr(e,2),16)<<24-e%8*4;return new c.init(n,i/2)}},l=a.Latin1={stringify:function(t){for(var i=t.words,n=t.sigBytes,e=[],s=0;s<n;s++){var r=i[s>>>2]>>>24-s%4*8&255;e.push(String.fromCharCode(r))}return e.join("")},parse:function(t){for(var i=t.length,n=[],e=0;e<i;e++)n[e>>>2]|=(255&t.charCodeAt(e))<<24-e%4*8;return new c.init(n,i)}},_=a.Utf8={stringify:function(t){try{return decodeURIComponent(escape(l.stringify(t)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(t){return l.parse(unescape(encodeURIComponent(t)))}},d=u.BufferedBlockAlgorithm=h.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=_.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(i){var n,e=this._data,s=e.words,r=e.sigBytes,o=this.blockSize,u=r/(4*o),h=(u=i?t.ceil(u):t.max((0|u)-this._minBufferSize,0))*o;i=t.min(4*h,r);if(h){for(var a=0;a<h;a+=o)this._doProcessBlock(s,a);n=s.splice(0,h),e.sigBytes-=i}return new c.init(n,i)},clone:function(){var t=h.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0}),v=(u.Hasher=d.extend({cfg:h.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){d.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(t){return function(i,n){return new t.init(n).finalize(i)}},_createHmacHelper:function(t){return function(i,n){return new v.HMAC.init(t,n).finalize(i)}}}),o.algo={});return o}(Math),e)}).call(this,n(14))},function(t,n){t.exports=i},function(t,i){t.exports=n},function(t,i,n){t.exports=function(t){for(var i=Math,n=t,e=n.lib,s=e.WordArray,r=e.Hasher,o=n.algo,u=[],h=0;h<64;h++)u[h]=4294967296*i.abs(i.sin(h+1))|0;var c=o.MD5=r.extend({_doReset:function(){this._hash=new s.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(t,i){for(var n=0;n<16;n++){var e=i+n,s=t[e];t[e]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8)}var r=this._hash.words,o=t[i+0],h=t[i+1],c=t[i+2],d=t[i+3],v=t[i+4],m=t[i+5],g=t[i+6],p=t[i+7],b=t[i+8],E=t[i+9],y=t[i+10],S=t[i+11],O=t[i+12],R=t[i+13],T=t[i+14],w=t[i+15],N=r[0],I=r[1],C=r[2],k=r[3];N=a(N,I,C,k,o,7,u[0]),k=a(k,N,I,C,h,12,u[1]),C=a(C,k,N,I,c,17,u[2]),I=a(I,C,k,N,d,22,u[3]),N=a(N,I,C,k,v,7,u[4]),k=a(k,N,I,C,m,12,u[5]),C=a(C,k,N,I,g,17,u[6]),I=a(I,C,k,N,p,22,u[7]),N=a(N,I,C,k,b,7,u[8]),k=a(k,N,I,C,E,12,u[9]),C=a(C,k,N,I,y,17,u[10]),I=a(I,C,k,N,S,22,u[11]),N=a(N,I,C,k,O,7,u[12]),k=a(k,N,I,C,R,12,u[13]),C=a(C,k,N,I,T,17,u[14]),N=f(N,I=a(I,C,k,N,w,22,u[15]),C,k,h,5,u[16]),k=f(k,N,I,C,g,9,u[17]),C=f(C,k,N,I,S,14,u[18]),I=f(I,C,k,N,o,20,u[19]),N=f(N,I,C,k,m,5,u[20]),k=f(k,N,I,C,y,9,u[21]),C=f(C,k,N,I,w,14,u[22]),I=f(I,C,k,N,v,20,u[23]),N=f(N,I,C,k,E,5,u[24]),k=f(k,N,I,C,T,9,u[25]),C=f(C,k,N,I,d,14,u[26]),I=f(I,C,k,N,b,20,u[27]),N=f(N,I,C,k,R,5,u[28]),k=f(k,N,I,C,c,9,u[29]),C=f(C,k,N,I,p,14,u[30]),N=l(N,I=f(I,C,k,N,O,20,u[31]),C,k,m,4,u[32]),k=l(k,N,I,C,b,11,u[33]),C=l(C,k,N,I,S,16,u[34]),I=l(I,C,k,N,T,23,u[35]),N=l(N,I,C,k,h,4,u[36]),k=l(k,N,I,C,v,11,u[37]),C=l(C,k,N,I,p,16,u[38]),I=l(I,C,k,N,y,23,u[39]),N=l(N,I,C,k,R,4,u[40]),k=l(k,N,I,C,o,11,u[41]),C=l(C,k,N,I,d,16,u[42]),I=l(I,C,k,N,g,23,u[43]),N=l(N,I,C,k,E,4,u[44]),k=l(k,N,I,C,O,11,u[45]),C=l(C,k,N,I,w,16,u[46]),N=_(N,I=l(I,C,k,N,c,23,u[47]),C,k,o,6,u[48]),k=_(k,N,I,C,p,10,u[49]),C=_(C,k,N,I,T,15,u[50]),I=_(I,C,k,N,m,21,u[51]),N=_(N,I,C,k,O,6,u[52]),k=_(k,N,I,C,d,10,u[53]),C=_(C,k,N,I,y,15,u[54]),I=_(I,C,k,N,h,21,u[55]),N=_(N,I,C,k,b,6,u[56]),k=_(k,N,I,C,w,10,u[57]),C=_(C,k,N,I,g,15,u[58]),I=_(I,C,k,N,R,21,u[59]),N=_(N,I,C,k,v,6,u[60]),k=_(k,N,I,C,S,10,u[61]),C=_(C,k,N,I,c,15,u[62]),I=_(I,C,k,N,E,21,u[63]),r[0]=r[0]+N|0,r[1]=r[1]+I|0,r[2]=r[2]+C|0,r[3]=r[3]+k|0},_doFinalize:function(){var t=this._data,n=t.words,e=8*this._nDataBytes,s=8*t.sigBytes;n[s>>>5]|=128<<24-s%32;var r=i.floor(e/4294967296),o=e;n[15+(s+64>>>9<<4)]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),n[14+(s+64>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),t.sigBytes=4*(n.length+1),this._process();for(var u=this._hash,h=u.words,c=0;c<4;c++){var a=h[c];h[c]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8)}return u},clone:function(){var t=r.clone.call(this);return t._hash=this._hash.clone(),t}});function a(t,i,n,e,s,r,o){var u=t+(i&n|~i&e)+s+o;return(u<<r|u>>>32-r)+i}function f(t,i,n,e,s,r,o){var u=t+(i&e|n&~e)+s+o;return(u<<r|u>>>32-r)+i}function l(t,i,n,e,s,r,o){var u=t+(i^n^e)+s+o;return(u<<r|u>>>32-r)+i}function _(t,i,n,e,s,r,o){var u=t+(n^(i|~e))+s+o;return(u<<r|u>>>32-r)+i}return n.MD5=r._createHelper(c),n.HmacMD5=r._createHmacHelper(c),t.MD5}(n(2))},function(t,i,n){t.exports=function(t){for(var i=t,n=i.lib.BlockCipher,e=i.algo,s=[],r=[],o=[],u=[],h=[],c=[],a=[],f=[],l=[],_=[],d=[],v=0;v<256;v++)d[v]=v<128?v<<1:v<<1^283;var m=0,g=0;for(v=0;v<256;v++){var p=g^g<<1^g<<2^g<<3^g<<4;p=p>>>8^255&p^99,s[m]=p,r[p]=m;var b=d[m],E=d[b],y=d[E],S=257*d[p]^16843008*p;o[m]=S<<24|S>>>8,u[m]=S<<16|S>>>16,h[m]=S<<8|S>>>24,c[m]=S;S=16843009*y^65537*E^257*b^16843008*m;a[p]=S<<24|S>>>8,f[p]=S<<16|S>>>16,l[p]=S<<8|S>>>24,_[p]=S,m?(m=b^d[d[d[y^b]]],g^=d[d[g]]):m=g=1}var O=[0,1,2,4,8,16,32,64,128,27,54],R=e.AES=n.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var t=this._keyPriorReset=this._key,i=t.words,n=t.sigBytes/4,e=4*((this._nRounds=n+6)+1),r=this._keySchedule=[],o=0;o<e;o++)o<n?r[o]=i[o]:(c=r[o-1],o%n?n>6&&o%n==4&&(c=s[c>>>24]<<24|s[c>>>16&255]<<16|s[c>>>8&255]<<8|s[255&c]):(c=s[(c=c<<8|c>>>24)>>>24]<<24|s[c>>>16&255]<<16|s[c>>>8&255]<<8|s[255&c],c^=O[o/n|0]<<24),r[o]=r[o-n]^c);for(var u=this._invKeySchedule=[],h=0;h<e;h++){o=e-h;if(h%4)var c=r[o];else c=r[o-4];u[h]=h<4||o<=4?c:a[s[c>>>24]]^f[s[c>>>16&255]]^l[s[c>>>8&255]]^_[s[255&c]]}}},encryptBlock:function(t,i){this._doCryptBlock(t,i,this._keySchedule,o,u,h,c,s)},decryptBlock:function(t,i){var n=t[i+1];t[i+1]=t[i+3],t[i+3]=n,this._doCryptBlock(t,i,this._invKeySchedule,a,f,l,_,r);n=t[i+1];t[i+1]=t[i+3],t[i+3]=n},_doCryptBlock:function(t,i,n,e,s,r,o,u){for(var h=this._nRounds,c=t[i]^n[0],a=t[i+1]^n[1],f=t[i+2]^n[2],l=t[i+3]^n[3],_=4,d=1;d<h;d++){var v=e[c>>>24]^s[a>>>16&255]^r[f>>>8&255]^o[255&l]^n[_++],m=e[a>>>24]^s[f>>>16&255]^r[l>>>8&255]^o[255&c]^n[_++],g=e[f>>>24]^s[l>>>16&255]^r[c>>>8&255]^o[255&a]^n[_++],p=e[l>>>24]^s[c>>>16&255]^r[a>>>8&255]^o[255&f]^n[_++];c=v,a=m,f=g,l=p}v=(u[c>>>24]<<24|u[a>>>16&255]<<16|u[f>>>8&255]<<8|u[255&l])^n[_++],m=(u[a>>>24]<<24|u[f>>>16&255]<<16|u[l>>>8&255]<<8|u[255&c])^n[_++],g=(u[f>>>24]<<24|u[l>>>16&255]<<16|u[c>>>8&255]<<8|u[255&a])^n[_++],p=(u[l>>>24]<<24|u[c>>>16&255]<<16|u[a>>>8&255]<<8|u[255&f])^n[_++];t[i]=v,t[i+1]=m,t[i+2]=g,t[i+3]=p},keySize:8});return i.AES=n._createHelper(R),t.AES}(n(2),(n(16),n(5),n(9),n(19)))},function(t,i,n){t.exports=n(2).enc.Utf8},function(t,i,n){function e(t){var i;return(a[t]||(i=a[t]={i:t,l:!1,exports:{}},c[t].call(i.exports,i,i.exports,e),i.l=!0,i)).exports}var s,r,o,u,h,c,a;t.exports=(s=n(10),r=n(20),o=n(5),u=n(6),h=n(7),c=[function(t,i,n){"use strict";Object.defineProperty(i,"u",{value:!0}),i.LinkedList=i.ListNode=i.ENUM_CONNECT_STATE=i.ENUM_NETWORK_STATE=i.SOCKET_DISCONNECT=i.errorList=i.Queue=i.getSeq=i.E_CLIENT_TYPE=i.ENUM_LOG_LEVEL=i.ENUM_REMOTE_TYPE=i.ZEGO_BROWSER_TYPE=i.ZEGO_ENV=i.PROTO_VERSION=void 0,i.PROTO_VERSION="1.0.3",(s=i.ZEGO_ENV||(i.ZEGO_ENV={}))[s.BROWSER=0]="BROWSER",s[s.WEIXINMINI=1]="WEIXINMINI",(s=i.ZEGO_BROWSER_TYPE||(i.ZEGO_BROWSER_TYPE={}))[s.IE=0]="IE",s[s.FIREFOX=1]="FIREFOX",s[s.CHROME=2]="CHROME",s[s.SAFARI=3]="SAFARI",s[s.OPERA=4]="OPERA",s[s.WEIXIN=5]="WEIXIN",s[s.WEIXINMINI=6]="WEIXINMINI",s[s.UNKOWN=7]="UNKOWN",(s=i.ENUM_REMOTE_TYPE||(i.ENUM_REMOTE_TYPE={}))[s.DISABLE=0]="DISABLE",s[s.WEBSOCKET=1]="WEBSOCKET",s[s.HTTPS=2]="HTTPS",i.ENUM_LOG_LEVEL={DEBUG:0,INFO:1,WARN:2,ERROR:3,REPORT:99,DISABLE:100,debug:0,info:1,warn:2,error:3,report:99,disable:100},(s=i.E_CLIENT_TYPE||(i.E_CLIENT_TYPE={}))[s.ClientType_None=0]="ClientType_None",s[s.ClientType_H5=1]="ClientType_H5",s[s.ClientType_SmallPragram=2]="ClientType_SmallPragram",s[s.ClientType_Webrtc=3]="ClientType_Webrtc",i.getSeq=(e=1,function(){return e++}),r.prototype.isEmpty=function(){return 0==this.items.length},r.prototype.enqueue=function(t){this.items.push(t)},r.prototype.dequeue=function(){return this.isEmpty()?"Underflow":this.items.shift()},r.prototype.front=function(){return this.isEmpty()?"No elements in Queue":this.items[0]},r.prototype.size=function(){return this.items.length},r.prototype.clear=function(){this.items=[]},r.prototype.all=function(){return this.items};var e,s=r;function r(){this.items=[],this.items=[]}i.Queue=s,i.errorList={TIMEOUT:{code:100001,msg:"network timeout"},DATAEXIST:{code:100002,msg:"data exist"},BROKEN:{code:100003,msg:"network broken"}},i.SOCKET_DISCONNECT=-1,(s=i.ENUM_NETWORK_STATE||(i.ENUM_NETWORK_STATE={}))[s.offline=0]="offline",s[s.online=1]="online",(s=i.ENUM_CONNECT_STATE||(i.ENUM_CONNECT_STATE={}))[s.disconnected=0]="disconnected",s[s.connecting=1]="connecting",s[s.connected=2]="connected",Object.defineProperty(u.prototype,"id",{get:function(){return this.h||null},set:function(t){this.h=t},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"data",{get:function(){return this.v},set:function(t){this.v=t},enumerable:!1,configurable:!0}),u.prototype.hasNext=function(){return this.next&&this.next.id},u.prototype.hasPrev=function(){return this.prev&&this.prev.id};var o=u;function u(t,i){void 0===t&&(t=null),void 0===i&&(i=null),this.next=null,this.prev=null,this.h=t,this.v=i}function h(){this.start=new o,this.end=new o,this.g=0,this._=0,this.start.next=this.end,this.start.prev=null,this.end.prev=this.start,this.end.next=null}i.ListNode=o,h.prototype.insertBefore=function(t,i){return(i=new o(this.g,i)).next=t,i.prev=t.prev,t.prev&&(t.prev.next=i),t.prev=i,++this.g,++this._,i},h.prototype.addLast=function(t){return this.insertBefore(this.end,t)},h.prototype.add=function(t){return this.addLast(t)},h.prototype.getFirst=function(){return 0===this._?null:this.start.next},h.prototype.getLast=function(){return 0===this._?null:this.end.prev},h.prototype.size=function(){return this._},h.prototype.getFromFirst=function(t){var i=0,n=this.start.next;if(0<=t)for(;i<t&&null!==n;)n=n.next,++i;else n=null;if(null===n)throw"Index out of bounds.";return n},h.prototype.get=function(t){return 0===t?this.getFirst():t===this._-1?this.getLast():this.getFromFirst(t)},h.prototype.remove=function(t){return t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),--this._,t},h.prototype.removeFirst=function(){return 0<this._&&this.start.next?this.remove(this.start.next):null},h.prototype.removeLast=function(){return 0<this._&&this.end.prev?this.remove(this.end.prev):null},h.prototype.removeAll=function(){this.start.next=this.end,this.end.prev=this.start,this._=0,this.g=0},h.prototype.each=function(t){for(var i=this.start;i.hasNext();)t(i=i.next)},h.prototype.find=function(t){for(var i=this.start,n=!1,e=null;i.hasNext()&&!n;)t(i=i.next)&&(e=i,n=!0);return e},h.prototype.map=function(t){for(var i=this.start,n=[];i.hasNext();)t(i=i.next)&&n.push(i);return n},h.prototype.push=function(t){return this.addLast(t)},h.prototype.unshift=function(t){0<this._?this.insertBefore(this.start.next,t):this.insertBefore(this.end,t)},h.prototype.pop=function(){return this.removeLast()},h.prototype.shift=function(){return this.removeFirst()},i.LinkedList=h},function(t,i,n){"use strict";var e=this&&this.__read||function(t,i){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var e,s,r=n.call(t),o=[];try{for(;(void 0===i||0<i--)&&!(e=r.next()).done;)o.push(e.value)}catch(t){s={error:t}}finally{try{e&&!e.done&&(n=r.return)&&n.call(r)}finally{if(s)throw s.error}}return o},s=this&&this.__spread||function(){for(var t=[],i=0;i<arguments.length;i++)t=t.concat(e(arguments[i]));return t},r=(Object.defineProperty(i,"u",{value:!0}),i.ContextAPI=i.suppressInstrumentation=i.ROOT_CONTEXT=i.BaseContext=i.setSpan=i.getSpanContext=i.getSpan=i.createContextKey=void 0,n(16));function o(t){return Symbol.for(t)}var u=(i.createContextKey=o)("OpenTelemetry Context Key SUPPRESS_INSTRUMENTATION"),h=o("OpenTelemetry Context Key SPAN");function c(t){return t.getValue(h)||void 0}function a(t){this.O=t,this.S=new r.StackContextManager}i.getSpan=c,i.getSpanContext=function(t){return null==(t=c(t))?void 0:t.context()},i.setSpan=function(t,i){return t.setValue(h,i)},i.BaseContext=n=function t(i){var n=this;n.M=i?new Map(i):new Map,n.getValue=function(t){return n.M.get(t)},n.setValue=function(i,e){var s=new t(n.M);return s.M.set(i,e),s},n.deleteValue=function(i){var e=new t(n.M);return e.M.delete(i),e}},i.ROOT_CONTEXT=new n,i.suppressInstrumentation=function(t){return t.setValue(u,!0)},a.getInstance=function(t){return void 0===t&&(t="context"),this.j||(this.j=new a(t)),this.j},a.prototype.active=function(){return this.S.active()},a.prototype.with=function(t,i,n){for(var e,r=[],o=3;o<arguments.length;o++)r[o-3]=arguments[o];return(e=this.T()).with.apply(e,s([t,i,n],r))},a.prototype.T=function(){return this.S},i.ContextAPI=a},function(t,i,n){"use strict";var e,s;Object.defineProperty(i,"u",{value:!0}),i.INVALID_SPAN_CONTEXT=i.INVALID_TRACEID=i.INVALID_SPANID=i.TraceFlags=i.SpanKind=i.SpanStatusCode=void 0,(e=i.SpanStatusCode||(i.SpanStatusCode={}))[e.UNSET=0]="UNSET",e[e.OK=1]="OK",e[e.ERROR=2]="ERROR",(e=i.SpanKind||(i.SpanKind={}))[e.INTERNAL=0]="INTERNAL",e[e.SERVER=1]="SERVER",e[e.CLIENT=2]="CLIENT",e[e.PRODUCER=3]="PRODUCER",e[e.CONSUMER=4]="CONSUMER",(s=e=i.TraceFlags||(i.TraceFlags={}))[s.NONE=0]="NONE",s[s.SAMPLED=1]="SAMPLED",i.INVALID_SPANID="0000000000000000",i.INVALID_TRACEID="00000000000000000000000000000000",i.INVALID_SPAN_CONTEXT={traceId:i.INVALID_TRACEID,spanId:i.INVALID_SPANID,traceFlags:e.NONE}},function(t,i,n){"use strict";Object.defineProperty(i,"u",{value:!0}),i.log=i.ZegoLog=void 0,s.prototype.log=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var n=t.join("");console.log(n)},s.prototype.debug=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var n=t.join("");console.debug(n)},s.prototype.info=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var n=t.join("");console.info(n)},s.prototype.warn=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var n=t.join("");console.warn(n)},s.prototype.error=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var n=t.join("");console.error(n)};var e=s;function s(){}e=new(i.ZegoLog=e),i.log=e},function(t,i,n){"use strict";Object.defineProperty(i,"u",{value:!0}),i.FAIL_TIME=i.FAIL_MAX_COUNT=i.FAIL_COUNT=i.STORE_SIZE=i.CACHE_SIZE=i.BUCKET_CONFIG=i.DEFAULT_CONFIG=void 0,i.DEFAULT_CONFIG={importantLevel:0,reportSize:3e3,reportNum:10,bps:16e3,netTimeout:10},i.BUCKET_CONFIG={bucketSize:1e4,tokensPerInterval:1600},i.CACHE_SIZE={totalAvailCache:102400,cacheMaxSize:2e4,cacheDelPer:.2},i.STORE_SIZE={totalDBSize:2048e3,storeDelPer:.2},i.FAIL_COUNT=5,i.FAIL_MAX_COUNT=10,i.FAIL_TIME=30},function(t,i,n){"use strict";var e=this&&this.__importDefault||function(t){return t&&t.u?t:{default:t}},s=(Object.defineProperty(i,"u",{value:!0}),i.uuid=i.calculateMemSize=i.analyzeKey=i.getCurrentTime=i.getCurrentEnv=i.getBrowser=void 0,n(0)),r=e(n(31)),o=(i.getBrowser=function(){var t=window.navigator.userAgent,i=null!=window.ActiveXObject&&-1!=t.indexOf("MSIE"),n=-1!=t.indexOf("Firefox"),e=null!=window.opr,r=t.indexOf("Chrome")&&window.chrome,o=-1!=t.indexOf("Safari")&&-1!=t.indexOf("Version");t=t.toLowerCase().match(/MicroMessenger/i)&&"micromessenger"===t.toLowerCase().match(/MicroMessenger/i)[0];return i?s.ZEGO_BROWSER_TYPE.IE:n?s.ZEGO_BROWSER_TYPE.FIREFOX:e?s.ZEGO_BROWSER_TYPE.OPERA:r?s.ZEGO_BROWSER_TYPE.CHROME:o?s.ZEGO_BROWSER_TYPE.SAFARI:t?s.ZEGO_BROWSER_TYPE.WEIXIN:s.ZEGO_BROWSER_TYPE.UNKOWN},i.getCurrentEnv=function(){var t=window.navigator.userAgent;return new Promise((function(i){-1==t.indexOf("MicroMessage")?i(s.ZEGO_ENV.BROWSER):wx.miniProgram.getEnv((function(t){t.miniprogram}))}))},["00","01","02","03","04","05","06","07","08","09"]);i.getCurrentTime=function(){var t=new Date;return[t.getFullYear()+"/",(o[t.getMonth()+1]||t.getMonth()+1)+"/",(o[t.getDate()]||t.getDate())+" ",(o[t.getHours()]||t.getHours())+":",(o[t.getMinutes()]||t.getMinutes())+":",o[t.getSeconds()]||t.getSeconds(),"."+t.getTime()%1e3].join("")},i.analyzeKey=function(t){return t=t.split("_"),{level:Number(t[0]),timestamp:t[1],seq:t[2]}},i.calculateMemSize=function(t){return r.default(t)},i.uuid=function(t,i){var n,e,s="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),r=[];if(i=i||s.length,t)for(n=0;n<t;n++)r[n]=s[0|Math.random()*i];else for(r[8]=r[13]=r[18]=r[23]="-",r[14]="4",n=0;n<36;n++)r[n]||(e=0|16*Math.random(),r[n]=s[19==n?3&e|8:e]);return r.join("")}},function(t,i,n){"use strict";var e=this&&this.__values||function(t){var i="function"==typeof Symbol&&Symbol.iterator,n=i&&t[i],e=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return{value:(t=t&&e>=t.length?void 0:t)&&t[e++],done:!t}}};throw new TypeError(i?"Object is not iterable.":"Symbol.iterator is not defined.")},s=this&&this.__read||function(t,i){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var e,s,r=n.call(t),o=[];try{for(;(void 0===i||0<i--)&&!(e=r.next()).done;)o.push(e.value)}catch(t){s={error:t}}finally{try{e&&!e.done&&(n=r.return)&&n.call(r)}finally{if(s)throw s.error}}return o};function r(t){var i,n,s;if(null!=t&&Array.isArray(t))try{for(var r=e(t),o=r.next();!o.done;o=r.next()){var u=o.value;if(null!=u)if(s){if(typeof u!==s)return!1}else s=typeof u}}catch(t){i={error:t}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(i)throw i.error}}return!0}Object.defineProperty(i,"u",{value:!0}),i.sanitizeAttributes=i.isAttributeValue=void 0,i.isAttributeValue=r,i.sanitizeAttributes=function(t){var i,n,o={};if(null!=t&&"object"==typeof t)try{for(var u=e(Object.entries(t)),h=u.next();!h.done;h=u.next()){var c=s(h.value,2),a=c[0],f=c[1];r(f)&&(Array.isArray(f)?o[a]=f.slice():o[a]=f)}}catch(t){i={error:t}}finally{try{h&&!h.done&&(n=u.return)&&n.call(u)}finally{if(i)throw i.error}}return o}},function(t,i,n){"use strict";Object.defineProperty(i,"u",{value:!0}),i.IdGenerator=void 0;var e=Array(32);function s(t){return function(){for(var i=0;i<2*t;i++)e[i]=Math.floor(16*Math.random())+48,58<=e[i]&&(e[i]+=39);return String.fromCharCode.apply(null,e.slice(0,2*t))}}i.IdGenerator=function(){this.generateTraceId=s(16),this.generateSpanId=s(8),this.generateEventId=s(4)}},function(t,i,n){"use strict";Object.defineProperty(i,"u",{value:!0}),i.Resource=i.SDK_INFO=i.SemanticResourceAttributes=void 0,i.SemanticResourceAttributes={PROCESS_RUNTIME_NAME:"process.runtime.name",TELEMETRY_SDK_NAME:"telemetry.sdk.name",TELEMETRY_SDK_LANGUAGE:"telemetry.sdk.language",TELEMETRY_SDK_VERSION:"telemetry.sdk.version"},i.SDK_INFO=((e={})[i.SemanticResourceAttributes.TELEMETRY_SDK_NAME]="opentelemetry",e[i.SemanticResourceAttributes.PROCESS_RUNTIME_NAME]="browser",e[i.SemanticResourceAttributes.TELEMETRY_SDK_LANGUAGE]="webjs",e[i.SemanticResourceAttributes.TELEMETRY_SDK_VERSION]=i.VERSION,e),s.empty=function(){return s.EMPTY},s.createTelemetrySDKResource=function(){var t;return new s(((t={})[i.SemanticResourceAttributes.TELEMETRY_SDK_LANGUAGE]=i.SDK_INFO[i.SemanticResourceAttributes.TELEMETRY_SDK_LANGUAGE],t[i.SemanticResourceAttributes.TELEMETRY_SDK_NAME]=i.SDK_INFO[i.SemanticResourceAttributes.TELEMETRY_SDK_NAME],t[i.SemanticResourceAttributes.TELEMETRY_SDK_VERSION]=i.SDK_INFO[i.SemanticResourceAttributes.TELEMETRY_SDK_VERSION],t))},s.prototype.merge=function(t){return t&&Object.keys(t.attributes).length?new s(Object.assign({},this.attributes,t.attributes)):this},s.EMPTY=new s({});var e=s;function s(t){this.attributes=t}i.Resource=e},function(t,i,n){"use strict";var e=this&&this.__values||function(t){var i="function"==typeof Symbol&&Symbol.iterator,n=i&&t[i],e=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return{value:(t=t&&e>=t.length?void 0:t)&&t[e++],done:!t}}};throw new TypeError(i?"Object is not iterable.":"Symbol.iterator is not defined.")},s=this&&this.__read||function(t,i){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var e,s,r=n.call(t),o=[];try{for(;(void 0===i||0<i--)&&!(e=r.next()).done;)o.push(e.value)}catch(t){s={error:t}}finally{try{e&&!e.done&&(n=r.return)&&n.call(r)}finally{if(s)throw s.error}}return o},r=(Object.defineProperty(i,"u",{value:!0}),i.Span=void 0,n(6)),o=n(1),u=n(2),h=n(7),c=n(17);function a(t,i,n,e,s,r,o,c){void 0===c&&(c=[]),this.attributes={},this.links=[],this.events=[],this.status={code:u.SpanStatusCode.UNSET},this.endTime=0,this.N=!1,this.A=0,this.exported=!0,this.R=t.context,this.reporter=t.reporter,this.spanProcessor=t.spanProcessor,this.parentTracer=t,this.name=n,this.level=e,this.spanContext=s,this.parentSpanId=o,this.kind=r,this.links=c,this.startTime=Date.now(),this.resource=t.resource,this.instrumentationLibrary=t.instrumentationLibrary,this.I=t.getActiveTraceParams(),this.k=new h.IdGenerator}a.prototype.context=function(){return this.spanContext},a.prototype.setAttribute=function(t,i){return null==i||0===t.length||!r.isAttributeValue(i)||Object.keys(this.attributes).length>=this.I.numberOfAttributesPerSpan&&!Object.prototype.hasOwnProperty.call(this.attributes,t)||(this.attributes[t]=i),this},a.prototype.appendAttribute=function(t,i){return null==i||0===t.length||!r.isAttributeValue(i)||Object.keys(this.attributes).length>=this.I.numberOfAttributesPerSpan&&!Object.prototype.hasOwnProperty.call(this.attributes,t)||(this.attributes[t]&&Array.isArray(this.attributes[t])?this.attributes[t].push(i):this.attributes[t]=[i]),this},a.prototype.setAttributes=function(t){var i,n;try{for(var r=e(Object.entries(t)),o=r.next();!o.done;o=r.next()){var u=s(o.value,2),h=u[0],c=u[1];this.setAttribute(h,c)}}catch(t){i={error:t}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(i)throw i.error}}return this},a.prototype.addEvent=function(t,i,n){this.events.length>=this.I.numberOfEventsPerSpan&&this.events.shift();var e=this.k.generateEventId();return c.isTimeInput(i)&&(void 0===n&&(n=i),i=void 0),void 0===n&&(n=c.hrTime()),this.events.push({name:t,attributes:i,time:c.timeInputToHrTime(n),event_id:e}),this},a.prototype.setStatus=function(t){return this.status=t,this},a.prototype.updateName=function(t){return this.name=t,this},a.prototype.end=function(t){var i,n=this;this.D()||(this.N=!0,this.resource=this.parentTracer.resource,this.spanProcessor.spanBeforeEnd&&this.spanProcessor.spanBeforeEnd(this),i=c.getCurrentTime(),this.setAttribute("e_time_s",i),this.endTime=Date.now(),this.A=this.endTime-this.startTime,this.R.with(o.suppressInstrumentation(this.R.active()),(function(){var i=n.P(n);n.spanProcessor.spanEnd&&n.spanProcessor.spanEnd(i,n.level),i.droped||!1===t||(delete i.droped,n.reporter.report(JSON.stringify(i),n.level))})))},a.prototype.spanReport=function(){var t=this.P(this);this.reporter.report(JSON.stringify(t),this.level)},a.prototype.isRecording=function(){return!1===this.N},Object.defineProperty(a.prototype,"duration",{get:function(){return this.A},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"ended",{get:function(){return this.N},enumerable:!1,configurable:!0}),a.prototype.D=function(){return this.N,this.N},a.prototype.P=function(t){var i=[],n=(t.events.forEach((function(t){var n={};Object.keys(t).forEach((function(i){"name"===i&&(n[i]=t[i]),"time"===i&&(n.timestamp=c.hrTimeToMilliseconds(t[i])),"attributes"===i&&(n.tags=t[i])})),i.push(n)})),[]);return t.links.forEach((function(t){n.push({span_id:t.context.spanId,trace_id:t.context.traceId})})),{trace_id:t.spanContext.traceId,parent_span_id:t.parentSpanId,name:t.name,span_id:t.spanContext.spanId,kind:t.kind,start_time:t.startTime,end_time:t.endTime,duration:t.duration,logs:i,tags:t.attributes,links:n}},i.Span=a},function(t,i,n){"use strict";Object.defineProperty(i,"u",{value:!0}),i.ZegoSpan=void 0;var e=n(3),s=n(9);function r(t,i){this.spanId=t,this.span=i}r.prototype.setAttribute=function(t,i){var n=this;return this.span?this.span.setAttribute(t,i):this.B().then((function(){n.span&&n.span.setAttribute(t,i)})),this},r.prototype.setAttributes=function(t){var i=this;return this.span?this.span.setAttributes(t):this.B().then((function(){i.span&&i.span.setAttributes(t)})),this},r.prototype.appendAttribute=function(t,i){var n=this;return this.span?this.span.appendAttribute(t,i):this.B().then((function(){n.span&&n.span.appendAttribute(t,i)})),this},r.prototype.addEvent=function(t,i,n){var e=this;return this.span?this.span.addEvent(t,i,n):this.B().then((function(){e.span&&e.span.addEvent(t,i,n)})),this},r.prototype.setStatus=function(t){var i=this;return this.span?this.span.setStatus(t):this.B().then((function(){i.span&&i.span.setStatus(t)})),this},r.prototype.updateName=function(t){var i=this;return this.span?this.span.updateName(t):this.B().then((function(){i.span&&i.span.updateName(t)})),this},r.prototype.end=function(t){var i=this;void 0===t&&(t=!0),this.span?this.span.end(t):this.B(!0).then((function(){i.span&&i.span.end(t),i.U()}))},r.prototype.setSpanActive=function(t){this.activeCallback=t},r.prototype.setSpanEnd=function(t){this.endCallback=t},r.prototype.spanReport=function(){var t;null!=(t=this.span)&&t.spanReport()},r.prototype.U=function(){this.L()||(this.J(this.spanId),this.endCallback&&this.endCallback(this.spanInfo))},r.prototype.L=function(){return"noop"===this.spanId},r.prototype.B=function(t){var i=this;return void 0===t&&(t=!1),new Promise((function(n,e){i.store.getItem(i.spanId).then((function(e){var o=new s.Span(r.tracer,r.tracer.context.active(),e.name,e.level,e.spanContext,e.kind,e.parentSpanId,e.links);o.setStatus(e.status),o.setAttributes(e.attributes),i.span=o,i.activeCallback&&i.activeCallback(i.spanId,t),n()})).catch((function(t){e(t)}))}))},r.prototype.J=function(t){var i=this;this.store.getItem(t).then((function(n){n&&i.store.removeItem(t).then((function(){e.log.log("remove suc")})).catch((function(t){e.log.warn("remove fail")}))}))},i.ZegoSpan=r},function(t,i,n){"use strict";Object.defineProperty(i,"u",{value:!0}),i.createZegoStore=i.ZegoWechatMiniStore=i.ZEGO_ENV=void 0;var e,s,r=n(12),o=((s=e=i.ZEGO_ENV||(i.ZEGO_ENV={}))[s.BROWSER=0]="BROWSER",s[s.WEIXINMINI=1]="WEIXINMINI",n(3)),u=(h.prototype.getItem=function(t){var i=this;return new Promise((function(n,e){try{n(wx.getStorageSync(i.keyPrefix+t))}catch(n){e(n)}}))},h.prototype.setItem=function(t,i){var n=this;return new Promise((function(e,s){try{wx.setStorageSync(n.keyPrefix+t,i),e()}catch(e){s(e)}}))},h.prototype.removeItem=function(t){var i=this;return new Promise((function(n,e){try{n(wx.removeStorageSync(i.keyPrefix+t))}catch(n){e(n)}}))},h.prototype.clear=function(){return new Promise((function(t,i){try{wx.clearStorageSync(),t()}catch(t){i(t)}}))},h.prototype.keys=function(){var t=this;return new Promise((function(i,n){try{var e=wx.getStorageInfoSync().keys,s=(o.log.warn("keys",e),[]);e.forEach((function(i){0==i.indexOf(t.keyPrefix)&&s.push(i.replace(t.keyPrefix,""))})),o.log.warn("keyArr",JSON.stringify(s)),s.sort(),i(s)}catch(i){n(i)}}))},h);function h(t){this.storeName=t,this.keyPrefix=t+"/",this.storeName}i.ZegoWechatMiniStore=u,i.createZegoStore=function(t,i,n){return i===e.BROWSER?r.createInstance({name:t+":"+(n||"store")}):new u(t)}},function(t,i){t.exports=s},function(t,i,n){"use strict";Object.defineProperty(i,"u",{value:!0}),i.DynamicCode=i.ZegoTracer=i.ZegoSpan=void 0;var e=n(14),s=(Object.defineProperty(i,"ZegoTracer",{enumerable:!0,get:function(){return e.ZegoTracer}}),n(46)),r=(Object.defineProperty(i,"DynamicCode",{enumerable:!0,get:function(){return s.DynamicCode}}),n(10));Object.defineProperty(i,"ZegoSpan",{enumerable:!0,get:function(){return r.ZegoSpan}})},function(t,i,n){"use strict";Object.defineProperty(i,"u",{value:!0}),i.ZegoTracer=void 0;var e=n(15),s=n(21),r=n(10),o=n(22),u=n(3),h=n(1),c=n(8),a=n(23),f=n(39),l=n(11),_=n(44),d=n(45);function v(t){this.q=o.DEFAULT_MAX_SPAN_SIZE,this.level=0,this.log=new _.ZegoLog,this.stateCenter=new d.StateCenter(this.log),this.stateCenter.proxyCtrl=t}v.prototype.init=function(t){this.options=t,this.name=t.product,this.reporter=new a.ZegoDataReport(this.name,this.stateCenter),this.reporter.init({appID:t.appID,env:t.env||0,importantLevel:t.importantLevel,levels:t.levels,deviceID:t.deviceID,bps:t.bps,serverUrl:t.serverUrl}),this.tracer=new e.Tracer({name:this.name,version:t.version},{resource:new c.Resource(t.resources)},this.reporter,{spanStart:t.spanStart,spanBeforeEnd:t.spanBeforeEnd,spanEnd:t.spanEnd}),this.reporter.setProcessData(this.tracer.resource.attributes),this.C(this.options),this.dyStore=l.createZegoStore(t.product+"_"+t.appID+"_dy",t.env||0)},v.prototype.C=function(t){this.rootSpan=this.tracer.startSpan("root",0);var i=h.setSpan(this.tracer.context.active(),this.rootSpan);this.tracer.context.T().M=i,this.rootSpan.end()},v.prototype.createSpan=function(t,i,n){var e,c;return t<=this.level?(e=n&&n.parent?h.setSpan(this.tracer.context.active(),n.parent.span):h.setSpan(this.tracer.context.active(),this.rootSpan),c=[],n&&n.linkSpans&&(n.linkSpans.forEach((function(t){c.push({context:t.span.context()})})),delete n.linkSpans),i=this.tracer.startSpan(i,t,Object.assign({},n,{links:c}),e),t=new r.ZegoSpan(i.spanContext.spanId,i),r.ZegoSpan.tracer=this.tracer,t):(u.log.warn("createSpan level not fix"),new r.ZegoSpan(o.NOOP_SPAN_ID,new s.NoopSpan))},v.prototype.setLogger=function(t){this.stateCenter.logger=t},v.prototype.setTimeOffset=function(t){this.reporter.setTimeOffset(t)},v.prototype.setWaitNtpTimeout=function(t){this.reporter.setWaitNtpTimeout(t)},v.prototype.setLogLevel=function(t){return this.stateCenter.F.setLogLevel(t)},v.prototype.startReport=function(t){return this.reporter.startReport(t)},v.prototype.setConfig=function(t){this.reporter.setConfig(t)},v.prototype.loadJs=function(t,i,n,e,s,r){return f.loadJS(t,this.dyStore,i,n,e,s,r)},v.prototype.flush=function(t){this.reporter.flush(t)},v.prototype.setUnloadState=function(t){this.reporter.setUnloadState(t)},v.prototype.shutdown=function(){this.reporter.saveDataBeforeUnload()},v.prototype.destroy=function(){this.reporter.uninit()},v.prototype.setSampleConfig=function(t){this.level=t.level||this.level},v.prototype.setResource=function(t){this.tracer.setResource(t),this.reporter.setProcessData(this.tracer.resource.attributes)},v.prototype.setNetStateCheck=function(){this.reporter.setNetStateCheck()},i.ZegoTracer=v},function(t,i,n){"use strict";Object.defineProperty(i,"u",{value:!0}),i.Tracer=void 0;var e=n(6),s=n(1),r=n(2),o=n(7),u=n(8),h=n(9),c=n(18),a=n(19);function f(t,i,n,e){var r=a.mergeConfig(i);this.I=r.traceParams,this.k=new o.IdGenerator,this.resource=null!=(r=i.resource)?r:u.Resource.createTelemetrySDKResource(),this.instrumentationLibrary=t,i=Math.random().toString(36).slice(-6);this.context=new s.ContextAPI(i),this.reporter=n,this.spanProcessor=e||{}}f.prototype.startSpan=function(t,i,n,o){var u,a,f,l=function(t,i){if(!t.root)return s.getSpanContext(i)}(n=void 0===n?{}:n,o=void 0===o?this.context.active():o),_=this.k.generateSpanId(),d=(l=(l&&c.isSpanContextValid(l)?(u=l.traceId,a=l.traceState,f=l.spanId):u=this.k.generateTraceId(),null!=(l=n.kind)?l:r.SpanKind.INTERNAL),null!=(d=n.links)?d:[]),v=(n=e.sanitizeAttributes(n.attributes),r.TraceFlags.NONE);return(o=new h.Span(this,o,t,i,{traceId:u,spanId:_,traceFlags:v,traceState:a},l,f,d)).setAttributes(n),this.spanProcessor.spanStart&&this.spanProcessor.spanStart(o),o},f.prototype.setResource=function(t){this.resource=this.resource.merge(new u.Resource(t))},f.prototype.getActiveTraceParams=function(){return this.I},i.Tracer=f},function(t,i,n){"use strict";var e=this&&this.__read||function(t,i){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var e,s,r=n.call(t),o=[];try{for(;(void 0===i||0<i--)&&!(e=r.next()).done;)o.push(e.value)}catch(t){s={error:t}}finally{try{e&&!e.done&&(n=r.return)&&n.call(r)}finally{if(s)throw s.error}}return o},s=this&&this.__spread||function(){for(var t=[],i=0;i<arguments.length;i++)t=t.concat(e(arguments[i]));return t},r=(Object.defineProperty(i,"u",{value:!0}),i.StackContextManager=void 0,n(1));function o(){this.W=!1,this.M=r.ROOT_CONTEXT}o.prototype.K=function(t,i){function n(){for(var n=this,s=[],r=0;r<arguments.length;r++)s[r]=arguments[r];return e.with(i,(function(){return t.apply(n,s)}))}void 0===i&&(i=r.ROOT_CONTEXT);var e=this;return Object.defineProperty(n,"length",{enumerable:!1,configurable:!0,writable:!1,value:t.length}),n},o.prototype.active=function(){return this.M},o.prototype.bind=function(t,i){return void 0===(i=void 0===i?r.ROOT_CONTEXT:i)&&(i=this.active()),"function"==typeof t?this.K(t,i):t},o.prototype.disable=function(){return this.M=r.ROOT_CONTEXT,this.W=!1,this},o.prototype.enable=function(){return this.W||(this.W=!0,this.M=r.ROOT_CONTEXT),this},o.prototype.with=function(t,i,n){for(var e=[],o=3;o<arguments.length;o++)e[o-3]=arguments[o];var u=this.M;this.M=t||r.ROOT_CONTEXT;try{return i.call.apply(i,s([n],e))}finally{this.M=u}},i.StackContextManager=o},function(t,i,n){"use strict";Object.defineProperty(i,"u",{value:!0}),i.getCurrentTime=i.isTimeInput=i.hrTimeToMilliseconds=i.hrTimeDuration=i.timeInputToHrTime=i.isTimeInputHrTime=i.hrTime=void 0;var e=9,s=Math.pow(10,e),r=["00","01","02","03","04","05","06","07","08","09"];function o(t){t/=1e3;var i=Math.trunc(t);return[i,Number((t-i).toFixed(e))*s]}function u(){var t,i=performance.timeOrigin;return"number"!=typeof i?(t=performance).timing&&t.timing.fetchStart:i}function h(t){var i=o(u()),n=(t=o("number"==typeof t?t:performance.now()),i[0]+t[0]);i=i[1]+t[1];return s<i&&(i-=s,n+=1),[n,i]}function c(t){return Array.isArray(t)&&2===t.length&&"number"==typeof t[0]&&"number"==typeof t[1]}i.hrTime=h,i.isTimeInputHrTime=c,i.timeInputToHrTime=function(t){if(c(t))return t;if("number"==typeof t)return(t<u()?h:o)(t);if(t instanceof Date)return o(t.getTime());throw TypeError("Invalid input type")},i.hrTimeDuration=function(t,i){var n=i[0]-t[0];return(i=i[1]-t[1])<0&&(--n,i+=s),[n,i]},i.hrTimeToMilliseconds=function(t){return Math.round(1e3*t[0]+t[1]/1e6)},i.isTimeInput=function(t){return c(t)||"number"==typeof t||t instanceof Date},i.getCurrentTime=function(){var t=new Date;return[t.getFullYear()+"/",(r[t.getMonth()+1]||t.getMonth()+1)+"/",(r[t.getDate()]||t.getDate())+" ",(r[t.getHours()]||t.getHours())+":",(r[t.getMinutes()]||t.getMinutes())+":",r[t.getSeconds()]||t.getSeconds(),"."+t.getTime()%1e3].join("")}},function(t,i,n){"use strict";Object.defineProperty(i,"u",{value:!0}),i.isSpanContextValid=i.isValidSpanId=i.isValidTraceId=i.INVALID_SPAN_CONTEXT=i.INVALID_TRACEID=i.INVALID_SPANID=void 0;n=n(2);var e=/^([0-9a-f]{32})$/i,s=/^[0-9a-f]{16}$/i;function r(t){return e.test(t)&&t!==i.INVALID_TRACEID}function o(t){return s.test(t)&&t!==i.INVALID_SPANID}i.INVALID_SPANID="0000000000000000",i.INVALID_TRACEID="00000000000000000000000000000000",i.INVALID_SPAN_CONTEXT={traceId:i.INVALID_TRACEID,spanId:i.INVALID_SPANID,traceFlags:n.TraceFlags.NONE},i.isValidTraceId=r,i.isValidSpanId=o,i.isSpanContextValid=function(t){return r(t.traceId)&&o(t.spanId)}},function(t,i,n){"use strict";Object.defineProperty(i,"u",{value:!0}),i.mergeConfig=void 0;var e=n(20);i.mergeConfig=function(t){var i=Object.assign({},e.DEFAULT_CONFIG,t);return i.traceParams=Object.assign({},e.DEFAULT_CONFIG.traceParams,t.traceParams||{}),i}},function(t,i,n){"use strict";Object.defineProperty(i,"u",{value:!0}),i.DEFAULT_CONFIG=void 0,i.DEFAULT_CONFIG={traceParams:{numberOfAttributesPerSpan:128,numberOfLinksPerSpan:128,numberOfEventsPerSpan:128}}},function(t,i,n){"use strict";Object.defineProperty(i,"u",{value:!0}),i.NoopSpan=void 0;var e=n(2);function s(t){void 0===t&&(t=e.INVALID_SPAN_CONTEXT),this.X=t}s.prototype.context=function(){return this.X},s.prototype.setAttribute=function(t,i){return this},s.prototype.appendAttribute=function(t,i){return this},s.prototype.setAttributes=function(t){return this},s.prototype.addEvent=function(t,i,n){return this},s.prototype.setStatus=function(t){return this},s.prototype.updateName=function(t){return this},s.prototype.end=function(t){},s.prototype.isRecording=function(){return!1},s.prototype.spanReport=function(){},s.prototype.recordException=function(t,i){},i.NoopSpan=s},function(t,i,n){"use strict";Object.defineProperty(i,"u",{value:!0}),i.NOOP_SPAN_ID=i.SCHEDULED_DELAY_MILLIS=i.DEFAULT_MAX_SPAN_SIZE=i.readSpanKeys=void 0,i.readSpanKeys=["name","level","kind","spanContext","parentSpanId","startTime","endTime","status","attributes","links","events","duration","ended","resource","instrumentationLibrary"],i.DEFAULT_MAX_SPAN_SIZE=1e3,i.SCHEDULED_DELAY_MILLIS=3e3,i.NOOP_SPAN_ID="noop"},function(t,i,n){"use strict";var e=this&&this.__assign||function(){return(e=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var s in i=arguments[n])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t}).apply(this,arguments)},s=this&&this.__awaiter||function(t,i,n,e){return new(n=n||Promise)((function(s,r){function o(t){try{h(e.next(t))}catch(t){r(t)}}function u(t){try{h(e.throw(t))}catch(t){r(t)}}function h(t){var i;t.done?s(t.value):((i=t.value)instanceof n?i:new n((function(t){t(i)}))).then(o,u)}h((e=e.apply(t,i||[])).next())}))},r=this&&this.__generator||function(t,i){var n,e,s,r={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},o={next:u(0),throw:u(1),return:u(2)};return"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){var h=[o,u];if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,e&&(s=2&h[0]?e.return:h[0]?e.throw||((s=e.return)&&s.call(e),0):e.next)&&!(s=s.call(e,h[1])).done)return s;switch(e=0,(h=s?[2&h[0],s.value]:h)[0]){case 0:case 1:s=h;break;case 4:return r.label++,{value:h[1],done:!1};case 5:r.label++,e=h[1],h=[0];continue;case 7:h=r.ops.pop(),r.trys.pop();continue;default:if(!(s=0<(s=r.trys).length&&s[s.length-1])&&(6===h[0]||2===h[0])){r=0;continue}if(3===h[0]&&(!s||h[1]>s[0]&&h[1]<s[3]))r.label=h[1];else if(6===h[0]&&r.label<s[1])r.label=s[1],s=h;else{if(!(s&&r.label<s[2])){s[2]&&r.ops.pop(),r.trys.pop();continue}r.label=s[2],r.ops.push(h)}}h=i.call(t,r)}catch(u){h=[6,u],e=0}finally{n=s=0}if(5&h[0])throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}}},o=this&&this.__read||function(t,i){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var e,s,r=n.call(t),o=[];try{for(;(void 0===i||0<i--)&&!(e=r.next()).done;)o.push(e.value)}catch(t){s={error:t}}finally{try{e&&!e.done&&(n=r.return)&&n.call(r)}finally{if(s)throw s.error}}return o},u=this&&this.__spread||function(){for(var t=[],i=0;i<arguments.length;i++)t=t.concat(o(arguments[i]));return t},h=this&&this.__values||function(t){var i="function"==typeof Symbol&&Symbol.iterator,n=i&&t[i],e=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return{value:(t=t&&e>=t.length?void 0:t)&&t[e++],done:!t}}};throw new TypeError(i?"Object is not iterable.":"Symbol.iterator is not defined.")},c=(Object.defineProperty(i,"u",{value:!0}),i.ZegoDataReport=void 0,n(0)),a=n(24),f=n(30),l=n(38),_=n(5),d=n(4);function v(t,i){this.G=i,this.QUEUE_MAX=100,this.cacheMaxSize=d.CACHE_SIZE.cacheMaxSize,this.cacheDelPer=d.CACHE_SIZE.cacheDelPer,this.state="normal",this.forceDataTotalLen=0,this.reportPackagesSize=0,this.staticConfig={totalAvailCache:d.CACHE_SIZE.totalAvailCache,totalDBSize:d.STORE_SIZE.totalDBSize,bps:1600},this.dataInDb=[],this.listenerList={progressUpdate:[],forceResult:[],postFail:[],dataDroped:[]},this.tempBuffer=[],this.traceType={MEM_I_API:0,MEM_O_DONE:0,MEM_O_DUMP:0,MEM_I_LOAD:0,DB_O_DROP:0,DB_O_DONE:0,DB_I_BACKUP:0},this.isPaused=!1,this.pro="json",this.isLoadReportData=!1,this.dropCount=0,this.timeInterval=!1,this.isWaitNtpTimeout=!1,this.waitNtpTimeout=2e3,this.postDataState="",this.product=t,this.reportMap=new Map}v.prototype.init=function(t){return s(this,void 0,void 0,(function(){var i=this;return r(this,(function(n){switch(n.label){case 0:return this.config=e(e({},d.DEFAULT_CONFIG),t),this.config.env%2!=1&&this.H(),this.zegoService=new a.ZegoService(this.config.env||c.ZEGO_ENV.BROWSER,this.config.bps||d.DEFAULT_CONFIG.bps,this.product,this.pro,this.G),this.zegoService.setLogUrlParams({product:this.product,signature:this.config.token||"",appid:this.config.appID,id_name:this.config.userID||"",deviceid:this.config.deviceID||""}),this.config.serverUrl&&this.zegoService.setLogServer(this.config.serverUrl),this.zegoService.setPostSucCallback(this.product,this.Y.bind(this)),this.zegoService.setPostFailCallback(this.product,(function(t){return s(i,void 0,void 0,(function(){return r(this,(function(i){switch(i.label){case 0:return this.G.logger.warn("zt.zd.i fail"),this.postDataState="fail",this.dropCount++,this.V(t),[4,this.Z(1)];case 1:return i.sent(),this.$("postFail"),[2]}}))}))})),this.tt(),this.storeHandler=new f.ZegoStoreHandler(this.product+"_"+this.config.appID+"_datareporter",_.uuid(6),this.config,this.traceType,this.staticConfig,this.G),this.storeHandler.setDropCallBack((function(t){i.traceType.DB_O_DROP+=_.calculateMemSize(t),i.$("dataDroped",t)})),[4,this.storeHandler.loadPendingData()];case 1:return n.sent(),this.storeHandler.init().then((function(){i.it()})).catch((function(t){console.warn(t)})),this.nt(),this.rt(),this.et(),[2]}}))}))},v.prototype.uninit=function(){this.isWaitNtpTimeout=!1,this.ntpTimer&&(clearTimeout(this.ntpTimer),this.ntpTimer=null),this.zegoService.destroy()},v.prototype.setConfig=function(t){"object"==typeof t&&"number"==typeof t.bps&&(this.config.bps=t.bps,this.zegoService.setBps(this.config.bps)),"object"==typeof t&&"number"==typeof t.totalDBSize&&(this.staticConfig.totalDBSize=t.totalDBSize),"object"==typeof t&&"string"==typeof t.serverUrl&&""!==t.serverUrl&&(this.config.serverUrl=t.serverUrl,this.zegoService.setLogServer(this.config.serverUrl))},v.prototype.pause=function(){this.isPaused=!0},v.prototype.resume=function(){this.isPaused=!1;var t=(i=this.pendingQueue.getPendingDataInfo()).pendingDataSize,i=i.size;this.st(t,i)},v.prototype.startReport=function(t){var i=t.get("userID"),n=t.get("token");return!(!i||"string"!=typeof i||!n||"string"!=typeof n||(this.startCommonField=t,this.config.userID=i,this.config.token=n,this.zegoService.setLogUrlParams({product:this.product,signature:this.config.token,appid:this.config.appID,id_name:this.config.userID||"",deviceid:this.config.deviceID||""}),this.ut()&&this.ot(),(i=t.get("serverUrl"))&&(this.config.serverUrl=i,this.zegoService.setLogServer(this.config.serverUrl)),this.isConfigOK(this.config)&&(t=(n=this.pendingQueue.getPendingDataInfo()).pendingDataSize,i=n.size,this.st(t,i)),0))},v.prototype.setTimeOffset=function(t){var i=this;this.clientTimeOffset=t,this.tempBuffer.forEach((function(t){(t=t.data).tags.time_offset||(t.tags.time_offset=i.clientTimeOffset)})),this.config.userID&&this.ot()},v.prototype.setProcessData=function(t){this.G.processData=t},v.prototype.on=function(t,i){return this.ht(t,i)},v.prototype.off=function(t,i){return this.ct(t,i)},v.prototype.report=function(t,i){var n;if(15e3<t.length)return!1;try{n=JSON.parse(t)}catch(t){return!1}return this.G.F.debug(t+" "+i),(null!=n&&n.id_name||null!=(t=null==n?void 0:n.tags)&&t.id_name||this.config.userID)&&this.ut()?(null!=n&&n.id_name||null!=(t=null==n?void 0:n.tags)&&t.id_name?this.clientTimeOffset&&(n.tags.time_offset=this.clientTimeOffset):(this.clientTimeOffset&&(n.tags.time_offset=this.clientTimeOffset),n.tags.id_name=this.config.userID),this.ft(JSON.stringify(n),i)):this.tempBuffer.push({data:n,level:i}),!0},v.prototype.setUnloadState=function(t){this.unloadLevel=t,this.state="unload"},v.prototype.ft=function(t,i){var n=this,e=_.calculateMemSize(t),s=(this.traceType.MEM_I_API+=e,c.getSeq()),r=(new Date).getTime(),o={seq:s,content:t,level:i,timestamp:r};"unload"===this.state?void 0!==this.unloadLevel&&i<=this.unloadLevel?(this.storeHandler.saveDataToStorage(o),this.pendingQueue.enqueue(o,i)):this.G.F.debug("level is low"):i<=this.config.importantLevel?(o.key=i+"_"+r+"_"+s,this.dataInDb.push(o.key),this.storeHandler.storeData(o).then((function(t){n.pendingQueue.enqueue(o,i),n.traceType.DB_I_BACKUP+=e})).catch((function(t){var e=n.dataInDb.findIndex((function(t){return t===o.key}));-1<e&&n.dataInDb.splice(e,1),n.pendingQueue.enqueue(o,i)}))):this.pendingQueue.enqueue(o,i),"force"===this.state&&(r=_.calculateMemSize(t),this.forceDataTotalLen+=r)},v.prototype.ut=function(){return this.isWaitNtpTimeout||void 0!==this.clientTimeOffset},v.prototype.ot=function(){var t,i=this.tempBuffer.shift();i&&(t=i.data,i=i.level,t.tags.id_name=this.config.userID,this.ft(JSON.stringify(t),i),this.ot())},v.prototype.isConfigOK=function(t){return""!==t.userID&&""!==t.token&&""!==t.server},v.prototype.testSize=function(t){},v.prototype.flush=function(t){var i;"force"!==this.state&&(this.state="force",i=16e6,"object"==typeof t&&"number"==typeof t.bps&&(i=t.bps),this.zegoService.setBps(i),this.forceDataTotalLen=this.storeHandler.storeSize+this.pendingQueue.pendingDataSize+this.reportPackagesSize,i=(t=this.pendingQueue.getPendingDataInfo()).pendingDataSize,t=t.size,0<i?this.st(i,t):this.it())},v.prototype.setWaitNtpTimeout=function(t){this.waitNtpTimeout=t},v.prototype.rt=function(){var t=this;this.ntpTimer=setTimeout((function(){t.isWaitNtpTimeout=!0,t.config.userID&&t.ot()}),this.waitNtpTimeout)},v.prototype.nt=function(){var t=this,i=(this.G.F.debug("startReportTimer "+new Date),this.timeInterval=!0,(n=this.pendingQueue.getPendingDataInfo()).pendingDataSize),n=n.size;this.st(i,n),this.reportTimer=window.setTimeout((function(){t.nt()}),3e4)},v.prototype.et=function(){return s(this,void 0,void 0,(function(){var t,i,n=this;return r(this,(function(e){switch(e.label){case 0:return i=this.pendingQueue.getPendingDataInfo(),t=i.pendingDataSize,i=i.size,t>this.config.reportSize||i>this.config.reportNum?[4,this.st(t,i)]:[3,2];case 1:return e.sent(),[3,3];case 2:this.it(),e.label=3;case 3:return this.checkDataTimer=window.setTimeout((function(){n.et()}),15e3),[2]}}))}))},v.prototype.H=function(){var t=this,i=navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPhone/i);navigator.userAgent.indexOf("Firefox"),window.addEventListener(i?"pagehide":"beforeunload",(function(){window.event&&(window.event.cancelBubble=!0),t.saveDataBeforeUnload()}))},v.prototype.saveDataBeforeUnload=function(){(t=this.pendingQueue.readStoreData(1)).totalLen;var t=t.storeArr,i=(this.storeHandler.resetCommonStore(),[]);i.push.apply(i,u(t)),t=this.zegoService.readReportQueueData();i.push.apply(i,u(t)),0<i.length&&this.storeHandler.storePendingData(i)},v.prototype.setNetStateCheck=function(){"fail"===this.postDataState&&this.zegoService.handleNetConnect()},v.prototype.Y=function(t,i,n){return s(this,void 0,void 0,(function(){var n,e,s,o,u,h=this;return r(this,(function(r){switch(r.label){case 0:for(this.G.F.debug("post suc"),this.postDataState="suc",t.forEach((function(t){h.traceType.MEM_O_DONE+=_.calculateMemSize(t.content)})),n=function(i){var n=t[i];e.storeHandler.removeDataItem(n).then((function(t){n.key&&h.reportMap.delete(n.key)})).catch((function(t){}))},e=this,s=0;s<t.length;s++)n(s);return this.reportPackagesSize-=i,u=this.pendingQueue.getPendingDataInfo(),o=u.pendingDataSize,u=u.size,o>this.config.reportSize||u>this.config.reportNum?[4,this.st(o,u)]:[3,2];case 1:return r.sent(),[3,3];case 2:this.it(),r.label=3;case 3:return"force"===this.state&&0==this.reportPackagesSize&&(o=this.reportPackagesSize+this.pendingQueue.pendingDataSize+this.storeHandler.storeSize,u=1-Number((o/this.forceDataTotalLen).toFixed(2)),this.listenerList.progressUpdate&&this.$("progressUpdate",u),0<this.storeHandler.storeSize)&&this.it((function(t){0===t&&(h.state="normal",h.zegoService.setBps(h.config.bps||d.DEFAULT_CONFIG.bps),h.listenerList.forceSuccessCallback)&&h.$("forceResult","SUCCESS")})),[2]}}))}))},v.prototype.st=function(t,i){return s(this,void 0,void 0,(function(){var n,e,s,o,u;return r(this,(function(r){switch(r.label){case 0:return t>this.config.reportSize||i>this.config.reportNum||["force","unload"].includes(this.state)||this.timeInterval?(this.timeInterval=!1,!this.isPaused&&this.config.userID&&this.config.token&&this.config.serverUrl?[3,3]:(this.G.F.debug("isPaused "+this.isPaused+" "+this.userID+" "+this.config.token+" "+this.config.serverUrl),t>=this.cacheMaxSize||this.staticConfig.totalAvailCache<=0?[4,this.Z(this.cacheDelPer)]:[3,2])):[3,7];case 1:r.sent(),r.label=2;case 2:return[2];case 3:return this.zegoService.reportAllowed()?[3,6]:(this.zegoService.resumeReport(),t>=this.cacheMaxSize||this.staticConfig.totalAvailCache<=0?[4,this.Z(this.cacheDelPer)]:[3,5]);case 4:r.sent(),r.label=5;case 5:return[2];case 6:if(s=this.pendingQueue.readReportData(this.config.reportSize),n=s.totalLen,s=s.reportDataArr,n<=0)return[2];for(s=this.at(s),e=s.packageArr,s=s.packageLen,this.zegoService.report(e,s,this.product,"unload"===this.state),o=0;o<e.length;o++)u=e[o],this.reportMap.set(u.key,u);this.reportPackagesSize+=s,this.pendingQueue.refresh(n),r.label=7;case 7:return[2]}}))}))},v.prototype.tt=function(){var t=this;this.pendingQueue=new l.PendingQueue(this.config.levels,this.product,this.staticConfig,this.G),this.pendingQueue.setListener({enCallback:function(i,n,e){return s(t,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return[4,this.st(e,n)];case 1:return t.sent(),[2]}}))}))}})},v.prototype.lt=function(){var t=this;this.storeHandler.readStoreDataItem().then((function(i){var n=_.calculateMemSize(i.content);t.traceType.MEM_I_LOAD+=n,t.pendingQueue.enqueue(i,i.level)})).catch((function(t){}))},v.prototype.Z=function(t){return s(this,void 0,void 0,(function(){var i,n,e,s,o,u,c,a,f;return r(this,(function(l){switch(l.label){case 0:n=this.pendingQueue.readStoreData(t),i=n.totalLen,n=n.storeArr,e=function(t){var n,e;return r(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,s.vt(t,i)];case 1:return r.sent(),n=t.level+"_"+t.timestamp+"_"+t.seq,-1<(e=s.dataInDb.findIndex((function(t){return t===n})))&&s.dataInDb.splice(e,1),[3,3];case 2:return r.sent(),[3,3];case 3:return[2]}}))},s=this,l.label=1;case 1:l.trys.push([1,6,7,8]),o=h(n),u=o.next(),l.label=2;case 2:return u.done?[3,5]:(c=u.value,[5,e(c)]);case 3:l.sent(),l.label=4;case 4:return u=o.next(),[3,2];case 5:return[3,8];case 6:return c=l.sent(),a={error:c},[3,8];case 7:try{u&&!u.done&&(f=o.return)&&f.call(o)}finally{if(a)throw a.error}return[7];case 8:return[2]}}))}))},v.prototype.V=function(t){var i=this;t.length&&t.forEach((function(t){i.storeHandler.storeData(t).then((function(n){var e=_.calculateMemSize(t.content);i.traceType.MEM_O_DUMP+=e})).catch((function(t){}))}))},v.prototype.vt=function(t,i){var n=this;return new Promise((function(i,e){return s(n,void 0,void 0,(function(){var n;return r(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,this.storeHandler.storeData(t)];case 1:return s.sent(),n=_.calculateMemSize(t.content),this.traceType.MEM_O_DUMP+=n,i(),[3,3];case 2:return n=s.sent(),e(n),[3,3];case 3:return[2]}}))}))}))},v.prototype.it=function(t){var i=this;this.storeHandler.storeSize<=0||this.isLoadReportData||(this.isLoadReportData=!0,this.storeHandler.loadDBData(this.config.reportSize,5,Math.floor(this.cacheMaxSize/3),(function(t){return-1<i.dataInDb.indexOf(t)})).then((function(n){i.isLoadReportData=!1,n.datas.forEach((function(t){var n;i.reportMap.has(t.key)||i.pendingQueue.findInQueue(t)||(n=_.calculateMemSize(t.content),i.traceType.MEM_I_LOAD+=n,i.pendingQueue.enqueue(t,t.level),i.dataInDb.push(t.key))})),t&&t(n.len)})).catch((function(t){i.isLoadReportData=!1})))},v.prototype.at=function(t){var i=this,n=0;return t.forEach((function(t){var e,s,r=JSON.parse(t.content);if(i.startCommonField)try{for(var u=h(i.startCommonField),c=u.next();!c.done;c=u.next()){var a=o(c.value,2),f=a[0],l=a[1];"userID"!==f&&"token"!==f&&"serverUrl"!==f&&(r[f]=l)}}catch(t){e={error:t}}finally{try{c&&!c.done&&(s=u.return)&&s.call(u)}finally{if(e)throw e.error}}n+=_.calculateMemSize(r),t.content=JSON.stringify(r)})),{packageArr:t,packageLen:n}},v.prototype.ht=function(t,i){return!!this.listenerList[t]&&"function"==typeof i&&(-1==this.listenerList[t].indexOf(i)&&this.listenerList[t].push(i),!0)},v.prototype.ct=function(t,i){var n;return!!this.listenerList[t]&&(n=this.listenerList[t],i?n.splice(n.indexOf(i),1):this.listenerList[t]=[],!0)},v.prototype.$=function(t){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];this.listenerList[t]&&this.listenerList[t].forEach((function(t){try{t.apply(void 0,u(i))}catch(t){}}))},i.ZegoDataReport=v},function(t,i,n){"use strict";var e=this&&this.__read||function(t,i){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var e,s,r=n.call(t),o=[];try{for(;(void 0===i||0<i--)&&!(e=r.next()).done;)o.push(e.value)}catch(t){s={error:t}}finally{try{e&&!e.done&&(n=r.return)&&n.call(r)}finally{if(s)throw s.error}}return o},s=this&&this.__spread||function(){for(var t=[],i=0;i<arguments.length;i++)t=t.concat(e(arguments[i]));return t},r=(Object.defineProperty(i,"u",{value:!0}),i.ZegoService=void 0,n(0)),o=n(25),u=n(29),h=n(4);function c(t,i,n,e,s){var u,h,c,a=this;this.dt=t,this.yt=n,this.wt=e,this.G=s,this.isDestroy=!1,this.websocket=null,this.packageLen=0,this.packagesDataSize=0,this.PACKAGE_MAX_LEN=5,this.msgID=0,this.logUploadTimer=null,this.logUploadInterval=1e4,this.logCacheSend=[],this.logCacheMax=100,this.bt=1e3,this.postSucCallbackList={},this.postFailCallbackList={},this.failCount=0,this.failStartTime=0,this.netWorkFail=!1,this.networkState=r.ENUM_NETWORK_STATE.online,this.state=r.ENUM_CONNECT_STATE.disconnected,this.gt=(h=u=0,c=function(){h=u=0},{onOpen:function(){u=performance.now()},onClose:function(){0<u&&(performance.now()-u<100?(h++,a.G.logger.info("zt.rzs.wfsc frequently shutdown.")):c())},isOutOfMaxTimes:function(){return 10<=h}}),this.bindWindowListener(),this.networkState=r.ENUM_NETWORK_STATE.online,this.service=new o.LogService(t,n,e,s),this.setBps(i),this.reportQueue=new r.Queue}c.prototype.destroy=function(){var t;null!=(t=this.websocket)&&t.close(),this.service.closeSocket(),this.logUploadTimer&&clearTimeout(this.logUploadTimer),this.reportQueue.clear(),this.isDestroy=!0},c.prototype.bindWindowListener=function(){var t=this;window.addEventListener("offline",(function(){t.networkState=r.ENUM_NETWORK_STATE.offline})),window.addEventListener("online",(function(i){t.handleNetConnect()}))},c.prototype.handleNetConnect=function(){this.networkState=r.ENUM_NETWORK_STATE.online;var t=this.url;this.url="",this.setLogServer(t),this.netWorkFail=!1},c.prototype.setLogServer=function(t){try{return t.startsWith("wss:")||t.startsWith("ws:")?(this.logType=r.ENUM_REMOTE_TYPE.WEBSOCKET,this._t(t)):t.startsWith("https:")||t.startsWith("http:")?(this.logType=r.ENUM_REMOTE_TYPE.HTTPS,this.Ot(t)):this.logType=r.ENUM_REMOTE_TYPE.DISABLE,!0}catch(t){return!1}},c.prototype.setLogUrlParams=function(t){this.logParams=t},c.prototype._t=function(t){var i=this;this.url!=t&&(this.url=t)&&(this.St(),this.logParams.id_name)&&(this.gt.isOutOfMaxTimes()?(this.G.logger.warn("zt.rzs.owsls frequently shutdown too many times. cannot create socket anymore."),this.state=r.ENUM_CONNECT_STATE.disconnected):(this.state=r.ENUM_CONNECT_STATE.connecting,t+="?product="+this.logParams.product+"&appid="+this.logParams.appid+"&token="+encodeURIComponent(this.logParams.signature)+"&deviceid="+this.logParams.deviceid+"&id_name="+this.logParams.id_name,this.service.createSocket(t),this.service.openHandler((function(){i.service.onPush(),i.service.startCheck(),i.G.logger.info("zt.rzs.owsls socket open"),i.openHandler(),i.gt.onOpen()})),this.service.closeHandler((function(t){i.G.logger.warn("zt.rzs.owsls socket close "+JSON.stringify(t.code||t)),i.state=r.ENUM_CONNECT_STATE.disconnected,i.service.closeSocket(),i.gt.onClose()})),this.service.errorHandler((function(t){i.G.logger.warn("zt.rzs.owsls socket error "+JSON.stringify(t.code||t)),i.state=r.ENUM_CONNECT_STATE.disconnected,i.service.closeSocket()}))))},c.prototype.St=function(){this.service.closeSocket()},c.prototype.Ot=function(t){(this.url=t)&&this.Mt()},c.prototype.Mt=function(){this.logUploadTimer&&(clearInterval(this.logUploadTimer),this.logUploadTimer=null)},c.prototype.Et=function(t,i,n,e){this.dt===r.ZEGO_ENV.BROWSER?this.jt(t,i,n,e):this.SendHttpsLogWeChatMini(t,i,n,e)},c.prototype.jt=function(t,i,n,e){var s=this,r=(t=JSON.stringify({body:{data:t}}),new XMLHttpRequest);r.onreadystatechange=function(){if(4==r.readyState)if(200==r.status){if(0!=r.responseText.length)try{var t=JSON.parse(r.responseText).interval;"number"==typeof t&&s.logUploadInterval!==t&&s.Ot(s.url),n&&n()}catch(t){e&&e()}}else e&&e()},r.open("POST",this.url,!0),r.send(t)},c.prototype.SendHttpsLogWeChatMini=function(t,i,n,e){var s=this;t={appid:this.logParams.appid+"",timestamp:(new Date).getTime()+"",token:this.logParams.signature,id_name:this.logParams.id_name,product:this.logParams.product,message_id:++this.msgID,req_sdk:1,s:JSON.stringify({speed_detail:t})};wx.request({url:this.url,data:JSON.stringify(t),method:"POST",success:function(t){0!=t.data.length&&("number"==typeof(t=t&&t.data&&t.data.interval)&&s.logUploadInterval!==t&&s.Ot(s.url),n)&&n()},fail:function(t){e&&e()}})},c.prototype.openHandler=function(){this.state=r.ENUM_CONNECT_STATE.connected,this.startReport()},c.prototype.setPostSucCallback=function(t,i){this.postSucCallbackList[t]=i},c.prototype.setPostFailCallback=function(t,i){this.postFailCallbackList[t]=i},c.prototype.reportAllowed=function(){return this.packageLen<this.PACKAGE_MAX_LEN},c.prototype.report=function(t,i,n,e){this.packageLen++,this.packagesDataSize+=i,this.reportQueue.enqueue({reportDatas:t,dataLen:i,product:n}),this.netWorkFail=!1,this.failCount=0,this.failStartTime=0,this.startReport(e)},c.prototype.setBps=function(t){this.tokenBucket=new u.TokenBucket(h.BUCKET_CONFIG.bucketSize,t/8,"sec")},c.prototype.startReport=function(t){var i,n,e,s,o=this;this.isDestroy||(this.logType===r.ENUM_REMOTE_TYPE.WEBSOCKET&&this.state===r.ENUM_CONNECT_STATE.disconnected?(i=this.url,this.url="",this.setLogServer(i)):0<this.reportQueue.size()&&(i=this.reportQueue.dequeue(),n=i.reportDatas,e=i.dataLen,s=i.product,new Date,t?this.sendReport(n,e,s):this.tokenBucket.removeTokens(e,(function(){o.sendReport(n,e,s)}))))},c.prototype.Tt=function(){if(this.failCount<=0)return!1;1==this.failCount&&(this.failStartTime=Date.now());var t=(Date.now()-this.failStartTime)/1e3;return this.failCount>=h.FAIL_COUNT&&t>h.FAIL_TIME||this.failCount>=h.FAIL_MAX_COUNT},c.prototype.sendReport=function(t,i,n){var e=this;this.reportData(t,i,n,(function(){e.failCount=0,e.failStartTime=0,e.packageLen--,e.packagesDataSize-=i,e.postSucCallbackList[n]&&e.postSucCallbackList[n](t,i,n)}),(function(s){var r;e.reportQueue.enqueue({reportDatas:t,dataLen:i,product:n}),e.failCount++,e.Tt()?(e.netWorkFail=!0,r=e.decodeReportQueue(),Object.keys(e.postFailCallbackList).forEach((function(t){e.postFailCallbackList[n](r[t])}))):e.startReport()}))},c.prototype.resumeReport=function(){!0===this.netWorkFail&&this.networkState===r.ENUM_NETWORK_STATE.online&&(this.netWorkFail=!1,this.startReport())},c.prototype.reportData=function(t,i,n,e,s){var o=this,u=[];t.forEach((function(t){u.push(JSON.parse(t.content))})),this.logType==r.ENUM_REMOTE_TYPE.WEBSOCKET?this.networkState===r.ENUM_NETWORK_STATE.offline?s&&s(r.errorList.BROKEN):this.service.sendMessage("report",u,e,(function(t){var i;o.state===r.ENUM_CONNECT_STATE.disconnected&&t===r.SOCKET_DISCONNECT&&(i=o.url,o.url="",o.setLogServer(i)),s&&s(t)})):this.logType==r.ENUM_REMOTE_TYPE.HTTPS&&this.Et(u,i,e,(function(){s&&s()}))},c.prototype.unsigned2signed=function(t){var i=parseInt(t,10);if(256<i)return i%256;for(var n=[];0<i;)i%2!=0?n.push(1):n.push(0),i=Number(i/2);for(n.reverse();n.length<8;)n.unshift(0);var e="";if(1==(n=n.join("")).substr(0,1)){for(var s=1;s<n.length;s++)1==n.substr(s,1)?e+=0:e+=1;return"-"+(parseInt(e,2)+1)}for(s=0;s<n.length;s++)e+=n.substr(s,1);return parseInt(e,2)},c.prototype.decodeReportQueue=function(){for(var t={},i=this.reportQueue.size(),n=0;n<i;n++){var e=this.reportQueue.dequeue(),r=e.reportDatas,o=e.dataLen;t[e=e.product]||(t[e]=[]),t[e]=s(t[e],r),this.reportQueue.enqueue({reportDatas:r,dataLen:o,product:e})}return t},c.prototype.readReportQueueData=function(){for(var t=[],i=this.reportQueue.size(),n=0;n<i;n++){var e=this.reportQueue.dequeue(),r=e.reportDatas;e.dataLen,e.product,t.push.apply(t,s(r))}return t},i.ZegoService=c},function(t,i,n){"use strict";Object.defineProperty(i,"u",{value:!0}),i.LogService=void 0;var e=n(26),s=n(4),r=n(0);function o(t,i,n,s){this.dt=t,this.yt=i,this.wt=n,this.G=s,this.Nt=new e.ZegoSocketService(this.dt,this.yt,this.wt,this.G),this.At=0,this.Rt={}}o.prototype.It=function(t){var i,n,e=this,s=this.Nt.sendCommandMap[t.messageId||(null==(s=null==t?void 0:t.data)?void 0:s.message_id)];null!=s&&(n=s.v,delete this.Nt.sendCommandMap[t.messageId||(null==(i=null==t?void 0:t.data)?void 0:i.message_id)],this.Nt.sendCommandList.remove(s),0===t.code?setTimeout((function(){n&&null!=n.success&&n.success(t,e.At)}),0):setTimeout((function(){n&&null!=n.error&&n.error(t,e.At)}),0))},o.prototype.onPush=function(){var t=this;this.Nt.onMessage=function(i){t.It(i)}},o.prototype.closeHandler=function(t){this.Nt.closeHandler(t)},o.prototype.openHandler=function(t){this.Nt.openHandler(t)},o.prototype.errorHandler=function(t){this.Nt.errorHandler(t)},o.prototype.kt=function(t){return{Protocol:"req",cmd:t,appid:123,seq:++this.At,session_id:""}},o.prototype.startCheck=function(){this.Nt.startCheck()},o.prototype.stopCheck=function(){this.Nt.stopCheck()},o.prototype.isDisConnect=function(){return!this.Nt||this.Nt.isDisConnect()},o.prototype.createSocket=function(t){this.Nt.createSocket(t),this.Rt={}},o.prototype.closeSocket=function(){this.Nt.closeSocket()},o.prototype.sendMessage=function(t,i,n,e,o,u){return this.Nt.isDisConnect()?(e&&e(r.SOCKET_DISCONNECT),0):(o=o||this.kt(t),this.Nt.sendMessage(o,i,n,e,{timeOut:1e3*s.DEFAULT_CONFIG.netTimeout}))},o.prototype.on=function(t,i){this.Rt[t]=i},i.LogService=o},function(t,i,n){"use strict";var e=this&&this.__assign||function(){return(e=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var s in i=arguments[n])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t}).apply(this,arguments)},s=(Object.defineProperty(i,"u",{value:!0}),i.ZegoSocketService=void 0,n(27)),r=n(0),o=n(28);function u(t,i,n,e){this.yt=i,this.wt=n,this.G=e,this.Dt=null,this.sendCommandList=new r.LinkedList,this.sendCommandMap={},this.xt=100,this.Pt=3e4,this.Bt=2e3,this.ENV=t}u.prototype.createSocket=function(t){this.Dt=s.createZegoWebSocket(t,this.ENV,this.G.proxyCtrl),this.Dt.binaryType="arraybuffer"},u.prototype.closeSocket=function(){this.Dt&&(this.Dt.onclose=null,this.Dt.onerror=null,this.Dt.close(),this.Dt=null)},u.prototype.isDisConnect=function(){return!this.Dt||1!==this.Dt.readyState},u.prototype.sendMessage=function(t,i,n,s,r){void 0===n&&(n=null),void 0===s&&(s=null),void 0===r&&(r={timeOut:6e3});var u=e(e({},this.G.processData),{time_upload:Date.now()});u={data:i={message_id:t.seq,product:this.yt,s:JSON.stringify({speed_detail:i,process:u})},seq:t.seq,deleted:!1,sendTime:Date.parse(new Date+""),timeOut:r.timeOut,success:n,error:s},r=this.sendCommandList.push(u);return this.sendCommandMap[u.seq]=r,this.Dt&&"pb"!==this.wt&&(this.G.F.debug("upload data",JSON.stringify(i)),n=o.deflate(JSON.stringify(i)),this.Dt.send(n)),t.seq},u.prototype.Ut=function(t){for(var i=t.getFirst();null!=i;)t.remove(i),i.v&&i.v.error&&setTimeout((function(){i&&i.v&&i.v.error&&i.v.error(r.errorList.TIMEOUT,i.v.data.message_id,i.v.data.s)}),0),i=t.getFirst()},u.prototype.zt=function(t,i){for(var n=t.getFirst(),e=Date.parse(new Date+""),s=0;!(null==n||n.v&&n.v.sendTime+n.v.timeOut>e||(n.v&&delete i[n.v.data.message_id],t.remove(n),!(n.v&&null==n.v.error||n.v&&n.v.sendTime+this.Pt<e)&&n&&n.v&&n.v.error&&n.v.error(r.errorList.TIMEOUT,n.v.data.message_id,n.v.data.s),++s>=this.xt));)n=t.getFirst()},u.prototype.startCheck=function(){var t=this;this.zt(this.sendCommandList,this.sendCommandMap),this.Lt=setTimeout((function(){t.startCheck()}),this.Bt)},u.prototype.stopCheck=function(){this.Ut(this.sendCommandList),clearTimeout(this.Lt)},u.prototype.openHandler=function(t){var i=this;this.Dt&&(this.Dt.onopen=function(n){i.responseHandler(),t(n)})},u.prototype.responseHandler=function(){var t=this;this.Dt&&(this.Dt.onmessage=function(i){i="string"==typeof i.data?JSON.parse(i.data):JSON.parse(String.fromCharCode.apply(null,new Uint8Array(i.data))),t.onMessage(i)})},u.prototype.closeHandler=function(t){this.Dt&&(this.Dt.onclose=function(i){t(i)})},u.prototype.errorHandler=function(t){this.Dt&&(this.Dt.onerror=t)},u.prototype.onMessage=function(t){},i.ZegoSocketService=u},function(t,i,n){"use strict";Object.defineProperty(i,"u",{value:!0}),i.createZegoWebSocket=i.ZegoWeiXinMiniWebSocket=void 0;var e=n(0),s=(r.prototype.init=function(){var t=this;this.Jt&&(this.readyState=0,this.Jt.onOpen((function(i){t.readyState=t.Jt.readyState,"function"==typeof t.onopen&&(t.onopen(i),t.Jt.onClose((function(i){t.readyState=t.Jt.readyState,"function"==typeof t.onclose&&t.onclose(i)})),t.Jt.onMessage((function(i){"function"==typeof t.onmessage&&t.onmessage(i)})))})),this.Jt.onError((function(i){t.readyState=t.Jt.readyState,"function"==typeof t.onerror&&t.onerror(i)})))},r.prototype.onopen=function(t){},r.prototype.onerror=function(t){},r.prototype.onclose=function(t){},r.prototype.onmessage=function(t){},r.prototype.send=function(t){this.Jt&&this.Jt.send({data:t})},r.prototype.close=function(){this.Jt&&this.Jt.close()},r);function r(t,i){this.url=t,this.readyState=3,this.Jt=wx.connectSocket({url:t}),this.init()}i.ZegoWeiXinMiniWebSocket=s,i.createZegoWebSocket=function(t,i,n){return i%2===e.ZEGO_ENV.BROWSER?(i=t,n?n.createSocket(i):new WebSocket(i)):new s(t)}},function(t,i){t.exports=r},function(t,i,n){"use strict";function e(t,i,n,e){if(this.bucketSize=1,this.tokensPerInterval=1,this.interval=1e3,this.parentBucket=null,this.content=0,this.lastDrip=0,this.bucketSize=t,this.tokensPerInterval=i,"string"==typeof n)switch(n){case"sec":case"second":this.interval=1e3;break;case"min":case"minute":this.interval=6e4;break;case"hr":case"hour":this.interval=36e5;break;case"day":this.interval=864e5;break;default:throw new Error("Invaid interval "+n)}else this.interval=n;this.parentBucket=e,this.content=0,this.lastDrip=+new Date}Object.defineProperty(i,"u",{value:!0}),i.TokenBucket=void 0,e.prototype.removeTokens=function(t,i){var n=this;return this.bucketSize?t>this.bucketSize?(setTimeout(i.bind(null,"Requested tokens "+t+" exceeds bucket size "+this.bucketSize,null),0),!1):(this.drip(),t>this.content?e():this.parentBucket?this.parentBucket.removeTokens(t,(function(s,r){return s?i(s,null):t>n.content?e():(n.content-=t,void i(null,Math.min(r,n.content)))})):(this.content-=t,setTimeout(i.bind(null,null,this.content),0),!0)):(setTimeout(i.bind(null,null,t,Number.POSITIVE_INFINITY),0),!0);function e(){var e=Math.ceil((t-n.content)*(n.interval/n.tokensPerInterval));return setTimeout((function(){n.removeTokens(t,i)}),e),!1}},e.prototype.tryRemoveTokens=function(t){if(this.bucketSize){if(t>this.bucketSize)return!1;if(this.drip(),t>this.content)return!1;if(this.parentBucket&&!this.parentBucket.tryRemoveTokens(t))return!1;this.content-=t}return!0},e.prototype.drip=function(){var t,i;this.tokensPerInterval?(i=+new Date,t=Math.max(i-this.lastDrip,0),this.lastDrip=i,i=t*(this.tokensPerInterval/this.interval),this.content=Math.min(this.content+i,this.bucketSize)):this.content=this.bucketSize},i.TokenBucket=e},function(t,i,n){"use strict";var e=this&&this.__awaiter||function(t,i,n,e){return new(n=n||Promise)((function(s,r){function o(t){try{h(e.next(t))}catch(t){r(t)}}function u(t){try{h(e.throw(t))}catch(t){r(t)}}function h(t){var i;t.done?s(t.value):((i=t.value)instanceof n?i:new n((function(t){t(i)}))).then(o,u)}h((e=e.apply(t,i||[])).next())}))},s=this&&this.__generator||function(t,i){var n,e,s,r={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},o={next:u(0),throw:u(1),return:u(2)};return"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){var h=[o,u];if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,e&&(s=2&h[0]?e.return:h[0]?e.throw||((s=e.return)&&s.call(e),0):e.next)&&!(s=s.call(e,h[1])).done)return s;switch(e=0,(h=s?[2&h[0],s.value]:h)[0]){case 0:case 1:s=h;break;case 4:return r.label++,{value:h[1],done:!1};case 5:r.label++,e=h[1],h=[0];continue;case 7:h=r.ops.pop(),r.trys.pop();continue;default:if(!(s=0<(s=r.trys).length&&s[s.length-1])&&(6===h[0]||2===h[0])){r=0;continue}if(3===h[0]&&(!s||h[1]>s[0]&&h[1]<s[3]))r.label=h[1];else if(6===h[0]&&r.label<s[1])r.label=s[1],s=h;else{if(!(s&&r.label<s[2])){s[2]&&r.ops.pop(),r.trys.pop();continue}r.label=s[2],r.ops.push(h)}}h=i.call(t,r)}catch(u){h=[6,u],e=0}finally{n=s=0}if(5&h[0])throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}}},r=this&&this.__importDefault||function(t){return t&&t.u?t:{default:t}},o=(Object.defineProperty(i,"u",{value:!0}),i.ZegoStoreHandler=void 0,n(11)),u=n(5),h=n(4),c=r(n(12));function a(t,i,n,e,s,r){this.O=t,this.qt=i,this.Ct=n,this.Ft=e,this.Wt=s,this.G=r,this.storeSize=0,this.storeTime=0,this.storeDelPer=h.STORE_SIZE.storeDelPer,this.updateTimeFreq=6e4,this.storeSleepInterval=6e5,this.droping=!1,this.bufferData=[],this.updateTimer=null,this.interSymbol="#",this.drops=[],this.storesKeys="",this.transStores=[],this.store=o.createZegoStore(t,n.env,i),this.commonStore=o.createZegoStore("data_common",n.env,"reporter")}Object.defineProperty(a.prototype,"Kt",{get:function(){return"z_t_"+this.Ct.appID},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"Xt",{get:function(){return"z_store_keys"},enumerable:!1,configurable:!0}),a.prototype.init=function(){return e(this,void 0,void 0,(function(){var t,i;return s(this,(function(n){switch(n.label){case 0:return n.trys.push([0,6,,7]),this.setCommonStoreState(),[4,this.transferStoreData()];case 1:return n.sent(),[4,this.commonStore.getItem(this.O+this.interSymbol+this.qt)];case 2:return(t=n.sent())?[3,4]:(i={storeSize:this.storeSize,lock:0,pros:1},[4,this.commonStore.setItem(this.O+this.interSymbol+this.qt,i)]);case 3:return n.sent(),[3,5];case 4:i="string"==typeof t?JSON.parse(t):t,this.storeSize=i.storeSize,n.label=5;case 5:return[3,7];case 6:return n.sent(),[3,7];case 7:return[2]}}))}))},a.prototype.uninit=function(){this.updateTimer&&(clearTimeout(this.updateTimer),this.updateTimer=null)},a.prototype.setCommonStoreState=function(){var t=this,i=(this.getStorage(this.Xt)||"").split(";");this.transStores=i.filter((function(i){return i.includes(t.Ct.appID+"")})),i=i.filter((function(i){return!i.includes(t.Ct.appID+"")}));this.storesKeys=i.join(";")},a.prototype.resetCommonStore=function(){return e(this,void 0,void 0,(function(){var t;return s(this,(function(i){switch(i.label){case 0:return t=0<this.storesKeys.length?";":"",this.saveStorage(this.Xt,this.storesKeys+t+this.O+this.interSymbol+this.qt),[4,this.commonStore.setItem(this.O+this.interSymbol+this.qt,{storeSize:this.storeSize,lock:0,pros:0})];case 1:return i.sent(),[2]}}))}))},a.prototype.transferStoreData=function(){return e(this,void 0,void 0,(function(){var t,i,n,r,h=this;return s(this,(function(c){switch(c.label){case 0:return[4,this.commonStore.keys()];case 1:t=c.sent(),i=function(i){var r,c,a,f,l,_,d,v;return s(this,(function(m){switch(m.label){case 0:return(r=t[i])===n.O+n.interSymbol+n.qt?[3,9]:[4,n.commonStore.getItem(r)];case 1:return(c="string"==typeof(c=m.sent())?JSON.parse(c):c).lock||c.pros&&!n.transStores.includes(r)?[3,9]:(f=r.split(n.interSymbol),a=f[0],f=f[1],[4,(l=o.createZegoStore(a,n.Ct.env,f)).keys()]);case 2:return 0!=(_=m.sent()).length?[3,3]:[3,8];case 3:return c.lock=1,[4,n.commonStore.setItem(r,c)];case 4:m.sent(),d=function(t){var i,r,o,c,a;return s(this,(function(f){switch(f.label){case 0:return i=_[t],[4,l.getItem(i)];case 1:return r=f.sent(),-1!==i.indexOf("pending")?r&&JSON.parse(r).forEach((function(t){return e(h,void 0,void 0,(function(){return s(this,(function(i){switch(i.label){case 0:return[4,this.storeData(t)];case 1:return i.sent(),[2]}}))}))})):(a=u.analyzeKey(i),o=a.level,c=a.timestamp,a=a.seq,n.storeData({level:o,timestamp:c,seq:a,content:r})),setTimeout((function(){return e(h,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,l.removeItem(i)];case 1:return t.sent(),[2]}}))}))}),300),[2]}}))},v=0,m.label=5;case 5:return v<_.length?[5,d(v)]:[3,8];case 6:m.sent(),m.label=7;case 7:return v++,[3,5];case 8:n.drops.push({name:a,storeName:f}),m.label=9;case 9:return[2]}}))},n=this,r=0,c.label=2;case 2:return r<t.length?[5,i(r)]:[3,5];case 3:c.sent(),c.label=4;case 4:return r++,[3,2];case 5:return this.transportStorageData(),setTimeout((function(){return e(h,void 0,void 0,(function(){var t,i,n;return s(this,(function(e){switch(e.label){case 0:t=0,e.label=1;case 1:if(!(t<this.drops.length))return[3,7];n=this.drops[t],i=n.name,n=n.storeName,e.label=2;case 2:return e.trys.push([2,5,,6]),[4,this.dropInstance(i,n)];case 3:return e.sent(),[4,this.commonStore.removeItem(i+this.interSymbol+n)];case 4:case 5:return e.sent(),[3,6];case 6:return t++,[3,1];case 7:return[2]}}))}))}),1e3),[2]}}))}))},a.prototype.dropInstance=function(t,i){return new Promise((function(n,e){c.default.dropInstance({name:t+":"+i}).then((function(){n()})).catch((function(t){e(t)}))}))},a.prototype.setDropCallBack=function(t){this.dropCallBack=t},a.prototype.storeData=function(t){var i=this;return new Promise((function(n,r){return e(i,void 0,void 0,(function(){var i,e,r,o,h,c=this;return s(this,(function(s){switch(s.label){case 0:i=t.level,o=t.timestamp,e=t.seq,r=t.content,o=i+"_"+o+"_"+e,s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this.store.getItem(o)];case 2:return s.sent()?(n(),[2]):[3,4];case 3:return s.sent(),[3,4];case 4:if(this.droping)return this.bufferData.push(t),[2];if(h=u.calculateMemSize(o)+u.calculateMemSize(r),this.Wt.totalDBSize-h<=0)return this.dropDBData(i,o,r).then((function(){c.droping=!1,c.bufferDump()})).catch((function(t){})),n(),[2];s.label=5;case 5:return s.trys.push([5,8,,9]),[4,this.store.setItem(o,r)];case 6:return s.sent(),this.storeSize+=h,this.Wt.totalDBSize-=h,[4,this.Gt()];case 7:return s.sent(),n(),[3,9];case 8:return"QuotaExceededError"===s.sent().name&&this.dropDBData(i,o,r).then((function(){c.droping=!1,c.bufferDump()})).catch((function(t){})),[3,9];case 9:return[2]}}))}))}))},a.prototype.loadPendingData=function(){return e(this,void 0,void 0,(function(){var t=this;return s(this,(function(i){switch(i.label){case 0:return[4,this.store.keys()];case 1:return i.sent().forEach((function(i){return e(t,void 0,void 0,(function(){var t,n=this;return s(this,(function(r){switch(r.label){case 0:return-1===i.indexOf("pending")?[3,3]:[4,this.store.getItem(i)];case 1:return(t=r.sent())?(JSON.parse(t).forEach((function(t){return e(n,void 0,void 0,(function(){return s(this,(function(i){switch(i.label){case 0:return[4,this.storeData(t)];case 1:return i.sent(),[2]}}))}))})),[4,this.store.removeItem(i)]):[3,3];case 2:r.sent(),r.label=3;case 3:return[2]}}))}))})),[2]}}))}))},a.prototype.storePendingData=function(t){return e(this,void 0,void 0,(function(){return s(this,(function(i){switch(i.label){case 0:return[4,this.store.setItem("pending"+(new Date).getTime(),JSON.stringify(t))];case 1:return i.sent(),[2]}}))}))},a.prototype.bufferDump=function(){return e(this,void 0,void 0,(function(){var t;return s(this,(function(i){switch(i.label){case 0:return(t=this.bufferData.pop())?[4,this.storeData(t)]:[3,2];case 1:i.sent(),this.bufferDump(),i.label=2;case 2:return[2]}}))}))},a.prototype.dropDBData=function(t,i,n){return e(this,void 0,void 0,(function(){var t=this;return s(this,(function(r){return this.droping=!0,[2,new Promise((function(r,o){return e(t,void 0,void 0,(function(){var t,e,h,c,a;return s(this,(function(s){switch(s.label){case 0:return s.trys.push([0,10,,11]),[4,this.store.keys()];case 1:(t=s.sent()).reverse(),e=Math.ceil(t.length*this.storeDelPer),h=0,s.label=2;case 2:return h<e?[4,this.store.getItem(t[h])]:[3,7];case 3:return null==(c=s.sent())?[3,6]:[4,this.store.removeItem(t[h])];case 4:return s.sent(),a=u.calculateMemSize(t[h])+u.calculateMemSize(c),this.Wt.totalDBSize+=a,this.storeSize-=a,[4,this.Gt()];case 5:s.sent(),this.dropCallBack(c),s.label=6;case 6:return h++,[3,2];case 7:return[4,this.store.setItem(i,n)];case 8:return s.sent(),this.storeSize+=u.calculateMemSize(i)+u.calculateMemSize(n),[4,this.Gt()];case 9:return s.sent(),r(),[3,11];case 10:return a=s.sent(),o(a),[3,11];case 11:return[2]}}))}))}))]}))}))},a.prototype.removeDataItem=function(t){var i=this;return new Promise((function(n,r){return e(i,void 0,void 0,(function(){var i,e,o,h,c;return s(this,(function(s){switch(s.label){case 0:i=t.level,o=t.timestamp,h=t.seq,t.content,i=i+"_"+o+"_"+h,s.label=1;case 1:return s.trys.push([1,6,,7]),[4,this.store.getItem(i)];case 2:return(e=s.sent())?[4,this.store.removeItem(i)]:[3,5];case 3:return s.sent(),o=1==this.Ct.env?u.calculateMemSize(JSON.parse(e)):u.calculateMemSize(e),h=u.calculateMemSize(i)+o,this.storeSize-=h,this.Wt.totalDBSize+=h,this.Ft.DB_O_DONE+=h,[4,this.Gt()];case 4:s.sent(),n(),s.label=5;case 5:return[3,7];case 6:return c=s.sent(),r(c),[3,7];case 7:return[2]}}))}))}))},a.prototype.Gt=function(){return e(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return t.trys.push([0,4,,5]),[4,this.commonStore.getItem(this.O+this.interSymbol+this.qt)];case 1:return t.sent()?[4,this.commonStore.setItem(this.O+this.interSymbol+this.qt,{storeSize:this.storeSize,lock:0,pros:1})]:[3,3];case 2:t.sent(),t.label=3;case 3:return[3,5];case 4:return t.sent(),[3,5];case 5:return[2]}}))}))},a.prototype.readStoreDataItem=function(){var t=this;return new Promise((function(i,n){return e(t,void 0,void 0,(function(){var t,e,r,o,h;return s(this,(function(s){switch(s.label){case 0:return s.trys.push([0,3,,4]),[4,this.store.keys()];case 1:return t=s.sent(),[4,this.store.getItem(t[0])];case 2:return e=s.sent(),o=u.analyzeKey(t[0]),h=o.level,r=o.timestamp,o=o.seq,i({level:h,timestamp:r,seq:o,content:e}),[3,4];case 3:return h=s.sent(),n(h),[3,4];case 4:return[2]}}))}))}))},a.prototype.loadDBData=function(t,i,n,r){var o=this;return new Promise((function(h,c){return e(o,void 0,void 0,(function(){var e,o,a,f,l,_,d,v,m,g;return s(this,(function(s){switch(s.label){case 0:return s.trys.push([0,6,,7]),[4,this.store.keys()];case 1:e=s.sent(),o=[],_=l=f=a=0,s.label=2;case 2:return _<e.length?r(e[_])?[3,4]:[4,this.store.getItem(e[_])]:[3,5];case 3:if(null==(d=s.sent()))return[3,4];if(v=u.analyzeKey(e[_]),m=v.level,g=v.timestamp,v=v.seq,o.push({level:m,timestamp:g,seq:v,content:d,key:e[_]}),m=u.calculateMemSize(d),f+=m,t<=(a+=m)&&(a=0,l++),i<=l&&n<=f)return[3,5];s.label=4;case 4:return _++,[3,2];case 5:return h({datas:o,len:f}),[3,7];case 6:return g=s.sent(),c(g),[3,7];case 7:return[2]}}))}))}))},a.prototype.sortKeys=function(t,i){void 0===i&&(i=!1),t.sort((function(t,i){return t=t.split("_"),+(i=i.split("_"))[0]-+t[0]||+i[1]-+t[1]||+i[2]-+t[2]})),i&&t.reverse()},a.prototype.saveStorage=function(t,i){try{localStorage.setItem(t,i)}catch(t){this.G.F.debug("storage set err")}},a.prototype.getStorage=function(t){try{return localStorage.getItem(t)}catch(t){this.G.F.debug("storage get err")}},a.prototype.saveDataToStorage=function(t){try{var i=t.level,n=t.timestamp,e=t.seq,s=t.content,r=i+"_"+n+"_"+e;this.saveStorage(this.Kt+"_"+r,s)}catch(t){this.G.F.debug("saveDataToStorage "+JSON.stringify(t))}},a.prototype.transportStorageData=function(){for(var t=[],i=0;i<localStorage.length;i++){var n,e,s,r,o=localStorage.key(i);this.G.F.debug("transportStorageData "+o),null!=o&&o.startsWith(this.Kt)&&(s=o.replace(this.Kt+"_",""),n=(s=u.analyzeKey(s)).level,e=s.timestamp,s=s.seq,"string"==typeof(r=this.getStorage(o))&&this.storeData({level:n,timestamp:e,seq:s,content:r}),t.push(o))}setTimeout((function(){for(var i=0;i<t.length;i++)localStorage.removeItem(t[i])}),100)},i.ZegoStoreHandler=a},function(t,i,n){"use strict";var e=n(32),s=n(33).Buffer;t.exports=function(t){return function t(i){return function(n){if(s.isBuffer(n))return n.length;switch(typeof n){case"string":return n.length*e.STRING;case"boolean":return e.BOOLEAN;case"number":return e.NUMBER;case"symbol":return Symbol.keyFor&&Symbol.keyFor(n)?Symbol.keyFor(n).length*e.STRING:(n.toString().length-8)*e.STRING;case"object":if(Array.isArray(n))return n.map(t(i)).reduce((function(t,i){return t+i}),0);var r=i,o=n;if(null==o)return 0;for(var u=0,h=function(t){var i,n=[];for(i in t)n.push(i);return Object.getOwnPropertySymbols&&(t=Object.getOwnPropertySymbols(t),Array.prototype.push.apply(n,t)),n}(o),c=0;c<h.length;c++){var a=h[c];if("object"==typeof o[a]&&null!==o[a]){if(r.has(o[a]))continue;r.add(o[a])}u+=t(r)(a);try{u+=t(r)(o[a])}catch(r){r instanceof RangeError&&(u=0)}}return u;default:return 0}}}(new WeakSet)(t)}},function(t,i){t.exports={STRING:2,BOOLEAN:4,NUMBER:8}},function(t,i,n){"use strict";(function(t){var e=n(35),s=n(36),r=n(37);function o(){return h.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function u(t,i){if(o()<i)throw new RangeError("Invalid typed array length");return h.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(i)).__proto__=h.prototype:(t=null===t?new h(i):t).length=i,t}function h(t,i,n){if(!(h.TYPED_ARRAY_SUPPORT||this instanceof h))return new h(t,i,n);if("number"!=typeof t)return c(this,t,i,n);if("string"==typeof i)throw new Error("If encoding is specified then the first argument must be a string");return f(this,t)}function c(t,i,n,e){if("number"==typeof i)throw new TypeError('"value" argument must not be a number');if("undefined"!=typeof ArrayBuffer&&i instanceof ArrayBuffer){var s=t,o=i,c=n;if(o.byteLength,c<0||o.byteLength<c)throw new RangeError("'offset' is out of bounds");if(o.byteLength<c+(e||0))throw new RangeError("'length' is out of bounds");return o=void 0===c&&void 0===e?new Uint8Array(o):void 0===e?new Uint8Array(o,c):new Uint8Array(o,c,e),h.TYPED_ARRAY_SUPPORT?(s=o).__proto__=h.prototype:s=l(s,o),s}if("string"!=typeof i){if(c=t,e=i,h.isBuffer(e))return 0!==(c=u(c,o=0|_(e.length))).length&&e.copy(c,0,0,o),c;if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||(o=e.length)!=o?u(c,0):l(c,e);if("Buffer"===e.type&&r(e.data))return l(c,e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}if(s=t,e=i,h.isEncoding(t="string"==typeof(t=n)&&""!==t?t:"utf8"))return(e=(s=u(s,i=0|d(e,t))).write(e,t))!==i?s.slice(0,e):s;throw new TypeError('"encoding" must be a valid string encoding')}function a(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function f(t,i){if(a(i),t=u(t,i<0?0:0|_(i)),!h.TYPED_ARRAY_SUPPORT)for(var n=0;n<i;++n)t[n]=0;return t}function l(t,i){var n=i.length<0?0:0|_(i.length);t=u(t,n);for(var e=0;e<n;e+=1)t[e]=255&i[e];return t}function _(t){if(t>=o())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o().toString(16)+" bytes");return 0|t}function d(t,i){if(h.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;var n=(t="string"!=typeof t?""+t:t).length;if(0===n)return 0;for(var e=!1;;)switch(i){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return C(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return k(t).length;default:if(e)return C(t).length;i=(""+i).toLowerCase(),e=!0}}function v(t,i,n){var e=t[i];t[i]=t[n],t[n]=e}function m(t,i,n,e,s){if(0===t.length)return-1;if("string"==typeof n?(e=n,n=0):2147483647<n?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,(n=(n=isNaN(n)?s?0:t.length-1:n)<0?t.length+n:n)>=t.length){if(s)return-1;n=t.length-1}else if(n<0){if(!s)return-1;n=0}if("string"==typeof i&&(i=h.from(i,e)),h.isBuffer(i))return 0===i.length?-1:g(t,i,n,e,s);if("number"==typeof i)return i&=255,h.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?(s?Uint8Array.prototype.indexOf:Uint8Array.prototype.lastIndexOf).call(t,i,n):g(t,[i],n,e,s);throw new TypeError("val must be string, number or Buffer")}function g(t,i,n,e,s){var r=1,o=t.length,u=i.length;if(void 0!==e&&("ucs2"===(e=String(e).toLowerCase())||"ucs-2"===e||"utf16le"===e||"utf-16le"===e)){if(t.length<2||i.length<2)return-1;o/=r=2,u/=2,n/=2}function h(t,i){return 1===r?t[i]:t.readUInt16BE(i*r)}if(s)for(var c=-1,a=n;a<o;a++)if(h(t,a)===h(i,-1===c?0:a-c)){if(a-(c=-1===c?a:c)+1===u)return c*r}else-1!==c&&(a-=a-c),c=-1;else for(a=n=o<n+u?o-u:n;0<=a;a--){for(var f=!0,l=0;l<u;l++)if(h(t,a+l)!==h(i,l)){f=!1;break}if(f)return a}return-1}function p(t,i,n,e){return A(function(t){for(var i=[],n=0;n<t.length;++n)i.push(255&t.charCodeAt(n));return i}(i),t,n,e)}function b(t,i,n){n=Math.min(t.length,n);for(var e=[],s=i;s<n;){var r,o,u,h,c=t[s],a=null,f=239<c?4:223<c?3:191<c?2:1;if(s+f<=n)switch(f){case 1:c<128&&(a=c);break;case 2:128==(192&(r=t[s+1]))&&127<(h=(31&c)<<6|63&r)&&(a=h);break;case 3:r=t[s+1],o=t[s+2],128==(192&r)&&128==(192&o)&&2047<(h=(15&c)<<12|(63&r)<<6|63&o)&&(h<55296||57343<h)&&(a=h);break;case 4:r=t[s+1],o=t[s+2],u=t[s+3],128==(192&r)&&128==(192&o)&&128==(192&u)&&65535<(h=(15&c)<<18|(63&r)<<12|(63&o)<<6|63&u)&&h<1114112&&(a=h)}null===a?(a=65533,f=1):65535<a&&(e.push((a-=65536)>>>10&1023|55296),a=56320|1023&a),e.push(a),s+=f}var l=e,_=l.length;if(_<=E)return String.fromCharCode.apply(String,l);for(var d="",v=0;v<_;)d+=String.fromCharCode.apply(String,l.slice(v,v+=E));return d}i.Buffer=h,i.SlowBuffer=function(t){return h.alloc(+(t=+t!=t?0:t))},i.INSPECT_MAX_BYTES=50,h.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(t){return!1}}(),i.kMaxLength=o(),h.poolSize=8192,h.Ht=function(t){return t.__proto__=h.prototype,t},h.from=function(t,i,n){return c(null,t,i,n)},h.TYPED_ARRAY_SUPPORT&&(h.prototype.__proto__=Uint8Array.prototype,h.__proto__=Uint8Array,"undefined"!=typeof Symbol)&&Symbol.species&&h[Symbol.species]===h&&Object.defineProperty(h,Symbol.species,{value:null,configurable:!0}),h.alloc=function(t,i,n){return a(t),t<=0||void 0===i?u(null,t):"string"==typeof n?u(null,t).fill(i,n):u(null,t).fill(i)},h.allocUnsafe=function(t){return f(null,t)},h.allocUnsafeSlow=function(t){return f(null,t)},h.isBuffer=function(t){return!(null==t||!t.Yt)},h.compare=function(t,i){if(!h.isBuffer(t)||!h.isBuffer(i))throw new TypeError("Arguments must be Buffers");if(t===i)return 0;for(var n=t.length,e=i.length,s=0,r=Math.min(n,e);s<r;++s)if(t[s]!==i[s]){n=t[s],e=i[s];break}return n<e?-1:e<n?1:0},h.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},h.concat=function(t,i){if(!r(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return h.alloc(0);if(void 0===i)for(s=i=0;s<t.length;++s)i+=t[s].length;for(var n=h.allocUnsafe(i),e=0,s=0;s<t.length;++s){var o=t[s];if(!h.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(n,e),e+=o.length}return n},h.byteLength=d,h.prototype.Yt=!0,h.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var i=0;i<t;i+=2)v(this,i,i+1);return this},h.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var i=0;i<t;i+=4)v(this,i,i+3),v(this,i+1,i+2);return this},h.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var i=0;i<t;i+=8)v(this,i,i+7),v(this,i+1,i+6),v(this,i+2,i+5),v(this,i+3,i+4);return this},h.prototype.toString=function(){var t=0|this.length;return 0==t?"":0===arguments.length?b(this,0,t):function(t,i,n){var s,r,o=!1;if((i=void 0===i||i<0?0:i)>this.length)return"";if((n=void 0===n||n>this.length?this.length:n)<=0)return"";if((n>>>=0)<=(i>>>=0))return"";for(t=t||"utf8";;)switch(t){case"hex":var u=i,h=n,c=this.length;(!h||h<0||c<h)&&(h=c);for(var a="",f=u=!u||u<0?0:u;f<h;++f)a+=(r=this[f])<16?"0"+r.toString(16):r.toString(16);return a;case"utf8":case"utf-8":return b(this,i,n);case"ascii":c=i;for(var l=n,_="",d=(l=Math.min(this.length,l),c);d<l;++d)_+=String.fromCharCode(127&this[d]);return _;case"latin1":case"binary":u=i;for(var v=n,m="",g=(v=Math.min(this.length,v),u);g<v;++g)m+=String.fromCharCode(this[g]);return m;case"base64":return p=this,s=n,0===(E=i)&&s===p.length?e.fromByteArray(p):e.fromByteArray(p.slice(E,s));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":for(var p=i,E=n,y=this.slice(p,E),S="",O=0;O<y.length;O+=2)S+=String.fromCharCode(y[O]+256*y[O+1]);return S;default:if(o)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),o=!0}}.apply(this,arguments)},h.prototype.equals=function(t){if(h.isBuffer(t))return this===t||0===h.compare(this,t);throw new TypeError("Argument must be a Buffer")},h.prototype.inspect=function(){var t="",n=i.INSPECT_MAX_BYTES;return 0<this.length&&(t=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n)&&(t+=" ... "),"<Buffer "+t+">"},h.prototype.compare=function(t,i,n,e,s){if(!h.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===n&&(n=t?t.length:0),void 0===e&&(e=0),void 0===s&&(s=this.length),(i=void 0===i?0:i)<0||n>t.length||e<0||s>this.length)throw new RangeError("out of range index");if(s<=e&&n<=i)return 0;if(s<=e)return-1;if(n<=i)return 1;if(this===t)return 0;for(var r=(s>>>=0)-(e>>>=0),o=(n>>>=0)-(i>>>=0),u=Math.min(r,o),c=this.slice(e,s),a=t.slice(i,n),f=0;f<u;++f)if(c[f]!==a[f]){r=c[f],o=a[f];break}return r<o?-1:o<r?1:0},h.prototype.includes=function(t,i,n){return-1!==this.indexOf(t,i,n)},h.prototype.indexOf=function(t,i,n){return m(this,t,i,n,!0)},h.prototype.lastIndexOf=function(t,i,n){return m(this,t,i,n,!1)},h.prototype.write=function(t,i,n,e){if(void 0===i)e="utf8",n=this.length,i=0;else if(void 0===n&&"string"==typeof i)e=i,n=this.length,i=0;else{if(!isFinite(i))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");i|=0,isFinite(n)?(n|=0,void 0===e&&(e="utf8")):(e=n,n=void 0)}var s=this.length-i;if((void 0===n||s<n)&&(n=s),0<t.length&&(n<0||i<0)||i>this.length)throw new RangeError("Attempt to write outside buffer bounds");e=e||"utf8";for(var r,o,u,h,c=!1;;)switch(e){case"hex":var a,f=t,l=n,_=(a=Number(i)||0,this.length-a);if((!l||_<(l=Number(l)))&&(l=_),(_=f.length)%2!=0)throw new TypeError("Invalid hex string");_/2<l&&(l=_/2);for(var d=0;d<l;++d){var v=parseInt(f.substr(2*d,2),16);if(isNaN(v))return d;this[a+d]=v}return d;case"utf8":case"utf-8":return _=i,o=n,A(C(t,(r=this).length-_),r,_,o);case"ascii":case"latin1":case"binary":return p(this,t,i,n);case"base64":return r=this,o=i,u=n,A(k(t),r,o,u);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return u=i,h=n,A(function(t,i){for(var n,e,s=[],r=0;r<t.length&&!((i-=2)<0);++r)e=(n=t.charCodeAt(r))>>8,s.push(n%256),s.push(e);return s}(t,this.length-u),this,u,h);default:if(c)throw new TypeError("Unknown encoding: "+e);e=(""+e).toLowerCase(),c=!0}},h.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var E=4096;function y(t,i,n){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(n<t+i)throw new RangeError("Trying to access beyond buffer length")}function S(t,i,n,e,s,r){if(!h.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(s<i||i<r)throw new RangeError('"value" argument is out of bounds');if(n+e>t.length)throw new RangeError("Index out of range")}function O(t,i,n,e){i<0&&(i=65535+i+1);for(var s=0,r=Math.min(t.length-n,2);s<r;++s)t[n+s]=(i&255<<8*(e?s:1-s))>>>8*(e?s:1-s)}function R(t,i,n,e){i<0&&(i=4294967295+i+1);for(var s=0,r=Math.min(t.length-n,4);s<r;++s)t[n+s]=i>>>8*(e?s:3-s)&255}function T(t,i,n,e){if(n+e>t.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function w(t,i,n,e,r){return r||T(t,0,n,4),s.write(t,i,n,e,23,4),n+4}function N(t,i,n,e,r){return r||T(t,0,n,8),s.write(t,i,n,e,52,8),n+8}h.prototype.slice=function(t,i){var n=this.length;if((t=~~t)<0?(t+=n)<0&&(t=0):n<t&&(t=n),(i=void 0===i?n:~~i)<0?(i+=n)<0&&(i=0):n<i&&(i=n),i<t&&(i=t),h.TYPED_ARRAY_SUPPORT)(s=this.subarray(t,i)).__proto__=h.prototype;else for(var e=i-t,s=new h(e,void 0),r=0;r<e;++r)s[r]=this[r+t];return s},h.prototype.readUIntLE=function(t,i,n){t|=0,i|=0,n||y(t,i,this.length);for(var e=this[t],s=1,r=0;++r<i&&(s*=256);)e+=this[t+r]*s;return e},h.prototype.readUIntBE=function(t,i,n){t|=0,i|=0,n||y(t,i,this.length);for(var e=this[t+--i],s=1;0<i&&(s*=256);)e+=this[t+--i]*s;return e},h.prototype.readUInt8=function(t,i){return i||y(t,1,this.length),this[t]},h.prototype.readUInt16LE=function(t,i){return i||y(t,2,this.length),this[t]|this[t+1]<<8},h.prototype.readUInt16BE=function(t,i){return i||y(t,2,this.length),this[t]<<8|this[t+1]},h.prototype.readUInt32LE=function(t,i){return i||y(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},h.prototype.readUInt32BE=function(t,i){return i||y(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},h.prototype.readIntLE=function(t,i,n){t|=0,i|=0,n||y(t,i,this.length);for(var e=this[t],s=1,r=0;++r<i&&(s*=256);)e+=this[t+r]*s;return(s*=128)<=e&&(e-=Math.pow(2,8*i)),e},h.prototype.readIntBE=function(t,i,n){t|=0,i|=0,n||y(t,i,this.length);for(var e=i,s=1,r=this[t+--e];0<e&&(s*=256);)r+=this[t+--e]*s;return(s*=128)<=r&&(r-=Math.pow(2,8*i)),r},h.prototype.readInt8=function(t,i){return i||y(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},h.prototype.readInt16LE=function(t,i){return i||y(t,2,this.length),32768&(i=this[t]|this[t+1]<<8)?4294901760|i:i},h.prototype.readInt16BE=function(t,i){return i||y(t,2,this.length),32768&(i=this[t+1]|this[t]<<8)?4294901760|i:i},h.prototype.readInt32LE=function(t,i){return i||y(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},h.prototype.readInt32BE=function(t,i){return i||y(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},h.prototype.readFloatLE=function(t,i){return i||y(t,4,this.length),s.read(this,t,!0,23,4)},h.prototype.readFloatBE=function(t,i){return i||y(t,4,this.length),s.read(this,t,!1,23,4)},h.prototype.readDoubleLE=function(t,i){return i||y(t,8,this.length),s.read(this,t,!0,52,8)},h.prototype.readDoubleBE=function(t,i){return i||y(t,8,this.length),s.read(this,t,!1,52,8)},h.prototype.writeUIntLE=function(t,i,n,e){t=+t,i|=0,n|=0,e||S(this,t,i,n,Math.pow(2,8*n)-1,0);var s=1,r=0;for(this[i]=255&t;++r<n&&(s*=256);)this[i+r]=t/s&255;return i+n},h.prototype.writeUIntBE=function(t,i,n,e){t=+t,i|=0,n|=0,e||S(this,t,i,n,Math.pow(2,8*n)-1,0);var s=n-1,r=1;for(this[i+s]=255&t;0<=--s&&(r*=256);)this[i+s]=t/r&255;return i+n},h.prototype.writeUInt8=function(t,i,n){return t=+t,i|=0,n||S(this,t,i,1,255,0),h.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[i]=255&t,i+1},h.prototype.writeUInt16LE=function(t,i,n){return t=+t,i|=0,n||S(this,t,i,2,65535,0),h.TYPED_ARRAY_SUPPORT?(this[i]=255&t,this[i+1]=t>>>8):O(this,t,i,!0),i+2},h.prototype.writeUInt16BE=function(t,i,n){return t=+t,i|=0,n||S(this,t,i,2,65535,0),h.TYPED_ARRAY_SUPPORT?(this[i]=t>>>8,this[i+1]=255&t):O(this,t,i,!1),i+2},h.prototype.writeUInt32LE=function(t,i,n){return t=+t,i|=0,n||S(this,t,i,4,4294967295,0),h.TYPED_ARRAY_SUPPORT?(this[i+3]=t>>>24,this[i+2]=t>>>16,this[i+1]=t>>>8,this[i]=255&t):R(this,t,i,!0),i+4},h.prototype.writeUInt32BE=function(t,i,n){return t=+t,i|=0,n||S(this,t,i,4,4294967295,0),h.TYPED_ARRAY_SUPPORT?(this[i]=t>>>24,this[i+1]=t>>>16,this[i+2]=t>>>8,this[i+3]=255&t):R(this,t,i,!1),i+4},h.prototype.writeIntLE=function(t,i,n,e){t=+t,i|=0,e||S(this,t,i,n,(e=Math.pow(2,8*n-1))-1,-e);var s=0,r=1,o=0;for(this[i]=255&t;++s<n&&(r*=256);)t<0&&0===o&&0!==this[i+s-1]&&(o=1),this[i+s]=(t/r>>0)-o&255;return i+n},h.prototype.writeIntBE=function(t,i,n,e){t=+t,i|=0,e||S(this,t,i,n,(e=Math.pow(2,8*n-1))-1,-e);var s=n-1,r=1,o=0;for(this[i+s]=255&t;0<=--s&&(r*=256);)t<0&&0===o&&0!==this[i+s+1]&&(o=1),this[i+s]=(t/r>>0)-o&255;return i+n},h.prototype.writeInt8=function(t,i,n){return t=+t,i|=0,n||S(this,t,i,1,127,-128),h.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[i]=255&(t=t<0?255+t+1:t),i+1},h.prototype.writeInt16LE=function(t,i,n){return t=+t,i|=0,n||S(this,t,i,2,32767,-32768),h.TYPED_ARRAY_SUPPORT?(this[i]=255&t,this[i+1]=t>>>8):O(this,t,i,!0),i+2},h.prototype.writeInt16BE=function(t,i,n){return t=+t,i|=0,n||S(this,t,i,2,32767,-32768),h.TYPED_ARRAY_SUPPORT?(this[i]=t>>>8,this[i+1]=255&t):O(this,t,i,!1),i+2},h.prototype.writeInt32LE=function(t,i,n){return t=+t,i|=0,n||S(this,t,i,4,2147483647,-2147483648),h.TYPED_ARRAY_SUPPORT?(this[i]=255&t,this[i+1]=t>>>8,this[i+2]=t>>>16,this[i+3]=t>>>24):R(this,t,i,!0),i+4},h.prototype.writeInt32BE=function(t,i,n){return t=+t,i|=0,n||S(this,t,i,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),h.TYPED_ARRAY_SUPPORT?(this[i]=t>>>24,this[i+1]=t>>>16,this[i+2]=t>>>8,this[i+3]=255&t):R(this,t,i,!1),i+4},h.prototype.writeFloatLE=function(t,i,n){return w(this,t,i,!0,n)},h.prototype.writeFloatBE=function(t,i,n){return w(this,t,i,!1,n)},h.prototype.writeDoubleLE=function(t,i,n){return N(this,t,i,!0,n)},h.prototype.writeDoubleBE=function(t,i,n){return N(this,t,i,!1,n)},h.prototype.copy=function(t,i,n,e){if(n=n||0,e||0===e||(e=this.length),i>=t.length&&(i=t.length),(e=0<e&&e<n?n:e)===n)return 0;if(0===t.length||0===this.length)return 0;if((i=i||0)<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(e<0)throw new RangeError("sourceEnd out of bounds");e>this.length&&(e=this.length);var s,r=(e=t.length-i<e-n?t.length-i+n:e)-n;if(this===t&&n<i&&i<e)for(s=r-1;0<=s;--s)t[s+i]=this[s+n];else if(r<1e3||!h.TYPED_ARRAY_SUPPORT)for(s=0;s<r;++s)t[s+i]=this[s+n];else Uint8Array.prototype.set.call(t,this.subarray(n,n+r),i);return r},h.prototype.fill=function(t,i,n,e){if("string"==typeof t){var s;if("string"==typeof i?(e=i,i=0,n=this.length):"string"==typeof n&&(e=n,n=this.length),1===t.length&&(s=t.charCodeAt(0))<256&&(t=s),void 0!==e&&"string"!=typeof e)throw new TypeError("encoding must be a string");if("string"==typeof e&&!h.isEncoding(e))throw new TypeError("Unknown encoding: "+e)}else"number"==typeof t&&(t&=255);if(i<0||this.length<i||this.length<n)throw new RangeError("Out of range index");if(!(n<=i))if(i>>>=0,n=void 0===n?this.length:n>>>0,"number"==typeof(t=t||0))for(u=i;u<n;++u)this[u]=t;else for(var r=h.isBuffer(t)?t:C(new h(t,e).toString()),o=r.length,u=0;u<n-i;++u)this[u+i]=r[u%o];return this};var I=/[^+\/0-9A-Za-z-_]/g;function C(t,i){i=i||1/0;for(var n,e=t.length,s=null,r=[],o=0;o<e;++o){if(55295<(n=t.charCodeAt(o))&&n<57344){if(!s){if(56319<n){-1<(i-=3)&&r.push(239,191,189);continue}if(o+1===e){-1<(i-=3)&&r.push(239,191,189);continue}s=n;continue}if(n<56320){-1<(i-=3)&&r.push(239,191,189),s=n;continue}n=65536+(s-55296<<10|n-56320)}else s&&-1<(i-=3)&&r.push(239,191,189);if(s=null,n<128){if(--i<0)break;r.push(n)}else if(n<2048){if((i-=2)<0)break;r.push(n>>6|192,63&n|128)}else if(n<65536){if((i-=3)<0)break;r.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((i-=4)<0)break;r.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return r}function k(t){return e.toByteArray(function(t){var i;if((t=((i=t).trim?i.trim():i.replace(/^\s+|\s+$/g,"")).replace(I,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function A(t,i,n,e){for(var s=0;s<e&&!(s+n>=i.length||s>=t.length);++s)i[s+n]=t[s];return s}}).call(this,n(34))},function(t,i){var n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,i,n){"use strict";i.byteLength=function(t){return 3*((t=h(t))[0]+(t=t[1]))/4-t},i.toByteArray=function(t){for(var i,n=(e=h(t))[0],e=e[1],o=new r(3*(n+e)/4-e),u=0,c=0<e?n-4:n,a=0;a<c;a+=4)i=s[t.charCodeAt(a)]<<18|s[t.charCodeAt(a+1)]<<12|s[t.charCodeAt(a+2)]<<6|s[t.charCodeAt(a+3)],o[u++]=i>>16&255,o[u++]=i>>8&255,o[u++]=255&i;return 2===e&&(i=s[t.charCodeAt(a)]<<2|s[t.charCodeAt(a+1)]>>4,o[u++]=255&i),1===e&&(i=s[t.charCodeAt(a)]<<10|s[t.charCodeAt(a+1)]<<4|s[t.charCodeAt(a+2)]>>2,o[u++]=i>>8&255,o[u++]=255&i),o},i.fromByteArray=function(t){for(var i,n=t.length,s=n%3,r=[],o=0,u=n-s;o<u;o+=16383)r.push(function(t,i){for(var n,s=[],r=o;r<i;r+=3)n=(t[r]<<16&16711680)+(t[r+1]<<8&65280)+(255&t[r+2]),s.push(e[n>>18&63]+e[n>>12&63]+e[n>>6&63]+e[63&n]);return s.join("")}(t,u<o+16383?u:o+16383));return 1==s?(i=t[n-1],r.push(e[i>>2]+e[i<<4&63]+"==")):2==s&&(i=(t[n-2]<<8)+t[n-1],r.push(e[i>>10]+e[i>>4&63]+e[i<<2&63]+"=")),r.join("")};for(var e=[],s=[],r="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",u=0;u<64;++u)e[u]=o[u],s[o.charCodeAt(u)]=u;function h(t){var i=t.length;if(0<i%4)throw new Error("Invalid string. Length must be a multiple of 4");return i=(t=-1===(t=t.indexOf("="))?i:t)===i?0:4-t%4,[t,i]}s["-".charCodeAt(0)]=62,s["_".charCodeAt(0)]=63},function(t,i){i.read=function(t,i,n,e,s){var r,o,u=8*s-e-1,h=(1<<u)-1,c=h>>1,a=-7,f=n?s-1:0,l=n?-1:1;s=t[i+f];for(f+=l,r=s&(1<<-a)-1,s>>=-a,a+=u;0<a;r=256*r+t[i+f],f+=l,a-=8);for(o=r&(1<<-a)-1,r>>=-a,a+=e;0<a;o=256*o+t[i+f],f+=l,a-=8);if(0===r)r=1-c;else{if(r===h)return o?NaN:1/0*(s?-1:1);o+=Math.pow(2,e),r-=c}return(s?-1:1)*o*Math.pow(2,r-e)},i.write=function(t,i,n,e,s,r){var o,u,h=8*r-s-1,c=(1<<h)-1,a=c>>1,f=23===s?Math.pow(2,-24)-Math.pow(2,-77):0,l=e?0:r-1,_=e?1:-1;r=i<0||0===i&&1/i<0?1:0;for(i=Math.abs(i),isNaN(i)||i===1/0?(u=isNaN(i)?1:0,o=c):(o=Math.floor(Math.log(i)/Math.LN2),i*(e=Math.pow(2,-o))<1&&(o--,e*=2),2<=(i+=1<=o+a?f/e:f*Math.pow(2,1-a))*e&&(o++,e/=2),c<=o+a?(u=0,o=c):1<=o+a?(u=(i*e-1)*Math.pow(2,s),o+=a):(u=i*Math.pow(2,a-1)*Math.pow(2,s),o=0));8<=s;t[n+l]=255&u,l+=_,u/=256,s-=8);for(o=o<<s|u,h+=s;0<h;t[n+l]=255&o,l+=_,o/=256,h-=8);t[n+l-_]|=128*r}},function(t,i){var n={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==n.call(t)}},function(t,i,n){"use strict";var e=this&&this.__read||function(t,i){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var e,s,r=n.call(t),o=[];try{for(;(void 0===i||0<i--)&&!(e=r.next()).done;)o.push(e.value)}catch(t){s={error:t}}finally{try{e&&!e.done&&(n=r.return)&&n.call(r)}finally{if(s)throw s.error}}return o},s=this&&this.__spread||function(){for(var t=[],i=0;i<arguments.length;i++)t=t.concat(e(arguments[i]));return t},r=(Object.defineProperty(i,"u",{value:!0}),i.PendingQueue=void 0,n(0)),o=n(5);function u(t,i,n,e){var s=this;this.Vt=t,this.yt=i,this.Wt=n,this.G=e,this.byteLength=0,this.size=0,this.pendingDataSize=0,this.cacheMap=new Map,t.forEach((function(t){s.cacheMap.set(t,new r.Queue)}))}u.prototype.enqueue=function(t,i){(i=this.cacheMap.get(i))&&!i.all().find((function(i){return i.content==t.content}))&&(i.enqueue(t),i=o.calculateMemSize(t.content),this.pendingDataSize+=i,this.size++,this.Wt.totalAvailCache-=i,this.enCallback)&&this.enCallback(this.byteLength,this.size,this.pendingDataSize)},u.prototype.dequeue=function(t){return t=null==(t=this.cacheMap.get(t))?void 0:t.dequeue(),this.size--,this.deCallback&&this.deCallback(),t},u.prototype.findInQueue=function(t){var i=null==(i=this.cacheMap.get(t.level))?void 0:i.all();return null==i?void 0:i.find((function(i){return i.key===t.key}))},u.prototype.readReportData=function(t){var i=s(this.cacheMap.entries());i=this.readData(i,t,!0);return this.reset(),{totalLen:i.totalLen,reportDataArr:i.resArr}},u.prototype.readStoreData=function(t){t=Math.ceil(this.pendingDataSize*t);var i=s(this.cacheMap.entries()).reverse();i=this.readData(i,t,!1);return this.refresh(i.totalLen),{totalLen:i.totalLen,storeArr:i.resArr}},u.prototype.readData=function(t,i,n){var s=[],r=0;t:for(var u=0;u<t.length;u++)for(var h=e(t[u],2),c=h[0],a=h[1];a.size();){var f=this.dequeue(c);if(s.push(f),i<(r+=o.calculateMemSize(f.content)))break t}return{totalLen:r,resArr:s}},u.prototype.decodeReportData=function(t){var i=this;t.forEach((function(t){i.enqueue(t,t.level)}))},u.prototype.setListener=function(t){this.enCallback=t.enCallback,this.deCallback=t.deCallback},u.prototype.getPendingDataInfo=function(){return{pendingDataSize:this.pendingDataSize,size:this.size}},u.prototype.refresh=function(t){this.pendingDataSize-=t,this.Wt.totalAvailCache+=t},u.prototype.reset=function(){this.byteLength=0},i.PendingQueue=u},function(t,i,n){"use strict";var e=this&&this.__awaiter||function(t,i,n,e){return new(n=n||Promise)((function(s,r){function o(t){try{h(e.next(t))}catch(t){r(t)}}function u(t){try{h(e.throw(t))}catch(t){r(t)}}function h(t){var i;t.done?s(t.value):((i=t.value)instanceof n?i:new n((function(t){t(i)}))).then(o,u)}h((e=e.apply(t,i||[])).next())}))},s=this&&this.__generator||function(t,i){var n,e,s,r={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},o={next:u(0),throw:u(1),return:u(2)};return"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){var h=[o,u];if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,e&&(s=2&h[0]?e.return:h[0]?e.throw||((s=e.return)&&s.call(e),0):e.next)&&!(s=s.call(e,h[1])).done)return s;switch(e=0,(h=s?[2&h[0],s.value]:h)[0]){case 0:case 1:s=h;break;case 4:return r.label++,{value:h[1],done:!1};case 5:r.label++,e=h[1],h=[0];continue;case 7:h=r.ops.pop(),r.trys.pop();continue;default:if(!(s=0<(s=r.trys).length&&s[s.length-1])&&(6===h[0]||2===h[0])){r=0;continue}if(3===h[0]&&(!s||h[1]>s[0]&&h[1]<s[3]))r.label=h[1];else if(6===h[0]&&r.label<s[1])r.label=s[1],s=h;else{if(!(s&&r.label<s[2])){s[2]&&r.ops.pop(),r.trys.pop();continue}r.label=s[2],r.ops.push(h)}}h=i.call(t,r)}catch(u){h=[6,u],e=0}finally{n=s=0}if(5&h[0])throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}}},r=(Object.defineProperty(i,"u",{value:!0}),i.loadJS=void 0,n(40));function o(t,i,n){return(t=r.decrypt(t,i))&&r.hashMd5(t)===n?t:""}i.loadJS=function(t,i,n,r,u,h,c){var a=this;return new Promise((function(f,l){return e(a,void 0,void 0,(function(){var a,_,d,v,m;return s(this,(function(g){switch(g.label){case 0:if(a="dy",t)return[3,7];g.label=1;case 1:return g.trys.push([1,5,,6]),[4,i.getItem("code")];case 2:return _=g.sent(),[4,i.getItem("key")];case 3:return d=g.sent(),[4,i.getItem("hash")];case 4:v=g.sent();var p=o(_,d,v)||h,b=a,E=c,y=document.getElementsByTagName("HEAD").item(0),S=document.createElement("script");S.language="javascript",S.type="text/javascript",S.id=b,S.param=E;try{S.appendChild(document.createTextNode(p))}catch(b){S.text=p}return y.appendChild(S),f(),[3,6];case 5:return g.sent(),l(),[3,6];case 6:return[2];case 7:if(window.ActiveXObject)try{m=new ActiveXObject("Msxml2.XMLHTTP")}catch(g){m=new ActiveXObject("Microsoft.XMLHTTP")}else window.XMLHttpRequest&&(m=new XMLHttpRequest);return m.open("GET",n,!0),m.send(null),m.onreadystatechange=function(){return e(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:if(4!=m.readyState)return[3,10];if(!(200<=m.status&&m.status<300||0==m.status||304==m.status))return[3,8];t.label=1;case 1:return t.trys.push([1,6,,7]),o(m.responseText,r,u)?[4,i.setItem("code",m.responseText)]:[3,5];case 2:return t.sent(),[4,i.setItem("key",r)];case 3:return t.sent(),[4,i.setItem("hash",u)];case 4:t.sent(),t.label=5;case 5:return f(),[3,7];case 6:return t.sent(),l(),[3,7];case 7:return[2];case 8:return l(),[2];case 9:return[3,11];case 10:case 11:return[2]}}))}))},[2]}}))}))}))}},function(t,i,n){"use strict";var e=this&&this.__importDefault||function(t){return t&&t.u?t:{default:t}},s=(Object.defineProperty(i,"u",{value:!0}),i.hashMd5=i.decrypt=void 0,e(n(41))),r=e(n(42)),o=e(n(43));i.decrypt=function(t,i){var n="";try{n=r.default.decrypt(t,i).toString(o.default)}catch(t){}return n},i.hashMd5=function(t){return s.default(t).toString()}},function(t,i){t.exports=o},function(t,i){t.exports=u},function(t,i){t.exports=h},function(t,i,n){"use strict";function e(){this.logLevel=i.ENUM_LOG_LEVEL.DISABLE}Object.defineProperty(i,"u",{value:!0}),i.ZegoLog=i.ENUM_LOG_LEVEL=void 0,i.ENUM_LOG_LEVEL={DEBUG:0,INFO:1,WARN:2,ERROR:3,REPORT:99,DISABLE:100,debug:0,info:1,warn:2,error:3,report:99,disable:100},e.prototype.setLogLevel=function(t){return void 0!==(t=i.ENUM_LOG_LEVEL[t])&&(this.logLevel=t,!0)},e.prototype.debug=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var e=t.join(" ");this.logLevel!==i.ENUM_LOG_LEVEL.DISABLE&&this.logLevel<=i.ENUM_LOG_LEVEL.DEBUG&&console.debug(e)},e.prototype.log=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var e=t.join(" ");this.logLevel!==i.ENUM_LOG_LEVEL.DISABLE&&this.logLevel<=i.ENUM_LOG_LEVEL.INFO&&console.log(e)},e.prototype.info=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var e=t.join(" ");this.logLevel!==i.ENUM_LOG_LEVEL.DISABLE&&this.logLevel<=i.ENUM_LOG_LEVEL.INFO&&console.info(e)},e.prototype.warn=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var e=t.join(" ");this.logLevel!==i.ENUM_LOG_LEVEL.DISABLE&&this.logLevel<=i.ENUM_LOG_LEVEL.WARN&&console.warn(e)},e.prototype.error=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var e=t.join(" ");this.logLevel!==i.ENUM_LOG_LEVEL.DISABLE&&this.logLevel<=i.ENUM_LOG_LEVEL.ERROR&&console.error(e)},i.ZegoLog=e},function(t,i,n){"use strict";function e(t){this.logger=t,this.F=t}Object.defineProperty(i,"u",{value:!0}),i.StateCenter=void 0,e.prototype.isLogin=function(){return!0},i.StateCenter=e},function(t,i,n){"use strict";var e=this&&this.__read||function(t,i){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var e,s,r=n.call(t),o=[];try{for(;(void 0===i||0<i--)&&!(e=r.next()).done;)o.push(e.value)}catch(t){s={error:t}}finally{try{e&&!e.done&&(n=r.return)&&n.call(r)}finally{if(s)throw s.error}}return o},s=this&&this.__spread||function(){for(var t=[],i=0;i<arguments.length;i++)t=t.concat(e(arguments[i]));return t},r=(Object.defineProperty(i,"u",{value:!0}),i.DynamicCode=void 0,n(3));function o(){this.init()}o.prototype.init=function(){window.dyObj={}},o.prototype.runExecution=function(t,i,n){t=new(Function.bind.apply(Function,s([void 0],t,[n])));try{t.apply(void 0,s(i))}catch(t){r.log.error(t)}},i.DynamicCode=o}],a={},e.m=c,e.c=a,e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:n})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"u",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.u)return t;var n=Object.create(null);if(e.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var s in t)e.d(n,s,function(i){return t[i]}.bind(null,s));return n},e.n=function(t){var i=t&&t.u?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},e.p="",e(e.s=13))},function(t,i,n){var e,s,r,o,u;t.exports=(t=n(2),n(17),n(18),e=(r=(n=t).lib).Base,s=r.WordArray,o=(r=n.algo).MD5,u=r.EvpKDF=e.extend({cfg:e.extend({keySize:4,hasher:o,iterations:1}),init:function(t){this.cfg=this.cfg.extend(t)},compute:function(t,i){for(var n,e=this.cfg,r=e.hasher.create(),o=s.create(),u=o.words,h=e.keySize,c=e.iterations;u.length<h;){n&&r.update(n),n=r.update(t).finalize(i),r.reset();for(var a=1;a<c;a++)n=r.finalize(n),r.reset();o.concat(n)}return o.sigBytes=4*h,o}}),n.EvpKDF=function(t,i,n){return u.create(n).compute(t,i)},t.EvpKDF)},function(t,i){t.exports=e},function(t,i,n){function e(t){var i;return(u[t]||(i=u[t]={i:t,l:!1,exports:{}},o[t].call(i.exports,i,i.exports,e),i.l=!0,i)).exports}var s,r,o,u;t.exports=(s=n(1),r=n(3),o=[function(t,i){t.exports=s},function(t,i){t.exports=r},function(t,i,n){"use strict";var e,s,r,o,u,h,c,a;n.r(i),n.d(i,"ZegoConnectionAgent",(function(){return wt})),n.d(i,"NetAgentPCRequest",(function(){return mt})),n.d(i,"NetAgentHttpRequest",(function(){return St})),n.d(i,"BusinessService",(function(){return r})),n.d(i,"BrokenType",(function(){return v})),n.d(i,"NET_ACCESS_CONFIG",(function(){return ct})),n.d(i,"ConnectedType",(function(){return d})),n.d(i,"DisconnectedType",(function(){return _})),n.d(i,"Mode",(function(){return u})),n.d(i,"Method",(function(){return l})),(i=e=e||{})[i.offline=0]="offline",i[i.online=1]="online",(i=s=s||{})[i.MSG_TYPE_STREAM_CLOSED=2]="MSG_TYPE_STREAM_CLOSED",i[i.MSG_TYPE_CLOSE_CONNECTION=3]="MSG_TYPE_CLOSE_CONNECTION",i[i.MSG_TYPE_HTTP_REQUEST=4]="MSG_TYPE_HTTP_REQUEST",i[i.MSG_TYPE_HTTP_RESPONSE=5]="MSG_TYPE_HTTP_RESPONSE",i[i.MSG_TYPE_HB_REQUEST=12]="MSG_TYPE_HB_REQUEST",i[i.MSG_TYPE_HB_RESPONSE=13]="MSG_TYPE_HB_RESPONSE",i[i.MSG_TYPE_GET_CONFIG_REQUEST=14]="MSG_TYPE_GET_CONFIG_REQUEST",i[i.MSG_TYPE_GET_CONFIG_RESPONSE=15]="MSG_TYPE_GET_CONFIG_RESPONSE",i[i.MSG_TYPE_HTTP_REQUEST_ACK=16]="MSG_TYPE_HTTP_REQUEST_ACK",i[i.MSG_TYPE_PC_UPWARD_MESSAGE=17]="MSG_TYPE_PC_UPWARD_MESSAGE",i[i.MSG_TYPE_PC_UPWARD_MESSAGE_ACK=18]="MSG_TYPE_PC_UPWARD_MESSAGE_ACK",i[i.MSG_TYPE_PC_ESTABLISHED=19]="MSG_TYPE_PC_ESTABLISHED",i[i.MSG_TYPE_PC_BROKEN=20]="MSG_TYPE_PC_BROKEN",i[i.MSG_TYPE_PC_DOWNWARD_MESSAGE=21]="MSG_TYPE_PC_DOWNWARD_MESSAGE",i[i.MSG_TYPE_REDIRECT=22]="MSG_TYPE_REDIRECT",i[i.MSG_TYPE_GET_APPCONFIG_REQUEST=23]="MSG_TYPE_GET_APPCONFIG_REQUEST",i[i.MSG_TYPE_GET_APPCONFIG_RESPONSE=24]="MSG_TYPE_GET_APPCONFIG_RESPONSE",i[i.MSG_TYPE_PUSH_APPCONFIG=25]="MSG_TYPE_PUSH_APPCONFIG",i[i.MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST=26]="MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST",i[i.MSG_TYPE_ACCESSHUB_DISPATCH_RESPONSE=27]="MSG_TYPE_ACCESSHUB_DISPATCH_RESPONSE",i[i.MSG_TYPE_PUSH_EXCEPTION=30]="MSG_TYPE_PUSH_EXCEPTION",i[i.MSG_TYPE_HTTP_REQUEST2=33]="MSG_TYPE_HTTP_REQUEST2",i[i.MSG_TYPE_REDIRECT2=34]="MSG_TYPE_REDIRECT2",i[i.MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST2=35]="MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST2",i[i.MSG_TYPE_ACCESSHUB_DISPATCH_RESPONSE2=36]="MSG_TYPE_ACCESSHUB_DISPATCH_RESPONSE2",i[i.MSG_TYPE_GET_SVRADDR_REQUEST=39]="MSG_TYPE_GET_SVRADDR_REQUEST",i[i.MSG_TYPE_GET_SVRADDR_RESPONSE=40]="MSG_TYPE_GET_SVRADDR_RESPONSE",(i=p=p||{})[i.ACCESSHUB_INVALID_FRAME=2e4]="ACCESSHUB_INVALID_FRAME",i[i.ACCESSHUB_NEED_ENCRYPT=20001]="ACCESSHUB_NEED_ENCRYPT",i[i.ACCESSHUB_DECRYPT=20002]="ACCESSHUB_DECRYPT",i[i.ACCESSHUB_MSGTYPE=20003]="ACCESSHUB_MSGTYPE",i[i.ACCESSHUB_UNMARSHAL=20004]="ACCESSHUB_UNMARSHAL",i[i.ACCESSHUB_TIMEOUT=20005]="ACCESSHUB_TIMEOUT",i[i.ACCESSHUB_CONNECT=20006]="ACCESSHUB_CONNECT",i[i.ACCESSHUB_BROKEN=20007]="ACCESSHUB_BROKEN",i[i.ACCESSHUB_INTERNAL_ERROR=20008]="ACCESSHUB_INTERNAL_ERROR",i[i.ACCESSHUB_MARSHAL=20009]="ACCESSHUB_MARSHAL",i[i.ACCESSHUB_UNSUPPORTED_SERVICE=20010]="ACCESSHUB_UNSUPPORTED_SERVICE",i[i.ACCESSHUB_TOO_FREQUENTLY=20011]="ACCESSHUB_TOO_FREQUENTLY",i[i.ACCESSHUB_INVALID_APPID=20012]="ACCESSHUB_INVALID_APPID",i[i.ACCESSHUB_HB_TIMEOUT=20013]="ACCESSHUB_HB_TIMEOUT",i[i.ACCESSHUB_INVALID_SIGNATURE=20014]="ACCESSHUB_INVALID_SIGNATURE",(i=r=r||{})[i.SERVICE_UNSET=0]="SERVICE_UNSET",i[i.SERVICE_MEDIAGW=1]="SERVICE_MEDIAGW",i[i.SERVICE_LIVEROOM=2]="SERVICE_LIVEROOM",i[i.SERVICE_MIX=3]="SERVICE_MIX",i[i.SERVICE_ZEUS=4]="SERVICE_ZEUS",i[i.SERVICE_ZPUSH=5]="SERVICE_ZPUSH",i[i.SERVICE_L3=6]="SERVICE_L3",i[i.SERVICE_TALKLINE=7]="SERVICE_TALKLINE",i[i.SERVICE_EDUSUITE=8]="SERVICE_EDUSUITE",i[i.SERVICE_ZIM=9]="SERVICE_ZIM",i[i.SERVICE_ClOUD_SETTING=10]="SERVICE_ClOUD_SETTING",i[i.SERVICE_ZEUSHB=11]="SERVICE_ZEUSHB",i[i.SERVICE_USER_LOGIC=12]="SERVICE_USER_LOGIC",i[i.SERVICE_UNIFYDISPATCH=13]="SERVICE_UNIFYDISPATCH",i[i.SERVICE_QUALITY=14]="SERVICE_QUALITY",i[i.SERVICE_SECURITY=15]="SERVICE_SECURITY",i[i.SERVICE_KTVCPR=16]="SERVICE_KTVCPR",i[i.SERVICE_SWITCH4LIVEROOM=17]="SERVICE_SWITCH4LIVEROOM",i[i.SERVICE_WEBRTC_SIGNAL=18]="SERVICE_WEBRTC_SIGNAL",i[i.SERVICE_L3_WEBRTC_SIGNAL=19]="SERVICE_L3_WEBRTC_SIGNAL",i[i.SERVICE_VIDEOCPR=20]="SERVICE_VIDEOCPR",i[i.SERVICE_CDN=21]="SERVICE_CDN",i[i.SERVICE_CLOUDRECORD=22]="SERVICE_CLOUDRECORD",i[i.SERVICE_INNER_ECHO=23]="SERVICE_INNER_ECHO",i[i.SERVICE_OUTER_ECHO=24]="SERVICE_OUTER_ECHO",i[i.SERVICE_LOCALHOST_ECHO=25]="SERVICE_LOCALHOST_ECHO",i[i.SERVICE_ECHO=26]="SERVICE_ECHO",i[i.SERVICE_DOCSERVICE=27]="SERVICE_DOCSERVICE",i[i.SERVICE_AUTHSVR=28]="SERVICE_AUTHSVR",(i=o=o||{})[i.ZEGOCONN_RUN_ENV_UNSET=0]="ZEGOCONN_RUN_ENV_UNSET",i[i.ZEGOCONN_RUN_ENV_BROWSER=1]="ZEGOCONN_RUN_ENV_BROWSER",i[i.ZEGOCONN_RUN_ENV_APPLET=2]="ZEGOCONN_RUN_ENV_APPLET",(i=u=u||{})[i.Mode_UNSET=0]="Mode_UNSET",i[i.MODE_ONLINE=1]="MODE_ONLINE",i[i.MODE_TEST=2]="MODE_TEST",i[i.MODE_ALPHA=3]="MODE_ALPHA",(i=h=h||{})[i.HTTP=0]="HTTP",i[i.PC=1]="PC",i[i.OTHER=2]="OTHER",(i=c=c||{})[i.NONE=0]="NONE",i[i.BROKEN=1]="BROKEN",i[i.DISCONNECT=2]="DISCONNECT",(i=a=a||{})[i.CONNECTED=0]="CONNECTED",i[i.DISCONNECT=1]="DISCONNECT",i[i.BROKEN=2]="BROKEN";var f,l,_,d,v,m=[p.ACCESSHUB_INVALID_APPID,p.ACCESSHUB_INVALID_SIGNATURE],g=((i=f=f||{})[i.ACTION_RESERVED=0]="ACTION_RESERVED",i[i.ACTION_DISPATCH=1]="ACTION_DISPATCH",i[i.ACTION_RETRY=2]="ACTION_RETRY",i[i.ACTION_NEXT_NODE=3]="ACTION_NEXT_NODE",i[i.ACTION_ABORT=4]="ACTION_ABORT",i[i.ACTION_NEXT_GROUP=5]="ACTION_NEXT_GROUP",(p=l=l||{})[p.METHOD_UNSET=0]="METHOD_UNSET",p[p.METHOD_GET=1]="METHOD_GET",p[p.METHOD_POST=2]="METHOD_POST",p[p.METHOD_PUT=3]="METHOD_PUT",p[p.METHOD_PATCH=4]="METHOD_PATCH",p[p.METHOD_DELETE=5]="METHOD_DELETE",p[p.METHOD_HEAD=6]="METHOD_HEAD",p[p.METHOD_OPTIONS=7]="METHOD_OPTIONS",(i=_=_||{})[i.CLOSE=0]="CLOSE",i[i.TEMP=1]="TEMP",i[i.TIMEOUT=2]="TIMEOUT",(p=d=d||{})[p.AUTO=0]="AUTO",p[p.MANUAL=1]="MANUAL",(i=v=v||{})[i.EMPTY=0]="EMPTY",i[i.CLOSE=1]="CLOSE",{2:"stream_closed",3:"close_connection",4:"http_request",5:"http_response",12:"hb_request",13:"hb_response",14:"get_config_request",15:"get_config_response",16:"http_request_ack",17:"pc_upward_message",18:"pc_upward_message_ack",19:"pc_established",20:"pc_broken",21:"pc_downward_message",22:"redirect",23:"get_appconfig_request",24:"get_appconfig_response",25:"push_appconfig",26:"accesshub_dispatch_request",27:"accesshub_dispatch_response",30:"push_exception",33:"http_request2",34:"redirect2",35:"accesshub_dispatch_request2",36:"accesshub_dispatch_response2",39:"get_svraddr_request",40:"get_svraddr_response"}),p=n(0),b=n.n(p),E=(i=n(1),n(1));p=n(0);E.util.Long=p,E.util.Long.fromBits=E.util.Long?E.util.Long.fromBits:function(){return 0};for(var y=E.roots,S=E.types?E.types.basic:{double:1,float:5,int32:0,uint32:0,sint32:0,fixed32:5,sfixed32:5,int64:0,uint64:0,sint64:0,fixed64:1,sfixed64:1,bool:0,string:2,bytes:2},O=E.types?E.types.packed:{double:1,float:5,int32:0,uint32:0,sint32:0,fixed32:5,sfixed32:5,int64:0,uint64:0,sint64:0,fixed64:1,sfixed64:1,bool:0},R=Object.keys(S),T={$:function(t){return T[t]?T[t].call(this):y[t].decode?y[t].decode(this,this.uint32()):T.$.call(this,"int32")}},w={$:function(t,i,n){var e=S[t];return void 0===e?y[t].encode?(this.uint32((n<<3|2)>>0).fork(),y[t].encode(i,this).ldelim()):w.$.call(this,"int32",i,n):w[t].call(this.uint32(n<<3|e),i)}},N=0;N<R.length;N++)T[R[N]]=E.Reader.prototype[R[N]],w[R[N]]=E.Writer.prototype[R[N]];!function t(i,n,e,s){for(var r=0,o=Object.keys(i);r<o.length;r++){var u=o[r];if(i[u].$m&&Object.keys(i[u].$m).every((function(t){return Number(t)}))){if(e[u])throw Error(`nested type ${e}.${u} has already exist`);e[u]=function(i,e){function s(t){for(var n in i)"{"===(n=i[n])[1].charAt(0)?this[n[0]]={}:"["!==n[1].charAt(0)&&"<"!==n[1].charAt(0)||(this[n[0]]=[]);if(t)for(var e=Object.keys(t),s=0;s<e.length;++s)null!=t[e[s]]&&(this[e[s]]=t[e[s]])}var r,o={};for(r in i){var u=i[r],h=u[1];"{"===h.charAt(0)?(s.prototype[u[0]]=E.util.emptyObject,o[h]={$m:h.substring(1).split(",").map((function(t,i){return["$"+(i+1),t,null]})).reduce((function(t,i,n){return t[n+1]=i,t}),{})}):"["===h.charAt(0)||"<"===h.charAt(0)?s.prototype[u[0]]=E.util.emptyArray:"bytes"===h?s.prototype[u[0]]=E.util.newBuffer([]):u[2]&&u[2].hasOwnProperty("low")&&u[2].hasOwnProperty("high")?s.prototype[u[0]]=E.util.Long.fromBits(u[2].low,u[2].high,u[2].unsigned):s.prototype[u[0]]=u[2]}return s.create=function(t){return new s(t)},s.decode=function(t,n){t instanceof E.Reader||(t=E.Reader.create(t));for(var e=void 0===n?t.len:t.pos+n,r=new s;t.pos<e;){var o=t.uint32(),u=o>>>3;if(0<u&&i[u]){var h=i[u][0],c=i[u][1];if("{"===c.charAt(0))r[h]===E.util.emptyObject&&(r[h]={}),u=s.$namespace[c].decode(t,t.uint32()),r[h][u.$1]=u.$2;else if("["===c.charAt(0)||"<"===c.charAt(0)){c=c.substring(1),r[h]&&r[h].length||(r[h]=[]);const i=!T[c]&&!y[c].decode;if(void 0!==O[c=i?"int32":c]&&2==(7&o))for(var a=t.uint32()+t.pos;t.pos<a;)r[h].push(T.$.call(t,c));else r[h].push(T.$.call(t,c))}else r[h]=T.$.call(t,c)}else t.skipType(7&o)}return r},s.encode=function(t,n){for(var e in n=n||E.Writer.create(),i){var r=i[e][0];if("{"===(c=i[e][1]).charAt(0)){if(null!=t[r]&&t.hasOwnProperty(r))for(var o=0,u=Object.keys(t[r]);o<u.length;++o)n.uint32((e<<3|2)>>0).fork(),s.$namespace[c].encode({$1:u[o],$2:t[r][u[o]]},n).ldelim()}else if("["===c.charAt(0)||"<"===c.charAt(0)){var h="<"===c.charAt(0),c=c.substring(1),a=t[r];if(null!=a&&a.length)if(c=void 0!==S[c]||y[c].encode?c:"int32",h&&void 0!==O[c]){for(n.uint32((e<<3|2)>>0).fork(),o=0;o<a.length;o++)w[c].call(n,a[o]);n.ldelim()}else for(o=0;o<a.length;o++)w.$.call(n,c,a[o],e)}else null!=t[r]&&t.hasOwnProperty(r)&&w.$.call(n,c,t[r],e)}return n},Object.keys(o).length&&(s.$namespace=t(o,n+"."+e,s.$namespace||{},!0)),s}(i[u].$m,u)}else i[u].$s?e[u]=function(t,i){function e(t,i,n){E.rpc.Service.call(this,t,i,n)}return((e.prototype=Object.create(E.rpc.Service.prototype)).constructor=e).create=function(t,i,n){return new e(t,i,n)},Object.keys(t).forEach((function(s){var r=t[s];function o(t,i){return this.rpcCall(o,y[r[0]],y[r[1]],t,i)}Object.defineProperty(o,"name",{value:s}),Object.defineProperty(o,"path",{value:n+"."+i}),e.prototype[s]=o})),e}(i[u].$s,u):i[u].$e&&Object.values(i[u].$e).every((function(t){return Number(t)===t}))&&(e[u]=function(t){for(var i=Object.keys(t),n={},e=0;e<i.length;e++)n[n[i[e]]=t[i[e]]]=i[e];return n}(i[u].$e));e[u]&&!s&&(y[n+"."+u]=e[u]),delete i[u].$m,delete i[u].$s,delete i[u].$e,e[u]=t(i[u],n?n+"."+u:u,e[u]||{})}return e}({protocol:{proto_accesshub:{AccesshubAddr:{$m:{1:["ipv4","fixed32",0],2:["ipv6","protocol.proto_accesshub.IPV6Addr",null],3:["quic_port","uint32",0],4:["wss_port","uint32",0]}},AccesshubDispatchGroup:{$m:{1:["group","string",""],2:["quic_nodes","<string",null],3:["mtcp_nodes","<string",null],4:["wss_nodes","<string",null]}},AccesshubDispatchGroup2:{$m:{1:["group","string",""],2:["nodes","<protocol.proto_accesshub.AccesshubAddr",null],3:["nodes_dual","<protocol.proto_accesshub.AccesshubAddr",null]}},AccesshubDispatchRequest2:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["appid","uint32",0],3:["biz_type","uint32",0],4:["mode_no","protocol.proto_accesshub.Mode",0],5:["id_name","string",""],6:["sdk_type","protocol.proto_accesshub.SdkType",0],7:["zegoconn_version","uint32",0],8:["zegoconn_run_env","protocol.proto_accesshub.ZegoconnRunEnv",0],9:["device_id","string",""],10:["client_ip","string",""],11:["geofencing_type","uint32",0],12:["geofencings","[uint32",null],13:["addr_type","uint32",0]}},AccesshubDispatchResponse2:{$m:{1:["code","int32",0],2:["message","string",""],3:["data","protocol.proto_accesshub.AccesshubDispatchResponseData2",null]}},AccesshubDispatchResponseData2:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["rand","string",""],3:["secret","string",""],4:["groups","<protocol.proto_accesshub.AccesshubDispatchGroup2",null],5:["wss_groups","<protocol.proto_accesshub.WssAccesshubDispatchGroup",null],6:["ttl","uint32",0]}},BackendConnType:{$e:{BACKEND_CONN_TYPE_UNSET:0,BACKEND_CONN_TYPE_TCP:1,BACKEND_CONN_TYPE_WSS:2}},CloseConnection:{$m:{1:["reason","int32",0],2:["msg","string",""],3:["action","int32",0]},Action:{$e:{ACTION_RESERVED:0,ACTION_DISPATCH:1,ACTION_RETRY:2,ACTION_NEXT_NODE:3,ACTION_ABORT:4,ACTION_NEXT_GROUP:5}}},ConnectionClosed:{$m:{1:["code","int32",0],2:["msg","string",""]}},ErrorCode:{$e:{OK:0,DISPATCH_NO_AVAILABLE_NODE:1e4,DISPATCH_INTERNAL_ERROR:10001,DISPATCH_INVALID_FRAME:10002,DISPATCH_UNMARSHAL:10003,DISPATCH_MSGTYPE:10004,DISPATCH_MARSHAL:10005,DISPATCH_TOO_FREQUENTLY:10006,DISPATCH_EMPTY_GEOFENCING:10007,ACCESSHUB_INVALID_FRAME:2e4,ACCESSHUB_NEED_ENCRYPT:20001,ACCESSHUB_DECRYPT:20002,ACCESSHUB_MSGTYPE:20003,ACCESSHUB_UNMARSHAL:20004,ACCESSHUB_TIMEOUT:20005,ACCESSHUB_CONNECT:20006,ACCESSHUB_BROKEN:20007,ACCESSHUB_INTERNAL_ERROR:20008,ACCESSHUB_MARSHAL:20009,ACCESSHUB_UNSUPPORTED_SERVICE:20010,ACCESSHUB_TOO_FREQUENTLY:20011,ACCESSHUB_INVALID_APPID:20012,ACCESSHUB_HB_TIMEOUT:20013,ACCESSHUB_INVALID_SIGNATURE:20014,ACCESSHUB_AUTH_FAILED:20015,ACCESSHUB_UNSUPPORTED_INTERFACE:20016,ACCESSHUB_EMPTY_GEOFENCING:20017,ACCESSHUB_ACCESS_DENIED:20018,ACCESSHUB_SPECIAL_CUSTOMER:20019,ACCESSHUB_GET_STREAM_FAILED:3e4,ACCESSHUB_GET_CONN_FAILED:30001,ACCESSHUB_DO_HTTP_REQUEST_FAILED:30002,ACCESSHUB_UNMARSHAL_HB_FAILED:30003,ACCESSHUB_DO_BACKEND_DISPATCH_FAILED:30004}},GeoFencing:{$e:{CN:2,NA:3,EU:4,AS:5,IN:6,NCN:7}},GeoFencingType:{$e:{NONE:0,UNION:1,EXCLUDE:2}},GetAppConfigRequest:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["appid","uint32",0],3:["biz_type","uint32",0],4:["mode_no","protocol.proto_accesshub.Mode",0],5:["id_name","string",""],6:["config_key","string",""],7:["ts","uint64",{low:0,high:0,unsigned:!0}],8:["signature","bytes",[]],9:["lite_sign","string",""],10:["token","string",""],11:["sdk_type","protocol.proto_accesshub.SdkType",0],12:["zegoconn_version","uint32",0],13:["zegoconn_run_env","protocol.proto_accesshub.ZegoconnRunEnv",0],14:["device_id","string",""],15:["etag","uint32",0],16:["is_special_customer","uint32",0]}},GetAppConfigResponse:{$m:{1:["code","int32",0],2:["message","string",""],3:["data","protocol.proto_accesshub.GetAppConfigResponseData",null]}},GetAppConfigResponseData:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["data","bytes",[]],3:["ts","uint64",{low:0,high:0,unsigned:!0}],4:["etag","uint32",0]}},GetConfigRequest:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["appid","uint32",0],3:["biz_type","uint32",0],4:["mode","string",""],5:["id_name","string",""],6:["reqid","string",""],7:["zegoconn_version","uint32",0],8:["sdk_type","protocol.proto_accesshub.SdkType",0],9:["zegoconn_run_env","protocol.proto_accesshub.ZegoconnRunEnv",0],10:["device_id","string",""],11:["mode_no","protocol.proto_accesshub.Mode",0],12:["geofencing_type","uint32",0],13:["geofencings","[uint32",null]}},GetConfigResponse:{$m:{1:["code","int32",0],2:["message","string",""],3:["data","protocol.proto_accesshub.GetConfigResponseData",null]}},GetConfigResponseData:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["quic_hb_interval","uint32",0],3:["quic_hb_timeout","uint32",0],4:["logic_hb_interval","uint32",0],5:["logic_hb_timeout","uint32",0],6:["pc_establish_timeout","uint32",0],7:["sdk_link_detect_interval","uint32",0],8:["sdk_link_detect_duration","uint32",0],9:["client_outer_ip","string",""],10:["ntp_time","uint64",{low:0,high:0,unsigned:!0}],11:["root_rsa_certs_ver","uint32",0],12:["geofencing_id","uint32",0],13:["svraddr_ver","uint32",0],14:["root_ecc_certs_ver","uint32",0]}},HBRequest:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["ts","int64",{low:0,high:0,unsigned:!1}]}},HBResponse:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["ts","int64",{low:0,high:0,unsigned:!1}],3:["ntp_time","uint64",{low:0,high:0,unsigned:!0}]}},HTTPRequest:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["appid","uint32",0],3:["biz_type","uint32",0],4:["mode","string",""],5:["id_name","string",""],6:["reqid","string",""],7:["stick","string",""],8:["service","string",""],9:["location","string",""],10:["method","string",""],11:["headers","<protocol.proto_accesshub.HTTPRequest.HTTPHeader",null],12:["body","bytes",[]],13:["ack","bool",!1],14:["mode_no","protocol.proto_accesshub.Mode",0],15:["service_no","protocol.proto_accesshub.Service",0],16:["method_no","protocol.proto_accesshub.Method",0],17:["sdk_type","protocol.proto_accesshub.SdkType",0],18:["zegoconn_run_env","protocol.proto_accesshub.ZegoconnRunEnv",0],19:["zegoconn_version","uint32",0],20:["device_id","string",""],21:["reduce_resp_header","uint32",0]},HTTPHeader:{$m:{1:["name","string",""],2:["val","string",""]}}},HTTPRequest2:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["appid","uint32",0],3:["biz_type","uint32",0],4:["mode","protocol.proto_accesshub.Mode",0],5:["id_name","string",""],6:["sdk_type","protocol.proto_accesshub.SdkType",0],7:["zegoconn_run_env","protocol.proto_accesshub.ZegoconnRunEnv",0],8:["zegoconn_version","uint32",0],9:["headers","<protocol.proto_accesshub.HTTPRequest.HTTPHeader",null],10:["method","protocol.proto_accesshub.Method",0],11:["interface_id","uint32",0],12:["res_id","string",""],13:["params","string",""],14:["body","bytes",[]],15:["ack","bool",!1],16:["device_id","string",""],17:["ts","uint64",{low:0,high:0,unsigned:!0}],18:["signature","bytes",[]],19:["token","string",""],20:["lite_sign","string",""],21:["reduce_resp_header","uint32",0]}},HTTPRequestAck:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}]}},HTTPRequestDroped:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["reason","int32",0],3:["msg","string",""]}},HTTPResponse:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["headers","<protocol.proto_accesshub.HTTPRequest.HTTPHeader",null],3:["status_code","int32",0],4:["body","bytes",[]]}},IPAddr:{$m:{1:["ipv4","fixed32",0],2:["ipv6","protocol.proto_accesshub.IPV6Addr",null]}},IPV6Addr:{$m:{1:["high","fixed64",{low:0,high:0,unsigned:!1}],2:["low","fixed64",{low:0,high:0,unsigned:!1}]}},MessageType:{$e:{MSG_TYPE_EMPTY:0,MSG_TYPE_CONNECTION_CLOSED:1,MSG_TYPE_STREAM_CLOSED:2,MSG_TYPE_CLOSE_CONNECTION:3,MSG_TYPE_HTTP_REQUEST:4,MSG_TYPE_HTTP_RESPONSE:5,MSG_TYPE_HTTP_REQUEST_DROPED:6,MSG_TYPE_PROXY_CONNECT:7,MSG_TYPE_PROXY_CONNECTED:8,MSG_TYPE_PROXY_CONNECTION_CLOSED:9,MSG_TYPE_PROXY_SEND_DATA:10,MSG_TYPE_PROXY_RECV_DATA:11,MSG_TYPE_HB_REQUEST:12,MSG_TYPE_HB_RESPONSE:13,MSG_TYPE_GET_CONFIG_REQUEST:14,MSG_TYPE_GET_CONFIG_RESPONSE:15,MSG_TYPE_HTTP_REQUEST_ACK:16,MSG_TYPE_PC_UPWARD_MESSAGE:17,MSG_TYPE_PC_UPWARD_MESSAGE_ACK:18,MSG_TYPE_PC_ESTABLISHED:19,MSG_TYPE_PC_BROKEN:20,MSG_TYPE_PC_DOWNWARD_MESSAGE:21,MSG_TYPE_REDIRECT:22,MSG_TYPE_GET_APPCONFIG_REQUEST:23,MSG_TYPE_GET_APPCONFIG_RESPONSE:24,MSG_TYPE_PUSH_APPCONFIG:25,MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST:26,MSG_TYPE_ACCESSHUB_DISPATCH_RESPONSE:27,MSG_TYPE_GET_IM_CONFIG_REQUEST:28,MSG_TYPE_GET_IM_CONFIG_RESPONSE:29,MSG_TYPE_PUSH_EXCEPTION:30,MSG_TYPE_RESOLVE_DOMAIN_REQUEST:31,MSG_TYPE_RESOLVE_DOMAIN_RESPONSE:32,MSG_TYPE_HTTP_REQUEST2:33,MSG_TYPE_REDIRECT2:34,MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST2:35,MSG_TYPE_ACCESSHUB_DISPATCH_RESPONSE2:36,MSG_TYPE_GET_ROOTCERTS_REQUEST:37,MSG_TYPE_GET_ROOTCERTS_RESPONSE:38,MSG_TYPE_GET_SVRADDR_REQUEST:39,MSG_TYPE_GET_SVRADDR_RESPONSE:40,MSG_TYPE_UA_DISPATCH_REQUEST:50,MSG_TYPE_UA_DISPATCH_RESPONSE:51,MSG_TYPE_UA_ECHO_REQUEST:52,MSG_TYPE_UA_ECHO_RESPONSE:53,MSG_TYPE_NODE_REGISTER_REQUEST:100,MSG_TYPE_NODE_REGISTER_RESPONSE:101,MSG_TYPE_NODE_HB_REQUEST:102,MSG_TYPE_NODE_HB_RESPONSE:103}},Method:{$e:{METHOD_UNSET:0,METHOD_GET:1,METHOD_POST:2,METHOD_PUT:3,METHOD_PATCH:4,METHOD_DELETE:5,METHOD_HEAD:6,METHOD_OPTIONS:7}},Mode:{$e:{Mode_UNSET:0,MODE_ONLINE:1,MODE_TEST:2,MODE_ALPHA:3}},PCBroken:{$m:{}},PCDownwardMessage:{$m:{1:["payload","bytes",[]],2:["wss_message_type","uint32",0],3:["ts","uint64",{low:0,high:0,unsigned:!0}]}},PCEstablished:{$m:{1:["elapse","uint32",0],2:["from","uint32",0]}},PCUpwardMessage:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["appid","uint32",0],3:["biz_type","uint32",0],4:["mode_no","protocol.proto_accesshub.Mode",0],5:["id_name","string",""],6:["service_no","protocol.proto_accesshub.Service",0],7:["ack","bool",!1],8:["payload","bytes",[]],9:["sdk_type","protocol.proto_accesshub.SdkType",0],10:["wss_message_type","uint32",0],11:["wss_path","string",""],12:["wss_raw_query","string",""],13:["zegoconn_version","uint32",0],14:["zegoconn_run_env","protocol.proto_accesshub.ZegoconnRunEnv",0],15:["backend_conn_type","protocol.proto_accesshub.BackendConnType",0],16:["device_id","string",""],17:["geofencing_type","uint32",0],18:["geofencings","[uint32",null],19:["addr_type","uint32",0]}},PCUpwardMessageAck:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}]}},ProxyConnectionClosed:{$m:{1:["code","int32",0],2:["msg","string",""],3:["connected","int32",0]}},PushAppConfig:{$m:{1:["config_key","string",""],2:["data","bytes",[]]}},PushException:{$m:{1:["reason","int32",0],2:["msg","string",""],3:["txid","uint64",{low:0,high:0,unsigned:!0}]}},Redirect2:{$m:{1:["rand","string",""],2:["secret","string",""],3:["groups","<protocol.proto_accesshub.AccesshubDispatchGroup2",null],4:["wss_groups","<protocol.proto_accesshub.WssAccesshubDispatchGroup",null],5:["ttl","uint32",0]}},SdkType:{$e:{SDK_TYPE_UNSET:0,SDK_TYPE_NATIVE:1,SDK_TYPE_WSS_WEB:3}},Service:{$e:{SERVICE_UNSET:0,SERVICE_MEDIAGW:1,SERVICE_LIVEROOM:2,SERVICE_MIX:3,SERVICE_ZEUS:4,SERVICE_ZPUSH:5,SERVICE_L3:6,SERVICE_TALKLINE:7,SERVICE_EDUSUITE:8,SERVICE_ZIM:9,SERVICE_ClOUD_SETTING:10,SERVICE_ZEUSHB:11,SERVICE_USER_LOGIC:12,SERVICE_UNIFYDISPATCH:13,SERVICE_QUALITY:14,SERVICE_SECURITY:15,SERVICE_KTVCPR:16,SERVICE_SWITCH4LIVEROOM:17,SERVICE_WEBRTC_SIGNAL:18,SERVICE_L3_WEBRTC_SIGNAL:19,SERVICE_VIDEOCPR:20,SERVICE_CDN:21,SERVICE_CLOUDRECORD:22,SERVICE_INNER_ECHO:23,SERVICE_OUTER_ECHO:24,SERVICE_LOCALHOST_ECHO:25,SERVICE_ECHO:26,SERVICE_DOCSERVICE:27,SERVICE_AUTHSVR:28,SERVICE_WEBLIVEROOM:29,SERVICE_WHITEBOARD:30,SERVICE_METAWORLD:31,SERVICE_ZEGOLAND:32}},StreamClosed:{$m:{1:["code","int32",0],2:["msg","string",""]}},WssAccesshubDispatchGroup:{$m:{1:["group","string",""],2:["host","string",""],3:["main_domain","string",""]}},ZegoconnRunEnv:{$e:{ZEGOCONN_RUN_ENV_UNSET:0,ZEGOCONN_RUN_ENV_BROWSER:1,ZEGOCONN_RUN_ENV_APPLET:2}}},proto_initconfig:{AppConfig:{$m:{1:["test_id","int32",0],2:["domain","string",""],3:["flexible_domain","string",""],4:["replace_flexible_domain","string",""]}},InitConfig:{$m:{1:["app_config","protocol.proto_initconfig.AppConfig",null],4:["speedlog_config","protocol.proto_initconfig.SpeedlogConfig",null],5:["media_config","protocol.proto_initconfig.MediaConfig",null]}},MediaConfig:{$m:{1:["play_config","protocol.proto_initconfig.MediaPlayConfig",null],2:["publish_config","protocol.proto_initconfig.MediaPublishConfig",null]}},MediaPlayConfig:{$m:{5:["resource_info","<protocol.proto_initconfig.MediaResourceInfo",null]}},MediaPublishConfig:{$m:{2:["resource_info","<protocol.proto_initconfig.MediaResourceInfo",null],5:["enable_subject_segmentation","int32",0],6:["object_segmentation_platform","int32",0]}},MediaResourceInfo:{$m:{1:["resource_type","protocol.proto_initconfig.ResourceType",0],2:["service_info","<protocol.proto_initconfig.MediaServiceProtocolInfo",null]}},MediaServiceProtocolInfo:{$m:{1:["config_id","string",""],2:["protocol","protocol.proto_initconfig.ProtocolType",0],3:["url_template","string",""],4:["resolve_type","protocol.proto_initconfig.ResolveType",0],5:["push_cdn_authentication","int32",0],6:["cdn_quic_version","<int32",null]}},ProtocolType:{$e:{UDP:0,RTMP:1,FLV:2,HLS:3,WEBRTC:4}},ResolveType:{$e:{LOCAL_DNS:0,DISPATCH:1}},ResourceType:{$e:{CDN:0,RTC:1,L3:2,CDN_PLUS:3,CDN_PLUS_BACKUP:4}},SpeedlogConfig:{$m:{1:["report_count","int32",0],2:["report_retry_interval","int32",0],3:["push_quality_sample_count","int32",0],4:["pull_quality_sample_count","int32",0],5:["hardware_report_cycle","int32",0],6:["room_user_max_count","int32",0],7:["room_stream_max_count","int32",0],8:["charge_info_report_cycle","int32",0],9:["charge_info_report_mode","int32",0],10:["disable_report_pull","<protocol.proto_initconfig.ResourceType",null],11:["report_max_bytes","int32",0],12:["push_quality_report_freq","int32",0],13:["pull_quality_report_freq","int32",0],14:["charge_info_report_no_playing","int32",0]}}}}},"",y,!1);var I=y.protocol,C=function(){return(C=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var s in i=arguments[n])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t}).apply(this,arguments)};i.util.Long=b.a,i.configure(),z.prototype.encodeRequest=function(t,i,n){var e=(s=this._[t])[0],s=s[1];s=(e=this.S(this.h[e][s],i)).length;return(i=new Uint8Array(13+s))[0]=175,i[1]=0,i[2]=t>>8,i[3]=t-(i[2]<<8),i.set(new Uint8Array(Int32Array.from([s]).buffer).reverse(),4),i.set(new Uint8Array(Int32Array.from([n]).buffer).reverse(),8),i[12]=0,i.set(e,13),i},z.prototype.decodeResponse=function(t){var i=(t[2]<<8)+t[3],n=new DataView(t.buffer).getUint32(8),e=t.slice(13);try{var s=this._[i],r=s[0],o=s[1];return[n,i,this.T(this.h[r][o],e)]}catch(t){return[n,i,{code:1}]}},z.prototype.decodeConfigMessage=function(t){return this.T(this.h.proto_initconfig.InitConfig,t)},z.prototype.S=function(t,i){return t.encode(new t(i)).finish()},z.prototype.T=function(t,i){return C({},t.decode(i))};var k,A=z,D=(Object.defineProperty(j.prototype,"id",{get:function(){return this.C||null},set:function(t){this.C=t},enumerable:!1,configurable:!0}),Object.defineProperty(j.prototype,"data",{get:function(){return this.v},set:function(t){this.v=t},enumerable:!1,configurable:!0}),j.prototype.hasNext=function(){return this.next&&this.next.id},j.prototype.hasPrev=function(){return this.prev&&this.prev.id},j),P=(U.prototype.insertBefore=function(t,i){return(i=new D(this.g,i)).next=t,i.prev=t.prev,t.prev&&(t.prev.next=i),t.prev=i,++this.g,++this.R,i},U.prototype.addLast=function(t){return this.insertBefore(this.end,t)},U.prototype.add=function(t){return this.addLast(t)},U.prototype.getFirst=function(){return 0===this.R?null:this.start.next},U.prototype.getLast=function(){return 0===this.R?null:this.end.prev},U.prototype.size=function(){return this.R},U.prototype.getFromFirst=function(t){var i=0,n=this.start.next;if(0<=t)for(;i<t&&null!==n;)n=n.next,++i;else n=null;if(null===n)throw"Index out of bounds.";return n},U.prototype.get=function(t){return 0===t?this.getFirst():t===this.R-1?this.getLast():this.getFromFirst(t)},U.prototype.remove=function(t){return t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),--this.R,t},U.prototype.removeFirst=function(){var t=null;return 0<this.R&&this.start.next?this.remove(this.start.next):t},U.prototype.removeLast=function(){var t=null;return 0<this.R&&this.end.prev?this.remove(this.end.prev):t},U.prototype.removeAll=function(){this.start.next=this.end,this.end.prev=this.start,this.R=0,this.g=0},U.prototype.each=function(t){for(var i=this.start;i.hasNext();)t(i=i.next)},U.prototype.find=function(t){for(var i=this.start,n=!1,e=null;i.hasNext()&&!n;)t(i=i.next)&&(e=i,n=!0);return e},U.prototype.map=function(t){for(var i=this.start,n=[];i.hasNext();)t(i=i.next)&&n.push(i);return n},U.prototype.push=function(t){return this.addLast(t)},U.prototype.unshift=function(t){0<this.R?this.insertBefore(this.start.next,t):this.insertBefore(this.end,t)},U.prototype.pop=function(){return this.removeLast()},U.prototype.shift=function(){return this.removeFirst()},U);M.prototype.createSocket=function(t){},M.prototype.setState=function(t){},M.prototype.initEvent=function(t,i,n,e){},M.prototype.sendMessage=function(t,i,n,e,s,r,o,u){void 0===e&&(e=!0),void 0===s&&(s=null),void 0===r&&(r=null),void 0===o&&(o=null)},n=M;function M(){this.txid=0,this.linkRetryTime=60,this.updatedMsgTime=0,this.connectServer=""}function U(){this.start=new D,this.end=new D,this.g=0,this.R=0,this.start.next=this.end,this.start.prev=null,this.end.prev=this.start,this.end.next=null}function j(t,i){void 0===t&&(t=null),void 0===i&&(i=null),this.next=null,this.prev=null,this.C=t,this.v=i}function z(){var t;this.h=I,this._=((t={})[s.MSG_TYPE_STREAM_CLOSED]=["proto_accesshub","ConnectionClosed"],t[s.MSG_TYPE_CLOSE_CONNECTION]=["proto_accesshub","CloseConnection"],t[s.MSG_TYPE_HTTP_REQUEST]=["proto_accesshub","HTTPRequest"],t[s.MSG_TYPE_HTTP_RESPONSE]=["proto_accesshub","HTTPResponse"],t[s.MSG_TYPE_HTTP_REQUEST2]=["proto_accesshub","HTTPRequest2"],t[s.MSG_TYPE_HB_REQUEST]=["proto_accesshub","HBRequest"],t[s.MSG_TYPE_HB_RESPONSE]=["proto_accesshub","HBResponse"],t[s.MSG_TYPE_GET_CONFIG_REQUEST]=["proto_accesshub","GetConfigRequest"],t[s.MSG_TYPE_GET_CONFIG_RESPONSE]=["proto_accesshub","GetConfigResponse"],t[s.MSG_TYPE_GET_SVRADDR_REQUEST]=["proto_accesshub","GetSvraddrRequest"],t[s.MSG_TYPE_GET_SVRADDR_RESPONSE]=["proto_accesshub","GetSvraddrResponse"],t[s.MSG_TYPE_HTTP_REQUEST_ACK]=["proto_accesshub","HTTPRequestAck"],t[s.MSG_TYPE_PC_UPWARD_MESSAGE]=["proto_accesshub","PCUpwardMessage"],t[s.MSG_TYPE_PC_UPWARD_MESSAGE_ACK]=["proto_accesshub","PCUpwardMessageAck"],t[s.MSG_TYPE_PC_ESTABLISHED]=["proto_accesshub","PCEstablished"],t[s.MSG_TYPE_PC_BROKEN]=["proto_accesshub","PCBroken"],t[s.MSG_TYPE_PC_DOWNWARD_MESSAGE]=["proto_accesshub","PCDownwardMessage"],t[s.MSG_TYPE_REDIRECT]=["proto_accesshub","Redirect"],t[s.MSG_TYPE_REDIRECT2]=["proto_accesshub","Redirect2"],t[s.MSG_TYPE_GET_APPCONFIG_REQUEST]=["proto_accesshub","GetAppConfigRequest"],t[s.MSG_TYPE_GET_APPCONFIG_RESPONSE]=["proto_accesshub","GetAppConfigResponse"],t[s.MSG_TYPE_PUSH_APPCONFIG]=["proto_accesshub","PushAppConfig"],t[s.MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST]=["proto_accesshub","AccesshubDispatchRequest"],t[s.MSG_TYPE_ACCESSHUB_DISPATCH_RESPONSE]=["proto_accesshub","AccesshubDispatchResponse"],t[s.MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST2]=["proto_accesshub","AccesshubDispatchRequest2"],t[s.MSG_TYPE_ACCESSHUB_DISPATCH_RESPONSE2]=["proto_accesshub","AccesshubDispatchResponse2"],t[s.MSG_TYPE_PUSH_EXCEPTION]=["proto_accesshub","PushException"],t)}(p=k=k||{})[p.BROWSER=0]="BROWSER",p[p.WEIXINMINI=1]="WEIXINMINI",x.prototype.init=function(){var t=this;this.O&&(this.readyState=0,this.O.onOpen((function(i){t.readyState=t.O.readyState,"function"==typeof t.onopen&&(t.onopen(i),t.O.onClose((function(i){t.readyState=t.O.readyState,"function"==typeof t.onclose&&t.onclose(i)})),t.O.onMessage((function(i){"function"==typeof t.onmessage&&t.onmessage(i)})))})),this.O.onError((function(i){t.readyState=t.O.readyState,"function"==typeof t.onerror&&t.onerror(i)})))},x.prototype.onopen=function(t){},x.prototype.onerror=function(t){},x.prototype.onclose=function(t){},x.prototype.onmessage=function(t){},x.prototype.send=function(t){t instanceof Uint8Array&&(t=new Uint8Array(t).buffer),this.O&&this.O.send({data:t})},x.prototype.close=function(){this.O&&this.O.close()};var L=x;function x(t,i){this.url=t,this.readyState=3,this.O=wx.connectSocket({url:t}),this.init()}function H(t,i,n){if(n||2===arguments.length)for(var e,s=0,r=i.length;s<r;s++)!e&&s in i||((e=e||Array.prototype.slice.call(i,0,s))[s]=i[s]);return t.concat(e||Array.prototype.slice.call(i))}function G(t){var i=unescape||window.unescape;return Uint8Array.from(Array.from(i(encodeURIComponent(t))).map((function(t){return t.charCodeAt(0)})))}function q(t){var i=escape||window.escape;return decodeURIComponent(i(String.fromCharCode.apply(String,Array.from(t))))}function B(t,i,n){if(n||2===arguments.length)for(var e,s=0,r=i.length;s<r;s++)!e&&s in i||((e=e||Array.prototype.slice.call(i,0,s))[s]=i[s]);return t.concat(e||Array.prototype.slice.call(i))}xt.prototype.createSocket=function(t){var i,n;this.P=(i=this.ENV%2,n=this.proxyCtrl,i%2===k.BROWSER?(i=t,n?n.createSocket(i):new WebSocket(i)):new L(t))},xt.prototype.openHandler=function(t){var i=this;this.P&&(this.P.onopen=function(n){i.P.binaryType="arraybuffer",i.responseHandler(),t(n)})},xt.prototype.responseHandler=function(){var t=this;this.P&&(this.P.onmessage=function(i){i="string"==typeof i.data?JSON.parse(i.data):i.data,t.onMessage(i)})},xt.prototype.onMessage=function(t){},xt.prototype.closeHandler=function(t){this.P&&(this.P.onclose=function(i){t(i)})},xt.prototype.errorHandler=function(t){this.P&&(this.P.onerror=t)},xt.prototype.closeSocket=function(){this.P&&(this.P.onclose=null,this.P.onerror=null,this.P.close(),this.P=null)},xt.prototype.isDisConnect=function(){return!this.P||1!==this.P.readyState},xt.prototype.sendMessage=function(t){this.isDisConnect()||this.P&&this.P.send(t)};var $,V=xt,J={TIMEOUT:{code:1100002,msg:"network timeout."},SOCKET_CLOSE:{code:1100003,msg:"socket close"},NET_SOCKET_TIMEOUT:{code:1100004,msg:"net agent timeout"},NET_HB_TIMEOUT:{code:1100005,msg:"net hb timeout"},NET_CONNECT_TIMEOUT:{code:1100006,msg:"net connect timeout"}},Y="zn.zca.gc",F="zn.zca.gac",K="zn.zca.rd",W="zn.zca.cc",Z="zn.shq.0",X="zn.nab.du",Q="zn.nab.gac",tt="zn.nhb.s",it="zn.rlh.at",nt="zn.rlh.sm",et="zn.wl.cs.0",st="zn.wl.bse",rt="zn.napr.sr",ot="zn.napr.ope",ut="zn.nahr.sr",ht="zn.nahr.sr2",ct={domains:["accesshub-wss.zego.im"],mode:"online",modeNo:u.MODE_ONLINE,sdkType:3,connectVer:30,pcEstablishTimeout:15,scheme:"wss",location:"accesshub",wssMessageType:1},at=($=function(t,i){return($=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}))(t,i)},function(){return(at=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var s in i=arguments[n])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t}).apply(this,arguments)}),ft=function(t){function i(i,n,e,r,o,u){var h=t.call(this)||this;return h.A=i,h.N=n,h.I=e,h.D=r,h.M=o,h.proxyCtrl=u,h.socketService=new V(h.N,h.proxyCtrl),h.urlIndex=0,h.updatedMsgTime=0,h.unUpdateMsgTimeTypes=[s.MSG_TYPE_HB_REQUEST,s.MSG_TYPE_HB_RESPONSE,s.MSG_TYPE_GET_CONFIG_REQUEST,s.MSG_TYPE_GET_CONFIG_RESPONSE,s.MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST2,s.MSG_TYPE_ACCESSHUB_DISPATCH_RESPONSE2],h.netLinkState=0,h.sendCommandList=new P,h.unSendCommandList=new P,h.sendCommandMap={},h.unSendCommandMap={},h.U=100,h.H=1e4,h.G=2e3,h.Y=5e3,h.connectInterval=1e4,h.connectTimer=null,h.connectRsp={},h.unlogTypes=[12,13],h.tryServers=[],h.tryConnectEvents=[],h.connectStartTime=0,h.updatedMsgTime=Date.now(),h}var n=i,e=t;if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=n}return $(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r),i.prototype.initEvent=function(t,i,n,e){this.V=t,this.B=i,this.k=n,this.L=e},i.prototype.createSocket=function(t){this.servers=t,this.urlIndex=0},i.prototype.destroySocket=function(t){this.D.info("zn.wl.ds.0 call "+t),this.socketService.closeSocket(),this.netLinkState=0,t!==c.NONE&&this.B&&this.B(t===c.BROKEN),this.resetConnect()},i.prototype.refreshServers=function(t){this.servers=H(H([],t,!0),this.servers,!0)},i.prototype.connectSocket=function(t,i,n){var e=this,s=(void 0===t&&(t=!0),this.D.info(et+" call"),this.connectRsp.suc=i,!1),r=(this.connectRsp.fail=function(){n&&(s?e.D.info(et+" fail cb has exec"):(n(),s=!0))},t&&(this.urlIndex=(this.urlIndex+1)%this.servers.length),this.servers[this.urlIndex]);return this.connectServer=r,this.D.info(et+" server "+r),this.tryServers.push(r),this.connectStartTime=Date.now(),this.closeSocket(),this.netLinkState=1,this.socketService.createSocket(r),this.k&&this.k(!0),this.bindSocketEvent(),this.connectTimer=setTimeout((function(){e.D.info(et+" timeout"),e.q(r,J.NET_CONNECT_TIMEOUT.code),e.connectRsp.fail&&e.connectRsp.fail()}),this.connectInterval),!0},i.prototype.bindSocketEvent=function(){var t=this;this.openHandler((function(){t.D.info(st+" open"),t.resetConnect(),t.connectRsp.suc&&t.connectRsp.suc(),t.netLinkState=2,t.q(t.connectServer,0),t.V&&t.V(t.tryServers,t.tryConnectEvents),t.tryConnectEvents=[],t.checkUnSendMsgs(t.unSendCommandList),t.startCheck()})),this.closeHandler((function(i){t.D.warn(st+" close "+JSON.stringify(i.code||i)),t.resetConnect(),t.connectRsp.fail&&t.connectRsp.fail(),t.q(t.connectServer,(null==i?void 0:i.code)||J.NET_CONNECT_TIMEOUT.code),t.B&&t.B(!0),t.netLinkState=0})),this.errorHandler((function(i){t.D.warn(st+" error "+JSON.stringify(i.code||i)),t.resetConnect(),t.connectRsp.fail&&t.connectRsp.fail(),t.q(t.connectServer,(null==i?void 0:i.code)||J.NET_CONNECT_TIMEOUT.code),t.B&&t.B(!0),t.netLinkState=0})),this.onMessage()},i.prototype.closeSocket=function(){this.D.info("zn.wl.cs.1 call"),this.socketService.closeSocket(),this.netLinkState=0},i.prototype.q=function(t,i){var n;this.connectStartTime&&(n=Date.now()-this.connectStartTime,this.tryConnectEvents.push({url:t,time_consumed:n,connect_type:3,error:i}))},i.prototype.resetConnect=function(){this.connectTimer&&(clearTimeout(this.connectTimer),this.connectTimer=null),this.stopCheck()},i.prototype.isConnect=function(){return 2===this.netLinkState},i.prototype.isDisConnect=function(){return!this.socketService||this.socketService.isDisConnect()},i.prototype.isConnecting=function(){return 1===this.netLinkState},i.prototype.setState=function(t){this.netLinkState=t},i.prototype.closeHandler=function(t){this.socketService.closeHandler(t)},i.prototype.openHandler=function(t){this.socketService.openHandler(t)},i.prototype.errorHandler=function(t){this.socketService.errorHandler(t)},i.prototype.sendMessage=function(t,i,n,e,r,u,h,c){void 0===e&&(e=!0),void 0===r&&(r=null),void 0===u&&(u=null),void 0===h&&(h=null),void 0===(c=void 0===c?{}:c).timeout&&(c.timeout=5e3),void 0===c.isInSendMap&&(c.isInSendMap=!0),void 0===c.isMsgCache&&(c.isMsgCache=!0),this.txid++;var a={appid:this.A,biz_type:0,mode_no:(null==(a=this.M.appInfo)?void 0:a.mode)||ct.modeNo,id_name:this.M.userId,sdk_type:ct.sdkType,zegoconn_run_env:0===this.N?o.ZEGOCONN_RUN_ENV_BROWSER:o.ZEGOCONN_RUN_ENV_APPLET,zegoconn_version:(null==(a=this.M.appInfo)?void 0:a.connVer)||ct.connectVer};null!=(f=this.M.appInfo)&&f.deviceID&&(a.device_id=null==(f=this.M.appInfo)?void 0:f.deviceID);var f=at(at({txid:this.txid},e?a:{}),n);e={data:f,txid:this.txid,sendTime:Date.now(),streamID:i,type:t,timeOut:c.timeout||this.Y,ack:n.ack,success:r,error:u,ackFunc:h,isSend:!0,isCheck:t!==s.MSG_TYPE_PC_UPWARD_MESSAGE,extras:c.extras};c.isInSendMap&&(a=this.sendCommandList.push(e),this.sendCommandMap[this.txid]=a),10!==f.service&&14!==f.interface_id&&this.unUpdateMsgTimeTypes.includes(t)||(this.updatedMsgTime=Date.now()),-1===this.unlogTypes.indexOf(t)&&this.D.info("zn.wl.sm type: "+t+"-"+g[t]+" streamID: "+i+" txid: "+this.txid),this.isConnect()?this.sendUint8Data(t,f,i,c.extras):c.isMsgCache&&(e.isSend=!1,n=this.unSendCommandList.push(e),this.unSendCommandMap[this.txid]=n)},i.prototype.checkUnSendMsgs=function(t){for(var i,n=t.getFirst();null!=n;)t.remove(n),n.v&&!1===(null==(i=n.v)?void 0:i.isSend)&&n.v.type&&n.v.streamID&&n.v.data&&(this.sendUint8Data(n.v.type,n.v.data,n.v.streamID),n.v.isSend=!0),n=t.getFirst()},i.prototype.j=function(t){return t.buffer.slice(t.byteOffset,t.byteLength+t.byteOffset)},i.prototype.sendUint8Data=function(t,i,n,e){t=this.I.encodeRequest(t,i,n),this.socketService.sendMessage(this.j(t))},i.prototype.onMessage=function(){var t=this;this.socketService.onMessage=function(i){i=new Uint8Array(i);var n,e,s=(e=t.I.decodeResponse(i))[0],r=e[1],o=((e=e[2]).txid&&b.a.isLong(e.txid)&&e.txid.toNumber&&(e.txid=e.txid.toNumber()),t.unUpdateMsgTimeTypes.includes(r)||(t.updatedMsgTime=Date.now()),(null==e?void 0:e.txid)||(null==(o=null==e?void 0:e.data)?void 0:o.txid));-1===t.unlogTypes.indexOf(r)&&(n=o?", txid: ".concat(o):"",t.D.info("zn.wl.om"+" streamID: ".concat(s,", msgType: ").concat(r,"-").concat(g[r])+n)),o&&t.isRspMsg(o)?t.handleSendCommandMsgRsp(s,r,o,e,{size:i.length}):t.L(s,r,e,{size:i.length})}},i.prototype.isRspMsg=function(t){return void 0!==this.sendCommandMap[t]},i.prototype.startCheck=function(){var t=this;this.F(this.sendCommandList,this.sendCommandMap),this.W=setTimeout((function(){t.startCheck()}),this.G)},i.prototype.stopCheck=function(){this.K(this.sendCommandList),clearTimeout(this.W)},i.prototype.F=function(t,i){for(var n,e=t.getFirst(),s=Date.now(),r=0,o=this;null!=e&&"break"!==function(){var u,h,c;return e.v&&e.v.sendTime+e.v.timeOut>s||(e.v&&delete i[e.v.data.txid],t.remove(e),e.v&&null==e.v.error||e.v&&e.v.sendTime+o.H<s||(u=e&&e.v&&e.v.error,h=e&&e.v&&e.v.txid,c=e&&e.v&&(null==(n=e.v)?void 0:n.isCheck),setTimeout((function(){c&&u&&u({},h,J.TIMEOUT)}),0)),++r>=o.U)?"break":void(e=t.getFirst())}(););},i.prototype.K=function(t){for(var i,n=t.getFirst();null!=n&&n.v;)!function(){var e,s,r;t.remove(n),n.v.isSend&&n.v.error&&(e=n&&n.v&&n.v.error,s=n&&n.v&&n.v.txid,r=n&&n.v&&(null==(i=n.v)?void 0:i.isCheck),setTimeout((function(){r&&e&&e({},s,J.TIMEOUT)}),0)),n=t.getFirst()}()},i.prototype.handleSendCommandMsgRsp=function(t,i,n,e,r){var o,u=this.sendCommandMap[n];null!=u&&(null!=(o=u.v)&&o.ack||(delete this.sendCommandMap[n],this.sendCommandList.remove(u)),e.code&&0!==e.code?o&&null!=o.error&&o.error(e,n):i===s.MSG_TYPE_PUSH_EXCEPTION?(e.code=e.reason,e.message=e.msg,delete e.reason,delete e.msg,o&&null!=o.error&&o.error(e,n)):i===s.MSG_TYPE_HTTP_REQUEST_ACK?o&&null!=o.ackFunc&&o.ackFunc(e,n):o&&null!=o.success&&o.success(e,n,r))},i}(n),lt=(Lt.prototype.getConfig=function(t,i){var n;this.D.info("zn.nab.gc call"),this.Z.createStream(h.OTHER).sendMessage(s.MSG_TYPE_GET_CONFIG_REQUEST,{geofencing_type:null==(n=this.stateCenter.appInfo.geoFencing)?void 0:n.type,geofencings:null==(n=this.stateCenter.appInfo.geoFencing)?void 0:n.list},t,i)},Lt.prototype.dispatchURL=function(t,i){var n,e=this;this.D.info(X+" call"),this.Z.createStream(h.OTHER).sendMessage(s.MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST2,{geofencing_type:null==(n=this.stateCenter.appInfo.geoFencing)?void 0:n.type,geofencings:null==(n=this.stateCenter.appInfo.geoFencing)?void 0:n.list},(function(i){e.D.info(X+" suc "),t&&t(i)}),(function(t,n,s){e.D.info(X+" fail"),i&&i(s||t)}))},Lt.prototype.getAppConfig=function(t,i,n,e,r){var o=this;return new Promise((function(u,c){function a(t,i,n){n?(o.D.error(Q+" fail "+JSON.stringify(n)),c(n)):0===t.code?(o.D.info(Q+" suc"),n=o.decodeConfigMessage(t.data.data),u({code:0,data:n,etag:t.data.etag})):(o.D.error(Q+" fail "+t.code),c({code:t.code}))}o.D.info(Q+" call");var f={id_name:i,config_key:t,token:n,mode_no:(null==(f=o.stateCenter.appInfo)?void 0:f.mode)||ct.modeNo,etag:r};o.Z.createStream(h.OTHER).sendMessage(s.MSG_TYPE_GET_APPCONFIG_REQUEST,f,a,a,null,{timeout:e})}))},Lt.prototype.decodeConfigMessage=function(t){return this.I.decodeConfigMessage(t)},Lt),_t=(zt.prototype.init=function(t){var i=this;this.D.info("zn.nhb.ii call"),this.et||(this.et=this.Z.createStream(h.OTHER)),1<=t.data.logic_hb_interval&&t.data.logic_hb_interval<=10&&(this.X=t.data.logic_hb_interval),3<=t.data.logic_hb_timeout&&t.data.logic_hb_timeout<=30&&(this.tt=t.data.logic_hb_timeout),this.nt=0,this.it=this.tt/this.X,this.J&&clearTimeout(this.J),this.J=setTimeout((function(){i.start()}),1e3*this.X)},zt.prototype.start=function(){var t,i,n,e=this;this.D.debug(tt+" call "),this.nt++>this.it?(this.D.error(tt+" come to try limit"),this.reset(),this.netHbLogout(J.NET_HB_TIMEOUT)):(t=(new Date).getTime(),i=function(i,n,s){var r=(new Date).getTime()-t;e.D.debug(tt+" hb callback "+r),s&&0!==(null==s?void 0:s.code)?e.D.info(tt+" fail "+JSON.stringify(s)):(null!=i&&i.ntp_time&&(s="number"==typeof(r=i.ntp_time)?r:r.toNumber(),i=(new Date).getTime(),e.M.updateNTP(t,s,i)),e.nt=0)},n={ts:Date.now()},this.et.sendMessage(s.MSG_TYPE_HB_REQUEST,n,i,i,null),this.et.isFirst=!1,this.J&&clearTimeout(this.J),this.J=setTimeout((function(){e.start()}),1e3*this.X))},zt.prototype.netHbLogout=function(t){},zt.prototype.reset=function(){this.J&&(clearTimeout(this.J),this.J=null),this.nt=0},zt),dt=(jt.prototype.addEventHandler=function(t,i){if(this.st[t]||(this.st[t]=[]),"function"!=typeof i)throw new Error("Params callBack is not a Function");return this.st[t]&&-1==this.st[t].indexOf(i)&&this.st[t].push(i),!0},jt.prototype.removeEventHandler=function(t,i){return!!this.st[t]&&(this.st[t]=i?this.st[t].filter((function(t){return t!==i})):[],!0)},jt.prototype.emit=function(t){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];this.st[t]&&this.st[t].forEach((function(n){try{n.apply(void 0,i)}catch(n){console.error('Fail to execute callback of event "'.concat(t,'" : ').concat(n))}}))},jt),vt=function(){return(vt=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var s in i=arguments[n])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t}).apply(this,arguments)},mt=(Ut.prototype.sendRequest=function(t,i,n,e){var r=this,o=t.payload,u=(null!=(u=this.ct)&&u.encode&&(o=G(t.payload)),{service_no:this.ot,ack:t.ack,payload:o,wss_message_type:null!=(o=null==(u=this.ct)?void 0:u.messageType)?o:ct.wssMessageType,wss_path:null==(u=this.ct)?void 0:u.path,wss_raw_query:null==(o=this.ct)?void 0:o.query,zegoconn_version:ct.connectVer});this.netPcStream.isConnect()||(this.D.info(rt+" pc is not connect"),this.eventManager.emit("connectStart")),this.netPcStream.sendMessage(s.MSG_TYPE_PC_UPWARD_MESSAGE,u,(function(){r.D.info(rt+" suc"),n&&n()}),(function(t){r.D.error(rt+" fail"),i&&i(t)}),null,{isInSendMap:"boolean"==typeof t.isInSendMap&&t.isInSendMap,extras:e,isMsgCache:null==(o=this.ct)?void 0:o.isMsgCache})},Ut.prototype.onPushEvent=function(t,i,n){var e;switch(this.D.info(ot+" msgType: ".concat(t)),t){case s.MSG_TYPE_PC_ESTABLISHED:this.netPcStream.isFirst=!1,this.pcEstablished(i,this.netPcStream.StreamID);break;case s.MSG_TYPE_PC_BROKEN:this.pcBroken();break;case s.MSG_TYPE_PC_DOWNWARD_MESSAGE:this.D.info(ot+" ".concat(this.ot," down ").concat((null==i?void 0:i.ts)&&i.ts.toNumber&&i.ts.toNumber()||i.ts));var r=i.payload;null!=(e=this.ct)&&e.encode&&(r=q(i.payload)),this.eventManager.emit("downLoadMessage",r,n);break;case s.MSG_TYPE_PUSH_EXCEPTION:this.D.info(ot+" ".concat(this.ot," exception ").concat(JSON.stringify(i))),this.eventManager.emit("exception",i,n)}},Ut.prototype.on=function(t,i){return this.eventManager.addEventHandler(t,i)},Ut.prototype.off=function(t,i){this.eventManager.removeEventHandler(t,i)},Ut.prototype.pcEstablished=function(t,i){this.D.info("zn.napr.pe call "+JSON.stringify(t)),this.setConnectState(a.CONNECTED);var n=d.MANUAL;this.lastConnectState===a.BROKEN&&this.connectState===a.CONNECTED&&(n=d.AUTO),this.eventManager.emit("connected",n),this.reportEvent("pcConnectedEvent",{proxy_link_sources:null==t?void 0:t.from,connect_stream:i}),this.brokenTimer&&clearTimeout(this.brokenTimer)},Ut.prototype.pcBroken=function(){var t=this;this.D.info("zn.napr.pb call"),this.setConnectState(a.BROKEN),this.eventManager.emit("broken"),this.reportEvent("pcBrokenEvent"),this.brokenTimer=setTimeout((function(){t.eventManager.emit("disconnected",_.TEMP),t.reportEvent("pcDisconnectedEvent")}),1e3*this.rt)},Ut.prototype.resetBrokenTimer=function(){this.brokenTimer&&clearTimeout(this.brokenTimer)},Ut.prototype.ut=function(t,i){var n;this.D.info("zn.napr.cr call "+this.ot+" "+this.connectState),this.connectState!==a.DISCONNECT&&(this.netPcStream.closeStream(0,""),this.resetBrokenTimer(),n=this.Z.getStreamID(),this.netPcStream.refresh(n),this.eventManager.emit(t,i),n="","broken"===t?n="pcBrokenEvent":"disconnected"===t&&(n="pcDisconnectedEvent"),n)&&this.reportEvent(n),this.setConnectState(a.DISCONNECT)},Ut.prototype.closePc=function(){this.ut("broken")},Ut.prototype.closeRequest=function(){this.ut("disconnected",_.CLOSE)},Ut.prototype.setConnectState=function(t){this.connectState!==t&&(this.lastConnectState=this.connectState,this.connectState=t)},Ut.prototype.reportEvent=function(t,i){this.eventManager.emit(t,vt({service_no:this.ot},i))},Ut),gt=(Mt.prototype.getRequest=function(t,i){return t=new mt(this.D,t,this.Z,this.pcEstablishTimeout,i),this.pcStreamRequests.push(t),t},Mt.prototype.updateConnectState=function(t,i,n){this.D.info("zn.naprm.ucs call "+t+" "+i),this.pcStreamRequests.forEach((function(e){t===a.BROKEN?(e.eventManager.emit("broken"),e.reportEvent("pcBrokenEvent")):t===a.DISCONNECT&&(e.eventManager.emit("disconnected",i,n),e.reportEvent("pcDisconnectedEvent"))}))},Mt.prototype.closePCs=function(){this.pcStreamRequests.forEach((function(t){t.closePc()}))},Mt.prototype.setEstablishTimeout=function(t){this.pcEstablishTimeout=t},Mt),pt=(Pt.prototype.initLink=function(t){this.link=t},Pt.prototype.startMaxTime=function(){var t=this;this.D.info(nt+" call"),this.maxTimer||(this.D.info(nt+" start max timer"),this.maxTimer=setTimeout((function(){t.D.warn(nt+" over max time ".concat(t.RETRY_MAX_TIME,"s, stop retry")),t.isOverTime=!0,t.link.destroySocket(c.NONE),t.stopMaxTime(),t.invalid(),t.onactive(!1,J.NET_SOCKET_TIMEOUT)}),1e3*this.RETRY_MAX_TIME))},Pt.prototype.stopMaxTime=function(){this.maxTimer&&clearTimeout(this.maxTimer),this.maxTimer=null},Pt.prototype.active=function(t,i,n){var s=this;if(void 0===n&&(n=!1),this.D.info(it+" call "+t+" "+(i=void 0!==i&&i)),this.retryTimer)return this.D.info(it+" has actived, ignore"),!1;var r=this.M.networkState==e.offline;if(r){if(this.D.info(it+"  check if really offline. "+this._t),this._t>=this.Et)return this.D.warn(it+" network is broken, stop retry"),!1}else this._t=0;return this.link.isConnecting()&&!n?(this.D.info(it+" link is connecting, ignore"),!1):this.isOverTime?(this.D.info(it+" retry over time, stop retry"),!1):(1==this.ht?this.ft=Math.floor(Math.random()*(1-this.RETRY_START_TIME_INTERVAL)+this.RETRY_START_TIME_INTERVAL):(n=Math.pow(2,Math.round(this.ht/this.RETRY_CONTINUE_COUNT+1)),this.ft=n>this.RETRY_MAX_TIME_INTERVAL?this.RETRY_MAX_TIME_INTERVAL:n),this.D.info(it+" interval "+this.ft),this.retryTimer=setTimeout((function(){s.link.destroySocket(c.BROKEN),s.link.connectSocket(t,(function(){s.D.info(it+" suc"),s.M.networkState=e.online,s.stopMaxTime(),s.invalid(),s.onactive(!0)}),(function(){s.D.info(it+" fail"),s.maxTimer||s.startMaxTime(),s.active(!0,!1,!0)})),s.retryTimer&&clearTimeout(s.retryTimer),s.retryTimer=null,r?s._t++:s.ht++}),i?0:1e3*this.ft),!0)},Pt.prototype.onactive=function(){for(var t=0;t<arguments.length;t++);},Pt.prototype.init=function(t,i,n,e){this.invalid(),this.stopMaxTime(),this.isOverTime=!1,"number"==typeof t&&t<3600&&(this.RETRY_MAX_TIME=t),"number"==typeof i&&(this.RETRY_START_TIME_INTERVAL=i),"number"==typeof n&&(this.RETRY_CONTINUE_COUNT=n),"number"==typeof e&&(this.RETRY_MAX_TIME_INTERVAL=e)},Pt.prototype.invalid=function(){this.D.info("zn.rlh.ivd end retry"),this.retryTimer&&clearTimeout(this.retryTimer),this.retryTimer=null,this.ht=1,this._t=0},Pt),bt=(Dt.prototype.updateNTP=function(t,i,n){var e;n<t||(e=n-t,this.timeOffset=Math.round((i-t+(i-n))/2),t=Math.round(i+e/2),(!this.networkRTT||e<this.networkRTT)&&(this.networkRTT=e,this.ntpTimeInfo={performanceTime:Math.round(performance.now()),ntp:t}))},Dt),Et=(At.prototype.log=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var n=t.join(" ");console.log(n)},At.prototype.debug=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var n=t.join(" ");console.debug(n)},At.prototype.info=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var n=t.join(" ");console.info(n)},At.prototype.warn=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var n=t.join(" ");console.warn(n)},At.prototype.error=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var n=t.join(" ");console.error(n)},At),yt=function(){return(yt=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var s in i=arguments[n])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t}).apply(this,arguments)},St=(kt.prototype.sendRequest=function(t,i,n,e,r){var o=this,u=t.disableLog;t={service_no:this.ot,ack:t.ack,headers:t.headers,body:G(JSON.stringify(t.body)),id_name:t.idName,method_no:t.method_no,stick:t.stick,location:t.location,reduce_resp_header:t.reduceRspHeaders?1:0};this.netHttpStream.sendMessage(s.MSG_TYPE_HTTP_REQUEST,t,(function(t){o.closeStream();var n=("gzip"===(null==(n=(null==t?void 0:t.headers).find((function(t){return"Content-Encoding"===(null==t?void 0:t.name)})))?void 0:n.val)?u||o.D.info(ut+" gzip"):t.body&&(n=q(t.body),t.body=n),yt(yt({},t),{body:void 0}));u||o.D.info(ut+" suc "+JSON.stringify(n)),i&&i(t)}),(function(t,i,e){o.closeStream(),u||o.D.error(ut+" fail"),n&&n(e||t)}),(function(t){u||o.D.error(ut+" ack"),e&&e(t)}),r),this.netHttpStream.isFirst=!1},kt.prototype.sendRequest2=function(t,i,n,e,r){var o=this,u=1===t.format?G(JSON.stringify(t.body)):t.body;u={ack:t.ack,body:u,id_name:t.idName,method:t.method,interface_id:t.interfaceID,token:t.token,reduce_resp_header:t.reduceRspHeaders?1:0};t.headers&&(u.headers=t.headers),t.resID&&(u.res_id=t.resID),t.urlParams&&(u.params=t.urlParams),t.mode&&(u.mode=t.mode),this.netHttpStream.sendMessage(s.MSG_TYPE_HTTP_REQUEST2,u,(function(e,s){o.closeStream();var r=(null==e?void 0:e.headers).find((function(t){return"Content-Encoding"===(null==t?void 0:t.name)}));if(200===e.status_code){if("gzip"===(null==r?void 0:r.val))o.D.info(ht+" gzip");else if(e.body&&1===t.format)try{u=q(e.body),e.body=u}catch(s){o.D.info(ht+" decode "+JSON.stringify(s))}r=yt(yt({},e),{body:void 0}),o.D.info(ht+" suc "+JSON.stringify(r)),i&&i(e,s)}else{try{var u=q(e.body);e.body=u}catch(s){o.D.info(ht+" status "+e.status_code+" "+JSON.stringify(s))}n&&n(e)}}),(function(t,i,e){o.closeStream(),o.D.error(ht+" fail"),n&&n(e||t)}),(function(t){o.D.error(ht+" ack"),e&&e(t)}),r),this.netHttpStream.isFirst=!1},kt.prototype.closeStream=function(){this.D.info("zn.nahr.cs call"),this.netHttpStream.closeStream(0,"")},kt),Ot=(Object.defineProperty(Ct.prototype,"StreamID",{get:function(){return this.St},enumerable:!1,configurable:!0}),Ct.prototype.refresh=function(t){this.St=t,this.isFirst=!0},Ct.prototype.sendMessage=function(t,i,n,e,s,r){var o=this;void 0===n&&(n=null),void 0===e&&(e=null),this.dt.sendMessage(t,this.St,i,this.isFirst,(function(t,i,e){o.lt!==h.PC&&(o.isFree=!0),n&&n(t,e)}),(function(t,i,n){o.lt!==h.PC&&(o.isFree=!0),e&&e(t,i,n)}),s=void 0===s?null:s,r=void 0===r?{timeout:5e3,isInSendMap:!0}:r)},Ct.prototype.onPushEvent=function(t,i,n){},Ct.prototype.closeStream=function(t,i){this.dt.sendMessage(s.MSG_TYPE_STREAM_CLOSED,this.St,{code:t,msg:i})},Ct.prototype.isConnect=function(){return this.dt.isConnect()},Ct),Rt=(It.prototype.createStream=function(t){var i=new Ot(t,this.streamID++,this.dt);return t===h.PC&&this.pcStreams.push(i),i},It.prototype.onPushEvent=function(t,i,n,e){var s=this.pcStreams.find((function(i){return i.StreamID===t}));s&&s.onPushEvent(i,n,e)},It.prototype.getStreamID=function(){return this.streamID++},It),Tt=function(){return(Tt=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var s in i=arguments[n])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t}).apply(this,arguments)},wt=(Object.defineProperty(Nt.prototype,"clientIP",{get:function(){return this.stateCenter.clientIP},enumerable:!1,configurable:!0}),Object.defineProperty(Nt.prototype,"timeOffset",{get:function(){return this.stateCenter.timeOffset},enumerable:!1,configurable:!0}),Object.defineProperty(Nt.prototype,"linkConnectState",{get:function(){return this.Ct},set:function(t){this.lastLinkConnectState=this.Ct,this.Ct=t},enumerable:!1,configurable:!0}),Nt.prototype.init=function(){this.logger=new Et,this.protobuf=new A,this.stateCenter=new bt,this.eventManager=new dt,this.At(),this.inited=!0},Nt.prototype.unInit=function(){this.inited=!1},Nt.prototype.setAppInfo=function(t){this.logger.info("zn.sai.0 "+JSON.stringify(t)),this.stateCenter.appInfo=t,this.stateCenter.networkState=!navigator||navigator.onLine?e.online:e.offline,0===t.env?this.bt():1===t.env&&this.Nt(),this.zegoLink=new ft(t.appID,t.env,this.protobuf,this.logger,this.stateCenter,this.proxyCtrl),this.zegoLink.initEvent(this.V,this.B,this.k,this.L),this.streamManager=new Rt(this.zegoLink),this.businessRequestMgr=new lt(this.streamManager,this.protobuf,this.logger,this.stateCenter),this.netHeartBeatHandler=new _t(this.streamManager,this.logger,this.stateCenter),this.netAgentPCRequestMgr=new gt(this.streamManager,this.logger),this.It()},Nt.prototype.setUserInfo=function(t){this.stateCenter.userId=t},Nt.prototype.setNetAgentDefaultServers=function(t){this.connectServers=B([],t,!0)},Nt.prototype.setNetAgentSpecifiedServers=function(t){this.logger.info("zn.sss.0 "+JSON.stringify(t)),this.stateCenter.specified=!0,this.specifiedServers=B([],t,!0)},Nt.prototype.setBackupDomains=function(t){this.primaryDomains=t},Nt.prototype.setDispatchConnectServers=function(t){this.Dt(t)},Nt.prototype.startHttpRequest=function(t,i,n,e,s){var r=this,o=this.reportSeq++;this.eventManager.emit("requestEvent",o,"start"),this.isConnect()||(this.logger.info(Z+" link is not connect"),this.connectUa()),new St(this.logger,this.streamManager,t.service).sendRequest(t,(function(n){r.eventManager.emit("requestEvent",o,"end",{na_req_location:t.location,status_code:n.status_code,err_code:0}),i&&i(n)}),(function(i){r.eventManager.emit("requestEvent",o,"end",{na_req_location:t.location,err_code:i.code||0}),n&&n(i)}),e,s)},Nt.prototype.startHttpRequest2=function(t,i,n,e,s){var r=this,o=this.reportSeq++;this.eventManager.emit("requestEvent",o,"start"),this.isConnect()||(this.logger.info(Z+" link is not connect"),this.connectUa()),new St(this.logger,this.streamManager).sendRequest2(t,(function(n,e){r.eventManager.emit("requestEvent",o,"end",{na_req_interface:t.interfaceID,status_code:n.status_code,err_code:0}),i&&i(n,e)}),(function(i){r.eventManager.emit("requestEvent",o,"end",{na_req_interface:t.interfaceID,err_code:i.code||0}),n&&n(i)}),e,s)},Nt.prototype.getAppConfigByAgent=function(t,i,n,e){return this.isConnect()||(this.logger.info("zn.gab.0 link is not connect"),this.connectUa()),this.Mt(t,this.stateCenter.userId,i,n,e)},Nt.prototype.getPCRequest=function(t,i){var n=this;return(i=this.netAgentPCRequestMgr.getRequest(t,i)).on("disconnected",(function(i){n.logger.warn("zn.zca.gpr "+t+" disconnect "+i),i===_.TEMP&&(n.Rt(),n.Ut())})),i.on("connectStart",(function(){n.connectUa()})),i},Nt.prototype.connectUa=function(){this.isDestroy||(this.logger.info("zn.zca.cua call"),this.retryLinkHandler&&(this.retryLinkHandler.init(),this.Ut(!1,!0)))},Nt.prototype.destroyConnect=function(){this.logger.info("zn.zca.dc.0 call"),this.Ht()},Nt.prototype.destroy=function(){this.logger.info("zn.zca.dy.0 call"),this.destroyConnect(),this.Tt&&clearTimeout(this.Tt),this.retryLinkHandler&&this.retryLinkHandler.invalid(),this.retryLinkHandler&&this.retryLinkHandler.stopMaxTime(),this.isDestroy=!0},Nt.prototype.isConnect=function(){return this.zegoLink&&this.zegoLink.isConnect()},Nt.prototype.on=function(t,i){return this.logger.info("zn.zca.o.0 "+t),this.eventManager.addEventHandler(t,i)},Nt.prototype.off=function(t,i){this.logger.info("zn.zca.o.1 "+t),this.eventManager.removeEventHandler(t,i)},Nt.prototype.setLogger=function(t){this.logger=t},Nt.prototype.setAccess=function(t){this.stateCenter.useNetAgent=t},Nt.prototype.getVersion=function(){return"1.1.6"},Nt.prototype.It=function(){var t=this;this.netHeartBeatHandler.netHbLogout=function(i){t.retryLinkHandler&&([J.NET_HB_TIMEOUT.code].includes(i.code)?(t.retryLinkHandler.startMaxTime(),t.Rt(),t.Ut()):(t.retryLinkHandler.stopMaxTime(),t.retryLinkHandler.invalid(),t.eventManager.emit("disconnected")))}},Nt.prototype.bt=function(){var t=this;window.addEventListener("offline",(function(){t.Gt()})),window.addEventListener("online",(function(){t.yt()}))},Nt.prototype.Nt=function(){var t=this;wx.onNetworkStatusChange((function(i){i.isConnected?t.yt():t.Gt()}))},Nt.prototype.yt=function(){this.logger.info("zn.zca.noh.0 network is online"),this.stateCenter.networkState=e.online,this.stateCenter.useNetAgent&&this.wt()},Nt.prototype.Gt=function(){this.logger.info("zn.zca.noh.1 network is broken"),this.stateCenter.networkState=e.offline,this.stateCenter.useNetAgent&&this.Yt()},Nt.prototype.At=function(){var t=this;if(this.stateCenter.useNetAgent){if(this.isConnect()){var i=Date.now()-this.zegoLink.updatedMsgTime;if(i>1e3*this.linkMsgMaxInterval)return this.logger.info("zn.zca.clm interval: "+i),void this.Ht()}this.Tt&&clearTimeout(this.Tt),this.Tt=setTimeout((function(){t.At()}),1e3*this.linkMsgCheckInterval)}},Nt.prototype.Dt=function(t){var i=this;0<t.length&&(this.connectServers=B([],t,!0)),this.stateCenter.specified&&0<this.specifiedServers.length&&(this.connectServers=this.specifiedServers),this.zegoLink.createSocket(this.connectServers),this.retryLinkHandler||(this.retryLinkHandler=new pt(this.logger,this.stateCenter)),this.retryLinkHandler.init(),this.retryLinkHandler.initLink(this.zegoLink),this.retryLinkHandler.onactive=function(t,n){n===J.NET_SOCKET_TIMEOUT&&(i.eventManager.emit("disconnected",n),i.netAgentPCRequestMgr.updateConnectState(a.DISCONNECT,_.TIMEOUT,n))},this.Ut(!1,!0)},Nt.prototype.Ht=function(){this.netHeartBeatHandler&&this.netHeartBeatHandler.reset(),this.zegoLink&&this.zegoLink.destroySocket(c.DISCONNECT)},Nt.prototype.vt=function(){function t(t,e,s){s?i.logger.info(Y+" fail "+JSON.stringify(s)):0===t.code?(i.logger.info(Y+" suc "+JSON.stringify(t)),i.Vt(t,n)):i.logger.info(Y+" fail "+JSON.stringify(t))}var i=this,n=(new Date).getTime();this.businessRequestMgr.getConfig(t,t)},Nt.prototype.Vt=function(t,i){this.netHeartBeatHandler.init(t),this.netAgentPCRequestMgr.setEstablishTimeout(t.data.pc_establish_timeout),null!=(n=null==t?void 0:t.data)&&n.client_outer_ip&&(this.stateCenter.clientIP=t.data.client_outer_ip),null!=(n=null==t?void 0:t.data)&&n.ntp_time&&(n="number"==typeof(n=t.data.ntp_time)?n:n.toNumber(),e=(new Date).getTime(),this.stateCenter.updateNTP(i,n,e));var n,e;i=t.data.geofencing_id;this.eventManager.emit("clientInfo",{clientIP:this.clientIP,timeOffset:this.timeOffset,geofencingID:i})},Nt.prototype.gt=function(){var t=this;return new Promise((function(i,n){t.businessRequestMgr.dispatchURL((function(n){n=n.data.wss_groups;var e=(t.logger.info(X+" wss_groups: "+JSON.stringify(n)),n.some((function(t){return t.host.includes("geo")}))),s=null!=(s=t.stateCenter.appInfo)&&s.geoFencing||e?n:t.Bt(n,t.primaryDomains);e=t.kt(s);i({servers:e,domains:s})}),(function(t){n(t)}))}))},Nt.prototype.kt=function(t){return Array.isArray(t)&&0<t.length?t.map((function(t){return ct.scheme+"://"+t.host+"/"+ct.location})):[]},Nt.prototype.Bt=function(t,i){var n=B([],t,!0);return i.forEach((function(i){t.forEach((function(t){var e,s="";t.main_domain?s=t.main_domain:t.host&&(s=(e=t.host.split("."))[e.length-2]+"."+e[e.length-1]),s&&s!==i&&(e=t.host.replace(s,i),n.push({group:t.group,host:e}))}))})),n=n.filter((function(t){return!!t.host}))},Nt.prototype.Mt=function(t,i,n,e,s){var r=this;return new Promise((function(o,u){"string"==typeof i&&"string"==typeof n?r.businessRequestMgr.getAppConfig(t,i,n,e,s).then((function(t){o(Tt(Tt({},t),{retryCount:r.getAppConfigFailCount}))})).catch((function(e){var h;r.logger.error(F+" "+JSON.stringify(e)),!(-1<m.indexOf(e.code))&&(r.getAppConfigFailCount++,20008===e.code||1100002===e.code)&&r.getAppConfigFailCount<3?r.Mt(t,i,n,s).then((function(t){return o(t)})).catch((function(t){return u(t)})):(h=r.getAppConfigFailCount,r.getAppConfigFailCount=0,u(Tt(Tt({},e),{retryCount:h})))})):r.logger.error(F+" userID or token must be string")}))},Nt.prototype.Lt=function(){var t=(new Date).getTime()-this.connectedTime;this.connectid&&this.eventManager.emit("disConnectedEvent",{duration:t,server:this.zegoLink.connectServer,connectid:this.connectid})},Nt.prototype.Ot=function(t){this.logger.info(K+" ".concat(JSON.stringify(t.wss_groups))),(t=this.kt(t.wss_groups))&&Array.isArray(t)&&0<t.length?(this.Rt(),this.stateCenter.specified&&(this.logger.info(K+" specified"),t=this.specifiedServers),this.zegoLink.createSocket(t),this.Ut(!1,!0)):this.logger.warn(K+" wss_groups null")},Nt.prototype.Pt=function(t){var i=this;switch(this.logger.info(W+" ".concat(t.reason," ").concat(t.msg," ").concat(t.action)),t.action){case f.ACTION_DISPATCH:var n=this.reportSeq++;this.eventManager.emit("dispatchEvent",n,"start"),this.gt().then((function(t){var e=t.servers;t=t.domains;i.eventManager.emit("dispatchEvent",n,"end",{domains:t,reason:"ConnectClosed"}),Array.isArray(e)&&0<e.length&&(i.eventManager.emit("dispatchResultUpdate",{servers:e,domains:t}),t=i.stateCenter.specified?i.specifiedServers:e,i.Rt(),i.zegoLink.createSocket(t),i.Ut(!1,!0))})).catch((function(t){i.logger.info(W+" dispatch fail")}));break;case f.ACTION_RETRY:this.Rt(),this.Ut(!1);break;case f.ACTION_NEXT_GROUP:this.netAgentPCRequestMgr.closePCs(),this.eventManager.emit("broken",v.CLOSE),this.Ut();case f.ACTION_ABORT:case f.ACTION_RESERVED:}},Nt.prototype.wt=function(){this.retryLinkHandler&&(this.zegoLink.isConnect()?this.retryLinkHandler.stopMaxTime():this.Ut())},Nt.prototype.Yt=function(){this.Rt(),this.retryLinkHandler&&(this.retryLinkHandler.invalid(),this.retryLinkHandler.startMaxTime(),this.zegoLink.setState(0))},Nt.prototype.Ut=function(t,i){this.retryLinkHandler.active(t,i)&&this.zt()},Nt.prototype.zt=function(){var t=this.reportSeq++;this.connectSeq=t,this.eventManager.emit("connectedEvent",t,"start")},Nt.prototype.Rt=function(){this.logger.info("zn.zca.dc.1 call"),this.netAgentPCRequestMgr.closePCs(),this.eventManager.emit("broken"),2===this.lastLinkConnectState&&0===this.linkConnectState&&this.Lt()},Nt.prototype.getNetworkTimeInfo=function(){var t,i=Date.now()+this.stateCenter.timeOffset,n=Math.round(this.stateCenter.networkRTT/2),e=this.stateCenter.ntpTimeInfo;return e&&(t=performance.now()-e.performanceTime,i=Math.round(e.ntp+t)),{timestamp:i,maxDeviation:n}},Nt);function Nt(t){var i=this;this.proxyCtrl=t,this.Tt=null,this.connectServers=[],this.specifiedServers=[],this.getAppConfigFailCount=0,this.getAppConfigTime=0,this.inited=!1,this.linkMsgMaxInterval=90,this.linkMsgCheckInterval=5,this.isDestroy=!1,this.connectedTime=0,this.connectid="",this.reportSeq=0,this.connectSeq=0,this.primaryDomains=[],this.Ct=0,this.lastLinkConnectState=0,this.V=function(t,n){var e;i.linkConnectState=2,i.vt(),i.stateCenter.specified||(e=i.reportSeq++,i.eventManager.emit("dispatchEvent",e,"start"),i.gt().then((function(t){var n=t.servers;t=t.domains.map((function(t){return t.host}));i.eventManager.emit("dispatchEvent",e,"end",{domains:t}),0<n.length&&i.eventManager.emit("dispatchResultUpdate",{servers:n,domains:t})})).catch((function(t){}))),i.eventManager.emit("connected"),i.connectedTime=(new Date).getTime(),i.connectid=function(t){var i,n="0123456789".split(""),e=[];for(t=n.length,i=0;i<16;i++)e[i]=n[0|Math.random()*t];return e.join("")}(),i.eventManager.emit("connectedEvent",i.connectSeq,"end",{servers:t,count:t.length,connectid:i.connectid,connectEvents:n})},this.k=function(){i.logger.info("zn.zca.oce call"),i.linkConnectState=1},this.B=function(t){i.logger.info("zn.zca.ode"+" ".concat(t)),i.linkConnectState=0,t?(i.Rt(),i.netAgentPCRequestMgr.updateConnectState(a.BROKEN)):(i.eventManager.emit("disconnected"),i.netAgentPCRequestMgr.updateConnectState(a.DISCONNECT))},this.L=function(t,n,e,r){switch(n){case s.MSG_TYPE_REDIRECT:case s.MSG_TYPE_REDIRECT2:i.Ot(e);break;case s.MSG_TYPE_CLOSE_CONNECTION:i.Pt(e);break;case s.MSG_TYPE_PC_BROKEN:case s.MSG_TYPE_PC_ESTABLISHED:case s.MSG_TYPE_PC_DOWNWARD_MESSAGE:case s.MSG_TYPE_PUSH_EXCEPTION:i.streamManager.onPushEvent(t,n,e,r);break;case s.MSG_TYPE_PUSH_APPCONFIG:i.businessRequestMgr.decodeConfigMessage(e.data)}}}function It(t){this.dt=t,this.streamID=1,this.httpStreams=[],this.pcStreams=[]}function Ct(t,i,n){this.lt=t,this.St=i,this.dt=n,this.isFree=!1,this.isFirst=!0}function kt(t,i,n){this.D=t,this.Z=i,this.ot=n,this.netHttpStream=this.Z.createStream(h.HTTP)}function At(){}function Dt(){this.networkState=e.online,this.useNetAgent=!0,this.specified=!1,this.clientIP="",this.timeOffset=0,this.networkRTT=0}function Pt(t,i){this.D=t,this.M=i,this.RETRY_START_TIME_INTERVAL=4,this.RETRY_CONTINUE_COUNT=2,this.RETRY_MAX_TIME_INTERVAL=32,this.retryTimer=null,this.maxTimer=null,this.ht=1,this._t=0,this.Et=3,this.isOverTime=!1,this.RETRY_MAX_TIME=90}function Mt(t,i){this.Z=t,this.D=i,this.pcStreamRequests=[],this.pcEstablishTimeout=ct.pcEstablishTimeout}function Ut(t,i,n,e,s){this.D=t,this.ot=i,this.Z=n,this.rt=e,this.ct=s,this.connectState=a.DISCONNECT,this.lastConnectState=a.DISCONNECT,this.brokenTimer=null,this.listenerList={connected:[],broken:[]},this.netPcStream=this.Z.createStream(h.PC),this.eventManager=new dt,this.netPcStream.onPushEvent=this.onPushEvent.bind(this)}function jt(){this.st={}}function zt(t,i,n){this.Z=t,this.D=i,this.M=n,this.J=null,this.X=5,this.tt=10,this.it=0,this.nt=0}function Lt(t,i,n,e){this.Z=t,this.I=i,this.D=n,this.stateCenter=e}function xt(t,i){this.proxyCtrl=i,this.P=null,this.ENV=t}}],u={},e.m=o,e.c=u,e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:n})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"u",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.u)return t;var n=Object.create(null);if(e.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var s in t)e.d(n,s,function(i){return t[i]}.bind(null,s));return n},e.n=function(t){var i=t&&t.u?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},e.p="",e(e.s=2))},function(t,i,n){function e(t){var i;return(h[t]||(i=h[t]={i:t,l:!1,exports:{}},u[t].call(i.exports,i,i.exports,e),i.l=!0,i)).exports}var s,r,o,u,h;t.exports=(s=n(10),r=n(1),o=n(3),u=[function(t,i,n){"use strict";Object.defineProperty(i,"u",{value:!0}),i.AUTH_FAIL=i.MULTI_FILE_NOT_EXIST=i.INFLATE_DATA_FAIL=i.FILE_REQUEST_FAIL=i.NOT_INIT=void 0,i.NOT_INIT={code:1001,msg:"not init"},i.FILE_REQUEST_FAIL={code:1002,msg:"fetch request fail"},i.INFLATE_DATA_FAIL={code:1003,msg:"inflate fail"},i.MULTI_FILE_NOT_EXIST={code:1004,msg:"get multi file fail"},i.AUTH_FAIL={code:1005,msg:"auth failed"}},function(t,i,n){"use strict";Object.defineProperty(i,"u",{value:!0}),i.SETTINGFETCHHANDLER_FETCHSETTING=i.SETTINGCACHEHANDLER_STORE_SETTING=i.SETTINGCACHEHANDLER_GET_CACHE_SETTING=i.SETTING_POLLING_SETTING=i.SETTING_GET_CLOUD_SETTING=i.SETTING__FETCH_SETTING=i.SETTING_FETCH_SETTING=i.SETTING_INIT=i.constRUCTOR=void 0,i.constRUCTOR="zs.0",i.SETTING_INIT="zs.ii.0",i.SETTING_FETCH_SETTING="zs.fs.0",i.SETTING__FETCH_SETTING="zs.fs.1",i.SETTING_GET_CLOUD_SETTING="zs.gcs.0",i.SETTING_POLLING_SETTING="zs.ps.0",i.SETTINGCACHEHANDLER_GET_CACHE_SETTING="zs.sch.gcs.0",i.SETTINGCACHEHANDLER_STORE_SETTING="zs.sch.ss.0",i.SETTINGFETCHHANDLER_FETCHSETTING="zs.sfh.fs.0"},function(t,i,n){"use strict";var e;Object.defineProperty(i,"u",{value:!0}),i.ProductMap=i.Product=i.SOCKET_DISCONNECT=i.ENUM_REMOTE_TYPE=i.ZEGO_BROWSER_TYPE=i.ZEGO_ENV=i.PROTO_VERSION=void 0,i.PROTO_VERSION="1.1.2",(e=i.ZEGO_ENV||(i.ZEGO_ENV={}))[e.BROWSER=0]="BROWSER",e[e.WEIXINMINI=1]="WEIXINMINI",(e=i.ZEGO_BROWSER_TYPE||(i.ZEGO_BROWSER_TYPE={}))[e.IE=0]="IE",e[e.FIREFOX=1]="FIREFOX",e[e.CHROME=2]="CHROME",e[e.SAFARI=3]="SAFARI",e[e.OPERA=4]="OPERA",e[e.WEIXIN=5]="WEIXIN",e[e.WEIXINMINI=6]="WEIXINMINI",e[e.UNKOWN=7]="UNKOWN",(e=i.ENUM_REMOTE_TYPE||(i.ENUM_REMOTE_TYPE={}))[e.DISABLE=0]="DISABLE",e[e.WEBSOCKET=1]="WEBSOCKET",e[e.HTTPS=2]="HTTPS",i.SOCKET_DISCONNECT=-1,(e=i.Product||(i.Product={}))[e.RTC=0]="RTC",e[e.WEB_RTC=1]="WEB_RTC",e[e.ZIM=2]="ZIM",e[e.ROOM_KIT=3]="ROOM_KIT",e[e.DOC_SHARE=4]="DOC_SHARE",e[e.WHITE_BOARD=5]="WHITE_BOARD",e[e.SELF_CHECK=999]="SELF_CHECK",e[e.TEST_ANOOUS=1e3]="TEST_ANOOUS",i.ProductMap={0:"rtc_sdk_native",1:"Web_SDK",2:"ZIM",3:"roomkitWeb",4:"docsshare",5:"WhiteBoard"}},function(t,i){t.exports=s},function(t,i,n){"use strict";var e=this&&this.__read||function(t,i){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var e,s,r=n.call(t),o=[];try{for(;(void 0===i||0<i--)&&!(e=r.next()).done;)o.push(e.value)}catch(t){s={error:t}}finally{try{e&&!e.done&&(n=r.return)&&n.call(r)}finally{if(s)throw s.error}}return o},s=this&&this.__spread||function(){for(var t=[],i=0;i<arguments.length;i++)t=t.concat(e(arguments[i]));return t},r=(Object.defineProperty(i,"u",{value:!0}),i.decodeString=i.decodeCompressData=i.generateUUID=i.checkValidNumber=i.analyzeKey=i.getCurrentTime=i.getBrowser=void 0,n(16)),o=(i.getBrowser=function(){var t=window.navigator.userAgent,i=null!=window.ActiveXObject&&-1!=t.indexOf("MSIE"),n=-1!=t.indexOf("Firefox"),e=null!=window.opr,s=t.indexOf("Chrome")&&window.chrome,r=-1!=t.indexOf("Safari")&&-1!=t.indexOf("Version");t=t.toLowerCase().match(/MicroMessenger/i)&&"micromessenger"===t.toLowerCase().match(/MicroMessenger/i)[0];return i?"IE":n?"FIREFOX":e?"OPERA":s?"CHROME":r?"SAFARI":t?"WEIXIN":"UNKOWN"},["00","01","02","03","04","05","06","07","08","09"]);i.getCurrentTime=function(){var t=new Date;return[t.getFullYear()+"/",(o[t.getMonth()+1]||t.getMonth()+1)+"/",(o[t.getDate()]||t.getDate())+" ",(o[t.getHours()]||t.getHours())+":",(o[t.getMinutes()]||t.getMinutes())+":",o[t.getSeconds()]||t.getSeconds(),"."+t.getTime()%1e3].join("")},i.analyzeKey=function(t){return t=t.split("_"),{level:Number(t[0]),timestamp:t[1],seq:t[2]}},i.checkValidNumber=function(t,i,n){return i=i||1,n=n||1e4,"number"==typeof t&&t%1==0&&i<=t&&t<=n},i.generateUUID=function(t){if(0===(t=void 0===t?0:t))try{n=localStorage.getItem("z_deviceID")}catch(t){}else wx.getStorageSync("z_deviceID");if(!n){var i=(new Date).getTime(),n="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=(i+16*Math.random())%16|0;return i=Math.floor(i/16),("x"==t?n:3&n|8).toString(36)}));if(0===t)try{localStorage.setItem("z_deviceID",n)}catch(t){}else wx.setStorageSync("z_deviceID",n)}return n},i.decodeCompressData=function(t){try{return r.inflate(t,{to:"string"})}catch(t){console.error(t)}},i.decodeString=function(t){return decodeURIComponent(window.escape(String.fromCharCode.apply(String,s(Array.from(t)))))}},function(t,i){t.exports=r},function(t,i){t.exports=o},function(t,i,n){"use strict";Object.defineProperty(i,"u",{value:!0}),i.INIT_CONFIG=void 0,i.INIT_CONFIG={env:0,compress:!0,p_version:1}},function(t,i,n){"use strict";Object.defineProperty(i,"u",{value:!0}),i.ZegoSetting=void 0;var e=n(9);Object.defineProperty(i,"ZegoSetting",{enumerable:!0,get:function(){return e.ZegoSetting}})},function(t,i,n){"use strict";var e=this&&this.__assign||function(){return(e=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var s in i=arguments[n])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t}).apply(this,arguments)},s=this&&this.__awaiter||function(t,i,n,e){return new(n=n||Promise)((function(s,r){function o(t){try{h(e.next(t))}catch(t){r(t)}}function u(t){try{h(e.throw(t))}catch(t){r(t)}}function h(t){var i;t.done?s(t.value):((i=t.value)instanceof n?i:new n((function(t){t(i)}))).then(o,u)}h((e=e.apply(t,i||[])).next())}))},r=this&&this.__generator||function(t,i){var n,e,s,r={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},o={next:u(0),throw:u(1),return:u(2)};return"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){var h=[o,u];if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,e&&(s=2&h[0]?e.return:h[0]?e.throw||((s=e.return)&&s.call(e),0):e.next)&&!(s=s.call(e,h[1])).done)return s;switch(e=0,(h=s?[2&h[0],s.value]:h)[0]){case 0:case 1:s=h;break;case 4:return r.label++,{value:h[1],done:!1};case 5:r.label++,e=h[1],h=[0];continue;case 7:h=r.ops.pop(),r.trys.pop();continue;default:if(!(s=0<(s=r.trys).length&&s[s.length-1])&&(6===h[0]||2===h[0])){r=0;continue}if(3===h[0]&&(!s||h[1]>s[0]&&h[1]<s[3]))r.label=h[1];else if(6===h[0]&&r.label<s[1])r.label=s[1],s=h;else{if(!(s&&r.label<s[2])){s[2]&&r.ops.pop(),r.trys.pop();continue}r.label=s[2],r.ops.push(h)}}h=i.call(t,r)}catch(u){h=[6,u],e=0}finally{n=s=0}if(5&h[0])throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}}},o=(Object.defineProperty(i,"u",{value:!0}),i.ZegoSetting=void 0,n(0)),u=n(2),h=n(10),c=n(11),a=n(13),f=n(7),l=n(4),_=n(1);function d(){this.fileList=[],this.publicEnvVariable={},this.proEnvVariable={},this.pollingTimer=null,this.pollingInterval=300,this.inited=!1,this.checkFailCount=0,this.checkFailed=!1,this.log=new h.ZegoLog}Object.defineProperty(d.prototype,"envVariable",{get:function(){return Object.assign({},this.publicEnvVariable,this.proEnvVariable)},enumerable:!1,configurable:!0}),d.prototype.init=function(t){var i,n=this;return t.pollingFreq&&!l.checkValidNumber(t.pollingFreq)?(this.log.error(_.SETTING_INIT+" pollingFreq must be integer number"),!1):(this.options=Object.assign({},f.INIT_CONFIG,t),this.h(),this.settingFetchHandler=new a.SettingFetchHandler(this.options,this.log),this.settingFetchHandler.setDataReport(this.options.reportNotify),t=Math.round(60*Math.random()),this.log.info(_.SETTING_INIT+" delay "+t),this.delayTimer&&(clearTimeout(this.delayTimer),this.delayTimer=null),this.options.pollingFreq&&60<=this.options.pollingFreq&&(this.pollingInterval=this.options.pollingFreq),this.delayTimer=setTimeout((function(){n.v(1e3*n.pollingInterval,!1)}),1e3*t),t=this.options.product||this.options.productNum,this.settingCacheHandler=new c.SettingCacheHandler("setting_"+(this.options.online?"online_":"test_")+t+"_"+this.options.appID,this.log,this.options.env),[0,1,2,3,4,5].includes(t)&&(i=u.ProductMap[t])&&(1===t&&this.settingCacheHandler.dropOldStore("setting_"+(this.options.online?"online_":"test_")+"undefined_"+this.options.appID),this.settingCacheHandler.dropOldStore("setting_"+(this.options.online?"online_":"test_")+i+"_"+this.options.appID)),null!=(t=this.options)&&t.unify&&this.options.connection&&null!=(t=null==(i=this.options)?void 0:i.connection)&&t.on("connected",(function(){n.settingFetchHandler.checkUnSendMsgs(n.settingFetchHandler.unSendCommandList)})),this.g(),this.inited=!0)},d.prototype.uninit=function(){this.pollingTimer&&(clearTimeout(this.pollingTimer),this.pollingTimer=null)},d.prototype.setEnvVariable=function(t,i){this.proEnvVariable[t]=String(i)},d.prototype.getEnvVariable=function(t){return this.envVariable[t]},d.prototype.setEnvVariables=function(t){var i=this;Object.keys(t).forEach((function(n){"string"!=typeof t[n]&&"number"!=typeof t[n]&&i.log.error("zs.sev env "+n+" type error"),i.proEnvVariable[n]=String(t[n])}))},d.prototype.getEnvVariables=function(){return this.envVariable},d.prototype.enablePolling=function(t,i){var n=this;i?i.forEach((function(i){var e=n.fileList.find((function(t){return t.fileName===i}));e&&(e.needPolling=t)})):this.fileList.forEach((function(i){return i.needPolling=t}))},d.prototype.setToken=function(t){this.token!==t&&this.g(),this.token=t},d.prototype.setUserID=function(t){this.userID!==t&&this.g(),this.userID=t},d.prototype.getSettingCache=function(t){return s(this,void 0,void 0,(function(){var i,n;return r(this,(function(e){switch(e.label){case 0:return this.inited?(i=this.fileList.find((function(i){return i.fileName===t})))?[2,Promise.resolve({setting:i.setting,versions:i.versions})]:[3,1]:[2,Promise.reject(o.NOT_INIT)];case 1:return[4,this.settingCacheHandler.getCacheSetting(t)];case 2:return(i=e.sent())&&(this.fileList.find((function(i){return i.fileName===t}))||this.fileList.push({fileName:t,fetchedTime:0,needPolling:!1,setting:i.setting,versions:i.versions}),n={setting:i.setting,versions:i.versions}),[2,Promise.resolve(n)]}}))}))},d.prototype.fetchSetting=function(t,i,n){return void 0===i&&(i={}),void 0===n&&(n=!0),this.log.info(_.SETTING_FETCH_SETTING+" call "+t),this.inited?(this.activePolling(),0<Object.keys(i).length?(this.log.info(_.SETTING_FETCH_SETTING+" get file with params"),this._(t,e(e({},this.envVariable),i))):(i=this.fileList.find((function(i){return i.fileName===t})))?(this.log.info(_.SETTING_FETCH_SETTING+" file exist"),(new Date).getTime()-i.fetchedTime<1e3*this.pollingInterval?(this.log.info(_.SETTING_FETCH_SETTING+" fetch time interval in freq"),i.needPolling=n,Promise.resolve({setting:i.setting,versions:i.versions})):this.O(t,i,n)):(this.log.info(_.SETTING_FETCH_SETTING+" file not found"),this.O(t,i,n))):Promise.reject(o.NOT_INIT)},d.prototype.fetchMultiSetting=function(t,i,n){var u=this;return void 0===i&&(i={}),void 0===n&&(n=!0),this.log.info(_.SETTING_FETCH_SETTING+" call "+JSON.stringify(t)),this.inited?(this.activePolling(),0<Object.keys(i).length?(this.log.info(_.SETTING_FETCH_SETTING+" get file with params"),this._(t,e(e({},this.envVariable),i))):new Promise((function(i,e){var o={},h=[];if(t.forEach((function(t){return s(u,void 0,void 0,(function(){var i;return r(this,(function(n){return(i=this.fileList.find((function(i){return i.fileName===t})))&&(new Date).getTime()-i.fetchedTime<1e3*this.pollingInterval?(this.log.info(_.SETTING_FETCH_SETTING+" fetch time interval in freq"),o[t]={setting:i.setting,versions:i.versions}):h.push(t),[2]}))}))})),!(0<h.length))return i(o);u._(h,u.envVariable).then((function(t){return u.k(t,n),Object.assign(o,t),i(o)})).catch((function(t){h.forEach((function(t){return s(u,void 0,void 0,(function(){var i;return r(this,(function(e){switch(e.label){case 0:return(i=this.fileList.find((function(i){return i.fileName==t})))?i.fetchedTime=(new Date).getTime():this.fileList.find((function(i){return i.fileName===t}))||this.fileList.push({fileName:t,fetchedTime:(new Date).getTime(),needPolling:n,setting:{},versions:{}}),[4,this.settingCacheHandler.getCacheSetting(t)];case 1:return i=e.sent(),o[t]={setting:i.setting,versions:i.versions},[2]}}))}))})),0<Object.keys(o).length?i(o):e(t)}))}))):(this.log.info(_.SETTING_FETCH_SETTING+" not init"),Promise.reject(o.NOT_INIT))},d.prototype.setOptions=function(t){t&&"boolean"==typeof t.unify&&(this.options.unify=t.unify,this.settingFetchHandler.setOptions(this.options))},d.prototype.setLog=function(t){this.log=t},d.prototype._=function(t,i){var n=this;return new Promise((function(e,u){return s(n,void 0,void 0,(function(){var n,s,h,c,a,f,l,d,v,m=this;return r(this,(function(r){switch(r.label){case 0:if(r.trys.push([0,6,,7]),this.checkFailed)return this.log.warn(_.SETTING_GET_CLOUD_SETTING+" check fail"),u(o.AUTH_FAIL),[2];s=(n=t instanceof Array)?t:[t],h=[],c={},a=function(t){return t=t.map((function(t){return m.settingCacheHandler.getCacheSetting(t)})),Promise.all(t)},r.label=1;case 1:return r.trys.push([1,3,,4]),[4,a(s)];case 2:return f=r.sent(),s.forEach((function(t,i){var n;h.push({file_name:t,hash:null==(n=f[i].versions)?void 0:n.hash,g_version:null==(n=f[i].versions)?void 0:n.g_version}),c[t]=f[i]})),[3,4];case 3:return r.sent(),s.forEach((function(t){h.push({file_name:t})})),[3,4];case 4:return[4,this.settingFetchHandler.fetchSetting(h,i,this.token,this.userID,!1)];case 5:return v=r.sent(),l=v.data,v=v.polling_interval,this.checkFailCount=0,this.log.info(_.SETTING_GET_CLOUD_SETTING+" suc"),"number"==typeof v&&5<=v&&this.pollingInterval!==60*v&&(this.log.warn(_.SETTING_GET_CLOUD_SETTING+" polling interval change"),this.pollingInterval=60*v,this.uninit(),this.activePolling()),n?(d={},t.forEach((function(t){var i;0==(null==(i=l[t])?void 0:i.code)&&(l[t].hashChange?(m.log.info(_.SETTING_GET_CLOUD_SETTING+" file "+t+" changed"),d[t]={setting:null==(i=l[t])?void 0:i.data,versions:null==(i=l[t])?void 0:i.versions}):c[t]&&(d[t]={setting:null==(i=c[t])?void 0:i.setting,versions:null==(i=c[t])?void 0:i.versions}))})),0<Object.keys(d).length?e(d):u(o.MULTI_FILE_NOT_EXIST)):0===(null==(v=l[t])?void 0:v.code)&&null!=(v=l[t])&&v.data?e({setting:null==(v=l[t])?void 0:v.data,versions:null==(v=l[t])?void 0:v.versions}):u({code:null==(v=l[t])?void 0:v.code,msg:null==(v=l[t])?void 0:v.message}),[3,7];case 6:return v=r.sent(),this.log.error(_.SETTING_GET_CLOUD_SETTING+" fail "+JSON.stringify(v)),21002!==(null==v?void 0:v.code)&&401!==(null==v?void 0:v.status_code)||(this.checkFailCount+=1),2<=this.checkFailCount&&(this.checkFailed=!0),u(v),[3,7];case 7:return[2]}}))}))}))},d.prototype.k=function(t,i){var n=this;Object.keys(t).forEach((function(e){(s=n.fileList.find((function(t){return t.fileName==e})))?(s.fetchedTime=(new Date).getTime(),s.setting=t[e].setting,s.versions=t[e].versions,s.needPolling=i):n.fileList.find((function(t){return t.fileName===e}))||n.fileList.push({fileName:e,fetchedTime:(new Date).getTime(),needPolling:i,setting:t[e].setting,versions:t[e].versions});var s=e;n.settingCacheHandler.storeSetting(s,t[e])}))},d.prototype.O=function(t,i,n){var e=this;return new Promise((function(o,u){e.log.info(_.SETTING__FETCH_SETTING+" call"),e._(t,e.envVariable).then((function(s){i?(i.fetchedTime=(new Date).getTime(),i.setting=s.setting,i.versions=s.versions,i.needPolling=n):e.fileList.find((function(i){return i.fileName===t}))||e.fileList.push({fileName:t,fetchedTime:(new Date).getTime(),needPolling:n,setting:s.setting,versions:s.versions}),e.settingCacheHandler.storeSetting(t,s),o(s),e.log.info(_.SETTING__FETCH_SETTING+" call suc")})).catch((function(h){return s(e,void 0,void 0,(function(){var e,s;return r(this,(function(r){switch(r.label){case 0:i?i.fetchedTime=(new Date).getTime():this.fileList.find((function(i){return i.fileName===t}))||this.fileList.push({fileName:t,fetchedTime:(new Date).getTime(),needPolling:n,setting:{},versions:{}}),e=t,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.settingCacheHandler.getCacheSetting(e)];case 2:return s=r.sent(),o(s),[3,4];case 3:return r.sent(),u(h),[3,4];case 4:return this.log.info(_.SETTING__FETCH_SETTING+" setting not contain or fetch file fail"),[2]}}))}))}))}))},d.prototype.h=function(){var t;0==this.options.env?(this.publicEnvVariable.userAgent=navigator.userAgent,this.publicEnvVariable.platform=navigator.platform,this.publicEnvVariable.browser=l.getBrowser(),this.publicEnvVariable.deviceid=l.generateUUID()):1==this.options.env&&(t=wx.getSystemInfoSync(),this.publicEnvVariable.brand=t.brand,this.publicEnvVariable.model=t.model,this.publicEnvVariable.system=t.system,this.publicEnvVariable.platform=t.platform,this.publicEnvVariable.wechatVersion=t.version,this.publicEnvVariable.wechatSDKVersion=t.SDKVersion,this.publicEnvVariable.deviceid=l.generateUUID(this.options.env))},d.prototype.v=function(t,i){return void 0===i&&(i=!0),s(this,void 0,void 0,(function(){var n,e,o,u,h=this;return r(this,(function(c){switch(c.label){case 0:if(this.log.info(_.SETTING_POLLING_SETTING+" call "+t+" "+i),n=t,i){if(e=[],this.fileList.forEach((function(t){t.fileName,t.needPolling&&e.push({file_name:t.fileName,hash:t.versions.hash,g_version:t.versions.g_version})})),!this.checkFailed)return[3,1];this.log.warn(_.SETTING_GET_CLOUD_SETTING+" has checked fail")}return[3,7];case 1:if(!(0<e.length))return[3,6];c.label=2;case 2:return c.trys.push([2,4,,5]),[4,this.settingFetchHandler.fetchSetting(e,this.envVariable,this.token,this.userID)];case 3:return u=c.sent(),o=u.data,u=u.polling_interval,this.log.info(_.SETTING_POLLING_SETTING+" fetch suc"),this.checkFailCount=0,"number"==typeof u&&5<=u&&this.pollingInterval!==60*u&&(this.log.warn(_.SETTING_POLLING_SETTING+" polling interval change"),this.pollingInterval=60*u,n=1e3*this.pollingInterval),this.fileList.forEach((function(t){return s(h,void 0,void 0,(function(){var i,n,e,s,u,h,c,a,f;return r(this,(function(r){switch(r.label){case 0:return t.fetchedTime=(new Date).getTime(),i=t.fileName,s=o[t.fileName],f=s.code,c=s.data,a=s.versions,n=s.message,e=s.hashChange,s&&0===f&&c?(s=JSON.stringify(c),u=JSON.stringify(t.setting),h={setting:c,versions:a,code:f,message:n},e&&u!==s&&(this.log.info(_.SETTING_POLLING_SETTING+" "+t.fileName+" setting changed"),t.setting=h.setting,t.versions=h.versions,this.options.pollingNotify(t.fileName,h)),[4,this.settingCacheHandler.getCacheSetting(i)]):[3,2];case 1:c=r.sent(),a=JSON.stringify(c),f=JSON.stringify(h),e&&a!==f&&this.settingCacheHandler.storeSetting(i,h),r.label=2;case 2:return[2]}}))}))})),[3,5];case 4:return u=c.sent(),this.log.error(_.SETTING_POLLING_SETTING+" fetch fail "+JSON.stringify(u)),21002!==(null==u?void 0:u.code)&&401!==(null==u?void 0:u.status_code)||(this.checkFailCount+=1),2<=this.checkFailCount&&(this.checkFailed=!0),[3,5];case 5:return[3,7];case 6:this.log.info(_.SETTING_POLLING_SETTING+" polling no file"),c.label=7;case 7:return this.pollingTimer&&clearTimeout(this.pollingTimer),this.pollingTimer=setTimeout((function(){h.v(n)}),n),[2]}}))}))},d.prototype.activePolling=function(){this.pollingTimer||this.v(1e3*this.pollingInterval)},d.prototype.g=function(){this.checkFailCount=0,this.checkFailed=!1},i.ZegoSetting=d},function(t,i,n){"use strict";function e(){}Object.defineProperty(i,"u",{value:!0}),i.ZegoLog=void 0,e.prototype.log=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var n=t.join(" ");console.log(n)},e.prototype.debug=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var n=t.join(" ");console.debug(n)},e.prototype.info=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var n=t.join(" ");console.info(n)},e.prototype.warn=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var n=t.join(" ");console.warn(n)},e.prototype.error=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var n=t.join(" ");console.error(n)},i.ZegoLog=e},function(t,i,n){"use strict";var e=this&&this.__awaiter||function(t,i,n,e){return new(n=n||Promise)((function(s,r){function o(t){try{h(e.next(t))}catch(t){r(t)}}function u(t){try{h(e.throw(t))}catch(t){r(t)}}function h(t){var i;t.done?s(t.value):((i=t.value)instanceof n?i:new n((function(t){t(i)}))).then(o,u)}h((e=e.apply(t,i||[])).next())}))},s=this&&this.__generator||function(t,i){var n,e,s,r={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},o={next:u(0),throw:u(1),return:u(2)};return"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){var h=[o,u];if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,e&&(s=2&h[0]?e.return:h[0]?e.throw||((s=e.return)&&s.call(e),0):e.next)&&!(s=s.call(e,h[1])).done)return s;switch(e=0,(h=s?[2&h[0],s.value]:h)[0]){case 0:case 1:s=h;break;case 4:return r.label++,{value:h[1],done:!1};case 5:r.label++,e=h[1],h=[0];continue;case 7:h=r.ops.pop(),r.trys.pop();continue;default:if(!(s=0<(s=r.trys).length&&s[s.length-1])&&(6===h[0]||2===h[0])){r=0;continue}if(3===h[0]&&(!s||h[1]>s[0]&&h[1]<s[3]))r.label=h[1];else if(6===h[0]&&r.label<s[1])r.label=s[1],s=h;else{if(!(s&&r.label<s[2])){s[2]&&r.ops.pop(),r.trys.pop();continue}r.label=s[2],r.ops.push(h)}}h=i.call(t,r)}catch(u){h=[6,u],e=0}finally{n=s=0}if(5&h[0])throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}}},r=this&&this.__importDefault||function(t){return t&&t.u?t:{default:t}},o=(Object.defineProperty(i,"u",{value:!0}),i.SettingCacheHandler=void 0,r(n(3))),u=n(1),h=n(12);function c(t,i,n){void 0===n&&(n=0),this.S=t,this.D=i,this.store=h.createZegoStore(t,n)}c.prototype.getCacheSetting=function(t){return e(this,void 0,void 0,(function(){return s(this,(function(i){switch(i.label){case 0:return this.D.info(u.SETTINGCACHEHANDLER_GET_CACHE_SETTING+" call"),[4,this.store.getItem(t)];case 1:return[2,i.sent()||""]}}))}))},c.prototype.storeSetting=function(t,i){return e(this,void 0,void 0,(function(){return s(this,(function(n){switch(n.label){case 0:return this.D.info(u.SETTINGCACHEHANDLER_STORE_SETTING+" call"),[4,this.store.setItem(t,i)];case 1:return n.sent(),[2]}}))}))},c.prototype.dropOldStore=function(t){o.default.dropInstance({name:t}).then((function(){console.debug("Dropped ",t)})).catch((function(t){console.warn(t)}))},i.SettingCacheHandler=c},function(t,i,n){"use strict";Object.defineProperty(i,"u",{value:!0}),i.createZegoStore=i.ZegoWechatMiniStore=void 0;var e=n(3),s=n(2),r=(o.prototype.getItem=function(t){var i=this;return new Promise((function(n,e){try{n(wx.getStorageSync(i.keyPrefix+t))}catch(n){e(n)}}))},o.prototype.setItem=function(t,i){var n=this;return new Promise((function(e,s){try{wx.setStorageSync(n.keyPrefix+t,i),e()}catch(e){s(e)}}))},o.prototype.removeItem=function(t){var i=this;return new Promise((function(n,e){try{n(wx.removeStorageSync(i.keyPrefix+t))}catch(n){e(n)}}))},o.prototype.clear=function(){return new Promise((function(t,i){try{wx.clearStorageSync(),t()}catch(t){i(t)}}))},o.prototype.keys=function(){var t=this;return new Promise((function(i,n){try{var e=wx.getStorageInfoSync().keys,s=(console.warn("keys",e),[]);e.forEach((function(i){0==i.indexOf(t.keyPrefix)&&s.push(i.replace(t.keyPrefix,""))})),console.warn("keyArr",s),s.sort(),i(s)}catch(i){n(i)}}))},o);function o(t){this.storeName=t,this.keyPrefix=t+"/",this.storeName}i.ZegoWechatMiniStore=r,i.createZegoStore=function(t,i){return i===s.ZEGO_ENV.BROWSER?e.createInstance({name:t}):new r(t)}},function(t,i,n){"use strict";var e,s,r=this&&this.__assign||function(){return(r=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var s in i=arguments[n])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t}).apply(this,arguments)},o=this&&this.__importDefault||function(t){return t&&t.u?t:{default:t}},u=(Object.defineProperty(i,"u",{value:!0}),i.SettingFetchHandler=void 0,n(14)),h=n(15),c=n(4),a=n(17),f=n(7),l=o(n(5)),_=n(1),d=n(0);function v(t,i){this.j=t,this.D=i,this.seq=0,this.userID="",this.unSendCommandList=new h.LinkedList,this.testNetPackageSize=!1,this.protobuf=new a.CloudSettingProtoBuf}e={SERVICE_ClOUD_SETTING:10,10:"SERVICE_ClOUD_SETTING"},o=s={METHOD_UNSET:0,0:"METHOD_UNSET",METHOD_GET:1,1:"METHOD_GET",METHOD_POST:2,2:"METHOD_POST"},v.prototype.setOptions=function(t){this.j=t},v.prototype.setDataReport=function(t){this.reportFunc=t},v.prototype.setUserID=function(t){this.userID=t},v.prototype.fetchSetting=function(t,i,n,e,s){var o=this;return void 0===s&&(s=!0),new Promise((function(h,a){function l(t){var i,n=t.code,e=(t.msg,t.data),r=t.polling_interval;t=t.reportData,o.D.info(_.SETTINGFETCHHANDLER_FETCHSETTING+" unify "+n),e&&(i=[],Object.keys(e).forEach((function(t){var n;i.push({name:t,code:e[t].code,message:null==(n=e[t])?void 0:n.message,versions:JSON.stringify(null==(n=e[t])?void 0:n.versions),content:JSON.stringify(null==(n=e[t])?void 0:n.data)})}))),o.reportFunc&&o.reportFunc(p,"request_end",{code:n,reportData:t,params:g,requestKV:m,files:i,polling:s}),h({data:e,polling_interval:r})}function d(t){var i=t.code,n=t.msg,e=(t.data,t.status_code);t=t.reportData,o.D.warn(_.SETTINGFETCHHANDLER_FETCHSETTING+" unify "+i),o.reportFunc&&o.reportFunc(p,"request_end",{code:i,params:g,requestKV:m,reportData:t,polling:s}),a({code:i,msg:n,status_code:e})}var v={product:o.j.product,files:t.map((function(t){return t.file_name})),param:r(r({},i),{deviceid:void 0}),appid:o.j.appID,token:n,id_name:e,timestamp:(new Date).getTime(),biztype:0,deviceid:i.deviceid||c.generateUUID(o.j.env),compress:!1,mode:o.j.online?"online":"test"},m=v.param,g={appid:v.appid,token:v.token,id_name:v.id_name,deviceid:v.deviceid},p=o.seq++;if(o.reportFunc&&o.reportFunc(p,"request_start",{polling:s}),null!=(y=o.j)&&y.unify&&o.j.connection)if(void 0!==o.j.productNum){var b,E=[];for(b in v.param)void 0!==v.param[b]&&E.push({key:b,value:v.param[b]});var y={product:o.j.productNum,response_compress:f.INIT_CONFIG.compress?0:1,files:t,param_list:E,p_version:f.INIT_CONFIG.p_version},S=(o.D.info(_.SETTINGFETCHHANDLER_FETCHSETTING+" files "+JSON.stringify(y.files)),o.j.online?1:2);o.sendCloudPBRequest(e,y,n,S,l,d)}else o.sendCloudRequest(e,v,"/cloud-setting/get",(function(t){l(t)}),(function(t){d(t)}));else o.j.urls&&u.fetch(o.j.urls,v,o.j.env||0).then((function(t){var i,n=t.code,e=(t.msg,t.data),r=t.polling_interval;t=t.reportData,o.D.info(_.SETTINGFETCHHANDLER_FETCHSETTING+" "+n),e&&(i=[],Object.keys(e).forEach((function(t){var n;i.push({name:t,code:e[t].code,message:null==(n=e[t])?void 0:n.message,versions:JSON.stringify(null==(n=e[t])?void 0:n.versions),content:JSON.stringify(null==(n=e[t])?void 0:n.data)})}))),o.reportFunc&&o.reportFunc(p,"request_end",{code:n,reportData:t,params:g,requestKV:m,files:i,polling:s}),h({data:e,polling_interval:r})})).catch((function(t){var i=t.code,n=t.msg;t.data,t=t.reportData,o.D.warn(_.SETTINGFETCHHANDLER_FETCHSETTING+" "+i),o.reportFunc&&o.reportFunc(p,"request_end",{code:i,params:g,requestKV:m,reportData:t,polling:s}),a({code:i,msg:n})}))}))},v.prototype.sendCloudRequest=function(t,i,n,o,u,h,c){var a=this,f=(void 0===h&&(h=3),void 0===c&&(c=[]),(new Date).getTime());this.sendNetAgentHttpRequest({service:e.SERVICE_ClOUD_SETTING,body:i,ack:!1,idName:t,method_no:s.METHOD_POST,location:n},(function(e){var s,l,_,v,m;200===(null==e?void 0:e.status_code)?(s=(v=JSON.parse(e.body)).code,l=v.message,_=v.data,v=v.polling_interval,m=(new Date).getTime()-f,c.push({timestamp:f,url:n,error:s,duration:m}),0===s?o({code:s,msg:l,data:_,polling_interval:v,reportData:c}):u({code:s,msg:l,reportData:c})):(m=(new Date).getTime()-f,c.push({timestamp:f,url:n,error:null==e?void 0:e.status_code,duration:m}),0<h?(h--,a.sendCloudRequest(t,i,n,o,u,h,c)):u(r(r({},d.FILE_REQUEST_FAIL),{reportData:c})))}),(function(e){var s=(new Date).getTime()-f;c.push({timestamp:f,url:n,error:e.code,duration:s}),0<h?(h--,a.sendCloudRequest(t,i,n,o,u,h,c)):u(r(r({},d.FILE_REQUEST_FAIL),{reportData:c}))}),null,{timeout:4e3})},v.prototype.sendNetAgentHttpRequest=function(t,i,n,e,s){t={param:t,suc:i,err:n,ack:e,option:s},null!=(i=this.j.connection)&&i.isConnect()?this.sendNetUintData(t):this.unSendCommandList.push(t)},v.prototype.sendNetUintData=function(t){var i,n=t.param,e=t.suc,s=t.err,r=t.ack;t=t.option,null!=(i=this.j.connection)&&i.startHttpRequest(n,e,s,r,t)},v.prototype.checkUnSendMsgs=function(t){for(var i=t.getFirst();null!=i;)t.remove(i),i.T&&i.T.param&&this.sendNetUintData(i.T),i=t.getFirst()},v.prototype.sendCloudPBRequest=function(t,i,n,e,o,u,h,a){var f,v=this,m=(void 0===h&&(h=3),void 0===a&&(a=[]),(new Date).getTime()),g=this.protobuf.encodeCloudSettingReq(i);null!=(f=this.j.connection)&&f.startHttpRequest2({interfaceID:14,body:g,ack:!1,idName:t,method:s.METHOD_POST,token:n,mode:e,reduceRspHeaders:!0},(function(s,f){if(200===(null==s?void 0:s.status_code)){var g=v.protobuf.decodeCloudSettingRsp(s.body),p=g.message,b=(g.data,g.polling_interval),E=g.code||0,y=(l.default.isLong(E)&&(E=E.toNumber()),(new Date).getTime()-m);if(a.push({timestamp:m,error:E,duration:y}),0===E){for(var S={},O=0;O<g.file_response.length;O++){var R=(C=g.file_response[O]).message,T=C.file_name,w=C.hash,N=C.g_version,I=C.json_data,C=(v.D.info(_.SETTINGFETCHHANDLER_FETCHSETTING+" file rsp "+T+" "+N+" "+w.toString()),C.code||0),k=(l.default.isLong(C)&&(C=C.toNumber()),{});if(0<(null==w?void 0:w.byteLength)&&0<(null==I?void 0:I.byteLength))try{var A=0===i.response_compress?c.decodeCompressData(I):c.decodeString(I);k=JSON.parse(A)}catch(s){v.D.info(_.SETTINGFETCHHANDLER_FETCHSETTING+" decode fail "+(null==s?void 0:s.message)?s.message:JSON.stringify(s))}S[T]={code:C,message:R,versions:{hash:w,g_version:N},data:k,hashChange:0===w.byteLength?0:1}}o({code:E,msg:p,data:S,polling_interval:b,reportData:a})}else u({code:E,msg:p,reportData:a})}else y=(new Date).getTime()-m,a.push({timestamp:m,error:null==s?void 0:s.status_code,duration:y}),0<h?(h--,v.sendCloudPBRequest(t,i,n,e,o,u,h,a)):u(r(r({},d.FILE_REQUEST_FAIL),{reportData:a,status_code:null==s?void 0:s.status_code}))}),(function(s){var c=(new Date).getTime()-m;a.push({timestamp:m,error:s.code,duration:c}),0<h?(h--,v.sendCloudPBRequest(t,i,n,e,o,u,h,a)):u(r(r({},d.FILE_REQUEST_FAIL),{reportData:a,status_code:null==s?void 0:s.status_code}))}),null,{timeout:4e3,extras:{protoCmd:"GetCloudSettingConfigRequest"}})},i.SettingFetchHandler=n=v},function(t,i,n){"use strict";var e=this&&this.__assign||function(){return(e=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var s in i=arguments[n])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t}).apply(this,arguments)},s=(Object.defineProperty(i,"u",{value:!0}),i.fetch=void 0,n(0));i.fetch=function t(i,n,r,o,u,h){return void 0===o&&(o=5),void 0===u&&(u=0),void 0===h&&(h=[]),new Promise((function(c,a){u=u||(new Date).getTime();var f,l,_,d=(new Date).getTime();0===r?(f=new XMLHttpRequest,l=i[(o+1)%2]||i[0],f.open("post",l),1==n.compress&&(f.responseType="arraybuffer"),f.ontimeout=function(){console.warn("The request for "+l+" timed out.")},f.onreadystatechange=function(){var _,v,m,g,p;4==f.readyState&&(200<=f.status&&f.status<300||304==f.status?(m=void 0,1!=n.compress&&(m=f.responseText),p=(new Date).getTime()-d,_=(m=JSON.parse(m)).code,v=m.message,g=m.data,m=m.polling_interval,h.push({timestamp:d,url:l,error:_,duration:p}),0===_?c({code:_,msg:v,data:g,polling_interval:m,reportData:h}):a({code:_,msg:v,reportData:h})):(g=(new Date).getTime()-d,h.push({timestamp:d,url:l,error:f.status,duration:g}),p=(new Date).getTime()-u,0<o&&p<8e3?t(i,n,r,--o,u,h).then((function(t){c(t)})).catch((function(t){a(t)})):a(e(e({},s.FILE_REQUEST_FAIL),{reportData:h}))))},f.timeout=8e3,f.send(JSON.stringify(n))):(_=i[(o+1)%2]||i[0],wx.request({url:_,data:n,method:"POST",success:function(f){console.log(f.data);var l=(g=f.data).code,v=g.message,m=g.data,g=g.polling_interval;void 0!==l?0===l?(console.log("post suc"),c({code:l,msg:v,data:m,polling_interval:g,reportData:h})):(console.error("post fail ",l,v),a({code:l,msg:v,reportData:h})):(m=(new Date).getTime()-d,h.push({timestamp:d,url:_,error:s.FILE_REQUEST_FAIL.code,msg:f.data,duration:m}),0<o?t(i,n,r,--o,u,h).then((function(t){c(t)})).catch((function(t){a(t)})):a(e(e({},s.FILE_REQUEST_FAIL),{reportData:h})))},fail:function(f){console.log("send failed "+JSON.stringify(f)+f.statusCode);var l=(new Date).getTime()-d;h.push({timestamp:d,url:_,error:s.FILE_REQUEST_FAIL.code,msg:f.errMsg,duration:l}),0<o?t(i,n,r,--o,u,h).then((function(t){c(t)})).catch((function(t){a(t)})):a(e(e({},s.FILE_REQUEST_FAIL),{reportData:h}))}}))}))}},function(t,i,n){"use strict";Object.defineProperty(i,"u",{value:!0}),i.LinkedList=i.ListNode=void 0,Object.defineProperty(s.prototype,"id",{get:function(){return this.N||null},set:function(t){this.N=t},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"data",{get:function(){return this.T},set:function(t){this.T=t},enumerable:!1,configurable:!0}),s.prototype.hasNext=function(){return this.next&&this.next.id},s.prototype.hasPrev=function(){return this.prev&&this.prev.id};var e=s;function s(t,i){void 0===t&&(t=null),void 0===i&&(i=null),this.next=null,this.prev=null,this.N=t,this.T=i}function r(){this.start=new e,this.end=new e,this.R=0,this.A=0,this.start.next=this.end,this.start.prev=null,this.end.prev=this.start,this.end.next=null}i.ListNode=e,r.prototype.insertBefore=function(t,i){return(i=new e(this.R,i)).next=t,i.prev=t.prev,t.prev&&(t.prev.next=i),t.prev=i,++this.R,++this.A,i},r.prototype.addLast=function(t){return this.insertBefore(this.end,t)},r.prototype.add=function(t){return this.addLast(t)},r.prototype.getFirst=function(){return 0===this.A?null:this.start.next},r.prototype.getLast=function(){return 0===this.A?null:this.end.prev},r.prototype.size=function(){return this.A},r.prototype.getFromFirst=function(t){var i=0,n=this.start.next;if(0<=t)for(;i<t&&null!==n;)n=n.next,++i;else n=null;if(null===n)throw"Index out of bounds.";return n},r.prototype.get=function(t){return 0===t?this.getFirst():t===this.A-1?this.getLast():this.getFromFirst(t)},r.prototype.remove=function(t){return t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),--this.A,t},r.prototype.removeFirst=function(){return 0<this.A&&this.start.next?this.remove(this.start.next):null},r.prototype.removeLast=function(){return 0<this.A&&this.end.prev?this.remove(this.end.prev):null},r.prototype.removeAll=function(){this.start.next=this.end,this.end.prev=this.start,this.A=0,this.R=0},r.prototype.each=function(t){for(var i=this.start;i.hasNext();)t(i=i.next)},r.prototype.find=function(t){for(var i=this.start,n=!1,e=null;i.hasNext()&&!n;)t(i=i.next)&&(e=i,n=!0);return e},r.prototype.map=function(t){for(var i=this.start,n=[];i.hasNext();)t(i=i.next)&&n.push(i);return n},r.prototype.push=function(t){return this.addLast(t)},r.prototype.unshift=function(t){0<this.A?this.insertBefore(this.start.next,t):this.insertBefore(this.end,t)},r.prototype.pop=function(){return this.removeLast()},r.prototype.shift=function(){return this.removeFirst()},i.LinkedList=r},function(t,i,n){!function(t){"use strict";function i(t,i,n,e){var r=s,o=e+n;t^=-1;for(var u=e;u<o;u++)t=t>>>8^r[255&(t^i[u])];return-1^t}function n(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}var e=function(t,i,n,e){for(var s=65535&t|0,r=t>>>16&65535|0,o=0;0!==n;){for(n-=o=2e3<n?2e3:n;r=r+(s=s+i[e++]|0)|0,--o;);s%=65521,r%=65521}return s|r<<16|0},s=new Uint32Array(function(){for(var t=[],i=0;i<256;i++){for(var n=i,e=0;e<8;e++)n=1&n?3988292384^n>>>1:n>>>1;t[i]=n}return t}()),r=16209,o=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),u=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),h=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),c=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),a=function(t,i,n,e,s,r,a,f){var l,_,d,v,m,g,p,b,E,y=f.bits,S=0,O=0,R=0,T=0,w=0,N=0,I=0,C=0,k=0,A=0,D=null,P=new Uint16Array(16),M=new Uint16Array(16),U=null;for(S=0;S<=15;S++)P[S]=0;for(O=0;O<e;O++)P[i[n+O]]++;for(w=y,T=15;1<=T&&0===P[T];T--);if(T<w&&(w=T),0===T)s[r++]=20971520,s[r++]=20971520,f.bits=1;else{for(R=1;R<T&&0===P[R];R++);for(w<R&&(w=R),S=C=1;S<=15;S++)if((C=(C<<1)-P[S])<0)return-1;if(0<C&&(0===t||1!==T))return-1;for(M[1]=0,S=1;S<15;S++)M[S+1]=M[S]+P[S];for(O=0;O<e;O++)0!==i[n+O]&&(a[M[i[n+O]]++]=O);if(g=0===t?(D=U=a,20):1===t?(D=o,U=u,257):(D=h,U=c,0),S=R,m=r,I=O=A=0,d=-1,v=(k=1<<(N=w))-1,1===t&&852<k||2===t&&592<k)return 1;for(;;){for(E=a[O]+1<g?(b=0,a[O]):a[O]>=g?(b=U[a[O]-g],D[a[O]-g]):(b=96,0),l=1<<(p=S-I),R=_=1<<N;s[m+(A>>I)+(_-=l)]=p<<24|b<<16|E|0,0!==_;);for(l=1<<S-1;A&l;)l>>=1;if(A=0!==l?(A&l-1)+l:0,O++,0==--P[S]){if(S===T)break;S=i[n+a[O]]}if(w<S&&(A&v)!==d){for(m+=R,C=1<<(N=S-(I=0===I?w:I));N+I<T&&!((C-=P[N+I])<=0);)N++,C<<=1;if(k+=1<<N,1===t&&852<k||2===t&&592<k)return 1;s[d=A&v]=w<<24|N<<16|m-r|0}}0!==A&&(s[m+A]=S-I<<24|64<<16|0),f.bits=w}return 0},f={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},l=f.Z_FINISH,_=f.Z_BLOCK,d=f.Z_TREES,v=f.Z_OK,m=f.Z_STREAM_END,g=f.Z_NEED_DICT,p=f.Z_STREAM_ERROR,b=f.Z_DATA_ERROR,E=f.Z_MEM_ERROR,y=f.Z_BUF_ERROR,S=f.Z_DEFLATED,O=16180,R=16190,T=16191,w=16209;function N(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function I(t,s){var o,u,h,c,f,N,I,C,P,j,z,L,x,H,G,q,B,$,V,J,Y,F,K,W,Z=0,X=new Uint8Array(4),Q=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(D(t)||!t.output||!t.input&&0!==t.avail_in)return p;(o=t.state).mode===T&&(o.mode=16192),f=t.next_out,h=t.output,I=t.avail_out,c=t.next_in,u=t.input,N=t.avail_in,C=o.hold,P=o.bits,j=N,z=I,F=v;t:for(;;)switch(o.mode){case O:if(0===o.wrap)o.mode=16192;else{for(;P<16;){if(0===N)break t;N--,C+=u[c++]<<P,P+=8}2&o.wrap&&35615===C?(0===o.wbits&&(o.wbits=15),X[o.check=0]=255&C,X[1]=C>>>8&255,o.check=i(o.check,X,2,0),P=C=0,o.mode=16181):(o.head&&(o.head.done=!1),!(1&o.wrap)||(((255&C)<<8)+(C>>8))%31?(t.msg="incorrect header check",o.mode=w):(15&C)!==S?(t.msg="unknown compression method",o.mode=w):(P-=4,Y=8+(15&(C>>>=4)),0===o.wbits&&(o.wbits=Y),15<Y||Y>o.wbits?(t.msg="invalid window size",o.mode=w):(o.dmax=1<<o.wbits,o.flags=0,t.adler=o.check=1,o.mode=512&C?16189:T,P=C=0)))}break;case 16181:for(;P<16;){if(0===N)break t;N--,C+=u[c++]<<P,P+=8}if(o.flags=C,(255&o.flags)!==S){t.msg="unknown compression method",o.mode=w;break}if(57344&o.flags){t.msg="unknown header flags set",o.mode=w;break}o.head&&(o.head.text=C>>8&1),512&o.flags&&4&o.wrap&&(X[0]=255&C,X[1]=C>>>8&255,o.check=i(o.check,X,2,0)),P=C=0,o.mode=16182;case 16182:for(;P<32;){if(0===N)break t;N--,C+=u[c++]<<P,P+=8}o.head&&(o.head.time=C),512&o.flags&&4&o.wrap&&(X[0]=255&C,X[1]=C>>>8&255,X[2]=C>>>16&255,X[3]=C>>>24&255,o.check=i(o.check,X,4,0)),P=C=0,o.mode=16183;case 16183:for(;P<16;){if(0===N)break t;N--,C+=u[c++]<<P,P+=8}o.head&&(o.head.xflags=255&C,o.head.os=C>>8),512&o.flags&&4&o.wrap&&(X[0]=255&C,X[1]=C>>>8&255,o.check=i(o.check,X,2,0)),P=C=0,o.mode=16184;case 16184:if(1024&o.flags){for(;P<16;){if(0===N)break t;N--,C+=u[c++]<<P,P+=8}o.length=C,o.head&&(o.head.extra_len=C),512&o.flags&&4&o.wrap&&(X[0]=255&C,X[1]=C>>>8&255,o.check=i(o.check,X,2,0)),P=C=0}else o.head&&(o.head.extra=null);o.mode=16185;case 16185:if(1024&o.flags&&((L=(L=o.length)>N?N:L)&&(o.head&&(Y=o.head.extra_len-o.length,o.head.extra||(o.head.extra=new Uint8Array(o.head.extra_len)),o.head.extra.set(u.subarray(c,c+L),Y)),512&o.flags&&4&o.wrap&&(o.check=i(o.check,u,L,c)),N-=L,c+=L,o.length-=L),o.length))break t;o.length=0,o.mode=16186;case 16186:if(2048&o.flags){if(0===N)break t;for(L=0;Y=u[c+L++],o.head&&Y&&o.length<65536&&(o.head.name+=String.fromCharCode(Y)),Y&&L<N;);if(512&o.flags&&4&o.wrap&&(o.check=i(o.check,u,L,c)),N-=L,c+=L,Y)break t}else o.head&&(o.head.name=null);o.length=0,o.mode=16187;case 16187:if(4096&o.flags){if(0===N)break t;for(L=0;Y=u[c+L++],o.head&&Y&&o.length<65536&&(o.head.comment+=String.fromCharCode(Y)),Y&&L<N;);if(512&o.flags&&4&o.wrap&&(o.check=i(o.check,u,L,c)),N-=L,c+=L,Y)break t}else o.head&&(o.head.comment=null);o.mode=16188;case 16188:if(512&o.flags){for(;P<16;){if(0===N)break t;N--,C+=u[c++]<<P,P+=8}if(4&o.wrap&&C!==(65535&o.check)){t.msg="header crc mismatch",o.mode=w;break}P=C=0}o.head&&(o.head.hcrc=o.flags>>9&1,o.head.done=!0),t.adler=o.check=0,o.mode=T;break;case 16189:for(;P<32;){if(0===N)break t;N--,C+=u[c++]<<P,P+=8}t.adler=o.check=n(C),P=C=0,o.mode=R;case R:if(0===o.havedict)return t.next_out=f,t.avail_out=I,t.next_in=c,t.avail_in=N,o.hold=C,o.bits=P,g;t.adler=o.check=1,o.mode=T;case T:if(s===_||s===d)break t;case 16192:if(o.last)C>>>=7&P,P-=7&P,o.mode=16206;else{for(;P<3;){if(0===N)break t;N--,C+=u[c++]<<P,P+=8}switch(o.last=1&C,--P,3&(C>>>=1)){case 0:o.mode=16193;break;case 1:it=void 0;var tt=o;if(M){k=new Int32Array(512),A=new Int32Array(32);for(var it=0;it<144;)tt.lens[it++]=8;for(;it<256;)tt.lens[it++]=9;for(;it<280;)tt.lens[it++]=7;for(;it<288;)tt.lens[it++]=8;for(a(1,tt.lens,0,288,k,0,tt.work,{bits:9}),it=0;it<32;)tt.lens[it++]=5;a(2,tt.lens,0,32,A,0,tt.work,{bits:5}),M=!1}if(tt.lencode=k,tt.lenbits=9,tt.distcode=A,tt.distbits=5,o.mode=16199,s!==d)break;C>>>=2,P-=2;break t;case 2:o.mode=16196;break;case 3:t.msg="invalid block type",o.mode=w}C>>>=2,P-=2}break;case 16193:for(C>>>=7&P,P-=7&P;P<32;){if(0===N)break t;N--,C+=u[c++]<<P,P+=8}if((65535&C)!=(C>>>16^65535)){t.msg="invalid stored block lengths",o.mode=w;break}if(o.length=65535&C,P=C=0,o.mode=16194,s===d)break t;case 16194:o.mode=16195;case 16195:if(L=o.length){if(0===(L=I<(L=N<L?N:L)?I:L))break t;h.set(u.subarray(c,c+L),f),N-=L,c+=L,I-=L,f+=L,o.length-=L}else o.mode=T;break;case 16196:for(;P<14;){if(0===N)break t;N--,C+=u[c++]<<P,P+=8}if(o.nlen=257+(31&C),C>>>=5,P-=5,o.ndist=1+(31&C),C>>>=5,P-=5,o.ncode=4+(15&C),C>>>=4,P-=4,286<o.nlen||30<o.ndist){t.msg="too many length or distance symbols",o.mode=w;break}o.have=0,o.mode=16197;case 16197:for(;o.have<o.ncode;){for(;P<3;){if(0===N)break t;N--,C+=u[c++]<<P,P+=8}o.lens[Q[o.have++]]=7&C,C>>>=3,P-=3}for(;o.have<19;)o.lens[Q[o.have++]]=0;if(o.lencode=o.lendyn,o.lenbits=7,K={bits:o.lenbits},F=a(0,o.lens,0,19,o.lencode,0,o.work,K),o.lenbits=K.bits,F){t.msg="invalid code lengths set",o.mode=w;break}o.have=0,o.mode=16198;case 16198:for(;o.have<o.nlen+o.ndist;){for(;q=(Z=o.lencode[C&(1<<o.lenbits)-1])>>>16&255,B=65535&Z,!((G=Z>>>24)<=P);){if(0===N)break t;N--,C+=u[c++]<<P,P+=8}if(B<16)C>>>=G,P-=G,o.lens[o.have++]=B;else{if(16===B){for(W=G+2;P<W;){if(0===N)break t;N--,C+=u[c++]<<P,P+=8}if(C>>>=G,P-=G,0===o.have){t.msg="invalid bit length repeat",o.mode=w;break}Y=o.lens[o.have-1],L=3+(3&C),C>>>=2,P-=2}else if(17===B){for(W=G+3;P<W;){if(0===N)break t;N--,C+=u[c++]<<P,P+=8}Y=0,L=3+(7&(C>>>=G)),C>>>=3,P=P-G-3}else{for(W=G+7;P<W;){if(0===N)break t;N--,C+=u[c++]<<P,P+=8}Y=0,L=11+(127&(C>>>=G)),C>>>=7,P=P-G-7}if(o.have+L>o.nlen+o.ndist){t.msg="invalid bit length repeat",o.mode=w;break}for(;L--;)o.lens[o.have++]=Y}}if(o.mode===w)break;if(0===o.lens[256]){t.msg="invalid code -- missing end-of-block",o.mode=w;break}if(o.lenbits=9,K={bits:o.lenbits},F=a(1,o.lens,0,o.nlen,o.lencode,0,o.work,K),o.lenbits=K.bits,F){t.msg="invalid literal/lengths set",o.mode=w;break}if(o.distbits=6,o.distcode=o.distdyn,K={bits:o.distbits},F=a(2,o.lens,o.nlen,o.ndist,o.distcode,0,o.work,K),o.distbits=K.bits,F){t.msg="invalid distances set",o.mode=w;break}if(o.mode=16199,s===d)break t;case 16199:o.mode=16200;case 16200:if(6<=N&&258<=I){t.next_out=f,t.avail_out=I,t.next_in=c,t.avail_in=N,o.hold=C,o.bits=P,at=vt=ut=ot=rt=st=et=nt=Rt=Ot=dt=ft=void 0;var nt,et,st,rt,ot,ut,ht=t,ct=z,at=ht.state,ft=ht.next_in,lt=ht.input,_t=ft+(ht.avail_in-5),dt=ht.next_out,vt=ht.output,mt=dt-(ct-ht.avail_out),gt=dt+(ht.avail_out-257),pt=at.dmax,bt=at.wsize,Et=at.whave,yt=at.wnext,St=at.window,Ot=at.hold,Rt=at.bits,Tt=at.lencode,wt=at.distcode,Nt=(1<<at.lenbits)-1,It=(1<<at.distbits)-1;i:do{for(Rt<15&&(Ot+=lt[ft++]<<Rt,Rt+=8,Ot+=lt[ft++]<<Rt,Rt+=8),nt=Tt[Ot&Nt];;){if(Ot>>>=et=nt>>>24,Rt-=et,0==(et=nt>>>16&255))vt[dt++]=65535&nt;else{if(!(16&et)){if(0==(64&et)){nt=Tt[(65535&nt)+(Ot&(1<<et)-1)];continue}if(32&et){at.mode=16191;break i}ht.msg="invalid literal/length code",at.mode=r;break i}for(st=65535&nt,(et&=15)&&(Rt<et&&(Ot+=lt[ft++]<<Rt,Rt+=8),st+=Ot&(1<<et)-1,Ot>>>=et,Rt-=et),Rt<15&&(Ot+=lt[ft++]<<Rt,Rt+=8,Ot+=lt[ft++]<<Rt,Rt+=8),nt=wt[Ot&It];;){if(Ot>>>=et=nt>>>24,Rt-=et,!(16&(et=nt>>>16&255))){if(0==(64&et)){nt=wt[(65535&nt)+(Ot&(1<<et)-1)];continue}ht.msg="invalid distance code",at.mode=r;break i}if(rt=65535&nt,Rt<(et&=15)&&(Ot+=lt[ft++]<<Rt,(Rt+=8)<et)&&(Ot+=lt[ft++]<<Rt,Rt+=8),(rt+=Ot&(1<<et)-1)>pt){ht.msg="invalid distance too far back",at.mode=r;break i}if(Ot>>>=et,Rt-=et,rt>(et=dt-mt)){if((et=rt-et)>Et&&at.sane){ht.msg="invalid distance too far back",at.mode=r;break i}if(ut=St,(ot=0)===yt){if(ot+=bt-et,et<st){for(st-=et;vt[dt++]=St[ot++],--et;);ot=dt-rt,ut=vt}}else if(yt<et){if(ot+=bt+yt-et,(et-=yt)<st){for(st-=et;vt[dt++]=St[ot++],--et;);if(ot=0,yt<st){for(st-=et=yt;vt[dt++]=St[ot++],--et;);ot=dt-rt,ut=vt}}}else if(ot+=yt-et,et<st){for(st-=et;vt[dt++]=St[ot++],--et;);ot=dt-rt,ut=vt}for(;2<st;)vt[dt++]=ut[ot++],vt[dt++]=ut[ot++],vt[dt++]=ut[ot++],st-=3;st&&(vt[dt++]=ut[ot++],1<st)&&(vt[dt++]=ut[ot++])}else{for(ot=dt-rt;vt[dt++]=vt[ot++],vt[dt++]=vt[ot++],vt[dt++]=vt[ot++],2<(st-=3););st&&(vt[dt++]=vt[ot++],1<st)&&(vt[dt++]=vt[ot++])}break}}break}}while(ft<_t&&dt<gt);ft-=st=Rt>>3,Ot&=(1<<(Rt-=st<<3))-1,ht.next_in=ft,ht.next_out=dt,ht.avail_in=ft<_t?_t-ft+5:5-(ft-_t),ht.avail_out=dt<gt?gt-dt+257:257-(dt-gt),at.hold=Ot,at.bits=Rt,f=t.next_out,h=t.output,I=t.avail_out,c=t.next_in,u=t.input,N=t.avail_in,C=o.hold,P=o.bits,o.mode===T&&(o.back=-1);break}for(o.back=0;q=(Z=o.lencode[C&(1<<o.lenbits)-1])>>>16&255,B=65535&Z,!((G=Z>>>24)<=P);){if(0===N)break t;N--,C+=u[c++]<<P,P+=8}if(q&&0==(240&q)){for($=G,V=q,J=B;q=(Z=o.lencode[J+((C&(1<<$+V)-1)>>$)])>>>16&255,B=65535&Z,!($+(G=Z>>>24)<=P);){if(0===N)break t;N--,C+=u[c++]<<P,P+=8}C>>>=$,P-=$,o.back+=$}if(C>>>=G,P-=G,o.back+=G,o.length=B,0===q){o.mode=16205;break}if(32&q){o.back=-1,o.mode=T;break}if(64&q){t.msg="invalid literal/length code",o.mode=w;break}o.extra=15&q,o.mode=16201;case 16201:if(o.extra){for(W=o.extra;P<W;){if(0===N)break t;N--,C+=u[c++]<<P,P+=8}o.length+=C&(1<<o.extra)-1,C>>>=o.extra,P-=o.extra,o.back+=o.extra}o.was=o.length,o.mode=16202;case 16202:for(;q=(Z=o.distcode[C&(1<<o.distbits)-1])>>>16&255,B=65535&Z,!((G=Z>>>24)<=P);){if(0===N)break t;N--,C+=u[c++]<<P,P+=8}if(0==(240&q)){for($=G,V=q,J=B;q=(Z=o.distcode[J+((C&(1<<$+V)-1)>>$)])>>>16&255,B=65535&Z,!($+(G=Z>>>24)<=P);){if(0===N)break t;N--,C+=u[c++]<<P,P+=8}C>>>=$,P-=$,o.back+=$}if(C>>>=G,P-=G,o.back+=G,64&q){t.msg="invalid distance code",o.mode=w;break}o.offset=B,o.extra=15&q,o.mode=16203;case 16203:if(o.extra){for(W=o.extra;P<W;){if(0===N)break t;N--,C+=u[c++]<<P,P+=8}o.offset+=C&(1<<o.extra)-1,C>>>=o.extra,P-=o.extra,o.back+=o.extra}if(o.offset>o.dmax){t.msg="invalid distance too far back",o.mode=w;break}o.mode=16204;case 16204:if(0===I)break t;if(o.offset>(L=z-I)){if((L=o.offset-L)>o.whave&&o.sane){t.msg="invalid distance too far back",o.mode=w;break}x=L>o.wnext?(L-=o.wnext,o.wsize-L):o.wnext-L,L>o.length&&(L=o.length),H=o.window}else H=h,x=f-o.offset,L=o.length;for(I-=L=I<L?I:L,o.length-=L;h[f++]=H[x++],--L;);0===o.length&&(o.mode=16200);break;case 16205:if(0===I)break t;h[f++]=o.length,I--,o.mode=16200;break;case 16206:if(o.wrap){for(;P<32;){if(0===N)break t;N--,C|=u[c++]<<P,P+=8}if(z-=I,t.total_out+=z,o.total+=z,4&o.wrap&&z&&(t.adler=o.check=(o.flags?i:e)(o.check,h,z,f-z)),z=I,4&o.wrap&&(o.flags?C:n(C))!==o.check){t.msg="incorrect data check",o.mode=w;break}P=C=0}o.mode=16207;case 16207:if(o.wrap&&o.flags){for(;P<32;){if(0===N)break t;N--,C+=u[c++]<<P,P+=8}if(4&o.wrap&&C!==(4294967295&o.total)){t.msg="incorrect length check",o.mode=w;break}P=C=0}o.mode=16208;case 16208:F=m;break t;case w:F=b;break t;case 16210:return E;default:return p}return t.next_out=f,t.avail_out=I,t.next_in=c,t.avail_in=N,o.hold=C,o.bits=P,(o.wsize||z!==t.avail_out&&o.mode<w&&(o.mode<16206||s!==l))&&U(t,t.output,t.next_out,z-t.avail_out),j-=t.avail_in,z-=t.avail_out,t.total_in+=j,t.total_out+=z,o.total+=z,4&o.wrap&&z&&(t.adler=o.check=(o.flags?i:e)(o.check,h,z,t.next_out-z)),t.data_type=o.bits+(o.last?64:0)+(o.mode===T?128:0)+(16199===o.mode||16194===o.mode?256:0),(0==j&&0===z||s===l)&&F===v?y:F}function C(t,i){var n,s=i.length;return D(t)||0!==(n=t.state).wrap&&n.mode!==R?p:n.mode===R&&e(1,i,s,0)!==n.check?b:U(t,i,s,s)?(n.mode=16210,E):(n.havedict=1,v)}var k,A,D=function(t){var i;return!t||!(i=t.state)||i.strm!==t||i.mode<O||16211<i.mode?1:0},P=function(t){var i;return D(t)||((i=t.state).wsize=0,i.whave=0,i.wnext=0,D(i=t))?p:(t=i.state,i.total_in=i.total_out=t.total=0,i.msg="",t.wrap&&(i.adler=1&t.wrap),t.mode=O,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,v)},M=!0,U=function(t,i,n,e){var s;return null===(t=t.state).window&&(t.wsize=1<<t.wbits,t.wnext=0,t.whave=0,t.window=new Uint8Array(t.wsize)),e>=t.wsize?(t.window.set(i.subarray(n-t.wsize,n),0),t.wnext=0,t.whave=t.wsize):((s=t.wsize-t.wnext)>e&&(s=e),t.window.set(i.subarray(n-e,n-e+s),t.wnext),(e-=s)?(t.window.set(i.subarray(n-e,n),0),t.wnext=e,t.whave=t.wsize):(t.wnext+=s,t.wnext===t.wsize&&(t.wnext=0),t.whave<t.wsize&&(t.whave+=s))),0},j=P,z=function(t,i){var n,e,s;return t?(n=new N,(t.state=n).strm=t,n.window=null,n.mode=O,n=i,(s=D(i=t)||(s=i.state,n<0?(e=0,n=-n):(e=5+(n>>4),n<48&&(n&=15)),n&&(n<8||15<n))?p:(null!==s.window&&s.wbits!==n&&(s.window=null),s.wrap=e,s.wbits=n,P(i)))!==v&&(t.state=null),s):p};function L(t){return(L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var x=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){x=!1}for(var H=new Uint8Array(256),G=0;G<256;G++)H[G]=252<=G?6:248<=G?5:240<=G?4:224<=G?3:192<=G?2:1;function q(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}function B(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}H[254]=H[254]=1;var $={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},V=Object.prototype.toString,J=f.Z_NO_FLUSH,Y=f.Z_FINISH,F=f.Z_OK,K=f.Z_STREAM_END,W=f.Z_NEED_DICT,Z=f.Z_STREAM_ERROR,X=f.Z_DATA_ERROR,Q=f.Z_MEM_ERROR;function tt(t){this.options=function(t){for(var i,n,e=Array.prototype.slice.call(arguments,1);e.length;){var s=e.shift();if(s){if("object"!==L(s))throw new TypeError(s+"must be non-object");for(var r in s)i=s,n=r,Object.prototype.hasOwnProperty.call(i,n)&&(t[r]=s[r])}}return t}({chunkSize:65536,windowBits:15,to:""},t||{});var i,n,e=this.options;if((t=(e.raw&&0<=e.windowBits&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits)&&(e.windowBits=-15),!(0<=e.windowBits&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),15<e.windowBits&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new q,this.strm.avail_out=0,z(this.strm,e.windowBits)))!==F)throw new Error($[t]);if(this.header=new B,i=this.strm,n=this.header,D(i)||0==(2&(i=i.state).wrap)||((i.head=n).done=!1),e.dictionary&&("string"==typeof e.dictionary?e.dictionary=function(t){if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(t);for(var i,n,e,s,r=t.length,o=0,u=0;u<r;u++)55296==(64512&(n=t.charCodeAt(u)))&&u+1<r&&56320==(64512&(e=t.charCodeAt(u+1)))&&(n=65536+(n-55296<<10)+(e-56320),u++),o+=n<128?1:n<2048?2:n<65536?3:4;for(i=new Uint8Array(o),u=s=0;s<o;u++)55296==(64512&(n=t.charCodeAt(u)))&&u+1<r&&56320==(64512&(e=t.charCodeAt(u+1)))&&(n=65536+(n-55296<<10)+(e-56320),u++),n<128?i[s++]=n:(n<2048?i[s++]=192|n>>>6:(n<65536?i[s++]=224|n>>>12:(i[s++]=240|n>>>18,i[s++]=128|n>>>12&63),i[s++]=128|n>>>6&63),i[s++]=128|63&n);return i}(e.dictionary):"[object ArrayBuffer]"===V.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw)&&(t=C(this.strm,e.dictionary))!==F)throw new Error($[t])}function it(t,i){if((i=new tt(i)).push(t),i.err)throw i.msg||$[i.err];return i.result}function nt(t,i){return(i=i||{}).raw=!0,it(t,i)}tt.prototype.push=function(t,i){var n,e,s=this.strm,r=this.options.chunkSize,o=this.options.dictionary;if(this.ended)return!1;for(e=i===~~i?i:!0===i?Y:J,"[object ArrayBuffer]"===V.call(t)?s.input=new Uint8Array(t):s.input=t,s.next_in=0,s.avail_in=s.input.length;;){for(0===s.avail_out&&(s.output=new Uint8Array(r),s.next_out=0,s.avail_out=r),(n=I(s,e))===W&&o&&((n=C(s,o))===F?n=I(s,e):n===X&&(n=W));0<s.avail_in&&n===K&&0<s.state.wrap&&0!==t[s.next_in];)j(s),n=I(s,e);switch(n){case Z:case X:case W:case Q:return this.onEnd(n),!(this.ended=!0)}var u,h,c,a=s.avail_out;if(!s.next_out||0!==s.avail_out&&n!==K||("string"===this.options.to?(u=function(t,i){for(var n=(i=(i=i||t.length)>t.length?t.length:i)-1;0<=n&&128==(192&t[n]);)n--;return!(n<0||0===n)&&n+H[t[n]]>i?n:i}(s.output,s.next_out),h=s.next_out-u,c=function(t,i){var n=i||t.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(t.subarray(0,i));for(var e=new Array(2*n),s=0,r=0;r<n;){var o=t[r++];if(o<128)e[s++]=o;else{var u=H[o];if(4<u)e[s++]=65533,r+=u-1;else{for(o&=2===u?31:3===u?15:7;1<u&&r<n;)o=o<<6|63&t[r++],u--;1<u?e[s++]=65533:o<65536?e[s++]=o:(o-=65536,e[s++]=55296|o>>10&1023,e[s++]=56320|1023&o)}}}var h=e,c=s;if(c<65534&&h.subarray&&x)return String.fromCharCode.apply(null,h.length===c?h:h.subarray(0,c));for(var a="",f=0;f<c;f++)a+=String.fromCharCode(h[f]);return a}(s.output,u),s.next_out=h,s.avail_out=r-h,h&&s.output.set(s.output.subarray(u,u+h),0),this.onData(c)):this.onData(s.output.length===s.next_out?s.output:s.output.subarray(0,s.next_out))),n!==F||0!==a){if(n===K)return u=this.strm,h=void 0,n=D(u)?p:((h=u.state).window&&(h.window=null),u.state=null,v),this.onEnd(n),this.ended=!0;if(0===s.avail_in)break}}return!0},tt.prototype.onData=function(t){this.chunks.push(t)},tt.prototype.onEnd=function(t){t===F&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=function(t){for(var i=0,n=0,e=t.length;n<e;n++)i+=t[n].length;for(var s=new Uint8Array(i),r=0,o=0,u=t.length;r<u;r++){var h=t[r];s.set(h,o),o+=h.length}return s}(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var et=it,st=it,rt={Inflate:tt,inflate:et,inflateRaw:nt,ungzip:st,constants:f};t.Inflate=tt,t.constants=f,t.default=rt,t.inflate=et,t.inflateRaw=nt,t.ungzip=st,Object.defineProperty(t,"u",{value:!0})}(i)},function(t,i,n){"use strict";var e=this&&this.__createBinding||(Object.create?function(t,i,n,e){void 0===e&&(e=n),Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[n]}})}:function(t,i,n,e){t[e=void 0===e?n:e]=i[n]}),s=this&&this.__setModuleDefault||(Object.create?function(t,i){Object.defineProperty(t,"default",{enumerable:!0,value:i})}:function(t,i){t.default=i}),r=this&&this.__importStar||function(t){if(t&&t.u)return t;var i={};if(null!=t)for(var n in t)"default"!==n&&Object.hasOwnProperty.call(t,n)&&e(i,t,n);return s(i,t),i},o=this&&this.__importDefault||function(t){return t&&t.u?t:{default:t}},u=(Object.defineProperty(i,"u",{value:!0}),i.CloudSettingProtoBuf=void 0,o(n(5))),h=(r=r(n(6)),o(n(18)).default.cloudsetting);function c(){}r.util.Long=u.default,r.configure(),c.prototype.encodeCloudSettingReq=function(t){var i=h.GetCloudSettingConfigRequest;return t=i.create(t),i.encode(t).finish()},c.prototype.decodeCloudSettingRsp=function(t){return h.GetCloudSettingConfigResponse.decode(t)},i.CloudSettingProtoBuf=c},function(t,i,n){"use strict";n.r(i);for(var e=n(6),s=e.util.Long?e.util.Long.fromBits:function(){return 0},r=e.roots,o=e.types?e.types.basic:{double:1,float:5,int32:0,uint32:0,sint32:0,fixed32:5,sfixed32:5,int64:0,uint64:0,sint64:0,fixed64:1,sfixed64:1,bool:0,string:2,bytes:2},u=e.types?e.types.packed:{double:1,float:5,int32:0,uint32:0,sint32:0,fixed32:5,sfixed32:5,int64:0,uint64:0,sint64:0,fixed64:1,sfixed64:1,bool:0},h=Object.keys(o),c={$:function(t){return c[t]?c[t].call(this):r[t].decode?r[t].decode(this,this.uint32()):c.$.call(this,"int32")}},a={$:function(t,i,n){var e=o[t];return void 0===e?r[t].encode?(this.uint32((n<<3|2)>>0).fork(),r[t].encode(i,this).ldelim()):a.$.call(this,"int32",i,n):a[t].call(this.uint32(n<<3|e),i)}},f=0;f<h.length;f++)c[h[f]]=e.Reader.prototype[h[f]],a[h[f]]=e.Writer.prototype[h[f]];!function t(i,n,h,f){for(var l=0,_=Object.keys(i);l<_.length;l++){var d=_[l];if(i[d].$m&&Object.keys(i[d].$m).every((function(t){return Number(t)}))){if(h[d])throw Error(`nested type ${h}.${d} has already exist`);h[d]=function(i,h){function f(t){for(var n in i)"{"===(n=i[n])[1].charAt(0)?this[n[0]]={}:"["!==n[1].charAt(0)&&"<"!==n[1].charAt(0)||(this[n[0]]=[]);if(t)for(var e=Object.keys(t),s=0;s<e.length;++s)null!=t[e[s]]&&(this[e[s]]=t[e[s]])}var l,_={};for(l in i){var d=i[l],v=d[1];"{"===v.charAt(0)?(f.prototype[d[0]]=e.util.emptyObject,_[v]={$m:v.substring(1).split(",").map((function(t,i){return["$"+(i+1),t,null]})).reduce((function(t,i,n){return t[n+1]=i,t}),{})}):"["===v.charAt(0)||"<"===v.charAt(0)?f.prototype[d[0]]=e.util.emptyArray:"bytes"===v?f.prototype[d[0]]=e.util.newBuffer([]):d[2]&&d[2].hasOwnProperty("low")&&d[2].hasOwnProperty("high")?f.prototype[d[0]]=s(d[2].low,d[2].high,d[2].unsigned):f.prototype[d[0]]=d[2]}return f.create=function(t){return new f(t)},f.decode=function(t,n){t instanceof e.Reader||(t=e.Reader.create(t));for(var s=void 0===n?t.len:t.pos+n,o=new f;t.pos<s;){var h=t.uint32();if(0<(_=h>>>3)&&i[_]){var a=i[_][0];if("{"===(l=i[_][1]).charAt(0))o[a]===e.util.emptyObject&&(o[a]={}),_=f.$namespace[l].decode(t,t.uint32()),o[a][_.$1]=_.$2;else if("["===l.charAt(0)||"<"===l.charAt(0)){l=l.substring(1),o[a]&&o[a].length||(o[a]=[]);var l,_=!c[l]&&!r[l].decode;if(void 0!==u[l=_?"int32":l]&&2==(7&h))for(var d=t.uint32()+t.pos;t.pos<d;)o[a].push(c.$.call(t,l));else o[a].push(c.$.call(t,l))}else o[a]=c.$.call(t,l)}else t.skipType(7&h)}return o},f.encode=function(t,n){for(var s in n=n||e.Writer.create(),i){var h=i[s][0];if("{"===(v=i[s][1]).charAt(0)){if(null!=t[h]&&t.hasOwnProperty(h))for(var c=0,l=Object.keys(t[h]);c<l.length;++c)n.uint32((s<<3|2)>>0).fork(),f.$namespace[v].encode({$1:l[c],$2:t[h][l[c]]},n).ldelim()}else if("["===v.charAt(0)||"<"===v.charAt(0)){var _="<"===v.charAt(0),d=(v=v.substring(1),t[h]);if(null!=d&&d.length){var v=void 0!==o[v]||r[v].encode?v:"int32";if(_&&void 0!==u[v]){for(n.uint32((s<<3|2)>>0).fork(),c=0;c<d.length;c++)a[v].call(n,d[c]);n.ldelim()}else for(c=0;c<d.length;c++)a.$.call(n,v,d[c],s)}}else null!=t[h]&&t.hasOwnProperty(h)&&a.$.call(n,v,t[h],s)}return n},Object.keys(_).length&&(f.$namespace=t(_,n+"."+h,f.$namespace||{},!0)),f}(i[d].$m,d)}else i[d].$s?h[d]=function(t,i){function s(t,i,n){e.rpc.Service.call(this,t,i,n)}return((s.prototype=Object.create(e.rpc.Service.prototype)).constructor=s).create=function(t,i,n){return new s(t,i,n)},Object.keys(t).forEach((function(e){var o=t[e];function u(t,i){return this.rpcCall(u,r[o[0]],r[o[1]],t,i)}Object.defineProperty(u,"name",{value:e}),Object.defineProperty(u,"path",{value:n+"."+i}),s.prototype[e]=u})),s}(i[d].$s,d):i[d].$e&&Object.values(i[d].$e).every((function(t){return Number(t)===t}))&&(h[d]=function(t){for(var i=Object.keys(t),n={},e=0;e<i.length;e++)n[n[i[e]]=t[i[e]]]=i[e];return n}(i[d].$e));h[d]&&!f&&(r[n+"."+d]=h[d]),delete i[d].$m,delete i[d].$s,delete i[d].$e,h[d]=t(i[d],n?n+"."+d:d,h[d]||{})}return h}({cloudsetting:{cloudsetting:{CloudSettingFileResponse:{$m:{1:["code","int64",{low:0,high:0,unsigned:!1}],2:["message","string",""],3:["file_name","string",""],4:["global_version","string",""],5:["version","string",""],6:["app_version","string",""],7:["json_data","bytes",[]],8:["hash","bytes",[]],9:["g_version","uint32",0]}},File:{$m:{1:["file_name","string",""],2:["hash","bytes",[]],3:["g_version","uint32",0]}},GetCloudSettingConfigRequest:{$m:{1:["product","cloudsetting.cloudsetting.Product",0],2:["response_compress","int32",0],3:["file_list","<string",null],4:["param_list","<cloudsetting.cloudsetting.Param",null],5:["files","<cloudsetting.cloudsetting.File",null],6:["p_version","uint32",0]}},GetCloudSettingConfigResponse:{$m:{1:["code","int64",{low:0,high:0,unsigned:!1}],2:["message","string",""],3:["polling_interval","int32",0],4:["file_response","<cloudsetting.cloudsetting.CloudSettingFileResponse",null]}},Param:{$m:{1:["key","string",""],2:["value","string",""]}},Product:{$e:{RTC:0,WEB_RTC:1,ZIM:2,ROOM_KIT:3,DOC_SHARE:4,WHITE_BOARD:5,SELF_CHECK:999,TEST_ANOOUS:1e3}}}}},"",r,!1),e.util.global.cloudsetting=r.cloudsetting,i.default=r.cloudsetting}],h={},e.m=u,e.c=h,e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:n})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"u",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.u)return t;var n=Object.create(null);if(e.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var s in t)e.d(n,s,function(i){return t[i]}.bind(null,s));return n},e.n=function(t){var i=t&&t.u?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},e.p="",e(e.s=8))},function(t,i,n){var e;t.exports=(e=n(2),function(){var t,i;"function"==typeof ArrayBuffer&&(t=e.lib.WordArray,i=t.init,(t.init=function(t){if((t=(t=t instanceof ArrayBuffer?new Uint8Array(t):t)instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array||t instanceof Float64Array?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t)instanceof Uint8Array){for(var n=t.byteLength,e=[],s=0;s<n;s++)e[s>>>2]|=t[s]<<24-s%4*8;i.call(this,e,n)}else i.apply(this,arguments)}).prototype=t)}(),e.lib.WordArray)},function(t,i){var n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,i){},function(t,i,n){var e;t.exports=(t=n(2),e=t.lib.WordArray,t.enc.Base64={stringify:function(t){for(var i=t.words,n=t.sigBytes,e=this._map,s=(t.clamp(),[]),r=0;r<n;r+=3)for(var o=(i[r>>>2]>>>24-r%4*8&255)<<16|(i[r+1>>>2]>>>24-(r+1)%4*8&255)<<8|i[r+2>>>2]>>>24-(r+2)%4*8&255,u=0;u<4&&r+.75*u<n;u++)s.push(e.charAt(o>>>6*(3-u)&63));var h=e.charAt(64);if(h)for(;s.length%4;)s.push(h);return s.join("")},parse:function(t){var i=t.length,n=this._map;if(!(s=this._reverseMap))for(var s=this._reverseMap=[],r=0;r<n.length;r++)s[n.charCodeAt(r)]=r;var o=n.charAt(64);return o&&-1!==(o=t.indexOf(o))&&(i=o),function(t,i,n){for(var s,r,o=[],u=0,h=0;h<i;h++)h%4&&(s=n[t.charCodeAt(h-1)]<<h%4*2,r=n[t.charCodeAt(h)]>>>6-h%4*2,o[u>>>2]|=(s|r)<<24-u%4*8,u++);return e.create(o,u)}(t,i,s)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},t.enc.Base64)},function(t,i,n){var e,s,r,o;t.exports=(t=n(2),o=(n=t).lib,e=o.WordArray,s=o.Hasher,o=n.algo,r=[],o=o.SHA1=s.extend({_doReset:function(){this._hash=new e.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(t,i){for(var n=this._hash.words,e=n[0],s=n[1],o=n[2],u=n[3],h=n[4],c=0;c<80;c++){c<16?r[c]=0|t[i+c]:(a=r[c-3]^r[c-8]^r[c-14]^r[c-16],r[c]=a<<1|a>>>31);var a=(e<<5|e>>>27)+h+r[c];a+=c<20?1518500249+(s&o|~s&u):c<40?1859775393+(s^o^u):c<60?(s&o|s&u|o&u)-1894007588:(s^o^u)-899497514,h=u,u=o,o=s<<30|s>>>2,s=e,e=a}n[0]=n[0]+e|0,n[1]=n[1]+s|0,n[2]=n[2]+o|0,n[3]=n[3]+u|0,n[4]=n[4]+h|0},_doFinalize:function(){var t=this._data,i=t.words,n=8*this._nDataBytes,e=8*t.sigBytes;return i[e>>>5]|=128<<24-e%32,i[14+(64+e>>>9<<4)]=Math.floor(n/4294967296),i[15+(64+e>>>9<<4)]=n,t.sigBytes=4*i.length,this._process(),this._hash},clone:function(){var t=s.clone.call(this);return t._hash=this._hash.clone(),t}}),n.SHA1=s._createHelper(o),n.HmacSHA1=s._createHmacHelper(o),t.SHA1)},function(t,i,n){var e;t.exports=(t=n(2),n=t.lib.Base,e=t.enc.Utf8,void(t.algo.HMAC=n.extend({init:function(t,i){t=this._hasher=new t.init,"string"==typeof i&&(i=e.parse(i));for(var n=t.blockSize,s=4*n,r=(t=((i=i.sigBytes>s?t.finalize(i):i).clamp(),this._oKey=i.clone()),i=this._iKey=i.clone(),t.words),o=i.words,u=0;u<n;u++)r[u]^=1549556828,o[u]^=909522486;t.sigBytes=i.sigBytes=s,this.reset()},reset:function(){var t=this._hasher;t.reset(),t.update(this._iKey)},update:function(t){return this._hasher.update(t),this},finalize:function(t){var i=this._hasher;t=i.finalize(t);return i.reset(),i.finalize(this._oKey.clone().concat(t))}})))},function(t,i,n){var e,s,r,o,u,h,c,a,f,l,_,d;t.exports=(t=n(2),n(9),void(t.lib.Cipher||(n=t.lib,e=n.Base,s=n.WordArray,r=n.BufferedBlockAlgorithm,(f=t.enc).Utf8,o=f.Base64,u=t.algo.EvpKDF,h=n.Cipher=r.extend({cfg:e.extend(),createEncryptor:function(t,i){return this.create(this._ENC_XFORM_MODE,t,i)},createDecryptor:function(t,i){return this.create(this._DEC_XFORM_MODE,t,i)},init:function(t,i,n){this.cfg=this.cfg.extend(n),this._xformMode=t,this._key=i,this.reset()},reset:function(){r.reset.call(this),this._doReset()},process:function(t){return this._append(t),this._process()},finalize:function(t){return t&&this._append(t),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function t(t){return"string"==typeof t?d:l}return function(i){return{encrypt:function(n,e,s){return t(e).encrypt(i,n,e,s)},decrypt:function(n,e,s){return t(e).decrypt(i,n,e,s)}}}}()}),n.StreamCipher=h.extend({_doFinalize:function(){return this._process(!0)},blockSize:1}),f=t.mode={},c=n.BlockCipherMode=e.extend({createEncryptor:function(t,i){return this.Encryptor.create(t,i)},createDecryptor:function(t,i){return this.Decryptor.create(t,i)},init:function(t,i){this._cipher=t,this._iv=i}}),f=f.CBC=function(){var t=c.extend();function i(t,i,n){var e,s=this._iv;s?(e=s,this._iv=void 0):e=this._prevBlock;for(var r=0;r<n;r++)t[i+r]^=e[r]}return t.Encryptor=t.extend({processBlock:function(t,n){var e=this._cipher,s=e.blockSize;i.call(this,t,n,s),e.encryptBlock(t,n),this._prevBlock=t.slice(n,n+s)}}),t.Decryptor=t.extend({processBlock:function(t,n){var e=this._cipher,s=e.blockSize,r=t.slice(n,n+s);e.decryptBlock(t,n),i.call(this,t,n,s),this._prevBlock=r}}),t}(),_=(t.pad={}).Pkcs7={pad:function(t,i){for(var n=(i=4*i)-t.sigBytes%i,e=n<<24|n<<16|n<<8|n,r=[],o=0;o<n;o+=4)r.push(e);i=s.create(r,n),t.concat(i)},unpad:function(t){var i=255&t.words[t.sigBytes-1>>>2];t.sigBytes-=i}},n.BlockCipher=h.extend({cfg:h.cfg.extend({mode:f,padding:_}),reset:function(){h.reset.call(this);var t,i=(n=this.cfg).iv,n=n.mode;this._xformMode==this._ENC_XFORM_MODE?t=n.createEncryptor:(t=n.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==t?this._mode.init(this,i&&i.words):(this._mode=t.call(n,this,i&&i.words),this._mode.__creator=t)},_doProcessBlock:function(t,i){this._mode.processBlock(t,i)},_doFinalize:function(){var t,i=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(i.pad(this._data,this.blockSize),t=this._process(!0)):(t=this._process(!0),i.unpad(t)),t},blockSize:4}),a=n.CipherParams=e.extend({init:function(t){this.mixIn(t)},toString:function(t){return(t||this.formatter).stringify(this)}}),f=(t.format={}).OpenSSL={stringify:function(t){var i=t.ciphertext;return(t=(t=t.salt)?s.create([1398893684,1701076831]).concat(t).concat(i):i).toString(o)},parse:function(t){var i,n=(t=o.parse(t)).words;return 1398893684==n[0]&&1701076831==n[1]&&(i=s.create(n.slice(2,4)),n.splice(0,4),t.sigBytes-=16),a.create({ciphertext:t,salt:i})}},l=n.SerializableCipher=e.extend({cfg:e.extend({format:f}),encrypt:function(t,i,n,e){e=this.cfg.extend(e);i=(s=t.createEncryptor(n,e)).finalize(i);var s=s.cfg;return a.create({ciphertext:i,key:n,iv:s.iv,algorithm:t,mode:s.mode,padding:s.padding,blockSize:t.blockSize,formatter:e.format})},decrypt:function(t,i,n,e){return e=this.cfg.extend(e),i=this._parse(i,e.format),t.createDecryptor(n,e).finalize(i.ciphertext)},_parse:function(t,i){return"string"==typeof t?i.parse(t,this):t}}),_=(t.kdf={}).OpenSSL={execute:function(t,i,n,e){return e=e||s.random(8),t=u.create({keySize:i+n}).compute(t,e),n=s.create(t.words.slice(i),4*n),t.sigBytes=4*i,a.create({key:t,iv:n,salt:e})}},d=n.PasswordBasedCipher=l.extend({cfg:l.cfg.extend({kdf:_}),encrypt:function(t,i,n,e){return n=(e=this.cfg.extend(e)).kdf.execute(n,t.keySize,t.ivSize),e.iv=n.iv,(t=l.encrypt.call(this,t,i,n.key,e)).mixIn(n),t},decrypt:function(t,i,n,e){return e=this.cfg.extend(e),i=this._parse(i,e.format),n=e.kdf.execute(n,t.keySize,t.ivSize,i.salt),e.iv=n.iv,l.decrypt.call(this,t,i,n.key,e)}}))))},function(t,i){t.exports=s},function(t,i,n){"use strict";n.r(i),n.d(i,"ZegoExpressWebRTMEngine",(function(){return _e})),n.d(i,"getReportSeq",(function(){return _})),n.d(i,"getSeq",(function(){return l})),n.d(i,"ZegoLogger",(function(){return s.ZegoLogger})),n.d(i,"ZegoDataReport",(function(){return s.ZegoDataReport})),n.d(i,"ZegoExpressWebRTM",(function(){return ee})),n.d(i,"BusinessService",(function(){return S})),n.d(i,"NetConnection",(function(){return w})),n.d(i,"ZReporter",(function(){return fe}));var e,s=n(4);(i=e=e||{})[i.SWITCH_ONE=1]="SWITCH_ONE",i[i.SWITCH_TWO=2]="SWITCH_TWO";var r,o,u,h,c,a,f,l=((i=r=r||{})[i.TT_NONE=0]="TT_NONE",i[i.TT_PC=1]="TT_PC",i[i.TT_IOS=2]="TT_IOS",i[i.TT_ANDROID=3]="TT_ANDROID",i[i.TT_MAC=4]="TT_MAC",i[i.TT_LINUX=5]="TT_LINUX",i[i.TT_WEB=6]="TT_WEB",i[i.TT_MINIPROGRAM=7]="TT_MINIPROGRAM",i[i.TT_UNKNOWN=32]="TT_UNKNOWN",(i=o=o||{})[i.logout=0]="logout",i[i.trylogin=1]="trylogin",i[i.login=2]="login",(i=u=u||{})[i.I=0]="I",i[i.H=10]="H",i[i.M=100]="M",i[i.L=1e3]="L",(i=h=h||{})[i.offline=0]="offline",i[i.online=1]="online",(i=c=c||{})[i.NT_NONE=0]="NT_NONE",i[i.NT_LINE=1]="NT_LINE",i[i.NT_WIFI=2]="NT_WIFI",i[i.NT_2G=3]="NT_2G",i[i.NT_3G=4]="NT_3G",i[i.NT_4G=5]="NT_4G",i[i.NT_UNKNOWN=32]="NT_UNKNOWN",function(){return a++}),_=(f=a=1,function(){return f++}),d=(Object.defineProperty(v.prototype,"id",{get:function(){return this._id||null},set:function(t){this._id=t},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t},enumerable:!1,configurable:!0}),v.prototype.hasNext=function(){return this.next&&this.next.id},v.prototype.hasPrev=function(){return this.prev&&this.prev.id},v);function v(t,i){void 0===t&&(t=null),void 0===i&&(i=null),this.next=null,this.prev=null,this._id=t,this._data=i}g.prototype.insertBefore=function(t,i){return(i=new d(this._idCounter,i)).next=t,i.prev=t.prev,t.prev&&(t.prev.next=i),t.prev=i,++this._idCounter,++this._numNodes,i},g.prototype.addLast=function(t){return this.insertBefore(this.end,t)},g.prototype.add=function(t){return this.addLast(t)},g.prototype.getFirst=function(){return 0===this._numNodes?null:this.start.next},g.prototype.getLast=function(){return 0===this._numNodes?null:this.end.prev},g.prototype.size=function(){return this._numNodes},g.prototype.getFromFirst=function(t){var i=0,n=this.start.next;if(0<=t)for(;i<t&&null!==n;)n=n.next,++i;else n=null;if(null===n)throw"Index out of bounds.";return n},g.prototype.get=function(t){return 0===t?this.getFirst():t===this._numNodes-1?this.getLast():this.getFromFirst(t)},g.prototype.remove=function(t){return t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),--this._numNodes,t},g.prototype.removeFirst=function(){var t=null;return 0<this._numNodes&&this.start.next?this.remove(this.start.next):t},g.prototype.removeLast=function(){var t=null;return 0<this._numNodes&&this.end.prev?this.remove(this.end.prev):t},g.prototype.removeAll=function(){this.start.next=this.end,this.end.prev=this.start,this._numNodes=0,this._idCounter=0},g.prototype.each=function(t){for(var i=this.start;i.hasNext();)t(i=i.next)},g.prototype.find=function(t){for(var i=this.start,n=!1,e=null;i.hasNext()&&!n;)t(i=i.next)&&(e=i,n=!0);return e},g.prototype.map=function(t){for(var i=this.start,n=[];i.hasNext();)t(i=i.next)&&n.push(i);return n},g.prototype.push=function(t){return this.addLast(t)},g.prototype.unshift=function(t){0<this._numNodes?this.insertBefore(this.start.next,t):this.insertBefore(this.end,t)},g.prototype.pop=function(){return this.removeLast()},g.prototype.shift=function(){return this.removeFirst()};var m=g;function g(){this.start=new d,this.end=new d,this._idCounter=0,this._numNodes=0,this.start.next=this.end,this.start.prev=null,this.end.prev=this.start,this.end.next=null}var p,b,E,y,S,O,R="未引入消息模块",T=n(11).ZegoConnectionAgent,w=(Object.defineProperty(N.prototype,"clientIP",{get:function(){var t;return(null==(t=this.connection)?void 0:t.clientIP)||""},enumerable:!1,configurable:!0}),Object.defineProperty(N.prototype,"timeOffset",{get:function(){var t;return null==(t=this.connection)?void 0:t.timeOffset},enumerable:!1,configurable:!0}),N.prototype.init=function(){var t;null!=(t=this.connection)&&t.init()},N.prototype.unInit=function(){var t;null!=(t=this.connection)&&t.unInit()},N.prototype.setAppInfo=function(t){var i;null!=(i=this.connection)&&i.setAppInfo(t)},N.prototype.setUserInfo=function(t){var i;null!=(i=this.connection)&&i.setUserInfo(t)},N.prototype.setNetAgentDefaultServers=function(t){var i;null!=(i=this.connection)&&i.setNetAgentDefaultServers(t)},N.prototype.setBackupDomains=function(t){var i;null!=(i=this.connection)&&i.setBackupDomains(t)},N.prototype.setDispatchConnectServers=function(t){var i;null!=(i=this.connection)&&i.setDispatchConnectServers(t)},N.prototype.setNetAgentSpecifiedServers=function(t){var i;null!=(i=this.connection)&&i.setNetAgentSpecifiedServers(t)},N.prototype.startHttpRequest=function(t,i,n,e,s){var r;null!=(r=this.connection)&&r.startHttpRequest(t,i,n,e,s)},N.prototype.startHttpRequest2=function(t,i,n,e,s){var r;null!=(r=this.connection)&&r.startHttpRequest2(t,i,n,e,s)},N.prototype.getAppConfigByAgent=function(t,i,n,e){var s;return null==(s=this.connection)?void 0:s.getAppConfigByAgent(t,i,n,e)},N.prototype.getPCRequest=function(t,i){var n;return(null==(n=this.connection)?void 0:n.getPCRequest(t,i))||null},N.prototype.connectUa=function(){var t;null!=(t=this.connection)&&t.connectUa()},N.prototype.destroyConnect=function(){var t;null!=(t=this.connection)&&t.destroyConnect()},N.prototype.destroy=function(){var t;null!=(t=this.connection)&&t.destroy()},N.prototype.isConnect=function(){return!!this.connection&&this.connection.isConnect()},N.prototype.on=function(t,i){var n;return(null==(n=this.connection)?void 0:n.on(t,i))||!0},N.prototype.off=function(t,i){var n;return null==(n=this.connection)?void 0:n.off(t,i)},N.prototype.setLogger=function(t){var i;return null==(i=this.connection)?void 0:i.setLogger(t)},N.prototype.setAccess=function(t){var i;return null==(i=this.connection)?void 0:i.setAccess(t)},N.prototype.getNTP=function(){var t;return(null==(t=this.connection)?void 0:t.getNetworkTimeInfo())||{timestamp:0,maxDeviation:0}},N);function N(){this.connection=null,this.isLoad=!1,this.callBackList=[],this.connection=new T(ee.proxyCtrl)}(i=p=p||{})[i.AUTO=0]="AUTO",i[i.MANUAL=1]="MANUAL",(i=b=b||{})[i.EMPTY=0]="EMPTY",i[i.CLOSE=1]="CLOSE",(i=E=E||{})[i.Mode_UNSET=0]="Mode_UNSET",i[i.MODE_ONLINE=1]="MODE_ONLINE",i[i.MODE_TEST=2]="MODE_TEST",i[i.MODE_ALPHA=3]="MODE_ALPHA",(i=y=y||{})[i.CLOSE=0]="CLOSE",i[i.TEMP=1]="TEMP",i[i.TIMEOUT=2]="TIMEOUT",(i=S=S||{})[i.SERVICE_UNSET=0]="SERVICE_UNSET",i[i.SERVICE_MEDIAGW=1]="SERVICE_MEDIAGW",i[i.SERVICE_LIVEROOM=2]="SERVICE_LIVEROOM",i[i.SERVICE_MIX=3]="SERVICE_MIX",i[i.SERVICE_ZEUS=4]="SERVICE_ZEUS",i[i.SERVICE_ZPUSH=5]="SERVICE_ZPUSH",i[i.SERVICE_L3=6]="SERVICE_L3",i[i.SERVICE_TALKLINE=7]="SERVICE_TALKLINE",i[i.SERVICE_EDUSUITE=8]="SERVICE_EDUSUITE",i[i.SERVICE_ZIM=9]="SERVICE_ZIM",i[i.SERVICE_ClOUD_SETTING=10]="SERVICE_ClOUD_SETTING",i[i.SERVICE_ZEUSHB=11]="SERVICE_ZEUSHB",i[i.SERVICE_USER_LOGIC=12]="SERVICE_USER_LOGIC",i[i.SERVICE_UNIFYDISPATCH=13]="SERVICE_UNIFYDISPATCH",i[i.SERVICE_QUALITY=14]="SERVICE_QUALITY",i[i.SERVICE_SECURITY=15]="SERVICE_SECURITY",i[i.SERVICE_KTVCPR=16]="SERVICE_KTVCPR",i[i.SERVICE_SWITCH4LIVEROOM=17]="SERVICE_SWITCH4LIVEROOM",i[i.SERVICE_WEBRTC_SIGNAL=18]="SERVICE_WEBRTC_SIGNAL",i[i.SERVICE_L3_WEBRTC_SIGNAL=19]="SERVICE_L3_WEBRTC_SIGNAL",i[i.SERVICE_VIDEOCPR=20]="SERVICE_VIDEOCPR",i[i.SERVICE_CDN=21]="SERVICE_CDN",i[i.SERVICE_CLOUDRECORD=22]="SERVICE_CLOUDRECORD",i[i.SERVICE_INNER_ECHO=23]="SERVICE_INNER_ECHO",i[i.SERVICE_OUTER_ECHO=24]="SERVICE_OUTER_ECHO",i[i.SERVICE_LOCALHOST_ECHO=25]="SERVICE_LOCALHOST_ECHO",i[i.SERVICE_ECHO=26]="SERVICE_ECHO",i[i.SERVICE_DOCSERVICE=27]="SERVICE_DOCSERVICE",i[i.SERVICE_AUTHSVR=28]="SERVICE_AUTHSVR",(i=O=O||{}).Logining="LOGINING",i.Logined="LOGINED",i.LoginFailed="LOGIN_FAILED",i.Reconnecting="RECONNECTING",i.Reconnected="RECONNECTED",i.ReconnectFailed="RECONNECT_FAILED",i.Kickout="KICKOUT",i.Logout="LOGOUT",i.LogoutFailed="LOGOUT_FAILED";var I={SERVER:{code:0,msg:"liverooom cmd error"},SUCCESS:{code:0,msg:"success."},INIT:{code:2000000001,msg:"init sdk wrong"},NOT_LOGIN:{code:1000002,msg:"not login"},APPID_INVALID:{code:1001004,msg:"appid invalid"},NETWORK_BROKEN:{code:1000017,msg:"network is broken"},GEO_SET_ERROR:{code:1000018,msg:"geo set error"},INPUT_PARAM:{code:1100001,msg:"input parm error."},TIMEOUT:{code:1100002,msg:"network timeout."},SOCKET_CLOSE:{code:1100003,msg:"socket close"},NET_SOCKET_TIMEOUT:{code:1100004,msg:"net agent timeout"},NET_HB_TIMEOUT:{code:1100005,msg:"net hb timeout"},INIT_SDK_WRONG:{code:1101e3,msg:"init sdk wrong"},ROOM_COUNT_EXCEED:{code:1002001,msg:"login rooms exceeds the upper limit"},USER_ID_NULL:{code:1002005,msg:"user ID is empty"},USER_ID_INVALID_CHARACTER:{code:1002006,msg:"user ID contains illegal characters"},USER_ID_TOO_LONG:{code:1002007,msg:"user ID is too long"},USER_NAME_NULL:{code:1002008,msg:"username is empty"},USER_NAME_TOO_LONG:{code:1002010,msg:"username is too long"},ROOM_ID_NULL:{code:1002011,msg:"room ID is empty"},ROOM_ID_INVALID_CHARACTER:{code:1002012,msg:"room ID contains illegal characters"},ROOM_ID_TOO_LONG:{code:1002013,msg:"room ID is too long"},ROOM_NOT_EXIST:{code:1002014,msg:"room not exist"},ROOM_EXTRA_INFO_KEY_LIMIT:{code:1002017,msg:"room extra info key exceed the limit"},LOGIN_TIMEOUT:{code:1002031,msg:"login timeout"},ROOM_MAX_USER_COUNT:{code:1002034,msg:"users logging into the room exceeds the maximum number"},MULTI_ROOM_UNABLE:{code:1002036,msg:"multi room unable"},MULTIPLE_LOGIN_KICKOUT:{code:1002050,msg:"kickout may be the same user ID login other"},NETWORK_RECOVERY:{code:1002051,msg:"network recovery"},ROOM_RETRY_TIMEOUT:{code:1002053,msg:"network is broken and login fail."},MANUAL_KICKOUT:{code:1002055,msg:"server has sent a signal to kick out"},REPEATEDLY_LOGIN:{code:1002056,msg:"user repeatedly login"},REPEATEDLY_ENTER_ROOM:{code:1002057,msg:"user repeatedly enter room"},ALREADY_LOGIN:{code:1002058,msg:"user already logged in"},FORBID_BLACK_USER:{code:1002066,msg:"forbid black user"},WHITE_BOARD_VERSION_ERROR:{code:1002098,msg:"Mismatch with RTC SDK version, please upgrade ZegoSuperBoard or ZegoWhiteboardView SDK to the latest version"},ROOM_INNER_ERROR:{code:1002099,msg:"room inner error"},HEARTBEAT_TIMEOUT:{code:1102001,msg:"heartbeat timeout."},PARSE_JSON_ERROR:{code:1102011,msg:"parse json error."},LOGIN_PROCESSING:{code:1102012,msg:"login is processing."},LIVEROMM_REQUEST_ERROR:{code:1102013,msg:"liveroom request error."},ZPUSH_REQUEST_FAIL:{code:1102014,msg:"zpush request fail."},LOGIN_STATE_WRONG:{code:1102015,msg:"user login state is wrong."},TOKEN_ERROR:{code:1102016,msg:"token error"},DIAPATCH_ERROR:{code:1102017,msg:"dispatch error"},TOKEN_EXPIRED:{code:1102018,msg:"token expired"},SUBCMD_ERROR:{code:1102019,msg:"subcmd error."},ZEGO_AUTH_ERROR:{code:1102020,msg:"zego auth error."},BIZ_CHANNEL_ERROR:{code:1102021,msg:"biz channel error."},UPLOAD_LOG_ERROR:{code:1102025,msg:"upload zip logs failed"}},C=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1],k=(i=n(6),n.n(i)),A=(i=n(7),n.n(i));function D(){var t=window.navigator.userAgent,i=null!=window.ActiveXObject&&-1!=t.indexOf("MSIE"),n=-1!=t.indexOf("Firefox"),e=null!=window.opr,s=t.indexOf("Chrome")&&window.chrome;t=-1!=t.indexOf("Safari")&&-1!=t.indexOf("Version");return i?"IE":n?"Firefox":e?"Opera":s?"Chrome":t?"Safari":"Unkown"}function P(){var t=navigator.connection||navigator.mozConnection||navigator.webkitConnection;return((null==t?void 0:t.effectiveType)||(null==t?void 0:t.type)||"unknwon").toUpperCase()}function M(t,i){return k.a.encrypt(t,i).toString()}function U(t,i){try{return k.a.decrypt(t,i).toString(A.a)}catch(t){return""}}function j(t,i){try{localStorage.setItem(t,i)}catch(t){}}function z(t){try{return localStorage.getItem(t)}catch(t){}}var L=n(0),x=function(){return(x=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var s in i=arguments[n])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t}).apply(this,arguments)};function H(t,i){return 0==i?Object(L.d)(t)&&t%1==0&&0<=t:Object(L.d)(t)&&t%1==0&&0<t}function G(t,i,n){var e;i.success&&(e=i.success,n[t+"SuccessCallback"]=e),i.error&&(e=i.error,n[t+"ErrorCallback"]=e)}function q(t,i){return i[t+"ErrorCallback"]}function B(t,i){return i[t+"SuccessCallback"]}function $(t,i,n,e){G(t,{success:function(t,e){for(var s=[],r=2;r<arguments.length;r++)s[r-2]=arguments[r];var o=i,u=n,h=e,c=s;switch(t){case"eventStart":o.eventStart(u,h);break;case"eventEndWithMsgInfo":o.eventEndWithMsgInfo(u,h,c[0]);break;case"addEventMsg":o.addEventMsg(u,h,c[0],c[1]);break;case"addEvent":o.addEvent(u,h);break;case"eventEnd":o.eventEnd(u,h);break;case"addMsgInfo":o.addMsgInfo(u,c[0])}}},e)}function V(t,i,n,e){return{interResolve:function(e){t.uploadReport(i),n(e)},interReject:function(n,s){var r;void 0===s&&(s=""),(r=n.code<2e9&&1e9<n.code?F(n.code,n.msg):{code:n.code,message:n.msg})&&t.addMsgInfo(i,{error:r.code,message:r.message+s}),t.uploadReport(i),e({errorCode:n.code||n.errorCode})}}}function J(t){var i,n,e={1:"parse json error.",1001:"login is processing.",1002:"liveroom request error.",1003:"zpush connect fail.",1004:"zpush handshake fail.",1005:"zpush login fail.",1006:"user login state is wrong.",1007:"got no zpush addr",1008:"token error",1009:"dispatch error",1010:"token expired",1011:"token format error",2002:"biz channel error",1e9:"liveroom cmd error, code:",1000002001:"need relogin",1000002002:"third token auth error",1000002003:"token nonce type should be int64",1000002004:"token appid type  should be uint32",1000002005:"token timeout type should be int64",1000002006:"token user_id type should be string",1000002007:"token room_id type should be string",1000002008:"token format error",1000002009:"token privilege type should be map",1000002010:"token expire_time type should be int64",1000002011:"token user_id type should be string",1000002012:"token not exist",1000002013:"token update error",1000002014:"token not need to check"};return 0===t?I.SUCCESS:((i=x({},I.ROOM_INNER_ERROR)).code=t,i.msg=1e9<t?(n=e[t])?"liveroom cmd error, code: "+t+", message: "+n:e[1e9]+t:e[t]?e[t]+" code:"+t:"unknown error code:"+t,i)}function Y(t,i){delete i[t+"SuccessCallback"],delete i[t+"ErrorCallback"]}function F(t,i){var n={code:-1,message:"server error"};return n.code=1e9<t?t-1e9+52e6:t+2002e6,i&&(n.message=i),n}function K(t,i){var n={1016:"MULTI_ROOM_UNABLE",1105:"ROOM_MAX_USER_COUNT",1012:"PUBLISHER_ERROR_REPETITIVE_PUBLISH_STREAM",2002:"TOKEN_ERROR",2003:"ROOM_ERROR_LOGIN_TIMEOUT",2010:"TOKEN_ERROR",5022:"ROOM_COUNT_EXCEED",5030:"FORBID_BLACK_USER"};return i?2e5<t&&t<3e5?n[t-2e5]:t<2e5?{50013:"MULTIPLE_LOGIN_KICKOUT",50116:"TOKEN_ERROR",50117:"TOKEN_EXPIRED",50118:"TOKEN_ERROR",50119:"TOKEN_ERROR",50120:"TOKEN_ERROR",50121:"TOKEN_ERROR",50122:"TOKEN_ERROR",50123:"TOKEN_EXPIRED",50124:"TOKEN_ERROR",50125:"TOKEN_ERROR",50126:"TOKEN_ERROR",50127:"TOKEN_ERROR",50128:"TOKEN_ERROR"}[t]||n[t]||"ROOM_INNER_ERROR":n[t]||"ROOM_INNER_ERROR":1e9<t?n[t-1e9]||"":{1:"PARSE_JSON_ERROR",1001:"LOGIN_PROCESSING",1002:"LIVEROMM_REQUEST_ERROR",1003:"ZPUSH_REQUEST_FAIL",1004:"ZPUSH_REQUEST_FAIL",1005:"ZPUSH_REQUEST_FAIL",1006:"LOGIN_STATE_WRONG",1007:"ZPUSH_REQUEST_FAIL",1008:"TOKEN_ERROR",1009:"DIAPATCH_ERROR",1010:"TOKEN_EXPIRED",1011:"TOKEN_ERROR",1012:"SUBCMD_ERROR",1101:"ZEGO_AUTH_ERROR",2001:"BIZ_CHANNEL_ERROR",2002:"BIZ_CHANNEL_ERROR"}[t]||"ROOM_INNER_ERROR"}function W(t){return parseInt(Math.random()*(t+1)+"",10)}function Z(t){return!(!t.startsWith("wss")||-1===t.indexOf("test")||!t.endsWith("ws"))}function X(t){try{var i,n=Uint8Array.from(function(t){for(var i,n,e,s,r=t.length,o=0,u="";o<r;){for(;i=C[255&t.charCodeAt(o++)],o<r&&-1==i;);if(-1==i)break;for(;n=C[255&t.charCodeAt(o++)],o<r&&-1==n;);if(-1==n)break;u+=String.fromCharCode(i<<2|(48&n)>>4);do{if(61==(e=255&t.charCodeAt(o++)))return u}while(e=C[e],o<r&&-1==e);if(-1==e)break;u+=String.fromCharCode((15&n)<<4|(60&e)>>2);do{if(61==(s=255&t.charCodeAt(o++)))return u}while(s=C[s],o<r&&-1==s);if(-1==s)break;u+=String.fromCharCode((3&e)<<6|s)}return u}(t),(function(t){return t.charCodeAt(0)})),e=new DataView(n.buffer);return 0<(i=Object(L.c)(e.getBigInt64)?e.getBigUint64(0):(s=0,r=!1,u=(o=e).getUint32(s,r),o=o.getUint32(s+4,r),s=Math.pow(2,32)*u+o,Number.isSafeInteger(s)||console.warn(s,"exceeds MAX_SAFE_INTEGER. Precision may be lost"),s))?Number(i):Number(e.getBigUint64(0,!0))}catch(t){console.error("token error")}var s,r,o,u;return-1}function Q(t){var i=(new Date).getTime(),n="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=(i+16*Math.random())%16|0;return i=Math.floor(i/16),("x"==t?n:3&n|8).toString(36)}));return 0===t?function(t){for(var i,n=document.createElement("canvas"),e=((e=n.getContext("2d")).textBaseline="top",e.font="14px 'Arial'",e.fillStyle="#f60",e.fillRect(125,1,62,20),e.fillStyle="#069",e.fillText(t,2,15),e.fillStyle="rgba(102, 204, 0, 0.7)",e.fillText(t,4,17),n.toDataURL().replace("data:image/png;base64,","")),s=atob(e).slice(-16,-12),r="",o=0,u=(s+="").length;o<u;o++)r+=(i=s.charCodeAt(o).toString(16)).length<2?"0"+i:i;return r}("hello, zego")+n.slice(8):n}var tt={product:"rtc_web",importLevel:u.H,levels:[0,10,100,1e3],bps:32e3},it="init",nt="0c9e6e0f8c0a8f4e",et="z_net_access_servers",st="z_appconfig",rt="z_appconfig_etag",ot={domains:["accesshub-wss.zego.im","accesshub-wss.coolzcloud.com","accesshub-wss.zegocloud.com"],primaryDomains:["zego.im","coolzcloud.com","zegocloud.com"],mode:"online",modeNo:E.MODE_ONLINE,sdkType:3,connectVer:4,pcEstablishTimeout:15,scheme:"wss",location:"accesshub",wssMessageType:1},ut=[{id:2,relative_geofencings:[],accesshub:"accesshub-wss-geo-2.zego.im",logreport:"weblogger-wss-geo-2.zego.im",detaillog:"detaillog-geo-2.zego.im"},{id:3,relative_geofencings:[7],accesshub:"accesshub-wss-geo-3.zego.im",logreport:"weblogger-wss-geo-3.zego.im",detaillog:"detaillog-geo-3.zego.im"},{id:4,relative_geofencings:[7],accesshub:"accesshub-wss-geo-4.zego.im",logreport:"weblogger-wss-geo-4.zego.im",detaillog:"detaillog-geo-4.zego.im"},{id:5,relative_geofencings:[7],accesshub:"accesshub-wss-geo-5.zego.im",logreport:"weblogger-wss-geo-5.zego.im",detaillog:"detaillog-geo-5.zego.im"},{id:6,relative_geofencings:[7],accesshub:"accesshub-wss-geo-6.zego.im",logreport:"weblogger-wss-geo-6.zego.im",detaillog:"detaillog-geo-6.zego.im"},{id:7,relative_geofencings:[3,4,5,6,1],accesshub:"accesshub-wss-geo-7.zego.im",logreport:"weblogger-wss-geo-7.zego.im",detaillog:"detaillog-geo-7.zego.im"}],ht=[2,3,4,5,6];function ct(t,i){this.$t=t,this.Zt=i,this.RETRY_MAX_TIME=300,this.RETRY_START_TIME_INTERVAL=4,this.RETRY_CONTINUE_COUNT=2,this.RETRY_MAX_TIME_INTERVAL=32,this.retryTimer=null,this.maxTimer=null,this._retryStartTime=0,this.retryActiveCount=1,this.isOverTime=!1}function at(t){return t}function ft(t){return t}function lt(t){return t}function _t(t){return t}ct.prototype.init=function(t,i,n,e){this.invalid(),this.stopMaxTime(),this.isOverTime=!1,Object(L.d)(t)&&t<3600&&(this.RETRY_MAX_TIME=t),Object(L.d)(i)&&(this.RETRY_START_TIME_INTERVAL=i),Object(L.d)(n)&&(this.RETRY_CONTINUE_COUNT=n),Object(L.d)(e)&&(this.RETRY_MAX_TIME_INTERVAL=e)},ct.prototype.invalid=function(){this.$t.info("zm.rh.ivd end retry"),this.retryTimer&&clearTimeout(this.retryTimer),this.retryTimer=null,this._retryStartTime=0,this.retryActiveCount=1};var dt="zm.0",vt="zm.slf",mt="zm.lg",gt="zm.lo",pt="zm.fac",bt="zm.fac.tk",Et="zm.hlu",yt="zm.cna",St="zm.gsac",Ot="zm.zpl.url",Rt="zm.on",Tt="zm.rntk",wt="zm.rm.lg",Nt="zm.rm.tl",It="zm.rm.lgr",Ct="zm.rm.clh",kt="zm.rm.lo",At="zm.rm.dcn",Dt="zm.rm.kco",Pt="zm.hhl",Mt="zm.hb.st",Ut="zm.hb.rsp",jt="zm.us.urp",zt="zm.us.uph",Lt="ON_LISTENER",xt="zm.st.ofls",Ht="zm.lrh.sm",Gt="zm.lrh.hsp",qt="zm.lrh.lgi",Bt="zm.lrh.ful",$t="zm.lrh.lgo",Vt="zm.lrh.sru",Jt="zm.lrh.hd",Yt={event:"/sdk/init",error:{kInvalidParamError:I.INPUT_PARAM},system_info:ft,servers:function(t){return t},is_from_cache:_t,project:ft,liveroom_version:ft,biz_type:lt,lua_md5:ft,sev_env:ft,use_na:lt},Ft="listener",Kt="/sdk/set_debug",Wt=ft,Zt={event:"/sdk/set_log_config",error:{kInvalidParamError:I.INPUT_PARAM},log_level:function(t){return t},remote_log_level:ft,log_url:ft},Xt={event:"/sdk/on_listener",listener:ft,error:{INPUT_PARAM:I.INPUT_PARAM}},Qt=ft,ti=(I.INPUT_PARAM,{event:"/sdk/login",room_id:ft,room_sid_string:ft,user_state_update:lt,max_member_cnt:lt,message:ft,token:ft,svr_env:ft,server:ft,try_cnt:lt,room_mode:lt,role:lt,audience_create_room:lt,liveroom_sid_string:ft,error:{ROOM_ID_NULL:I.ROOM_ID_NULL,INPUT_PARAM:I.INPUT_PARAM,ROOM_ID_TOO_LONG:I.ROOM_ID_TOO_LONG,ROOM_ID_INVALID_CHARACTER:I.ROOM_ID_INVALID_CHARACTER,USER_ID_NULL:I.USER_ID_NULL,USER_ID_TOO_LONG:I.USER_ID_TOO_LONG,USER_ID_INVALID_CHARACTER:I.USER_ID_INVALID_CHARACTER,USER_NAME_NULL:I.USER_NAME_NULL,USER_NAME_TOO_LONG:I.USER_NAME_TOO_LONG,REPEATEDLY_LOGIN:I.REPEATEDLY_LOGIN,LOGIN_TIMEOUT:I.LOGIN_TIMEOUT,INNER_ERROR:I.ROOM_INNER_ERROR,NETWORK_BROKEN:I.NETWORK_BROKEN}}),ii="/sdk/sublogin",ni=ft,ei={event:"/zpush/login",sdk_zpush_sessionid_string:ft},si={event:"/liveroom/enter"},ri={event:"/sdk/renew_token",error:{INPUT_PARAM:I.INPUT_PARAM,NOT_LOGIN:I.NOT_LOGIN},token:ft},oi={event:"/sdk/logout",error:{INPUT_PARAM:I.INPUT_PARAM,ROOM_NOT_EXIST:I.ROOM_NOT_EXIST},room_id:ft,room_sid_string:ft,is_multi:_t,is_send_cmd_net:_t,liveroom_sid_string:ft},ui=(I.INPUT_PARAM,I.ROOM_NOT_EXIST,"/liveroom/quit"),hi=(I.INPUT_PARAM,I.ROOM_NOT_EXIST,ft),ci=ft,ai=(I.INPUT_PARAM,I.ROOM_NOT_EXIST,"/sdk/relogin"),fi=(I.ROOM_ID_NULL,I.NETWORK_BROKEN,{event:"/liveroom/tempbroken"}),li={event:"/sdk/reconnect",room_broken_time:lt},_i={event:"/sdk/disconnect"},di=lt,vi=lt,mi={event:"/liveroom/hb",room_id:ft,room_sid_string:ft,interval:lt,stream_seq:lt,server_user_seq:lt,error:{NOT_LOGIN:I.NOT_LOGIN,HB_TIMEOUT:I.TIMEOUT}},gi=(I.ROOM_NOT_EXIST,"/sdk/listener"),pi={event:"/sdk/enable_multi_room",is_multi:_t,error:{kInvalidParamError:I.INPUT_PARAM,kAlreadyLoginError:I.ALREADY_LOGIN}},bi=at,Ei=at,yi=at,Si="/cloud_setting/request",Oi=at,Ri=at,Ti={event:"/liveroom/get_current_user_list",user_index:lt,is_time_ascend:_t,use_na:lt},wi="/zegoconn/connect",Ni=ft,Ii=lt,Ci=at,ki=ft,Ai=ft,Di=lt,Pi="/zegoconn/request",Mi=at,Ui=at,ji=lt,zi={event:"/zegoconn/proxy_connect",service_no:lt,proxy_link_sources:lt,recv_time:lt,connect_stream:lt},Li={event:"/zegoconn/proxy_broken",service_no:lt},xi={event:"/zegoconn/proxy_disconnect",service_no:lt};Hi=function(t,i){return(Hi=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}))(t,i)},function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=t}Hi(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}($i,Gi=ct),Object.defineProperty($i.prototype,"Qt",{get:function(){return this.Zt.reporter},enumerable:!1,configurable:!0}),$i.prototype.renewLocalToken=function(t,i){this.token=t,this._room.token=this.token;var n=(new Date).getTime(),e=void 0;i&&Object(L.d)(i)?e=1e3*i:Object(L.f)(t)&&["03","04"].includes(t.substring(0,2))&&(i=1e3*X(t.substring(2)),this.$t.info("zm.rm.rlt time "+i+" "+n+" "+this.Zt.local_time_deviation),e=i-(n-this.Zt.local_time_deviation)),e&&this.roomHandler.resetTokenTimer(e),this.$t.setTokenInfo(t),this.Zt.actionListener("_tokenRenewed",t,this._room.roomID)},$i.prototype.initRoom=function(t,i,n,e,s,r,o){this.roomHandler=t,this.roomID=i,this.renewLocalToken(n),this.user=e,this.server=s,this.serverBak=r||s,this.config=o},$i.prototype.active=function(t){var i=this,n=(this.$t.info(wt+" retry call "+(null==(n=this._room)?void 0:n.roomID)+" "+(t=void 0!==t&&t)),null!=(n=this.loginRoomCallback)&&n.success?ii:ai);if(this.subLoginSpan||(this.subLoginSpan=this.Qt.createSpan(u.H,{key:ti.event,par:this.roomID},{key:n,par:this.roomID},n,!0),this.spanKey=n),this.roomHandler.setRunState(o.trylogin),this._room.isMulti&&(null==(n=this.Zt.roomModulesList.find((function(t){return!t.isMulti})))?void 0:n.runState)!==o.login)this.$t.info(wt+" service is disconnected, multi room stop retry");else if(this.retryTimer)this.$t.info(wt+" has actived, ignore");else{var e=this.Zt.networkState==h.offline;if(e){if(this.$t.info(wt+" check if really offline. "+this._retryNetCount),this._retryNetCount>=this._retryNetMaxTimes)return void this.$t.warn(wt+" network is broken, stop retry")}else this._retryNetCount=0;this.isOverTime?this.$t.info(wt+" retry over time, stop retry"):(1==this.retryActiveCount?this.retryActiveInterval=Math.floor(Math.random()*(1-this.RETRY_START_TIME_INTERVAL)+this.RETRY_START_TIME_INTERVAL):(n=Math.pow(2,Math.round(this.retryActiveCount/this.RETRY_CONTINUE_COUNT+1)),this.retryActiveInterval=n>this.RETRY_MAX_TIME_INTERVAL?this.RETRY_MAX_TIME_INTERVAL:n),this.$t.info(wt+" interval "+this.retryActiveInterval),this.retryTimer=setTimeout((function(){i.roomHandler.login(i.retryActiveCount%2==1?i.server:i.serverBak,i.roomID,i.token,i.user,i.config,(function(t){i.Zt.networkState=h.online,i.handleLoginFinish(t)}),(function(t,n){i.handleLoginFinish(!1,t,n)})),i.retryTimer&&clearTimeout(i.retryTimer),i.retryTimer=null,e?i._retryNetCount++:i.retryActiveCount++}),t?0:1e3*this.retryActiveInterval))}},$i.prototype.startMaxTime=function(){var t=this;this.maxTimer||(this.$t.info(wt+" start max timer"),this.maxTimer=setTimeout((function(){t.$t.info(wt+" over max time ".concat(t.RETRY_MAX_TIME,"s, stop retry")),t.isOverTime=!0,t.roomHandler.resetRoom(),t.stopMaxTime(),t.invalid(),t.onactive(!1,I.LOGIN_TIMEOUT),t.subLoginSpan&&(t.Qt.spanEnd({key:t.spanKey,par:t.roomID},{error:I.LOGIN_TIMEOUT.code,message:I.LOGIN_TIMEOUT.msg}),t.subLoginSpan=null),t.loginRoomCallback.fail&&(t.loginRoomCallback.fail(I.LOGIN_TIMEOUT),t.roomHandler.disconnectedHandle(I.LOGIN_TIMEOUT),t.resetCallBack())}),1e3*this.RETRY_MAX_TIME))},$i.prototype.stopMaxTime=function(){this.$t.info(wt+" stop max timer"),this.maxTimer&&clearTimeout(this.maxTimer),this.maxTimer=null},$i.prototype.onactive=function(t,i){},$i.prototype.handleError=function(t,i){if(this.RETRY_MAX_TIME<3)return!1;if(i){i=void 0;var n=void 0,e=void 0,s=(this.Zt.useNetAgent&&(i=["202002","205030","205035","50116","50117","50118","50119","50120","50121","50122","50123","50124","50125","50126","50127","50128","50013"],n=["40001","40100"],e=["201002","30019"]),t.code+"");if(this.Zt.useNetAgent){if(10015===t.code)return this._room.retryConnect(),!0;if(40001<=t.code&&t.code<=40100||50200<=t.code&&t.code<=50299||null!=e&&e.includes(s))return this._room.resetSessionInfo(),!0}return!(null!=i&&i.includes(s)||(null==n||!n.includes(s))&&(this._room.lastRunState!=o.login||(this.$t.warn("zm.rrh.he reset"),this._room.resetUserSession(),this.invalid(),0)))}return!0},$i.prototype.setLoginRoomCallback=function(t,i){this.loginRoomCallback.success=t,this.loginRoomCallback.fail=i},$i.prototype.loginFail=function(t){this.roomHandler.resetRoom(),this.stopMaxTime(),this.invalid(),this.onactive(!1,t),this.loginRoomCallback.fail&&(this.loginRoomCallback.fail(t),this.roomHandler.disconnectedHandle(t),this.resetCallBack())},$i.prototype.handleLoginFinish=function(t,i,n){this.$t.info("zm.rrh.hlf "+t+" "+JSON.stringify(i)),i?(this.subLoginSpan&&(this.Qt.spanEnd({key:this.spanKey,par:this.roomID},{error:i.code,message:i.msg}),this.subLoginSpan=null),this.handleError(i,n)?(this.maxTimer||this.startMaxTime(),this.active()):(this.roomHandler.resetRoom(),this.stopMaxTime(),this.invalid(),this.onactive(t,i),this.loginRoomCallback.fail&&(this.loginRoomCallback.fail(i),this.roomHandler.disconnectedHandle(i),this.resetCallBack()))):(this.stopMaxTime(),this.invalid(),this.onactive(t,{code:0,msg:""}),this.subLoginSpan&&(this.Qt.spanEnd({key:this.spanKey,par:this.roomID},{room_id:this.roomID,room_sid_string:null==(n=this._room)?void 0:n.roomSidString}),this.subLoginSpan=null),this.loginRoomCallback.success&&(this.loginRoomCallback.success(t),this.resetCallBack()))},$i.prototype.invalid=function(){this.$t.info("zm.rh.ivd end retry"),this.retryTimer&&clearTimeout(this.retryTimer),this.retryTimer=null,this.retryActiveCount=1,this._retryNetCount=0},$i.prototype.resetCallBack=function(){this.loginRoomCallback.success=void 0,this.loginRoomCallback.fail=void 0};var Hi,Gi,qi,Bi=$i;function $i(t,i,n){var e=Gi.call(this,t,i)||this;return e.$t=t,e.Zt=i,e._room=n,e._retryNetCount=0,e._retryNetMaxTimes=3,e.spanKey="",e.loginRoomCallback={},e}(i=qi=qi||{}).NOT_EMPTY="NOT_EMPTY",i.ILLEGAL_CHARACTERS="ILLEGAL_CHARACTERS",i.TYPE_STRING="TYPE_STRING",i.TYPE_INTEGER="TYPE_INTEGER",i.TYPE_OBJECT="TYPE_OBJECT",i.MAX_LENGTH_10="MAX_LENGTH_10",i.MAX_LENGTH_64="MAX_LENGTH_64",i.MAX_LENGTH_100="MAX_LENGTH_100",i.MAX_LENGTH_128="MAX_LENGTH_128",i.MAX_LENGTH_256="MAX_LENGTH_256",i.MAX_LENGTH_1024="MAX_LENGTH_1024";var Vi={error:{code:0,msg:"suc"}},Ji={NOT_EMPTY:function(t,i,n,e,s){return void 0===i||""===i||null===i?(e.error("".concat(n," ").concat(t," is empty")),s):Vi},ILLEGAL_CHARACTERS:function(t,i,n,e,s){return/^([0-9a-zA-Z#!$%&()`'+-;<=.>@^_~,\\*])+$/.test(i)&&/^[^:/]*$/g.test(i)?Vi:(e.error("".concat(n," ").concat(t," contains illegal characters")),s)},TYPE_STRING:function(t,i,n,e,s){return Object(L.f)(i)?Vi:(e.error("".concat(n," ").concat(t," must be string")),s)},TYPE_INTEGER:function(t,i,n,e,s){return H(i,!1)?Vi:(e.error("".concat(n," ").concat(t,"  must be integer number")),s)},TYPE_OBJECT:function(t,i,n,e,s){return i&&Object(L.e)(i)?Vi:(e.error("".concat(n," ").concat(t,"  must be object")),s)},MAX_LENGTH_10:function(t,i,n,e,s){return 10<i.length?(e.error("".concat(n," ").concat(t," is too long")),s):Vi},MAX_LENGTH_64:function(t,i,n,e,s){return 64<i.length?(e.error("".concat(n," ").concat(t," is too long")),s):Vi},MAX_LENGTH_100:function(t,i,n,e,s){return 100<i.length?(e.error("".concat(n," ").concat(t," is too long")),s):Vi},MAX_LENGTH_128:function(t,i,n,e,s){return 128<i.length?(e.error("".concat(n," ").concat(t," is too long")),s):Vi},MAX_LENGTH_256:function(t,i,n,e,s){return 256<i.length?(e.error("".concat(n," ").concat(t," is too long")),s):Vi},MAX_LENGTH_1024:function(t,i,n,e,s){return 1024<i.length?(e.error("".concat(n," ").concat(t," is too long")),s):Vi}};Object.defineProperty(Fi.prototype,"debug",{get:function(){return this._debug},set:function(t){this._debug=t,s.LoggerStateCenter.getInstance().debug=t},enumerable:!1,configurable:!0}),Object.defineProperty(Fi.prototype,"testEnvironment",{get:function(){return this._testEnvironment},set:function(t){this._testEnvironment=t,s.LoggerStateCenter.getInstance().testEnvironment=t},enumerable:!1,configurable:!0}),Object.defineProperty(Fi.prototype,"ENV",{get:function(){return this._env},set:function(t){this._env=t,s.LoggerStateCenter.getInstance().ENV=t},enumerable:!1,configurable:!0}),Object.defineProperty(Fi.prototype,"roomid",{get:function(){return this.roomModulesList[0]?this.roomModulesList[0].roomID:""},enumerable:!1,configurable:!0}),Object.defineProperty(Fi.prototype,"serverTimeOffset",{get:function(){return this.roomModulesList[0]?this.roomModulesList[0].messageHandler.serverTimeOffset:0},enumerable:!1,configurable:!0}),Fi.prototype.getRequestId=function(){return this.idName+"-"+l()},Fi.prototype.actionListener=function(t){for(var i,n=this,e=[],s=1;s<arguments.length;s++)e[s-1]=arguments[s];["getAnchorInfo","HBResponse","roomOnlineUserCountUpdate","roomLoginResponse"].includes(t)||t.startsWith("_")||!this.listenerList[t]||((i=this.reporter.createSpan(u.H,{key:Ft},{key:""},gi)).setAttributes({listener:t,listener_params:JSON.stringify(e)}),i.end()),["roomStateChanged","tokenWillExpire"].includes(t)&&this.$t.info("zm.al ".concat(t," ").concat(JSON.stringify(e),". pageID: ").concat(ee.pageID," , instID: ").concat(this.id)),this.listenerList[t]&&this.listenerList[t].forEach((function(i){try{i.apply(void 0,e)}catch(i){n.$t.error("zm.st.at ",t," ",JSON.stringify(i))}}))},Fi.prototype.onListener=function(t,i){return this.listenerList[t]?Object(L.c)(i)?(-1==this.listenerList[t].indexOf(i)&&this.listenerList[t].push(i),!0):(this.$t.error(Lt+" listener callBack must be funciton"),!1):(this.$t.error(Lt+" event "+t+" no found"),!1)},Fi.prototype.offListener=function(t,i){return this.listenerList[t]?Object(L.c)(i)?(-1!==this.listenerList[t].indexOf(i)&&(this.listenerList[t]=this.listenerList[t].filter((function(t){return t!==i}))),!0):(this.$t.error(xt+" listener callBack must be funciton"),!1):(this.$t.error(xt+" event "+t+" no found"),!1)},Object.defineProperty(Fi.prototype,"sdKVersion",{get:function(){return this._sdkVersion},set:function(t){this._sdkVersion=t},enumerable:!1,configurable:!0}),Fi.prototype.proxyRes=function(t,i,n){return{interResolve:function(n){i(n),t.end()},interReject:function(i,e){var s;void 0===e&&(e=""),(s=i.code<2e9&&1e9<i.code?F(i.code,i.msg):{code:i.code,message:i.msg})&&t.setAttributes({error:s.code,message:s.message+e}),t.end(),n({errorCode:i.code})}}};var Yi=Fi;function Fi(t,i){this.$t=t,this._dataReport=i,this.id="",this._debug=!1,this.appConfigEtag=-1,this.appConfigFetched=!1,this.requestList={},this.mode=E.MODE_ONLINE,this.connectState="connected",this.testNetPackageSize=!1,this.netGeoFencing={},this._testEnvironment=!1,this._env=0,this.type="PUBLIC",this.debugCustom=!1,this.configOK=!1,this.role=2,this.relateService=[],this.maxMemberCount=0,this.roomCreateFlag=1,this.local_time_deviation=0,this.callbackList={},this.listenerList={roomUserUpdate:[],roomOnlineUserCountUpdate:[],getAnchorInfo:[],_getAnchorInfo:[],IMRecvCustomCommand:[],IMRecvBroadcastMessage:[],recvReliableMessage:[],roomExtraInfoUpdate:[],IMRecvBarrageMessage:[],recvJoinLiveRequest:[],recvInviteJoinLiveRequest:[],recvEndJoinLiveCommand:[],roomLoginResponse:[],_roomLogin:[],_appConfigRsp:[],_netAppConfigRsp:[],_connectChanged:[],HBResponse:[],roomStateUpdate:[],_roomStateUpdate:[],_getTotalUserList:[],_userStateUpdate:[],_recvBigRoomMessage:[],_recvRoomMsg:[],_kickout:[],tokenWillExpire:[],_tokenExpired:[],roomStateChanged:[],hallStateUpdate:[],_hallStateUpdate:[],roomTokenWillExpire:[],_tokenRenewed:[],_protobufResponse:[],_cloudSettingNotify:[],_settingCanFetch:[]},this.reportList={},this.reportSeqList={login:0,relogin:0},this.networkState=h.online,this.roomRetryTime=300,this.roomModulesList=[],this.isMultiRoom=!1,this.setMultiRoom=!1,this.protoFormat="json",this.settingFetched=!1,this.useNetAgent=!0,this.netHasSet=!1,this.configRoomAuth=!1,this.configCheckToken=!1,this._sdkVersion="unknown",this.mode=ot.modeNo}Object.defineProperty(Wi.prototype,"Qt",{get:function(){return this.Zt.reporter},enumerable:!1,configurable:!0}),Wi.prototype.init=function(t){var i=this,n=t.body.hearbeat_interval<3e3?3e3:t.body.hearbeat_interval;this._tryHeartbeatCount=0,this._heartbeatTimer&&clearTimeout(this._heartbeatTimer),this._loginHeartbeatTimer=setTimeout((function(){i.start(n)}),n),this.initCount++},Wi.prototype.start=function(t){var i,n=this,e=(this.$t.info(Mt+" call"),this.Qt.createSpan(u.H,{key:ti.event,par:this._room.roomID},{key:""},mi.event));this._room.isLogin()?3<++this._tryHeartbeatCount?(this.$t.error(Mt+" come to try limit"),this.Qt.setError(e,mi.error.HB_TIMEOUT),this.hbLogout(I.HEARTBEAT_TIMEOUT),this.Qt.createSpan(u.H,{key:ti.event,par:this._room.roomID},{key:""},"/zpush/hb_timeout").end()):(this._liveRoomHandler.heartBeat(i=function(t,i){var s=t.body&&t.body.err_code;t.header&&t.body?0!==s&&(s=F(t.body.err_code||t.body.code,t.body.err_message||t.body.message),e.setAttributes({error:s.code,message:s.message+t.body.err_code})):e.setAttributes({error:(0<t.code?t:I.ROOM_INNER_ERROR).code,message:t.msg||I.ROOM_INNER_ERROR}),n._handleHeartbeatRsp(t,i),0===(null==(s=null==t?void 0:t.body)?void 0:s.err_code)&&e.setAttributes({interval:mi.interval(null==(i=null==t?void 0:t.body)?void 0:i.hearbeat_interval),stream_seq:mi.stream_seq(null==(s=null==t?void 0:t.body)?void 0:s.stream_seq),server_user_seq:mi.server_user_seq(null==(i=null==t?void 0:t.body)?void 0:i.server_user_seq)}),e.end()},i,this._room),this._heartbeatInterval=t,i=this._heartbeatInterval,2<=this.initCount?(i=Math.round(Math.random()*(this._heartbeatInterval+1)),this.initCount=1):i=this._heartbeatInterval,this._heartbeatTimer=setTimeout((function(){n.start(n._heartbeatInterval)}),i),this.$t.info(Mt+" call success")):(this.$t.error(Mt+" state error"),this.Qt.setError(e,mi.error.NOT_LOGIN))},Wi.prototype._handleHeartbeatRsp=function(t,i){if(t.body&&t.body.err_code&&0!==t.body.err_code)return this.$t.error(Ut+" disconnect, server error=",t.body.err_code),1000000152==t.body.err_code?void this.hbLogout(I.HEARTBEAT_TIMEOUT):void this.hbLogout(J(t.body.err_code));t.header&&t.body?((this._tryHeartbeatCount=0)!==t.body.hearbeat_interval&&(this._heartbeatInterval=t.body.hearbeat_interval,this._heartbeatInterval<3e3)&&(this._heartbeatInterval=3e3),this.heartbeatRspNotiFy(t,this._room.roomID),this.$t.info(Ut+" call success")):(this.$t.error(Ut+" disconnect, error=",JSON.stringify(t)+", seq = "+i),this.hbLogout(t))},Wi.prototype.heartbeatRspNotiFy=function(t,i){},Wi.prototype.hbLogout=function(t){},Wi.prototype.resetHeartbeat=function(){clearTimeout(this._heartbeatTimer),this._heartbeatTimer=null,clearTimeout(this._loginHeartbeatTimer),this._loginHeartbeatTimer=null,this._tryHeartbeatCount=0,this.initCount=0,this.$t.info("zm.hb.rst call success")};var Ki=Wi;function Wi(t,i,n,e,s,r){this.$t=t,this.Zt=i,this._dataReport=n,this._liveRoomHandler=e,this._room=s,this._service=r,this._tryHeartbeatCount=0,this._heartbeatTimer=null,this._loginHeartbeatTimer=null,this.initCount=0}Object.defineProperty(Xi.prototype,"_isUseNetAgent",{get:function(){return this.Zt.useNetAgent},enumerable:!1,configurable:!0}),Object.defineProperty(Xi.prototype,"Qt",{get:function(){return this.Zt.reporter},enumerable:!1,configurable:!0}),Xi.prototype.resetTokenTimer=function(t){var i=this;this.$t.info("zm.rm.rst  call: "+(t=2147483647<(t=(t-=3e4)<0?0:t)?2147483647:t)),this._tokenTimer&&clearTimeout(this._tokenTimer),this._tokenTimer=setTimeout((function(){i.Zt.actionListener("tokenWillExpire",i._room.roomID),i.Zt.actionListener("roomTokenWillExpire",i._room.roomID)}),t)},Xi.prototype._stopTokenTimer=function(){this._tokenTimer&&clearTimeout(this._tokenTimer),this._tokenTimer=null},Xi.prototype.setRunState=function(t){this._room.runState!==t&&(this._room.lastRunState=this._room.runState,this._room.runState=t)},Xi.prototype._resetTryLogin=function(){this._tryLoginTimer&&clearTimeout(this._tryLoginTimer),this._tryLoginTimer=null},Xi.prototype._reportLogoutSpan=function(t){var i,n=this.Zt.isMultiRoom?ui:"/switch/logout_user";n=this.Qt.createSpan(u.H,{key:oi.event,par:this._room.roomID},{key:""},n),t&&this._isUseNetAgent&&"0"===this._liveRoomHandler.roomServicer.zPushSid&&(this._liveRoomHandler.roomServicer.zPushSid=null==(i=null==(i=null==(i=this._liveRoomHandler)?void 0:i.roomServicer)?void 0:i.switchSessionID)?void 0:i.toString()),t=this._isUseNetAgent?t?null==(t=null==(i=this._liveRoomHandler)?void 0:i.roomServicer)?void 0:t.zPushSid:null==(i=null==(t=null==(i=this._liveRoomHandler)?void 0:i.roomServicer)?void 0:t.switchSessionID)?void 0:i.toString():void 0;n.setAttributes({room_id:oi.room_id(null==(i=this._room)?void 0:i.roomID),room_sid_string:oi.room_sid_string(null==(i=this._room)?void 0:i.roomSidString),liveroom_sid_string:hi(null==(i=this._room)?void 0:i.userSidString),sdk_zpush_sessionid_string:ci(t)}),n.end()},Xi.prototype.resetRoom=function(t){var i,n=this;(t=(this.$t.info("zm.rm.rr call"),1<this.Zt.roomModulesList.length&&!t&&(this._room.isMulti=!0),this._resetTryLogin(),this._room.sessionExist&&this._room.runState!==o.logout&&!this._room.isDisConnect()&&this._liveRoomHandler.logout(this._room,i=function(t){n.handleLogoutRsp(t,!n._room.isMulti)},i),this._reportLogoutSpan(t),this.setRunState(o.logout),this._room.resetRoomSession(),this._room.resetUserSession(),this._room.isMulti||(this.Zt.userid="",this.$t.setSessionInfo(this.Zt.appid,this._room.roomID,this._room.userSidString,this.Zt.idName,this.Zt.nickName,this.Zt.sdKVersion),null!=(i=this._liveRoomHandler)&&i.reset()),this.resetRoomCallBack(),this.Zt.roomModulesList=this.Zt.roomModulesList.filter((function(t){return t!==n._room})),this.Zt.roomModulesList[0]))&&(t.isMulti=!1,t.runState!==o.login)&&t.roomTryHandler&&(t.roomTryHandler.startMaxTime(),t.roomTryHandler.active()),this.Zt.isMultiRoom&&0===this.Zt.roomModulesList.length&&(this.Qt.createSpan(u.H,{key:oi.event,par:this._room.roomID},{key:""},"/zpush/multi_logout_user").end(),this._liveRoomHandler.roomServicer.zPushSid="0"),this.$t.info("zm.rm.rr call success")},Xi.prototype.resetRoomCallBack=function(){},Xi.prototype.loginSuccessCallBack=function(t,i){},Xi.prototype.handlePushKickout=function(t,i,n){var e=this,s=(this.$t.info(Dt+"  call "+JSON.stringify(t)),function(t,i){var n={code:t,message:"kickout reason = "+t},e={code:63000005,message:"zpush token expired",name:"TOKEN_EXPIRED"};switch(t){case 1:return{code:63000001,message:"zpush multiple login kickout",name:"MULTIPLE_LOGIN_KICKOUT"};case 2:return{code:63000002,message:"zpush manual kickout",name:"MANUAL_KICKOUT"};case 4:return i?e:{code:63000004,message:"zpush multiple login kickout",name:"MULTIPLE_LOGIN_KICKOUT"};case 5:if(!i)return e;default:n.code=t,n.message="kickout reason = "+t}return n}(t.body.reason||(null==(s=t.body)?void 0:s.kickout_reason),this._isUseNetAgent)),r=this.Qt.createSpan(u.H,{key:ti.event,par:this._room.roomID},{key:""},"/sdk/kickout"),h=(r.setAttributes({error:null==(h=I[s.name||"ROOM_INNER_ERROR"])?void 0:h.code,message:s.message,kickout_reason:di((null==(h=t.body)?void 0:h.reason)||(null==(h=t.body)?void 0:h.kickout_reason)),need_relogin:vi(null==(h=null==t?void 0:t.body)?void 0:h.need_relogin)}),r.end(),this._room.roomTryHandler);h?(h.onactive=function(t,i){e.$t.info(Dt+" onactive"),e.disconnectedHandle(i),e.Zt.actionListener("_kickout",i)},t.body.need_relogin&&1==t.body.need_relogin?(this._room.resetUserSession(),h.startMaxTime(),h.active()):(this.setRunState(o.logout),this.resetRoom(i),r={},t&&t.body.custom_reason?r.custom_kickout_message=t.body.custom_reason:s.name&&I[s.name]&&(h=t.body.reason||t.body.kickout_reason,r.custom_kickout_message=I[s.name].msg+"; kickout reason: "+h),s.name&&I[s.name]?this.disconnectedHandle(I[s.name],{extendedData:JSON.stringify(r),isKickout:!0}):this.disconnectedHandle(I.ROOM_INNER_ERROR,{extendedData:JSON.stringify(r),isKickout:!0}),this.Zt.actionListener("_kickout",{code:I.MANUAL_KICKOUT.code,msg:I.MANUAL_KICKOUT.msg+t.body.reason||t.body.kickout_reason}))):this.$t.info(Dt+" try handler no found")},Xi.prototype.handleHbLogout=function(t){var i=this,n=this._room.roomTryHandler;n&&(n.onactive=function(t,n){i.$t.warn(Pt+" onactive"),i.transError(n),i.disconnectedHandle(n)},[I.HEARTBEAT_TIMEOUT,I.SOCKET_CLOSE].includes(t)||[105,152,2001].includes(null==t?void 0:t.code)||t.msg.endsWith("1000002001")||t.msg.endsWith("1000000152")||t.msg.endsWith("1000000105")?(n.startMaxTime(),n.active()):[I.TIMEOUT].includes(t)?this.$t.warn(Pt+" timeout"):(this.$t.warn(Pt+" unexpected error: ".concat(JSON.stringify(t))),n.stopMaxTime(),n.invalid(),this.resetRoom(),this.disconnectedHandle(t)))},Xi.prototype.onDisconnect=function(t){var i=this,n=(this.$t.error(At+" "+t.msg),t.code);(n=(Object(L.f)(n)&&"Error.Network"===n||Object(L.d)(n)&&(n<2e9&&1e9<n||n<1e6?F(n,t.msg):t.msg),Y(ai,this.Zt.reportList),this._room.roomTryHandler))?(n.onactive=function(t,n){i.$t.error(At+" onactive"),n&&0!==n.code?(i.transError(n),i._roomStateHandle("DISCONNECTED",O.ReconnectFailed,n)):i._roomStateHandle("CONNECTED",O.Reconnected,n)},n.startMaxTime(),n.active()):this.$t.error(At+" try handler no found")},Xi.prototype.onConnecting=function(t){this._roomStateHandle("CONNECTING",O.Logining,t)},Xi.prototype.disconnectedHandle=function(t,i){var n;t&&0!==t.code?(this._stopTokenTimer(),n=null!=i&&i.isKickout?O.Kickout:O.ReconnectFailed,this.transError(t),this._roomStateHandle("DISCONNECTED",n,t,(null==i?void 0:i.extendedData)||t.msg)):this._roomStateHandle("CONNECTED",O.Reconnected,t,null==i?void 0:i.extendedData)},Xi.prototype._roomStateHandle=function(t,i,n,e,s){if(!i||i!=O.Reconnecting||(this._reconectTimes++,1!=this._reconectTimes)){this.$t.info("zm.rm.scb "+t+" "+JSON.stringify(n)),["CONNECTED","DISCONNECTED"].includes(t)&&(this._reconectTimes=0);var r,o,h=0;switch(i=(i=(i=i&&[O.LoginFailed,O.ReconnectFailed].includes(i)?null!=(o=this._room.roomTryHandler)&&o.loginRoomCallback.fail?O.LoginFailed:O.ReconnectFailed:i)&&[O.Logined,O.Reconnected].includes(i)?null!=(o=this._room.roomTryHandler)&&o.loginRoomCallback.success?O.Logined:O.Reconnected:i)&&[O.Logining,O.Reconnecting].includes(i)?null!=(o=this._room.roomTryHandler)&&o.loginRoomCallback.success?O.Logining:O.Reconnecting:i){case O.Reconnecting:r=fi,this.tempBrokenTime=(new Date).getTime();break;case O.ReconnectFailed:r=_i;break;case O.Reconnected:r=li,h=(new Date).getTime()-this.tempBrokenTime}this._room.lastRoomState=this._room.roomState,this._room.roomState=t,this._room.roomReasonState=i,this._room.roomState!==this._room.lastRoomState&&(this.Zt.actionListener("_roomStateUpdate",this._room.roomID,t,n?n.code:0,e,s),s||(this.Zt.actionListener("roomStateUpdate",this._room.roomID,t,n?n.code:0,e),this.Zt.actionListener("roomStateChanged",this._room.roomID,i,n?n.code:0,e)),r)&&(o=this.Qt.createSpan(u.H,{key:ti.event,par:this._room.roomID},{key:""},r.event),i===O.Reconnected?o.setAttributes({room_broken_time:li.room_broken_time(h)}):o.setAttributes({error:(null==n?void 0:n.code)||0,message:e||""}),o.end())}},Xi.prototype.transError=function(t){var i;this.$t.info("zm.rm.te "+JSON.stringify(t)),0!==t.code&&(t.code<2e9&&1e9<t.code||t.code<1e6)&&(i=K(t.code,this.Zt.useNetAgent))&&I[i]&&(t.code=I[i].code,t.msg=I[i].msg)},Xi.prototype.login=function(t,i,n,e,s,r,h){var c;this.$t.info(wt+" call:"+i),this.$t.remoteReport(wt+" call:"+n),this._room.isMulti||this.$t.setSessionInfo(this.Zt.appid,i,"",e.userID,"",this.Zt.sdKVersion),s&&(c=s.userUpdate,s=s.maxMemberCount,c&&Object(L.b)(c)&&(this._room.userStateUpdate=c),s)&&Object(L.d)(s)&&(this._room.maxMemberCount=s),this.Zt.configOK?(this._room.runState!==o.trylogin&&this.setRunState(o.trylogin),this._room.roomID=i,this._room.token=n,this._room.thirdToken=n,this.Zt.idName=e.userID,this.Zt.nickName=e.userName||e.userID,this.loginCallback.success=r,this.loginCallback.fail=h,this.server=t,this.Qt.spanSetAttributes({key:ii,bak_key:ai,par:i},{server:this._isUseNetAgent?void 0:ni(this.server)}),this.liveRoomLoginKey=this._room.isMulti?si:ei,this.Qt.createSpan(u.H,{key:ii,bak_key:ai,par:this._room.roomID},{key:this.liveRoomLoginKey.event,par:this._room.roomID},this.liveRoomLoginKey.event,!0),this._resetTryLogin(),this.onConnecting({code:0,msg:""}),this._tryLogin(t),this.$t.info(wt+" call success")):(this.$t.error(wt+" init sdk wrong"),h(I.INIT))},Xi.prototype._tryLogin=function(t){var i,n=this;if(this._room.runState!==o.trylogin)this.$t.error("zb.rh.tl state error");else{var e;if(this.Zt.reportSeqList.login,this._isUseNetAgent)return this._room.isMulti&&this._room.isDisConnect()?void this.$t.warn(Nt+" liveroom is not connected"):(e=function(t,i){n.handleLoginRsp(t,i)},void(null!=(i=this._liveRoomHandler)&&i.isUaConnect()?(this.Qt.spanSetAttributes({key:this.liveRoomLoginKey.event,par:null==(i=this._room)?void 0:i.roomID},{sdk_zpush_sessionid_string:null==(i=null==(i=null==(i=this._liveRoomHandler)?void 0:i.roomServicer)?void 0:i.switchSessionID)?void 0:i.toString()}),this._liveRoomHandler.login(this._room,e,e)):(this._tryLoginTimer=setTimeout((function(){n.$t.info(Nt+" over time no response, login timeout"),n.loginCallback.fail&&n.loginCallback.fail(ti.error.LOGIN_TIMEOUT)}),this._tryLoginInterval),this.$t.warn(Nt+" ua is not connected"))));this._tryLoginTimer=setTimeout((function(){n.$t.info(Nt+" over time no response, login timeout"),n.loginCallback.fail&&n.loginCallback.fail(ti.error.LOGIN_TIMEOUT)}),this._tryLoginInterval),this.$t.info(Nt+" call success")}},Xi.prototype.handleLoginRsp=function(t,i){this.$t.info(It+" seq: "+i+" "+JSON.stringify(t)),this.Zt.reportSeqList.login,this._room.runState!==o.trylogin?this.$t.error(It+" state error"):t.header&&t.body?t.header.seq!==i&&0==this._room.isMulti?this.$t.error(It+" in wrong seq, local=",i+"",",recv=",t.header.seq):0!==t.body.err_code?(this.$t.error(It+" server error=",t.body.err_code),this.handleLoginFail(t)):(this.$t.info(It+" call success."),this.handleLoginSuccess(t)):(this.$t.error(It+" "+JSON.stringify(t)),this.handleLoginFail(t))},Xi.prototype.handleLoginFail=function(t){this._resetTryLogin();var i=ti.error.INNER_ERROR;t.header&&t.body?i=J(t.body.err_code):t.code&&t.msg&&(i=t),this.Qt.spanEnd({key:this.liveRoomLoginKey.event,par:this._room.roomID},{error:i.code,message:i.msg}),this.loginCallback.fail&&this.loginCallback.fail(i,!0)},Xi.prototype.handleLoginSuccess=function(t){var i,n,e=this,s=(this._room.checkRoomSession(t.body.room_session_id)&&(this._room.loginTime=Date.now()),this._room.lastRunState),r=(this.setRunState(o.login),this.Zt.userid=t.body.user_id,this._isUseNetAgent?(this._room.longRoomSid=t.body.room_session_id,this._room.longSid=t.body.session_id):(this._room.sessionID=t.body.session_id,this._room.roomSessionID=t.body.room_session_id),(r={})[this._room.roomID]={room_sid_string:this._room.roomSidString},this.Qt.setPublicPros(r),null==(r=null==t?void 0:t.body)?void 0:r.token_remain_time);this.Zt.configRoomAuth=0<r,t.body.ret_timestamp&&["03","04"].includes(this._room.token.substring(0,2))&&(n=(i=(new Date).getTime())-t.body.ret_timestamp,this.Zt.local_time_deviation=n<5e3?0:n,n=0<r?1e3*r:1e3*X(this._room.token.substring(2))-(i-this.Zt.local_time_deviation),this.resetTokenTimer(n)),this._room.isMulti||this.$t.setSessionInfo(this.Zt.appid,this._room.roomID,this._room.userSidString,this.Zt.idName,this.Zt.nickName,this.Zt.sdKVersion),this.Qt.spanEnd({key:this.liveRoomLoginKey.event,par:this._room.roomID},{server:this._isUseNetAgent?void 0:ni(this.server),room_id:null==(r=this._room)?void 0:r.roomID,room_sid_string:null==(i=this._room)?void 0:i.roomSidString,zpush_sessionid_string:this._isUseNetAgent&&null!=(r=null==(n=null==t?void 0:t.header)?void 0:n.session_id)?r.toString():void 0,liveroom_sid_string:null==(i=this._room)?void 0:i.userSidString}),this._resetTryLogin(),this.loginSuccessCallBack(s,t),this._roomStateHandle("CONNECTED",O.Logined,{code:0,msg:""}),this.$t.makeZipLogSpaceUpload().catch((function(t){e.$t.error("zm.rm.lgsuc zip log upload error: "+JSON.stringify(t))})),this.loginCallback.success&&this.loginCallback.success(!0)},Xi.prototype.closeHandler=function(t){this.$t.error(Ct+" room websocket close "+JSON.stringify(t.code||t)),this._room.runState!==o.logout?this._room.runState===o.trylogin?(this._resetTryLogin(),this.loginCallback.fail&&this.loginCallback.fail(1006==t.code?ti.error.LOGIN_TIMEOUT:t)):this._room.runState===o.login&&(this.$t.info(Ct+" is called because of network broken"),this._resetTryLogin(),this.onDisconnect(ti.error.NETWORK_BROKEN)):this.$t.info(Ct+" onclose logout flow call websocket.close")},Xi.prototype.logout=function(t,i){this.$t.info(kt+" call"),this._room.runState===o.logout?this.$t.warn("zb.rh.lo at logout"):(this.resetRoom(t),this._roomStateHandle("DISCONNECTED",O.Logout,{code:0,msg:""},void 0,i),this._stopTokenTimer(),this.$t.info(kt+" call success"))},Xi.prototype.handleLogoutRsp=function(t,i){this.$t.info(kt+" result=",t.body&&t.body.err_code?t.body.err_code:"-1"),this._isUseNetAgent&&i&&null!=(t=this._liveRoomHandler)&&t.closeRequest()};var Zi=Xi;function Xi(t,i,n,e,s,r){this.$t=t,this.Zt=i,this._dataReport=n,this._room=e,this._liveRoomHandler=s,this._service=r,this._tryLoginTimer=null,this._tryLoginCount=0,this._tryLoginInterval=1e4,this._tokenTimer=null,this._beforeExpire=30,this.server="",this.tempBrokenTime=0,this._reconectTimes=0,this.loginCallback={}}var Qi=function(t,i,n){if(n||2===arguments.length)for(var e,s=0,r=i.length;s<r;s++)!e&&s in i||((e=e||Array.prototype.slice.call(i,0,s))[s]=i[s]);return t.concat(e||Array.prototype.slice.call(i))},tn=(nn.prototype.loginRsp=function(t,i){this._anchor_info=t.body.anchor_info||this._anchor_info,this._userListInterval=t.body.userlist_interval||this._userListInterval,this._userListMergeInterval=t.body.userlist_merge_timeout||this._userListMergeInterval,t.body.anchor_info&&(this.Zt.actionListener("getAnchorInfo",t.body.anchor_info.anchor_id_name,t.body.anchor_info.anchor_nick_name),this.Zt.actionListener("_getAnchorInfo",t.body.anchor_info.anchor_id_name,t.body.anchor_info.anchor_nick_name)),t.body.online_count&&this.Zt.actionListener("roomOnlineUserCountUpdate",this._room.roomID,t.body.online_count),this.$t.info("zm.us.lgr  userStateUpdate "+this._room.userStateUpdate),this._room.userStateUpdate&&this.fetchUserList(i)},nn.prototype.patchUserList=function(t){var i=this;t.body.server_user_seq!==this._userSeq&&this._room.userStateUpdate&&!this._userSeqMergeMap&&(this.$t.info("zm.us.pt call update user "+this._userSeq+" server "+t.body.server_user_seq),this._userSeqMergeMap||(this._userSeqMergeMap={}),this._userSeqMergeTimer&&clearTimeout(this._userSeqMergeTimer),this._userSeqMergeTimer=setTimeout((function(){i.handleMergeTimeout()}),this._userListMergeInterval)),this._minUserSeq=t.body.server_user_seq,null!=t.body.online_count&&0!=t.body.online_count&&this.Zt.actionListener("roomOnlineUserCountUpdate",this._room.roomID,t.body.online_count)},nn.prototype.resetUserHandler=function(){this._userQuerying=!1,this._lastUserQueryTime=0,this._userTempList=[],this._userSeq=0,this._minUserSeq=0,this._userList=void 0,this._userSeqMergeMap={},this._userSeqMergeTimer=void 0,this._userQueryTimer=void 0,this._userListInterval=3e4,this._userListMergeInterval=5e3,this._anchor_info={anchor_id:"",anchor_id_name:"",anchor_nick_name:""}},nn.prototype.fetchUserList=function(t){this._userQuerying?this.$t.warn("zm.us.ftu is already querying"):(this._userQuerying=!0,this._userTempList=[],this.fetchUserListWithPage(0,t||0),this.$t.info("zm.us.ftu the first time call"))},nn.prototype.fetchUserListWithPage=function(t,i){function n(t){e.handleFetchUserListRsp(t,i)}var e=this,s={user_index:t,sort_type:0},r=Ti;null!=(r=(this.Zt.reporter.createSpan(u.H,{key:ti.event,par:this._room.roomID},{key:r.event,par:this._room.roomID},r.event,!0).setAttribute("user_index",r.user_index(t)),this.Zt.useNetAgent?this._liveRoomHandler:this._service))&&r.fetchUserList(s,n,n,this._room)},nn.prototype.handleFetchUserListRsp=function(t,i){var n=this;if(this.Zt.reporter.spanEnd({key:Ti.event,par:this._room.roomID},{error:(null==(e=null==t?void 0:t.body)?void 0:e.err_code)||(null==t?void 0:t.code),message:(null==(e=null==t?void 0:t.body)?void 0:e.err_message)||(null==t?void 0:t.msg)}),t.body&&0!=t.body.err_code)this._userQuerying=!1,this._lastUserQueryTime=Date.now()+this._userListInterval,this.$t.info(jt+" fetch error "+t.body.err_code);else if(t.header&&t.body)if(this._room.userStateUpdate){this._userTempList=Qi(Qi([],this._userTempList,!0),t.body.user_baseinfos,!0);var e=t.body.ret_user_index;if(e!=t.body.server_user_index)this.$t.info(jt+" fetch another page"),this.fetchUserListWithPage(e+1,i);else{this._userSeq=t.body.server_user_seq;for(var s=[],r=[],u=0;u<this._userTempList.length;u++){var h={userID:this._userTempList[u].id_name,userName:this._userTempList[u].nick_name,role:this._userTempList[u].role};4!==h.role&&(s.push(h),r.push({idName:this._userTempList[u].id_name,nickName:this._userTempList[u].nick_name,role:this._userTempList[u].role}))}if(this.Zt.actionListener("_getTotalUserList",this._room.roomID,r),i==o.login){if(this._userList){e=this.$t;var c=this._userList,a=s;i=function(t,i){0!==t.length&&n.onUserStateUpdate(n._room.roomID,"ADD",t),0!==i.length&&n.onUserStateUpdate(n._room.roomID,"DELETE",i)},e.debug("msl.0 call");var f=[],l=[];a=a||[];for(var _=0;_<a.length;_++){for(var d=!1,v=0;v<c.length;v++)if(a[_].userID===c[v].userID){d=!0;break}d||f.push(a[_])}for(var m=0;m<c.length;m++){d=!1;for(var g=0;g<a.length;g++)if(c[m].userID===a[g].userID){d=!0;break}d||l.push(c[m])}for(c.splice(0),_=0;_<a.length;_++)c.push(c[_]);i(f,l),e.debug("msl.0 call success")}this._userList=s}else 0!==(this._userList=s).length&&this.onUserStateUpdate(this._room.roomID,"ADD",s);this._userQuerying=!1,this._lastUserQueryTime=Date.now()+this._userListInterval,this._userTempList=[],this.$t.info(jt+" call success user_list "+s+", count: "+s.length+", seq: "+this._userSeq)}}else this.$t.info(jt+" not update");else this._userQuerying=!1,this._lastUserQueryTime=Date.now()+this._userListInterval,this.$t.info(jt+" fetch error "+t)},nn.prototype.handlePushUserStateUpdateMsg=function(t){if(this.$t.info(zt+" call"),this._room.userStateUpdate)if(this._userSeq===t.body.user_list_seq)this.$t.warn(zt+" user_list_seq is the same with local seq");else if(this._userSeq+t.body.user_actions.length!==t.body.user_list_seq)this.mergeUserByUserSeq(t.body.user_list_seq,t.body.user_actions);else{this._userSeq=t.body.user_list_seq;for(var i=[],n=0;n<t.body.user_actions.length;n++){var e={action:t.body.user_actions[n].Action,idName:t.body.user_actions[n].IdName,nickName:t.body.user_actions[n].NickName,role:t.body.user_actions[n].Role,loginTime:t.body.user_actions[n].LoginTime};4!==e.role&&i.push(e)}this.Zt.actionListener("_userStateUpdate",t.body.room_id,i);var s=[],r=[];i.forEach((function(t){1==t.action?s.push({userID:t.idName,userName:t.nickName,role:t.role}):2==t.action&&r.push({userID:t.idName,userName:t.nickName,role:t.role})})),this._userList&&(this._userList=this._userList.concat(s).filter((function(t){return!r.some((function(i){return i.userID==t.userID}))}))),0!==s.length&&this.onUserStateUpdate(t.body.room_id,"ADD",s),0!==r.length&&this.onUserStateUpdate(t.body.room_id,"DELETE",r),this.$t.info(zt+" call success")}else this.$t.info(zt+" userStateUpdate is false")},nn.prototype.onUserStateUpdate=function(t,i,n){var e=this;n=n.filter((function(t){return t.userID!==e.Zt.idName}));0!=n.length&&(n=n.map((function(t){return{userID:t.userID,userName:t.userName}})),this.Zt.actionListener("roomUserUpdate",t,i,n))},nn.prototype.mergeUserByUserSeq=function(t,i){var n=this;this._userSeqMergeMap||(this.$t.warn("zm.us.mg new merge userlist "+this._userSeq+" server "+t),this._userSeqMergeMap={},this._userSeqMergeTimer&&clearTimeout(this._userSeqMergeTimer),this._userSeqMergeTimer=setTimeout((function(){n.handleMergeTimeout()}),this._userListMergeInterval)),this._userSeqMergeMap[t]=i,this.$t.warn("zm.us.mg  merge userlist "+this._userSeq+" server "+t+" userlist "+i.length)},nn.prototype.mergeUser=function(t){var i=this,n=(this.$t.info("zm.us.mg merge userlist "+this._userSeq+" userSeqList "+t.join(",")),this._userSeq=t[t.length-1],this._lastUserQueryTime=Date.now()+this._userListInterval,{}),e=((t=(t.forEach((function(t){i._userSeqMergeMap&&i._userSeqMergeMap[t].forEach((function(t){n[t.IdName]=t}))})),this._userSeqMergeMap=null,Object.values(n).map((function(t){return{action:t.Action,idName:t.IdName,nickName:t.NickName,role:t.Role,loginTime:t.LoginTime?String(t.LoginTime):""}})).filter((function(t){return 4!==t.role})))).sort((function(t,i){return t.loginTime.localeCompare(i.loginTime)})),[]),s=[];t.forEach((function(t){1==t.action?e.push({userID:t.idName,userName:t.nickName,role:t.role}):2==t.action&&s.push({userID:t.idName,userName:t.nickName,role:t.role})})),this._userList=this._userList&&this._userList.concat(e).filter((function(t){return!s.some((function(i){return i.userID==t.userID}))})),0!==e.length&&this.onUserStateUpdate(this._room.roomID,"ADD",e),0!==s.length&&this.onUserStateUpdate(this._room.roomID,"DELETE",s),this.Zt.actionListener("_userStateUpdate",this._room.roomID,t)},nn.prototype.handleMergeTimeout=function(){var t,i=this,n=Object.keys(this._userSeqMergeMap).map((function(t){return+t})).sort((function(t,i){return t-i}));n[n.length-1]-n[0]+1===n.length||n[n.length-1]>=this._minUserSeq?this.mergeUser(n):(this._userSeqMergeMap=null,t=this._lastUserQueryTime-Date.now(),this.$t.info("zm.us.mto  fetch merge userlist "+this._userSeq+" userSeqList "+n.join(",")+" wait "+t),0<t?(this._userQueryTimer&&clearTimeout(this._userQueryTimer),this._userQueryTimer=setTimeout((function(){i.fetchUserList()}),t)):this.fetchUserList())},nn);function nn(t,i,n,e,s,r){this.$t=t,this.Zt=i,this._dataReport=n,this._liveRoomHandler=e,this._room=s,this._service=r,this._userQuerying=!1,this._userTempList=[],this._userSeq=0,this._minUserSeq=0,this._userList=[],this._userSeqMergeMap=null,this._userListInterval=3e4,this._userListMergeInterval=5e3,this._anchor_info={anchor_id:"",anchor_id_name:"",anchor_nick_name:""}}Object.defineProperty(sn.prototype,"logger",{get:function(){return this.$t},enumerable:!1,configurable:!0}),Object.defineProperty(sn.prototype,"stateCenter",{get:function(){return this.Zt},enumerable:!1,configurable:!0}),Object.defineProperty(sn.prototype,"liveRoomHandler",{get:function(){return this._liveRoomHandler},enumerable:!1,configurable:!0}),Object.defineProperty(sn.prototype,"_isUseNetAgent",{get:function(){return this.Zt.useNetAgent},enumerable:!1,configurable:!0}),Object.defineProperty(sn.prototype,"sessionExist",{get:function(){return null!==this.longSid||"0"!==this.sessionID},enumerable:!1,configurable:!0}),Object.defineProperty(sn.prototype,"roomSidString",{get:function(){return this.longRoomSid?this.longRoomSid.toString():"0"},enumerable:!1,configurable:!0}),Object.defineProperty(sn.prototype,"userSidString",{get:function(){return this.longSid?this.longSid.toString():"0"},enumerable:!1,configurable:!0}),sn.prototype.initMessageHandler=function(){},sn.prototype.initLiveHandler=function(){},sn.prototype.init=function(){this.bindHeatBeatHandler(),this.bindRoomHandler(),this.bindMessageHandler(),this.bindLiveHandler()},sn.prototype.bindHeatBeatHandler=function(){var t=this;this.heartBeatHandler.hbLogout=function(i){t.roomHandler.handleHbLogout(i)},this.heartBeatHandler.heartbeatRspNotiFy=function(i,n){t.messageHandler&&t.messageHandler.loginRsp(i),t.userHandler.patchUserList(i),t._HBResponse(i,n)}},sn.prototype.bindRoomHandler=function(){var t=this;this.roomHandler.loginSuccessCallBack=function(i,n){t.$t.info("zm.lrm.brh login suc "+i),t.heartBeatHandler.init(n),t._isUseNetAgent?t._liveRoomHandler.startCheck():t.service&&(t.service.stopCheck(),t.service.startCheck()),t.userHandler.loginRsp(n,i),t.messageHandler&&t.messageHandler.loginRsp(n),t.isMulti||t._handleMultiRoom(),t._roomLoginResponse(n)},this.roomHandler.resetRoomCallBack=function(){t.heartBeatHandler.resetHeartbeat(),t.liveHandler&&t.liveHandler.resetLiveHandler(),t.messageHandler&&t.messageHandler.resetMessageInfo(),t._isUseNetAgent&&t._liveRoomHandler&&t._liveRoomHandler.stopCheck(),t.userHandler.resetUserHandler(),t.roomTryHandler&&(t.roomTryHandler.invalid(),t.roomTryHandler.stopMaxTime())}},sn.prototype.bindUserHandler=function(){},sn.prototype.bindMessageHandler=function(){},sn.prototype.bindLiveHandler=function(){},sn.prototype._HBResponse=function(t,i){this.Zt.actionListener("HBResponse",t,i)},sn.prototype._roomLoginResponse=function(t){this.Zt.actionListener("roomLoginResponse",t)},sn.prototype.checkRoomSession=function(t){return this._isUseNetAgent?null!==this.longRoomSid&&this.longRoomSid.eq(t):this.roomSessionID===t},sn.prototype._handleMultiRoom=function(){var t=this;this.Zt.roomModulesList.forEach((function(i){i.runState!==o.login&&i.roomTryHandler&&1==i.isMulti&&(i.roomTryHandler.onactive=function(n,e){var s;e&&0!==e.code?(0!==e.code&&(s=K(e.code,t._isUseNetAgent))&&I[s]&&(e=I[s]),i.roomHandler._roomStateHandle("DISCONNECTED",O.ReconnectFailed,e,e.msg)):i.roomHandler._roomStateHandle("CONNECTED",O.Reconnected,e)},i.roomTryHandler.startMaxTime(),i.roomTryHandler.active())}))},sn.prototype.isLogin=function(){return this.runState===o.login},sn.prototype.isLogout=function(){return this.runState===o.logout},sn.prototype.isTryLogin=function(){return this.runState===o.trylogin},sn.prototype.isDisConnect=function(){return(this._isUseNetAgent?this._liveRoomHandler:this.service).isDisConnect()},sn.prototype.retryConnect=function(){this.$t.info("zm.lrm.rc call"),this._isUseNetAgent&&(this.resetSessionInfo(),this._liveRoomHandler.closeRequest())},sn.prototype.retryRoom=function(){this.$t.info("zm.lrm.rr.0 call"),this.roomTryHandler&&this.rtm.netAgent.isConnect()&&(this.resetRoomSession(),this.resetUserSession(),this.roomTryHandler.active(!0))},sn.prototype.resetSessionInfo=function(){var t;this.$t.info("zm.lrm.rsi call"),this.resetRoomSession(),this.resetUserSession(),null!=(t=this._liveRoomHandler)&&t.reset()},sn.prototype.resetRoomSession=function(){this.roomSessionID="0",this.longRoomSid=null},sn.prototype.resetUserSession=function(){this.sessionID="0",this.longSid=null};var en=sn;function sn(t,i,n,e,s,r,u){this.roomID=t,this.Zt=i,this.$t=n,this.dataReport=e,this.rtm=s,this._liveRoomHandler=r,this.service=u,this.runState=o.logout,this.lastRunState=o.logout,this.lastRoomState="DISCONNECTED",this.roomState="DISCONNECTED",this.roomReasonState=O.Logout,this.roomSessionID="0",this.sessionID="0",this.longSid=null,this.longRoomSid=null,this.isMulti=!1,this.token="",this.thirdToken="",this.loginTime=0,this.userStateUpdate=!1,this.maxMemberCount=0,this.roomName="",this.roomHandler=new Zi(this.$t,this.Zt,this.dataReport,this,r,this.service),this.heartBeatHandler=new Ki(this.$t,this.Zt,this.dataReport,this._liveRoomHandler,this,this.service),this.userHandler=new tn(this.$t,this.Zt,this.dataReport,this._liveRoomHandler,this,this.service),this.initMessageHandler(),this.initLiveHandler(),this.init()}var rn=function(){},on=(Object.defineProperty(un.prototype,"Qt",{get:function(){return this.Zt.reporter},enumerable:!1,configurable:!0}),Object.defineProperty(un.prototype,"logger",{get:function(){return this.$t},enumerable:!1,configurable:!0}),Object.defineProperty(un.prototype,"stateCenter",{get:function(){return this.Zt},enumerable:!1,configurable:!0}),un.prototype.checkResponse=function(t){return!1},un.prototype.handleSendCommandMsgRsp=function(t){},un.prototype.onPush=function(){},un.prototype.handlePushKickout=function(t){},un.prototype.handlePushCustomMsg=function(t){},un.prototype.handlePushRoomMsg=function(t){},un.prototype.handlePushUserStateUpdateMsg=function(t){},un.prototype.handlePushMergeMsg=function(t){},un.prototype.handlePushTransMsg=function(t){},un.prototype.handleBigImMsgRsp=function(t){},un.prototype.handlePushSignalMsg=function(t){},un.prototype.handlePushTokenExpire=function(t){},un.prototype.closeHandler=function(t){},un.prototype.openHandler=function(t){},un.prototype.errorHandler=function(t){},un.prototype.getHeader=function(t,i,n,e){return{Protocol:"req",cmd:t,appid:this.Zt.appid,seq:++this.cmdSeq,user_id:this.Zt.userid,session_id:i||"",room_id:n||"",room_session_id:e||"",biz_version:this.Zt.bizVersion||""}},un.prototype.startCheck=function(){},un.prototype.stopCheck=function(){},un.prototype.isDisConnect=function(){return!1},un.prototype.createSocket=function(t){},un.prototype.closeSocket=function(){},un.prototype.sendMessage=function(t,i,n,e,s,r){return 0},un.prototype.on=function(t,i){},un.prototype.login=function(t,i,n){return-1},un.prototype.logout=function(t,i,n){return-1},un.prototype.heartBeat=function(t,i,n){return-1},un.prototype.fetchUserList=function(t,i,n,e){return this.sendMessage("user_list",t,i,n,void 0,e)},un.prototype.fetchUserListV2=function(t,i,n,e){return this.sendMessage("user_list_v2",t,i,n,void 0,e)},un.prototype.fetchReliableMessage=function(t,i,n,e){return this.sendMessage("trans_fetch",t,i,n,void 0,e)},un.prototype.sendReliableMessage=function(t,i,n,e){return this.sendMessage("trans",t,i,n,void 0,e)},un.prototype.sendRoomMsg=function(t,i,n,e){return this.sendMessage("im_chat",t,i,n,void 0,e)},un.prototype.sendCustomCommand=function(t,i,n,e){return this.sendMessage("custommsg",t,i,n,void 0,e)},un.prototype.sendBigRoomMessage=function(t,i,n,e){return this.sendMessage("bigim_chat",t,i,n,void 0,e)},un.prototype.sendRelayMessage=function(t,i,n,e){return this.sendMessage("relay",t,i,n,void 0,e)},un.prototype.sendSignalCmd=function(t,i,n,e){return this.sendMessage("signal",t,i,n,void 0,e)},un.prototype.sendPB=function(t){return!1},un);function un(t,i,n){this.Zt=t,this.$t=i,this.rtm=n,this.cmdSeq=0,this.responseRouters={},this.service=new rn(this.Zt.ENV)}cn.prototype.setSetting=function(t,i){var n,e=Array.isArray(i)&&0<i.length;for(n in t){var s,r=t[n];if(Object(L.d)(r.ctrlmode)&&[1,2].includes(r.ctrlmode))this.setting[n]=r,this.setting[n+"_ctrlmode"]=r.ctrlmode;else for(var o in r)o.endsWith("_ctrlmode")||e&&-1==i.indexOf(o)||(1===(s=r[o+"_ctrlmode"])||2===s?this.setting[o]=r[o]:this.defaultSetting[o]&&(this.setting[o]=this.defaultSetting[o]),Object(L.d)(s)&&(this.setting[o+"_ctrlmode"]=r[o+"_ctrlmode"]))}},cn.prototype.getSetting=function(t,i){return(i=void 0!==i&&i)&&2!=this.setting[t+"_ctrlmode"]?void 0:this.setting[t]};var hn=cn;function cn(){this.defaultSetting={remote_log_level:"info",zip_log:0,detaillog_domain:""},this.requestList={},this.setting=JSON.parse(JSON.stringify(this.defaultSetting))}const an=n(3);i=n(1),an.util.Long=i,an.util.Long.fromBits=an.util.Long?an.util.Long.fromBits:function(){return 0};const fn=an.roots,ln=an.types?an.types.basic:{double:1,float:5,int32:0,uint32:0,sint32:0,fixed32:5,sfixed32:5,int64:0,uint64:0,sint64:0,fixed64:1,sfixed64:1,bool:0,string:2,bytes:2},_n=an.types?an.types.packed:{double:1,float:5,int32:0,uint32:0,sint32:0,fixed32:5,sfixed32:5,int64:0,uint64:0,sint64:0,fixed64:1,sfixed64:1,bool:0};var dn=Object.keys(ln),vn={$:function(t){return vn[t]?vn[t].call(this):fn[t].decode?fn[t].decode(this,this.uint32()):vn.$.call(this,"int32")}},mn={$:function(t,i,n){var e=ln[t];return void 0===e?fn[t].encode?(this.uint32((n<<3|2)>>0).fork(),fn[t].encode(i,this).ldelim()):mn.$.call(this,"int32",i,n):mn[t].call(this.uint32(n<<3|e),i)}};for(let t=0;t<dn.length;t++)vn[dn[t]]=an.Reader.prototype[dn[t]],mn[dn[t]]=an.Writer.prototype[dn[t]];!function t(i,n,e,s){for(let o=0,u=Object.keys(i);o<u.length;o++){var r=u[o];if(i[r].$m&&Object.keys(i[r].$m).every((function(t){return Number(t)}))){if(e[r])throw Error(`nested type ${e}.${r} has already exist`);e[r]=function(i,e){function s(t){for(const t in i){var n=i[t];"{"===n[1].charAt(0)?this[n[0]]={}:"["!==n[1].charAt(0)&&"<"!==n[1].charAt(0)||(this[n[0]]=[])}if(t)for(let i=Object.keys(t),n=0;n<i.length;++n)null!=t[i[n]]&&(this[i[n]]=t[i[n]])}var r={};for(const t in i){var o=i[t],u=o[1];"{"===u.charAt(0)?(s.prototype[o[0]]=an.util.emptyObject,r[u]={$m:u.substring(1).split(",").map((function(t,i){return["$"+(i+1),t,null]})).reduce((function(t,i,n){return t[n+1]=i,t}),{})}):"["===u.charAt(0)||"<"===u.charAt(0)?s.prototype[o[0]]=an.util.emptyArray:"bytes"===u?s.prototype[o[0]]=an.util.newBuffer([]):o[2]&&o[2].hasOwnProperty("low")&&o[2].hasOwnProperty("high")?s.prototype[o[0]]=an.util.Long.fromBits(o[2].low,o[2].high,o[2].unsigned):s.prototype[o[0]]=o[2]}return s.create=function(t){return new s(t)},s.decode=function(t,n){t instanceof an.Reader||(t=an.Reader.create(t));for(var e=void 0===n?t.len:t.pos+n,r=new s;t.pos<e;){var o=t.uint32(),u=o>>>3;if(0<u&&i[u]){var h=i[u][0];let n=i[u][1];if("{"===n.charAt(0))r[h]===an.util.emptyObject&&(r[h]={}),u=s.$namespace[n].decode(t,t.uint32()),r[h][u.$1]=u.$2;else if("["===n.charAt(0)||"<"===n.charAt(0))if(n=n.substring(1),r[h]&&r[h].length||(r[h]=[]),n=(u=!vn[n]&&!fn[n].decode)?"int32":n,void 0!==_n[n]&&2==(7&o))for(var c=t.uint32()+t.pos;t.pos<c;)r[h].push(vn.$.call(t,n));else r[h].push(vn.$.call(t,n));else r[h]=vn.$.call(t,n)}else t.skipType(7&o)}return r},s.encode=function(t,n){n=n||an.Writer.create();for(const c in i){var e=i[c][0];let a=i[c][1];if("{"===a.charAt(0)){if(null!=t[e]&&t.hasOwnProperty(e))for(var r=0,o=Object.keys(t[e]);r<o.length;++r)n.uint32((c<<3|2)>>0).fork(),s.$namespace[a].encode({$1:o[r],$2:t[e][o[r]]},n).ldelim()}else if("["===a.charAt(0)||"<"===a.charAt(0)){var u="<"===a.charAt(0),h=(a=a.substring(1),t[e]);if(null!=h&&h.length)if(a=void 0===ln[a]&&!fn[a].encode?"int32":a,u&&void 0!==_n[a]){for(n.uint32((c<<3|2)>>0).fork(),r=0;r<h.length;r++)mn[a].call(n,h[r]);n.ldelim()}else for(r=0;r<h.length;r++)mn.$.call(n,a,h[r],c)}else null!=t[e]&&t.hasOwnProperty(e)&&mn.$.call(n,a,t[e],c)}return n},Object.keys(r).length&&(s.$namespace=t(r,n+"."+e,s.$namespace||{},!0)),s}(i[r].$m,r)}else i[r].$s?e[r]=function(t,i){function e(t,i,n){an.rpc.Service.call(this,t,i,n)}return((e.prototype=Object.create(an.rpc.Service.prototype)).constructor=e).create=function(t,i,n){return new e(t,i,n)},Object.keys(t).forEach((function(s){const r=t[s];function o(t,i){return this.rpcCall(o,fn[r[0]],fn[r[1]],t,i)}Object.defineProperty(o,"name",{value:s}),Object.defineProperty(o,"path",{value:n+"."+i}),e.prototype[s]=o})),e}(i[r].$s,r):i[r].$e&&Object.values(i[r].$e).every((function(t){return Number(t)===t}))&&(e[r]=function(t){var i=Object.keys(t),n={};for(let e=0;e<i.length;e++)n[n[i[e]]=t[i[e]]]=i[e];return n}(i[r].$e));e[r]&&!s&&(fn[n+"."+r]=e[r]),delete i[r].$m,delete i[r].$s,delete i[r].$e,e[r]=t(i[r],n?n+"."+r:r,e[r]||{})}return e}({liveroom:{liveroom_cs_v3:{AddStreamReq:{$m:{1:["stream_id","bytes",[]],2:["stream_title","bytes",[]],3:["stream_type","uint32",0],4:["stream_attr","bytes",[]],5:["extra_info","bytes",[]],6:["client_req_seq","uint32",0],7:["third_token","bytes",[]],8:["censor_mode","uint32",0],9:["need_gather","uint32",0]}},AddStreamRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null],2:["stream_seq","uint32",0],3:["stream_sid","string",""],4:["stream_ver","uint32",0],5:["stream_nid","uint32",0],6:["token_remain_time","uint32",0]}},AnchorInfo:{$m:{1:["id_name","bytes",[]],2:["user_id","uint64",{low:0,high:0,unsigned:!0}],3:["nick_name","bytes",[]]}},BigImData:{$m:{1:["id_name","bytes",[]],2:["nick_name","bytes",[]],3:["role","uint32",0],4:["msg_id","bytes",[]],5:["msg_category","uint32",0],6:["msg_type","uint32",0],7:["msg_content","bytes",[]],8:["msg_timestamp","int64",{low:0,high:0,unsigned:!1}]}},CommonRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null]}},DeleteStreamReq:{$m:{1:["stream_sid","string",""],2:["stream_id","bytes",[]],3:["client_req_seq","uint32",0]}},DeleteStreamRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null],2:["stream_seq","uint32",0],3:["stream_ver","uint32",0]}},EnterRoomReq:{$m:{1:["net_type","uint32",0],2:["conn_type","uint32",0],3:["room_id","bytes",[]],4:["room_name","bytes",[]],5:["role","uint32",0],6:["third_token","bytes",[]],7:["room_create_flag","uint32",0],8:["user_state_flag","uint32",0],9:["user_count_limit","uint32",0],10:["relate_service","string",""],11:["need_gather_stream","uint32",0],12:["callback_data","bytes",[]],13:["service_flags","uint32",0],14:["license_token","bytes",[]]}},EnterRoomRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null],2:["user_session_id","uint64",{low:0,high:0,unsigned:!0}],3:["room_session_id","uint64",{low:0,high:0,unsigned:!0}],4:["user_id","uint64",{low:0,high:0,unsigned:!0}],5:["ret_timestamp","int64",{low:0,high:0,unsigned:!1}],6:["big_im_time_window","uint32",0],7:["liveroom_hb_interval","uint32",0],8:["liveroom_hb_timeout","uint32",0],9:["online_count","uint32",0],10:["anchor_info","liveroom.liveroom_cs_v3.AnchorInfo",null],11:["userlist_merge_timeout","uint32",0],12:["userlist_interval","uint32",0],13:["token_remain_time","uint32",0],14:["trans_list_seq","uint32",0],15:["trans_channel_list","<liveroom.liveroom_cs_v3.TransChannel",null],16:["stream_count","uint32",0],17:["stream_list_seq","uint32",0],18:["stream_info_list","<liveroom.liveroom_cs_v3.StreamInfo",null],19:["stream_fetch_flag","uint32",0],20:["stream_list_push_merge_timeout","uint32",0],21:["stream_list_hb_merge_timeout","uint32",0],22:["relate_result_list","<liveroom.liveroom_cs_v3.RelateResult",null],23:["gather_list_seq","uint32",0],24:["gather_info_list","<liveroom.liveroom_cs_v3.GatherInfo",null]}},EnumSignalTransmitResult:{$e:{ok:0,version_err:1}},GatherInfo:{$m:{1:["gather_id","string",""]}},GetGatherListReq:{$m:{}},GetGatherListRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null],2:["gather_list_seq","uint32",0],3:["gather_info_list","<liveroom.liveroom_cs_v3.GatherInfo",null]}},GetImReq:{$m:{1:["msg_id","uint64",{low:0,high:0,unsigned:!0}],2:["sort_type","uint32",0],3:["msg_count","uint32",0]}},GetImRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null],2:["server_msg_id","uint64",{low:0,high:0,unsigned:!0}],3:["ret_msg_id","uint64",{low:0,high:0,unsigned:!0}],4:["msg_list","<liveroom.liveroom_cs_v3.GetImRspImData",null]}},GetImRspImData:{$m:{1:["id_name","bytes",[]],2:["nick_name","bytes",[]],3:["role","uint32",0],4:["msg_id","uint64",{low:0,high:0,unsigned:!0}],5:["msg_category","uint32",0],6:["msg_type","uint32",0],7:["msg_content","bytes",[]],8:["send_time","int64",{low:0,high:0,unsigned:!1}]}},GetStreamListReq:{$m:{}},GetStreamListRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null],2:["stream_list_seq","uint32",0],3:["stream_info_list","<liveroom.liveroom_cs_v3.StreamInfo",null],4:["stream_refresh","uint32",0]}},GetTransReq:{$m:{1:["trans_channel","bytes",[]],2:["trans_list","<liveroom.liveroom_cs_v3.GetTransReqTransData",null]}},GetTransReqTransData:{$m:{1:["trans_type","bytes",[]],2:["trans_local_seq","uint32",0]}},GetTransRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null],2:["trans_channel","bytes",[]],3:["trans_list_seq","uint32",0],4:["trans_list","<liveroom.liveroom_cs_v3.GetTransRspTransData",null]}},GetTransRspTransData:{$m:{1:["err_code","uint32",0],2:["trans_type","bytes",[]],3:["trans_data","bytes",[]],4:["trans_send_time","int64",{low:0,high:0,unsigned:!1}],5:["trans_seq","uint32",0],6:["id_name","bytes",[]],7:["nick_name","bytes",[]],8:["role","uint32",0]}},GetUserlistReq:{$m:{1:["sort_type","uint32",0],2:["user_index","uint32",0]}},GetUserlistRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null],2:["server_user_seq","uint64",{low:0,high:0,unsigned:!0}],3:["server_user_index","int64",{low:0,high:0,unsigned:!1}],4:["ret_user_index","int64",{low:0,high:0,unsigned:!1}],5:["user_base_info_list","<liveroom.liveroom_cs_v3.UserBaseInfo",null]}},GetUserTransReq:{$m:{1:["trans_channel","bytes",[]],2:["user_trans_list","<liveroom.liveroom_cs_v3.GetUserTransReqTransData",null]}},GetUserTransReqTransData:{$m:{1:["trans_type","bytes",[]],2:["trans_local_seq","uint32",0]}},GetUserTransRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null],2:["trans_channel","bytes",[]],3:["user_trans_list","<liveroom.liveroom_cs_v3.GetUserTransRspTransData",null]}},GetUserTransRspTransData:{$m:{1:["err_code","uint32",0],2:["trans_type","bytes",[]],3:["trans_data","bytes",[]],4:["trans_send_time","int64",{low:0,high:0,unsigned:!1}],5:["trans_seq","uint32",0],6:["id_name","bytes",[]],7:["nick_name","bytes",[]],8:["role","uint32",0]}},HbReq:{$m:{}},HbRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null],2:["ret_timestamp","int64",{low:0,high:0,unsigned:!1}],3:["hb_interval","uint32",0],4:["hb_timeout","uint32",0],5:["stream_seq","uint32",0],6:["user_seq","int64",{low:0,high:0,unsigned:!1}],7:["online_count","uint32",0],8:["big_im_time_window","uint32",0],9:["trans_channel_list","<liveroom.liveroom_cs_v3.TransChannel",null],10:["user_trans_channel_list","<liveroom.liveroom_cs_v3.TransChannel",null],11:["stream_refresh","uint32",0],12:["trans_list_seq","uint32",0],13:["gather_list_seq","uint32",0]}},ImData:{$m:{1:["id_name","bytes",[]],2:["nick_name","bytes",[]],3:["role","uint32",0],4:["msg_id","uint64",{low:0,high:0,unsigned:!0}],5:["msg_category","uint32",0],6:["msg_type","uint32",0],7:["msg_content","bytes",[]],8:["send_time","int64",{low:0,high:0,unsigned:!1}]}},LiveroomSessionInfo:{$m:{1:["RoomId","bytes",[]],2:["UserSessionId","uint64",{low:0,high:0,unsigned:!0}],3:["RoomSessionId","uint64",{low:0,high:0,unsigned:!0}],4:["Role","uint32",0]}},PushBigIm:{$m:{1:["msg_list","<liveroom.liveroom_cs_v3.BigImData",null]}},PushIm:{$m:{1:["server_msg_id","uint64",{low:0,high:0,unsigned:!0}],2:["ret_msg_id","uint64",{low:0,high:0,unsigned:!0}],4:["msg_list","<liveroom.liveroom_cs_v3.ImData",null]}},PushStartGather:{$m:{1:["gather_id","string",""],2:["gather_seq","uint32",0]}},PushStopGather:{$m:{1:["gather_id","string",""],2:["gather_seq","uint32",0]}},PushStream:{$m:{1:["stream_seq","uint32",0],2:["stream_info_list","<liveroom.liveroom_cs_v3.PushStreamInfo",null]}},PushStreamInfo:{$m:{1:["stream_id","bytes",[]],2:["stream_sid","string",""],3:["id_name","bytes",[]],4:["nick_name","bytes",[]],5:["stream_title","bytes",[]],6:["stream_ver","uint32",0],7:["stream_attr","bytes",[]],8:["stream_src","uint32",0],9:["stream_state","uint32",0],10:["stream_type","uint32",0],11:["stream_nid","uint32",0],12:["extra_info","bytes",[]],13:["create_time","int64",{low:0,high:0,unsigned:!1}],14:["close_type","uint32",0],15:["need_gather","uint32",0]}},PushTrans:{$m:{1:["id_name","bytes",[]],2:["nick_name","bytes",[]],3:["role","uint32",0],4:["trans_type","bytes",[]],5:["trans_data","bytes",[]],6:["trans_seq","uint32",0],7:["trans_send_time","int64",{low:0,high:0,unsigned:!1}],8:["trans_channel","bytes",[]],9:["trans_list_seq","uint32",0]}},PushUserInfoUpdated:{$m:{1:["server_user_seq","int64",{low:0,high:0,unsigned:!1}],2:["user_action_list","<liveroom.liveroom_cs_v3.UserAction",null]}},PushUserKickout:{$m:{1:["id_name","bytes",[]],2:["user_session_id","uint64",{low:0,high:0,unsigned:!0}],3:["kickout_reason","int32",0],4:["custom_reason","bytes",[]]}},PushUserLogReport:{$m:{}},PushUserTokenExpire:{$m:{1:["token","string",""],2:["stop_stream_info","liveroom.liveroom_cs_v3.StopStream",null]}},PushUserTrans:{$m:{1:["id_name","bytes",[]],2:["nick_name","bytes",[]],3:["role","uint32",0],4:["trans_send_time","int64",{low:0,high:0,unsigned:!1}],5:["trans_channel","bytes",[]],6:["trans_seq_list","<liveroom.liveroom_cs_v3.PushUserTransInfo",null]}},PushUserTransInfo:{$m:{1:["trans_type","bytes",[]],2:["trans_data","bytes",[]],3:["trans_seq","uint32",0]}},QuitRoomReq:{$m:{}},QuitRoomRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null]}},RelateResult:{$m:{1:["service","string",""],2:["relate_result","uint32",0]}},RenewTokenReq:{$m:{1:["token","string",""]}},RenewTokenRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null],2:["token_remain_time","uint32",0],3:["stop_stream_id_list","<bytes",null]}},RspHead:{$m:{1:["code","uint32",0],2:["message","string",""]}},SendBigImReq:{$m:{1:["msg_list","<liveroom.liveroom_cs_v3.SendBigImReqMsgData",null]}},SendBigImReqMsgData:{$m:{1:["msg_category","uint32",0],2:["msg_type","uint32",0],3:["msg_content","bytes",[]],4:["msg_timestamp","int64",{low:0,high:0,unsigned:!1}],5:["msg_client_id","bytes",[]]}},SendBigImRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null],2:["big_im_time_window","uint32",0],3:["msg_list","<liveroom.liveroom_cs_v3.SendBigImRspMsgData",null]}},SendBigImRspMsgData:{$m:{1:["msg_id","bytes",[]],2:["msg_client_id","bytes",[]]}},SendImReq:{$m:{1:["msg_category","uint32",0],2:["msg_type","uint32",0],3:["msg_content","bytes",[]],4:["to_user_list","<liveroom.liveroom_cs_v3.ToUser",null]}},SendImRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null],2:["msg_id","uint64",{low:0,high:0,unsigned:!0}]}},SetTransReq:{$m:{1:["trans_type","bytes",[]],2:["trans_data","bytes",[]],3:["trans_local_seq","uint32",0],4:["trans_channel","bytes",[]]}},SetTransRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null],2:["trans_type","bytes",[]],3:["trans_seq","uint32",0],4:["trans_list_seq","uint32",0],5:["trans_channel","bytes",[]]}},SetUserAttrReq:{$m:{1:["use_data_channel","uint32",0],2:["is_modify_use_data_channel","bool",!1],3:["user_type","uint32",0],4:["is_modify_user_type","bool",!1]}},SetUserAttrRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null]}},SignalLiveCustomReq:{$m:{1:["push_message","bytes",[]],2:["to_user_list","<liveroom.liveroom_cs_v3.ToUser",null]}},SignalLiveCustomRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null]}},SignalLiveInviteReq:{$m:{1:["push_message","bytes",[]],2:["to_user_list","<liveroom.liveroom_cs_v3.ToUser",null]}},SignalLiveInviteRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null]}},SignalLiveRequestReq:{$m:{1:["push_message","bytes",[]],2:["to_user_list","<liveroom.liveroom_cs_v3.ToUser",null]}},SignalLiveRequestRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null]}},SignalLiveResultReq:{$m:{1:["push_message","bytes",[]],2:["to_user_list","<liveroom.liveroom_cs_v3.ToUser",null]}},SignalLiveResultRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null]}},SignalLiveStopReq:{$m:{1:["push_message","bytes",[]],2:["to_user_list","<liveroom.liveroom_cs_v3.ToUser",null]}},SignalLiveStopRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null]}},SignalTransmitReq:{$m:{1:["to_user_list","<bytes",null],2:["transmit_data","bytes",[]]}},SignalTransmitResult:{$m:{1:["to_user","bytes",[]],2:["result","liveroom.liveroom_cs_v3.EnumSignalTransmitResult",0]}},SignalTransmitRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null],2:["result","<liveroom.liveroom_cs_v3.SignalTransmitResult",null]}},StopStream:{$m:{1:["stream_id_list","<bytes",null]}},StreamInfo:{$m:{1:["stream_id","bytes",[]],2:["stream_sid","string",""],3:["id_name","bytes",[]],4:["nick_name","bytes",[]],5:["stream_title","bytes",[]],6:["stream_ver","uint32",0],7:["stream_attr","bytes",[]],8:["create_time","int64",{low:0,high:0,unsigned:!1}],9:["stream_src","uint32",0],10:["stream_state","uint32",0],11:["stream_type","uint32",0],12:["stream_nid","uint32",0],13:["extra_info","bytes",[]],14:["need_gather","uint32",0]}},ToUser:{$m:{1:["id_name","bytes",[]],2:["user_id","uint64",{low:0,high:0,unsigned:!0}]}},TransChannel:{$m:{1:["trans_channel","bytes",[]],2:["trans_seq_list","<liveroom.liveroom_cs_v3.TransSeq",null]}},TransSeq:{$m:{1:["trans_type","bytes",[]],2:["trans_seq","uint32",0]}},UpdateStreamReq:{$m:{1:["stream_sid","string",""],2:["stream_id","bytes",[]],3:["stream_title","bytes",[]],4:["stream_attr","bytes",[]],5:["extra_info","bytes",[]],6:["client_req_seq","uint32",0],7:["nick_name","bytes",[]]}},UpdateStreamRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null],2:["stream_seq","uint32",0],3:["stream_ver","uint32",0]}},UserAction:{$m:{1:["action","uint32",0],2:["id_name","bytes",[]],3:["nick_name","bytes",[]],4:["role","uint32",0],5:["login_time","int64",{low:0,high:0,unsigned:!1}]}},UserBaseInfo:{$m:{1:["id_name","bytes",[]],2:["nick_name","bytes",[]],3:["role","uint32",0]}}},proto_switch_v3:{AnchorInfo:{$m:{1:["id_name","bytes",[]],2:["user_id","uint64",{low:0,high:0,unsigned:!0}],3:["nick_name","bytes",[]]}},CommonRsp:{$m:{1:["rsp_head","liveroom.proto_switch_v3.RspHead",null]}},GatherInfo:{$m:{1:["gather_id","string",""]}},Header:{$m:{1:["cmd","uint32",0],2:["seq","uint32",0],3:["timestamp","int64",{low:0,high:0,unsigned:!1}],4:["controls","bytes",[]],5:["flags","bytes",[]],6:["context_key","uint32",0],101:["dev_traffic_label","bytes",[]]}},LiveroomProtoVersion:{$e:{PROTO_VERSION_NONE:0,RPOTO_V020000:131072}},LoginRoomReq:{$m:{1:["app_id","uint32",0],2:["biz_type","uint32",0],3:["room_id","bytes",[]],4:["room_name","bytes",[]],5:["role","uint32",0],6:["id_name","bytes",[]],7:["nick_name","bytes",[]],8:["device_id","string",""],9:["term_type","liveroom.proto_switch_v3.TermType",0],10:["net_type","liveroom.proto_switch_v3.NetType",0],11:["sdk_conn_type","liveroom.proto_switch_v3.SdkConnType",0],12:["sdk_version","uint32",0],13:["biz_version","string",""],14:["client_stamp","bytes",[]],15:["login_logic","uint32",0],16:["third_token","bytes",[]],17:["login_token","bytes",[]],18:["relogin_token","bytes",[]],19:["switch_session_id","uint64",{low:0,high:0,unsigned:!0}],20:["user_session_id","uint64",{low:0,high:0,unsigned:!0}],21:["room_create_flag","uint32",0],22:["user_state_flag","uint32",0],23:["user_count_limit","uint32",0],24:["relate_service","string",""],25:["need_gather_stream","uint32",0],26:["callback_data","bytes",[]],27:["service_flags","uint32",0],28:["license_token","bytes",[]],29:["relogin_type","liveroom.proto_switch_v3.ReloginType",0]}},LoginRoomRsp:{$m:{1:["rsp_head","liveroom.proto_switch_v3.RspHead",null],2:["switch_session_id","uint64",{low:0,high:0,unsigned:!0}],3:["user_session_id","uint64",{low:0,high:0,unsigned:!0}],4:["room_session_id","uint64",{low:0,high:0,unsigned:!0}],5:["user_id","uint64",{low:0,high:0,unsigned:!0}],6:["ret_timestamp","int64",{low:0,high:0,unsigned:!1}],7:["big_im_time_window","uint32",0],8:["liveroom_hb_interval","uint32",0],9:["liveroom_hb_timeout","uint32",0],10:["online_count","uint32",0],11:["anchor_info","liveroom.proto_switch_v3.AnchorInfo",null],12:["relogin_token","bytes",[]],13:["userlist_merge_timeout","uint32",0],14:["userlist_interval","uint32",0],15:["token_remain_time","uint32",0],16:["trans_list_seq","uint32",0],17:["trans_channel_list","<liveroom.proto_switch_v3.TransChannel",null],18:["stream_count","uint32",0],19:["stream_list_seq","uint32",0],20:["stream_info_list","<liveroom.proto_switch_v3.StreamInfo",null],21:["stream_fetch_flag","uint32",0],22:["stream_list_push_merge_timeout","uint32",0],23:["stream_list_hb_merge_timeout","uint32",0],24:["relate_result_list","<liveroom.proto_switch_v3.RelateResult",null],25:["gather_list_seq","uint32",0],26:["gather_info_list","<liveroom.proto_switch_v3.GatherInfo",null]}},LogoutRoomReq:{$m:{2:["logout_check","bytes",[]]}},LogoutRoomRsp:{$m:{1:["rsp_head","liveroom.proto_switch_v3.RspHead",null]}},MergePushHead:{$m:{1:["qos_flag","uint32",0],2:["send_time","int64",{low:0,high:0,unsigned:!1}]}},MergePushInfo:{$m:{1:["sub_cmd","uint32",0],2:["sub_seq","uint32",0],3:["msg_body","bytes",[]]}},MergePushReq:{$m:{1:["head","liveroom.proto_switch_v3.MergePushHead",null],2:["message_list","<liveroom.proto_switch_v3.MergePushInfo",null]}},MergePushRsp:{$m:{1:["message_list","<liveroom.proto_switch_v3.MergePushRspInfo",null],2:["server_send_time","int64",{low:0,high:0,unsigned:!1}]}},MergePushRspInfo:{$m:{1:["sub_cmd","uint32",0],2:["sub_seq","uint32",0]}},NetType:{$e:{NT_NONE:0,NT_LINE:1,NT_WIFI:2,NT_2G:3,NT_3G:4,NT_4G:5,NT_UNKNOWN:32}},PushKickout:{$m:{1:["reason","uint32",0],2:["message","string",""],3:["is_need_relogin","uint32",0]}},PushReq:{$m:{1:["head","liveroom.proto_switch_v3.PushReqHead",null],2:["msg_body","bytes",[]]}},PushReqHead:{$m:{1:["sub_cmd","uint32",0],2:["qos_flag","uint32",0],3:["send_time","int64",{low:0,high:0,unsigned:!1}]}},PushRsp:{$m:{1:["code","uint32",0],2:["message","string",""],3:["sub_cmd","uint32",0],4:["server_send_time","int64",{low:0,high:0,unsigned:!1}]}},RelateResult:{$m:{1:["service","string",""],2:["relate_result","uint32",0]}},ReloginType:{$e:{ReloginType_None:0,ReloginType_SdkAuto:1}},RspHead:{$m:{1:["code","uint32",0],2:["message","string",""]}},SdkConnType:{$e:{SdkConnType_None:0,SdkConnType_Tcp:1,SdkConnType_Websocket:2}},StreamInfo:{$m:{1:["stream_id","bytes",[]],2:["stream_sid","string",""],3:["id_name","bytes",[]],4:["nick_name","bytes",[]],5:["create_time","int64",{low:0,high:0,unsigned:!1}],6:["extra_info","bytes",[]],7:["title","bytes",[]],8:["stream_ver","uint32",0],9:["stream_attr","bytes",[]],10:["stream_src","uint32",0],11:["stream_state","uint32",0],12:["stream_type","uint32",0],13:["stream_nid","uint32",0],14:["need_gather","uint32",0]}},TermType:{$e:{TT_NONE:0,TT_PC:1,TT_IOS:2,TT_ANDROID:3,TT_MAC:4,TT_LINUX:5,TT_WEB:6,TT_MINI_PROGRAM:7,TT_UNKNOWN:32}},TransChannel:{$m:{1:["trans_channel","bytes",[]],2:["trans_seq_list","<liveroom.proto_switch_v3.TransSeq",null]}},TransSeq:{$m:{1:["trans_type","bytes",[]],2:["trans_seq","uint32",0]}}},webproxy:{HTTPHeader:{$m:{1:["name","string",""],2:["val","string",""]}},HTTPRequest:{$m:{1:["appid","uint32",0],2:["biz_type","uint32",0],3:["mode","liveroom.webproxy.Mode",0],4:["id_name","string",""],5:["token","string",""],6:["url","string",""],7:["method","liveroom.webproxy.Method",0],8:["headers","<liveroom.webproxy.HTTPHeader",null],9:["body","bytes",[]]}},HTTPResponse:{$m:{1:["code","int32",0],2:["message","string",""],3:["data","liveroom.webproxy.HTTPResponseData",null]}},HTTPResponseData:{$m:{1:["status_code","int32",0],2:["headers","<liveroom.webproxy.HTTPHeader",null],3:["body","bytes",[]]}},IntranetCheckRequest:{$m:{1:["appid","uint32",0],2:["biz_type","uint32",0],3:["mode","liveroom.webproxy.Mode",0],4:["id_name","string",""],5:["token","string",""],6:["vrs_ipv4","fixed32",0],7:["vrs_ipv6","liveroom.webproxy.IPv6Addr",null]}},IntranetCheckResponse:{$m:{1:["code","int32",0],2:["message","string",""],3:["data","liveroom.webproxy.IntranetCheckResponseData",null]}},IntranetCheckResponseData:{$m:{1:["intranet","bool",!1]}},IPv6Addr:{$m:{1:["high","fixed64",{low:0,high:0,unsigned:!1}],2:["low","fixed64",{low:0,high:0,unsigned:!1}]}},Method:{$e:{METHOD_UNSET:0,METHOD_GET:1,METHOD_POST:2,METHOD_PUT:3,METHOD_PATCH:4,METHOD_DELETE:5,METHOD_HEAD:6,METHOD_OPTIONS:7}},Mode:{$e:{MODE_UNSET:0,MODE_ONLINE:1,MODE_TEST:2}},TurnInfoRequest:{$m:{1:["appid","uint32",0],2:["biz_type","uint32",0],3:["mode","liveroom.webproxy.Mode",0],4:["id_name","string",""],5:["token","string",""]}},TurnInfoResponse:{$m:{1:["code","int32",0],2:["message","string",""],3:["data","liveroom.webproxy.TurnInfoResponseData",null]}},TurnInfoResponseData:{$m:{1:["username","string",""],2:["password","string",""],3:["turn_ipv4","fixed32",0],4:["turn_ipv6","liveroom.webproxy.IPv6Addr",null],5:["turn_port","uint32",0],6:["expiration_in_seconds","uint32",0],7:["turn_internal_ipv4","fixed32",0]}},WssBindRequest:{$m:{1:["appid","uint32",0],2:["biz_type","uint32",0],3:["mode","liveroom.webproxy.Mode",0],4:["id_name","string",""],5:["token","string",""],6:["url","string",""],7:["ack","bool",!1]}},WssBindRequestAck:{$m:{}},WssBindResponse:{$m:{1:["code","int32",0],2:["message","string",""]}}}}},"",fn,!1);var gn,pn=fn.liveroom,bn={1002:"LoginRoomRsp",1004:"LogoutRoomRsp",1101:"PushReq",1103:"MergePushReq",1105:"PushKickout",10001:"PushUserInfoUpdated",10002:"PushUserKickout",10003:"PushUserLogReport",10004:"PushUserTokenExpire",12001:"PushStream",12002:"PushStream",12003:"PushStream",13001:"PushIm",14001:"PushBigIm",15001:"PushTrans",15002:"PushUserTrans",301002:"EnterRoomRsp",301004:"QuitRoomRsp",301006:"HbRsp",301008:"RenewTokenRsp",301012:"SetTransRsp",301014:"GetTransRsp",302002:"AddStreamRsp",302004:"DeleteStreamRsp",302006:"UpdateStreamRsp",302008:"GetStreamListRsp",303002:"SendImRsp",303006:"SendBigImRsp",303010:"SignalLiveRequestRsp",303012:"SignalLiveResultRsp",303014:"SignalLiveInviteRsp",303016:"SignalLiveStopRsp",303018:"SignalLiveCustomRsp",304002:"GetUserlistRsp"},En=(i=((i=gn=gn||{})[i.LoginRoomReq=1001]="LoginRoomReq",i[i.LoginRoomRsp=1002]="LoginRoomRsp",i[i.LogoutRoomReq=1003]="LogoutRoomReq",i[i.LogoutRoomRsp=1004]="LogoutRoomRsp",i[i.PushReq=1101]="PushReq",i[i.PushRsp=1102]="PushRsp",i[i.MergePushReq=1103]="MergePushReq",i[i.MergePushRsp=1104]="MergePushRsp",i[i.PushKickout=1105]="PushKickout",i[i.PushUserInfoUpdated=10001]="PushUserInfoUpdated",i[i.PushUserKickout=10002]="PushUserKickout",i[i.PushUserLogReport=10003]="PushUserLogReport",i[i.PushUserTokenExpire=10004]="PushUserTokenExpire",i[i.PushIm=13001]="PushIm",i[i.PushBigIm=14001]="PushBigIm",i[i.PushTrans=15001]="PushTrans",i[i.PushUserTrans=15002]="PushUserTrans",i[i.EnterRoomReq=301001]="EnterRoomReq",i[i.EnterRoomRsp=301002]="EnterRoomRsp",i[i.QuitRoomReq=301003]="QuitRoomReq",i[i.QuitRoomRsp=301004]="QuitRoomRsp",i[i.HbReq=301005]="HbReq",i[i.HbRsp=301006]="HbRsp",i[i.RenewTokenReq=301007]="RenewTokenReq",i[i.RenewTokenRsp=301008]="RenewTokenRsp",i[i.SetUserAttrReq=301009]="SetUserAttrReq",i[i.SetUserAttrRsp=301010]="SetUserAttrRsp",i[i.SetTransReq=301011]="SetTransReq",i[i.SetTransRsp=301012]="SetTransRsp",i[i.GetTransReq=301013]="GetTransReq",i[i.GetTransRsp=301014]="GetTransRsp",i[i.GetUserTransReq=301015]="GetUserTransReq",i[i.GetUserTransRsp=301016]="GetUserTransRsp",i[i.AddStreamReq=302001]="AddStreamReq",i[i.AddStreamRsp=302002]="AddStreamRsp",i[i.DeleteStreamReq=302003]="DeleteStreamReq",i[i.DeleteStreamRsp=302004]="DeleteStreamRsp",i[i.UpdateStreamReq=302005]="UpdateStreamReq",i[i.UpdateStreamRsp=302006]="UpdateStreamRsp",i[i.GetStreamListReq=302007]="GetStreamListReq",i[i.GetStreamListRsp=302008]="GetStreamListRsp",i[i.SendImReq=303001]="SendImReq",i[i.SendImRsp=303002]="SendImRsp",i[i.GetImReq=303003]="GetImReq",i[i.GetImRsp=303004]="GetImRsp",i[i.SendBigImReq=303005]="SendBigImReq",i[i.SendBigImRsp=303006]="SendBigImRsp",i[i.SignalLiveRequestReq=303009]="SignalLiveRequestReq",i[i.SignalLiveRequestRsp=303010]="SignalLiveRequestRsp",i[i.SignalLiveResultReq=303011]="SignalLiveResultReq",i[i.SignalLiveResultRsp=303012]="SignalLiveResultRsp",i[i.SignalLiveInviteReq=303013]="SignalLiveInviteReq",i[i.SignalLiveInviteRsp=303014]="SignalLiveInviteRsp",i[i.SignalLiveStopReq=303015]="SignalLiveStopReq",i[i.SignalLiveStopRsp=303016]="SignalLiveStopRsp",i[i.SignalLiveCustomReq=303017]="SignalLiveCustomReq",i[i.SignalLiveCustomRsp=303018]="SignalLiveCustomRsp",i[i.SignalTransmitReq=303019]="SignalTransmitReq",i[i.SignalTransmitRsp=303020]="SignalTransmitRsp",i[i.GetUserlistReq=304001]="GetUserlistReq",i[i.GetUserlistRsp=304002]="GetUserlistRsp",n(3)),n(13)),yn=n.n(En),Sn=(En=n(5),n.n(En)),On=(Rn.prototype.md5Bytes=function(t){return this.wordArray2Uint8Array(Sn()(this.uint8Array2WordArray(t)))},Rn.prototype.wordArray2Uint8Array=function(t){for(var i=t.words,n=t.sigBytes,e=new Uint8Array(n),s=0;s<n;s++){var r=i[s>>>2]>>>24-s%4*8&255;e[s]=r}return e},Rn.prototype.uint8Array2WordArray=function(t){for(var i=t.length,n=[],e=0;e<i;e++)n[e>>>2]|=(255&t[e])<<24-e%4*8;return yn.a.create(n,i)},Rn);function Rn(){}function Tn(t){return i=escape||window.escape,decodeURIComponent(i(String.fromCharCode.apply(String,Array.from(t))));var i}var wn,Nn=function(t){return i=unescape||window.unescape,Uint8Array.from(Array.from(i(encodeURIComponent(t))).map((function(t){return t.charCodeAt(0)})));var i},In=(En=n(1),n.n(En)),Cn=function(){return(Cn=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var s in i=arguments[n])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t}).apply(this,arguments)},kn=(i.util.Long=In.a,i.configure(),pn),An=pn.liveroom_cs_v3,Dn=pn.proto_switch_v3,Pn=((En=wn=wn||{})[En.disconnected=0]="disconnected",En[En.broken=1]="broken",En[En.connected=2]="connected",Object.defineProperty(Mn.prototype,"nickName",{get:function(){return Nn(this.Zt.nickName)},enumerable:!1,configurable:!0}),Object.defineProperty(Mn.prototype,"TermType",{get:function(){return this.Zt.ENV%2==0?r.TT_WEB:r.TT_MINIPROGRAM},enumerable:!1,configurable:!0}),Object.defineProperty(Mn.prototype,"Qt",{get:function(){return this.Zt.reporter},enumerable:!1,configurable:!0}),Mn.prototype.isDisConnect=function(){return this._state!==wn.connected},Mn.prototype.getHeader=function(t,i){return t={cmd:t,seq:++this.seq,timestamp:(new Date).getTime()},this.controls&&(t.controls=this.controls),null!=i&&i.contextKey&&(t.context_key=null==i?void 0:i.contextKey),i=Dn.Header.create(t),i=Dn.Header.encode(i).finish(),[t.seq,i]},Mn.prototype.isUaConnect=function(){return this._ua.isConnect()},Mn.prototype.sendMessage=function(t,i,n,e,s,r,o){var u=this;if(void 0===r&&(r={timeout:6e3}),void 0===o&&(o=!0),this.$t.info(Ht+" call"),"LoginRoomReq"!==t&&this._state!==wn.connected)return this.$t.warn(Ht+" state "+this._state),e&&e(I.SOCKET_CLOSE),-1;if(Object(L.d)(t))a=t;else if(a=gn[t],Object(L.g)(a))return this.$t.warn(Ht+" cmd not found "+t),-1;var h=0,c=Object(L.g)(null==s?void 0:s.roomID)?null==(c=this.Zt.roomModulesList[0])?void 0:c.roomID:null==s?void 0:s.roomID,a=(c=("LoginRoomReq"!==t&&c&&(h=this._roomIDKeys[c]),this.getHeader(a,{contextKey:h})))[1];h=i,i=this.getHead(a.length,h.length),i=new Uint8Array(Array.from(i).concat(Array.from(a)).concat(Array.from(h)));return o&&(a={seq:this.seq,deleted:!1,sendTime:Date.parse(new Date+""),timeout:r.timeout,success:n,error:function(t,i,n){var s;if(u.$t.info(Ht+" seq: "+i+" "+JSON.stringify(t)+" "+JSON.stringify(n)),(null==(s=null==t?void 0:t.header)?void 0:s.cmd)!==gn.LoginRoomRsp&&-1<[1002,105].indexOf(null==(s=null==t?void 0:t.body)?void 0:s.err_code))return(null==(s=null==t?void 0:t.header)?void 0:s.cmd)===gn.EnterRoomRsp&&null!=n&&n.roomID?(s=u.Zt.roomModulesList.find((function(t){return t.roomID==n.roomID})))?void s.retryRoom():void u.$t.error(Ht+" room no found ignore "):void u.rtm.retryRoom();[207,208].indexOf(null==(s=null==t?void 0:t.body)?void 0:s.err_code),e&&e(t,i)},params:s},h=this.sendCommandList.push(a),this.sendCommandMap[a.seq]=h),this.$t.info(Ht+" seq: "+c[0]+" cmd: "+t),null!=(o=this.liveroomRequest)&&o.sendRequest({payload:i,ack:"LoginRoomReq"===t},(function(t){u.$t.info(Ht+" fail")}),(function(){u.$t.info(Ht+" ack")}),{}),c[0]},Mn.prototype.getHead=function(t,i){var n=new Uint8Array(7);return n[0]=49,n[1]=t>>8,n[2]=t-(n[1]<<8),n.set(new Uint8Array(Int32Array.from([i]).buffer).reverse(),3),n},Mn.prototype.handlePush=function(t,i){var n,e,s;49===t[0]&&(s=(t[1]<<8)+t[2],n=Dn.Header.decode(t.slice(7,7+s)),t=t.slice(7+s),bn[n.cmd]?(s=this.decodeResponseBody(n,t),this.swPushCmdList.includes(n.cmd)?this.handleSwitchPush(n,s):(e=bn[n.cmd]||n.cmd,this.$t.info("zm.lrh.hp down "+e+" "+JSON.stringify(this.transBuf(s))),e={header:this.transHeader(n),body:this.transRsp(s)},s=this._roomKeyIDs[n.context_key],Object(L.g)(s)||(e.header.room_id=s),this.handleSendCommandMsgRsp(e))):(this.$t.info("zm.lrh.hp cmd is not rtc"),this.onSwitchMessage(n,t)))},Mn.prototype.handleSwitchPush=function(t,i){var n,e,s=this._roomKeyIDs[t.context_key];if(s||this.noContextKeyCmdList.includes(t.cmd))if(t.cmd===gn.PushReq)if((e=this.transRsp(i.head)).room_id=s,this.Zt.roomModulesList.find((function(t){return t.roomID==s}))){var r,o,u,h=void 0,c={header:e,body:h=this.unStructCmdList.includes(i.head.sub_cmd)?{signal_msg:Tn(i.msg_body),sub_cmd:i.head.sub_cmd}:11005===i.head.sub_cmd?{custommsg:Tn(i.msg_body)}:bn[i.head.sub_cmd]?this.transRsp(this._decode(An[bn[i.head.sub_cmd]],i.msg_body)):{}};if(this.$t.info(Gt+" push "+JSON.stringify(this.transBuf(c))),this.rtcPushCmdList.includes(i.head.sub_cmd))switch(i.head.sub_cmd){case gn.PushUserInfoUpdated:this.handlePushUserStateUpdateMsg(c);break;case gn.PushUserKickout:this.transKeysName(c.body,this.loginKeyTransMap),this.handlePushKickout(c,!1);break;case gn.PushTrans:this.handlePushTransMsg(c);break;case gn.PushIm:this.handlePushRoomMsg(c);break;case 11005:this.handlePushCustomMsg(c);break;case 12001:case 12002:case 12003:this.handlePushStreamMsg(c);break;case 11001:case 11002:case 11003:case 11004:this.handlePushSignalMsg(c);break;case gn.PushUserTokenExpire:this.handlePushTokenExpire(c)}else this.$t.info(Gt+" white "),this.onSwitchMessage(t,i);1==i.head.qos_flag&&(r={code:0,message:"",sub_cmd:i.head.sub_cmd,server_send_time:i.head.send_time},o=Dn.PushRsp.create(r),u=Dn.PushRsp.encode(o).finish(),this.sendMessage("PushRsp",u,void 0,void 0))}else this.$t.warn(Gt+" room no found ignore ");else t.cmd===gn.MergePushReq?((e=this.transRsp(i.head)).room_id=s,this.Zt.roomModulesList.find((function(t){return t.roomID==s}))?(n=[],i.message_list.forEach((function(t){var i;n.push({sub_cmd:t.sub_cmd,sub_seq:t.sub_seq}),t.sub_cmd===gn.PushBigIm&&(i=An.PushBigIm.decode(t.msg_body),t.msg_body=i)})),delete(e={header:e,body:h=this.transRsp(i)}).body.head,this.handlePushMergeMsg(e),1==i.head.qos_flag&&(r={messages:n,server_send_time:i.head.send_time},o=Dn.MergePushRsp.create(r),u=Dn.MergePushRsp.encode(o).finish(),this.sendMessage("MergePushRsp",u,void 0,void 0))):this.$t.warn(Gt+" room no found ignore ")):t.cmd===gn.PushKickout&&(h={reason:900<i.reason?i.reason-900:i.reason,msg:i.message,need_relogin:void 0!==i.is_need_relogin?i.is_need_relogin:0},this.handlePushKickout({header:t,body:h},!0));else this.$t.warn(Gt+" ctx key not found")},Mn.prototype.handlePushTokenExpire=function(t){},Mn.prototype.handlePushKickout=function(t,i){},Mn.prototype.handlePushStreamMsg=function(t){},Mn.prototype.handlePushSignalMsg=function(t){},Mn.prototype.handlePushMergeMsg=function(t){},Mn.prototype.handlePushCustomMsg=function(t){},Mn.prototype.handlePushRoomMsg=function(t){},Mn.prototype.handlePushTransMsg=function(t){},Mn.prototype.onSwitchMessage=function(t,i){},Mn.prototype.decodeResponseBody=function(t,i){var n=this.onSwitchCmdList.includes(t.cmd)?"proto_switch_v3":"liveroom_cs_v3";return this._decode(this._protoInstance[n][bn[t.cmd]],i)},Mn.prototype.handlePushUserStateUpdateMsg=function(t){},Mn.prototype.login=function(t,i,n){var e,s,r,o,u,h=this,a=(this._state==wn.disconnected&&(this.$t.info(qt+" state disconnect"),this.closeRequest()),(new Date).getTime()+""),f={net_type:(e=c.NT_UNKNOWN,s="",f=navigator.connection||navigator.mozConnection||navigator.webkitConnection,-1<(s=((null==f?void 0:f.effectiveType)||(null==f?void 0:f.type)||"unknwon").toUpperCase()).indexOf("4G")?e=c.NT_4G:-1<s.indexOf("2G")?e=c.NT_2G:-1<s.indexOf("3G")?e=c.NT_3G:-1<s.indexOf("WIFI")?e=c.NT_WIFI:-1<s.indexOf("LINE")?e=c.NT_LINE:-1<s.indexOf("NONE")&&(e=c.NT_NONE),e),room_id:Nn(t.roomID),room_name:Nn(t.roomName),nick_name:this.nickName,role:this.Zt.role,third_token:Nn(t.token),room_create_flag:this.Zt.roomCreateFlag,user_state_flag:t.userStateUpdate?1:0,user_count_limit:t.maxMemberCount,relate_service:this.Zt.relateService.join()||""};t.isMulti?(s=Cn(Cn({},f),{conn_type:2}),r=Cn(Cn({},s),{room_id:t.roomID,room_name:t.roomName,third_token:t.token}),this.$t.info(qt+" enter "+JSON.stringify(r)),o=An.EnterRoomReq.create(s),u=An.EnterRoomReq.encode(o).finish(),this.sendMessage("EnterRoomReq",u,(function(n,e){h._transLoginRspKeys(n,t),i&&i(n,e)}),(function(t,i){n&&n(t,i)}),{roomID:t.roomID})):(s=Cn(Cn({},f),{app_id:this.Zt.appid,id_name:Nn(this.Zt.idName),device_id:this.Zt.deviceID,term_type:this.TermType,sdk_version:this._getNumSDKVersion(),client_stamp:Nn(a),relogin_token:this.switchSessionID.notEquals(In.a.fromInt(0))?Nn(this.reloginToken):"",switch_session_id:this.switchSessionID,user_session_id:null!=(e=t.longSid)?e:In.a.fromInt(0),biz_type:0,biz_version:this.Zt.bizVersion||"",login_logic:this.Zt.isMultiRoom?3:1,sdk_conn_type:2}),t.roomReasonState===O.Reconnecting&&(s.relogin_type=1),r=Cn(Cn({},s),{id_name:this.Zt.idName,nick_name:this.Zt.nickName,client_stamp:a,k1_sign:void 0,relogin_token:this.reloginToken,room_id:t.roomID,room_name:t.roomName,user_session_id:t.longSid}),this.logoutCheckToken=t.token,this.$t.info(qt+" login "+JSON.stringify(r)),this.$t.remoteReport(qt+" token "+t.token),o=Dn.LoginRoomReq.create(s),u=Dn.LoginRoomReq.encode(o).finish(),this.sendMessage("LoginRoomReq",u,(function(n,e){var s;h.$t.info(qt+" login rsp"),h.switchSessionID=n.body.switch_session_id,h.reloginToken=n.body.relogin_token,null!=(s=null==n?void 0:n.header)&&s.controls&&(h.controls=null==(s=null==n?void 0:n.header)?void 0:s.controls),h._transLoginRspKeys(n,t),i&&i(n,e)}),(function(t,i){n&&n(t,i)})))},Mn.prototype._transLoginRspKeys=function(t,i){null!=(n=t.header)&&n.context_key&&(this._roomIDKeys[i.roomID]=null==(n=t.header)?void 0:n.context_key,this._roomKeyIDs[null==(n=t.header)?void 0:n.context_key]=i.roomID,t.header.room_id=i.roomID),this.longToStringNumber(t.body,["ret_timestamp"],"toString"),this.transKeysName(t.body,this.loginKeyTransMap),this.keysExist(t.body,["token_remain_time","stream_seq"]);var n={anchor_id_name:t.body.anchor_info.id_name,anchor_id:t.body.anchor_info.user_id,anchor_nick_name:t.body.anchor_info.nick_name};t.body.anchor_info=n},Mn.prototype.transKeysName=function(t,i){i.forEach((function(i){Object(L.g)(t[i[0]])||(t[i[1]]=t[i[0]],delete t[i[0]])}))},Mn.prototype.keysExist=function(t,i){i.forEach((function(i){void 0===t[i]&&(t[i]=0)}))},Mn.prototype.longToStringNumber=function(t,i,n){i.forEach((function(i){In.a.isLong(t[i])&&(t[i]=t[i][n]())}))},Mn.prototype.logout=function(t,i,n){var e,s,r,o;return t.isMulti?(e={},this.$t.info($t+" quit "+t.roomID),r=An.QuitRoomReq.create(e),o=An.QuitRoomReq.encode(r).finish(),this.sendMessage("QuitRoomReq",o,i,n,{roomID:null==t?void 0:t.roomID})):(e={logout_code:0,logout_check:this.crypto.md5Bytes(Nn(this.logoutCheckToken)),user_session_id:t.longSid,logout_logic:this.Zt.isMultiRoom?3:1},s=this.transBuf(e),this.$t.info($t+" logout "+JSON.stringify(s)),r=Dn.LogoutRoomReq.create(e),o=Dn.LogoutRoomReq.encode(r).finish(),this.sendMessage("LogoutRoomReq",o,i,n,{roomID:null==t?void 0:t.roomID}))},Mn.prototype._checkSendMessageList=function(t){for(var i=t.getFirst();null!=i;)t.remove(i),i._data&&i._data.error&&setTimeout((function(){i&&i._data&&i._data.error&&i._data.error(I.TIMEOUT,i._data.seq)}),0),i=t.getFirst()},Mn.prototype._checkMessageListTimeout=function(t,i){for(var n=t.getFirst(),e=Date.parse(new Date+""),s=0,r=this;null!=n&&"break"!==function(){var o,u;return n._data&&n._data.sendTime+n._data.timeout>e||(n._data&&delete i[n._data.seq],t.remove(n),n._data&&null==n._data.error||n._data&&n._data.sendTime+r._sendDataDropTimeout<e||(o=n&&n._data&&n._data.error,u=n&&n._data&&n._data.seq,setTimeout((function(){o&&o(I.TIMEOUT,u)}),0)),++s>=r._sendDataCheckOnceCount)?"break":void(n=t.getFirst())}(););},Mn.prototype.startCheck=function(){var t=this;this._checkMessageListTimeout(this.sendCommandList,this.sendCommandMap),this._sendDataCheckTimer=setTimeout((function(){t.startCheck()}),this._sendDataCheckInterval)},Mn.prototype.stopCheck=function(){this._checkSendMessageList(this.sendCommandList),clearTimeout(this._sendDataCheckTimer)},Mn.prototype.handleSendCommandMsgRsp=function(t){var i,n,e=this.sendCommandMap[t.header.seq];null!=e&&(i=e._data,n=null==i?void 0:i.params,delete this.sendCommandMap[t.header.seq],this.sendCommandList.remove(e),0===t.body.err_code?setTimeout((function(){i&&null!=i.success&&i.success(t,t.header.seq)}),0):setTimeout((function(){i&&null!=i.error&&i.error(t,t.header.seq,n)}),0))},Mn.prototype.getReqHead=function(t){return{}},Mn.prototype.heartBeat=function(t,i,n){var e=this,s=An.HbReq.create({});s=An.HbReq.encode(s).finish();this.sendMessage("HbReq",s,(function(i,n){e.transKeysName(i.body,[["hb_interval","hearbeat_interval"],["hb_timeout","hearbeat_timeout"],["big_im_time_window","bigim_time_window"],["trans_channel_list","trans_seqs"]]),i.body.server_user_seq=i.body.user_seq.toNumber(),e.longToStringNumber(i.body,["ret_timestamp"],"toNumber"),t&&t(i,n)}),i,{roomID:null==n?void 0:n.roomID})},Mn.prototype.fetchUserList=function(t,i,n,e){var s=this,r=(t=Cn({},t),this.transBuf(t));this.$t.info(Bt+" "+JSON.stringify(r)),r=An.GetUserlistReq.create(t),t=An.GetUserlistReq.encode(r).finish();return this.sendMessage("GetUserlistReq",t,(function(t,n){s.$t.info(Bt+" suc "+n),s.transKeysName(t.body,[["user_base_info_list","user_baseinfos"]]),s.longToStringNumber(t.body,["server_user_seq","server_user_index","ret_user_index"],"toNumber"),i&&i(t,n)}),n,{roomID:null==e?void 0:e.roomID})},Mn.prototype.sendRoomMsg=function(t,i,n,e){var s=this,r=(t={msg_category:t.msg_category,msg_type:t.msg_type,msg_content:Nn(t.msg_content)},this.transBuf(t));this.$t.info("zm.lrh.srm.1 "+JSON.stringify(r)),r=An.SendImReq.create(t),t=An.SendImReq.encode(r).finish();return this.sendMessage("SendImReq",t,(function(t,n){s.longToStringNumber(t.body,["msg_id"],"toNumber"),i&&i(t,n)}),n,{roomID:null==e?void 0:e.roomID})},Mn.prototype.sendReliableMessage=function(t,i,n,e){t={trans_type:Nn(t.trans_type),trans_data:Nn(t.trans_data),trans_local_seq:t.trans_local_seq,trans_channel:Nn(t.trans_channel)};var s=this.transBuf(t);this.$t.info("zm.lrh.srm.0 "+JSON.stringify(s)),s=An.SetTransReq.create(t),t=An.SetTransReq.encode(s).finish();return this.sendMessage("SetTransReq",t,i,n,{roomID:null==e?void 0:e.roomID})},Mn.prototype.fetchReliableMessage=function(t,i,n,e){var s=t.fetch_array.map((function(t){return{trans_type:Nn(t.trans_type),trans_local_seq:t.trans_seq}}));t={trans_channel:Nn(t.trans_channel),trans_list:s},s=this.transBuf(t),this.$t.info("zm.lrh.frm "+JSON.stringify(s)),s=An.GetTransReq.create(t),t=An.GetTransReq.encode(s).finish();return this.sendMessage("GetTransReq",t,i,n,{roomID:null==e?void 0:e.roomID})},Mn.prototype.sendCustomCommand=function(t,i,n,e){var s=this,r=t.dest_id_name.map((function(t){return{id_name:Nn(t)}}));r=Cn({to_user_list:r,push_message:Nn(t.custom_msg)},t),t=this.transBuf(r),this.$t.info("zm.lrh.scc "+JSON.stringify(t)),t=An.SignalLiveCustomReq.create(r),r=An.SignalLiveCustomReq.encode(t).finish();return this.sendMessage("SignalLiveCustomReq",r,(function(t,n){i&&i(s.transRsp(t),n)}),(function(t,i){n&&n(t,i)}),{roomID:null==e?void 0:e.roomID})},Mn.prototype.sendBigRoomMessage=function(t,i,n,e){t={msg_list:t.msgs.map((function(t){return{msg_category:t.msg_category,msg_type:t.msg_type,msg_timestamp:In.a.fromNumber(Date.now()),msg_content:Nn(t.msg_content),msg_client_id:Nn(t.bigmsg_client_id)}}))};var s=this.transBuf(t);this.$t.info("zm.lrh.sbrm "+JSON.stringify(s)),s=An.SendBigImReq.create(t),t=An.SendBigImReq.encode(s).finish();return this.sendMessage("SendBigImReq",t,i,n,{roomID:null==e?void 0:e.roomID})},Mn.prototype.sendSignalCmd=function(t,i,n,e){var s="";switch(t.sub_cmd){case 1003:s="SignalLiveInviteReq";break;case 1001:s="SignalLiveRequestReq";break;case 1002:s="SignalLiveResultReq";break;case 1004:s="SignalLiveStopReq"}var r=t.dest_id_name.map((function(t){return{id_name:Nn(t)}}));t={push_message:Nn(t.signal_msg),to_user_list:r},r=this.transBuf(t),this.$t.info("zm.lrh.ssc "+JSON.stringify(r)),r=An[s].create(t),t=An[s].encode(r).finish();return this.sendMessage(s,t,i,n,{roomID:null==e?void 0:e.roomID})},Mn.prototype.sendStreamUpdate=function(t,i,n,e){var s,r=this;try{s=JSON.parse(t.stream_msg)}catch(t){}var o,u="",h=(this.$t.info(Vt+" "+JSON.stringify(Cn(Cn({},t),{third_token:void 0}))),this.$t.remoteReport(Vt+" token "+t.third_token),this.Zt.roomModulesList.find((function(t){return t.roomID==e.roomID})));if(!h)return this.$t.error(Vt+" room no found ignore "),-1;switch(t.sub_cmd){case 2001:u="AddStreamReq",o={stream_id:Nn(s.stream_id),extra_info:Nn(s.extra_info),client_req_seq:this.seq+1,third_token:Nn(t.third_token||"")};break;case 2002:u="DeleteStreamReq",o={stream_id:Nn(s.stream_id),stream_sid:s.stream_sid,client_req_seq:this.seq+1};break;case 2003:u="UpdateStreamReq",o={stream_id:Nn(s.stream_id),stream_sid:s.stream_sid,client_req_seq:this.seq+1,extra_info:Nn(s.extra_info)}}var c=this.transBuf(o);this.$t.info(Vt+" "+JSON.stringify(c)),c=An[u].create(o),c=An[u].encode(c).finish();return this.sendMessage(u,c,(function(t,n){r.$t.info(Vt+" suc "+u+" "+JSON.stringify(t)),t.header.room_id=h.roomID,i&&i(t,n)}),(function(t,i){r.$t.info(Vt+" fail "+u+" "+JSON.stringify(t)),n&&n(t,i)}),{roomID:null==e?void 0:e.roomID})},Mn.prototype.getStreamList=function(t,i,n,e){var s,r,o=this;this.Zt.roomModulesList.find((function(t){return t.roomID==e.roomID}))?(s=this.transBuf(r={}),this.$t.info("zm.lrh.gs "+JSON.stringify(s)),s=An.GetStreamListReq.create(r),r=An.GetStreamListReq.encode(s).finish(),this.sendMessage("GetStreamListReq",r,(function(t,n){var e;null!=(e=t.body)&&e.stream_info_list.forEach((function(t){t.create_time=t.create_time.toNumber()})),o.transKeysName(t.body,[["stream_list_seq","stream_seq"],["stream_info_list","stream_info"]]),i&&i(t,n)}),(function(t,i){n&&n(t,i)}),{roomID:null==e?void 0:e.roomID})):this.$t.error("zm.lrh.gs room no found ignore "+e.roomID)},Mn.prototype.transBuf=function(t){var i=this,n={};return Object.keys(t).forEach((function(e){["logout_check","k2_sign","k1_sign"].includes(e)?n[e]=t[e]:i.transReqBytes(n,t,e)})),n},Mn.prototype.transReqBytes=function(t,i,n){var e=this;if(In.a.isLong(i[n]))t[n]=i[n].toString();else if("[object Object]"===Object.prototype.toString.call(i[n]))t[n]={},Object.keys(i[n]).forEach((function(s){return e.transReqBytes(t[n],i[n],s)}));else if("[object Array]"===Object.prototype.toString.call(i[n])&&"[object Object]"===Object.prototype.toString.call(i[n][0])){t[n]=[];for(var s=0;s<i[n].length;s++)!function(s){var r={};Object.keys(i[n][s]).forEach((function(t){e.transReqBytes(r,i[n][s],t)})),t[n].push(r)}(s)}else"[object Uint8Array]"===Object.prototype.toString.call(i[n])?t[n]=Tn(i[n]):t[n]=i[n]},Mn.prototype.transHeader=function(t){return t.timestamp=In.a.isLong(t.timestamp)?t.timestamp.toString():t.timestamp,t},Mn.prototype.transRsp=function(t){var i=this,n=t&&t.rsp_head?this.transRspHead(t.rsp_head):{},e=Cn(Cn({},t),n),s=(delete e.rsp_head,{});return Object.keys(e).forEach((function(t){"k2_sign"===t?s[t]=e[t]:i.transBytes(s,e,t)})),s},Mn.prototype.transBytes=function(t,i,n){var e=this;if(In.a.isLong(i[n]))t[n]=i[n];else if("[object Object]"===Object.prototype.toString.call(i[n]))t[n]={},Object.keys(i[n]).forEach((function(s){return e.transBytes(t[n],i[n],s)}));else if("[object Array]"===Object.prototype.toString.call(i[n])&&"[object Object]"===Object.prototype.toString.call(i[n][0])){t[n]=[];for(var s=0;s<i[n].length;s++)!function(s){var r={};Object.keys(i[n][s]).forEach((function(t){e.transBytes(r,i[n][s],t)})),t[n].push(r)}(s)}else"[object Uint8Array]"===Object.prototype.toString.call(i[n])?t[n]=Tn(i[n]):t[n]=i[n]},Mn.prototype.transRspHead=function(t){return t?{err_code:t.code||0,err_message:t.message}:{}},Mn.prototype._decode=function(t,i){return Cn({},t.decode(i))},Mn.prototype._handleDisconnected=function(t,i){var n=this;this.$t.info(Jt+" call"),this._state=wn.disconnected,this.Zt.useNetAgent&&t===y.TIMEOUT&&this.Zt.roomModulesList.forEach((function(t){t.roomTryHandler&&(n._ua.isConnect()?(n.$t.info(Jt+" ua is connect"),t.roomTryHandler.active()):(n.$t.info(Jt+" ua is disconnect"),n._ua.connectUa()))}))},Mn.prototype._handleBroken=function(){var t=this;this.$t.info("zm.lrh.hb call"),this._state=wn.broken,this.Zt.useNetAgent&&this.Zt.roomModulesList.forEach((function(i){i.roomTryHandler&&(i.roomTryHandler.invalid(),i.roomTryHandler.onactive=function(n,e){t.$t.info("zm.lrh.hb onactive"),i.roomHandler.transError(e),i.roomHandler.disconnectedHandle(e)},i.roomTryHandler.startMaxTime(),i.roomHandler._roomStateHandle("CONNECTING",O.Reconnecting,I.NETWORK_BROKEN))}))},Mn.prototype._handleConnected=function(t){var i=this;this.$t.info("zm.lrh.hc call "+t),this._state=wn.connected,this.Zt.useNetAgent&&t===p.AUTO&&this.Zt.roomModulesList.forEach((function(t){t.roomTryHandler&&i._ua.isConnect()&&t.roomTryHandler.active()}))},Mn.prototype.renewToken=function(t,i,n,e){var s=this,r=(t={token:t.token},An.RenewTokenReq.create(t));r=An.RenewTokenReq.encode(r).finish(),t=this.transBuf(t);this.$t.info("zm.lrh.rt "+JSON.stringify(t)),this.sendMessage("RenewTokenReq",r,(function(t,n){s.keysExist(t.body,["token_remain_time"]),i&&i(t,n)}),n,{roomID:null==e?void 0:e.roomID})},Mn.prototype.reset=function(){this.$t.info("zm.lrh.r.0 call "),this._state=wn.disconnected,this.switchSessionID=In.a.fromInt(0),this._sendDataCheckTimer&&clearTimeout(this._sendDataCheckTimer)},Mn.prototype.closeRequest=function(){var t;null!=(t=this.liveroomRequest)&&t.closeRequest()},Mn.prototype.resetSessionInfo=function(){this.switchSessionID=In.a.fromInt(0)},Mn.prototype._getNumSDKVersion=function(){var t=0===this.Zt.ENV?6:7,i=this.rtm.version.split(".").map((function(t){return parseInt(t)}));return t<<28|i[0]<<20|i[1]<<8|i[2]},Mn);function Mn(t,i,n,e,s){var r=this;this.$t=t,this.Zt=i,this._ua=n,this._dataReport=e,this.rtm=s,this.seq=0,this.sendCommandList=new m,this.sendCommandMap={},this.logoutCheckToken="",this.zPushSid="0",this.loginKeyTransMap=[["user_session_id","session_id"],["liveroom_hb_interval","hearbeat_interval"],["liveroom_hb_timeout","hearbeat_timeout"],["big_im_time_window","bigim_time_window"],["trans_channel_list","trans_seqs"],["stream_list_seq","stream_seq"],["stream_info_list","stream_info"]],this._sendDataCheckOnceCount=100,this._sendDataDropTimeout=1e4,this._sendDataCheckInterval=2e3,this._protoInstance=kn,this._roomKeyIDs={},this._roomIDKeys={},this.swPushCmdList=[gn.PushReq,gn.MergePushReq,gn.PushKickout],this.onSwitchCmdList=[gn.LoginRoomRsp,gn.LogoutRoomRsp,gn.PushKickout,gn.PushReq,gn.MergePushReq],this.noContextKeyCmdList=[1105],this.rtcPushCmdList=[10001,10002,10004,11001,11002,11003,11004,11005,12001,12002,12003,13001,15001],this._state=wn.disconnected,this.unStructCmdList=[11001,11002,11003,11004],this.reloginToken="",this.crypto=new On,this.liveroomRequest=this._ua.getPCRequest(S.SERVICE_SWITCH4LIVEROOM),this.switchSessionID=In.a.fromInt(0),null!=(t=this.liveroomRequest)&&t.on("connected",(function(t){r._handleConnected(t)})),null!=(i=this.liveroomRequest)&&i.on("broken",(function(t){r._handleBroken()})),null!=(n=this.liveroomRequest)&&n.on("disconnected",(function(t,i){r._handleDisconnected(t,i)})),null!=(e=this.liveroomRequest)&&e.on("downLoadMessage",(function(t,i){r.handlePush(t,i)})),null!=(s=this.liveroomRequest)&&s.on("exception",(function(t,i){r.$t.info("zm.lrh.o.0 except "+JSON.stringify(t))})),null!=(t=this.liveroomRequest)&&t.on("pcBrokenEvent",(function(t){var i=Li,n=r.Qt.createSpan(u.H,{key:wi},{key:""},i.event);n.setAttributes({service_no:i.service_no(null==t?void 0:t.service_no)}),n.end()})),null!=(i=this.liveroomRequest)&&i.on("pcDisconnectedEvent",(function(t){var i=xi,n=r.Qt.createSpan(u.H,{key:wi},{key:""},i.event);n.setAttributes({service_no:i.service_no(null==t?void 0:t.service_no)}),n.end()})),null!=(n=this.liveroomRequest)&&n.on("pcConnectedEvent",(function(t){var i=zi,n=r.Qt.createSpan(u.H,{key:wi},{key:""},i.event);n.setAttributes({service_no:i.service_no(t.service_no),recv_time:i.recv_time((new Date).getTime()),proxy_link_sources:i.proxy_link_sources(t.proxy_link_sources),connect_stream:i.connect_stream(t.connect_stream)}),n.end()}))}var Un=(Object.defineProperty(jn.prototype,"logger",{get:function(){return this.$t},enumerable:!1,configurable:!0}),Object.defineProperty(jn.prototype,"stateCenter",{get:function(){return this.Zt},enumerable:!1,configurable:!0}),jn.prototype.listenCallBack=function(){var t=this;this.roomServicer.handlePushCustomMsg=function(i){t.handlePushCustomMsg(i)},this.roomServicer.handlePushTokenExpire=function(i){var n,e=null==(e=null==(e=null==i?void 0:i.body)?void 0:e.stop_stream)?void 0:e.stream_id_list.map(Tn);null!=(n=null==(n=null==i?void 0:i.body)?void 0:n.stop_stream)&&(n.stream_id_list=e),t.Zt.actionListener("_tokenExpired",i)},this.roomServicer.handlePushKickout=function(i,n){var e;n?function(t,i,n){if(n||2===arguments.length)for(var e,s=0,r=i.length;s<r;s++)!e&&s in i||((e=e||Array.prototype.slice.call(i,0,s))[s]=i[s]);return t.concat(e||Array.prototype.slice.call(i))}([],t.Zt.roomModulesList,!0).forEach((function(t){t.roomHandler.handlePushKickout(i,!0,!0)})):(e=null==(n=null==i?void 0:i.header)?void 0:n.room_id,n=t.Zt.roomModulesList.find((function(t){return t.roomID==e})),t.roomServicer.longToStringNumber(i.body,["session_id"],"toString"),n?n.roomHandler.handlePushKickout(i):t.$t.error("zm.lrh.pk room no found ignore "+JSON.stringify(null==(n=i.header)?void 0:n.room_id)))},this.roomServicer.handlePushStreamMsg=function(i){t.handlePushStreamMsg(i)},this.roomServicer.handlePushSignalMsg=function(i){t.handlePushSignalMsg(i)},this.roomServicer.handlePushMergeMsg=function(i){t.handlePushMergeMsg(i)},this.roomServicer.handlePushRoomMsg=function(i){t.handlePushRoomMsg(i)},this.roomServicer.handlePushTransMsg=function(i){t.handlePushTransMsg(i)},this.roomServicer.onSwitchMessage=function(i,n){t.onSwitchMessage(i,n)},this.roomServicer.handlePushUserStateUpdateMsg=function(i){var n,e,s,r=null==(o=null==i?void 0:i.header)?void 0:o.room_id,o=t.Zt.roomModulesList.find((function(t){return t.roomID==r}));o?(s=i.body.user_action_list.map((function(t){return{Action:t.action,IdName:t.id_name,NickName:t.nick_name,Role:t.role,LoginTime:t.login_time.toString()}})),e=t.Zt.reporter.createSpan(u.H,{key:ti.event,par:r},{key:""},"/liveroom/recv_user_update_info"),s={body:{user_actions:s,user_list_seq:i.body.server_user_seq.toNumber(),room_id:r}},e.setAttributes({user_list_seq:null==(n=null===s?void 0:s.body)?void 0:n.user_list_seq,update_user:null==(n=null===s?void 0:s.body)?void 0:n.user_actions}),e.end(),o.userHandler.handlePushUserStateUpdateMsg(s)):t.$t.error("zm.lrh.puu room no found ignore "+JSON.stringify(i))}},jn.prototype.isDisConnect=function(){return!!this.roomServicer&&this.roomServicer.isDisConnect()},jn.prototype.isUaConnect=function(){var t;return null==(t=this.roomServicer)?void 0:t.isUaConnect()},jn.prototype.sendMessage=function(t,i,n,e,s,r,o){var u;return null==(u=this.roomServicer)?void 0:u.sendMessage(t,i,n,e,s,r)},jn.prototype.handlePushTokenExpire=function(t){},jn.prototype.handlePushKickout=function(t,i){},jn.prototype.handlePushStreamMsg=function(t){},jn.prototype.handlePushSignalMsg=function(t){},jn.prototype.handlePushMergeMsg=function(t){},jn.prototype.handlePushCustomMsg=function(t){},jn.prototype.handlePushRoomMsg=function(t){},jn.prototype.handlePushTransMsg=function(t){},jn.prototype.onSwitchMessage=function(t,i){},jn.prototype.handlePushUserStateUpdateMsg=function(t){},jn.prototype.login=function(t,i,n){var e;null!=(e=this.roomServicer)&&e.login(t,i,n)},jn.prototype.logout=function(t,i,n){var e;return null==(e=this.roomServicer)?void 0:e.logout(t,i,n)},jn.prototype.startCheck=function(){var t;null!=(t=this.roomServicer)&&t.startCheck()},jn.prototype.stopCheck=function(){var t;null!=(t=this.roomServicer)&&t.stopCheck()},jn.prototype.getReqHead=function(t){var i;return null==(i=this.roomServicer)?void 0:i.getReqHead(t)},jn.prototype.heartBeat=function(t,i,n){var e;null!=(e=this.roomServicer)&&e.heartBeat(t,i,n)},jn.prototype.fetchUserList=function(t,i,n,e){var s;return null==(s=this.roomServicer)?void 0:s.fetchUserList(t,i,n,e)},jn.prototype.sendRoomMsg=function(t,i,n,e){var s;return null==(s=this.roomServicer)?void 0:s.sendRoomMsg(t,i,n,e)},jn.prototype.sendReliableMessage=function(t,i,n,e){var s;return null==(s=this.roomServicer)?void 0:s.sendReliableMessage(t,i,n,e)},jn.prototype.fetchReliableMessage=function(t,i,n,e){var s;return null==(s=this.roomServicer)?void 0:s.fetchReliableMessage(t,i,n,e)},jn.prototype.sendCustomCommand=function(t,i,n,e){var s;return null==(s=this.roomServicer)?void 0:s.sendCustomCommand(t,i,n,e)},jn.prototype.sendBigRoomMessage=function(t,i,n,e){var s;return null==(s=this.roomServicer)?void 0:s.sendBigRoomMessage(t,i,n,e)},jn.prototype.sendSignalCmd=function(t,i,n,e){var s;return null==(s=this.roomServicer)?void 0:s.sendSignalCmd(t,i,n,e)},jn.prototype.sendStreamUpdate=function(t,i,n,e){var s;return null==(s=this.roomServicer)?void 0:s.sendStreamUpdate(t,i,n,e)},jn.prototype.getStreamList=function(t,i,n,e){var s;return null==(s=this.roomServicer)?void 0:s.getStreamList(t,i,n,e)},jn.prototype.renewToken=function(t,i,n,e){var s;null!=(s=this.roomServicer)&&s.renewToken(t,i,n,e)},jn.prototype.reset=function(){var t;null!=(t=this.roomServicer)&&t.reset()},jn.prototype.closeRequest=function(){var t;null!=(t=this.roomServicer)&&t.closeRequest()},jn);function jn(t,i,n,e,s){this.$t=t,this.Zt=i,this.ua=n,this._dataReport=e,this.rtm=s,this.roomServicer=new Pn(t,i,n,e,s),this.listenCallBack()}var zn=n(12),Ln=(xn.prototype.setLog=function(t){this.zegoSetting.setLog(t)},xn.prototype.init=function(t){this.zegoSetting.init(t)},xn.prototype.setEnvVariable=function(t,i){this.zegoSetting.setEnvVariable(t,i)},xn.prototype.getEnvVariables=function(){return this.zegoSetting.getEnvVariables()},xn.prototype.fetchSetting=function(t,i,n){return this.zegoSetting.fetchSetting(t,i,n)},xn.prototype.fetchMultiSetting=function(t,i,n){return this.zegoSetting.fetchMultiSetting(t,i,n)},xn.prototype.setOptions=function(t){return this.zegoSetting.setOptions(t)},xn.prototype.getSettingCache=function(t){return this.zegoSetting.getSettingCache(t)},xn.prototype.setToken=function(t){this.zegoSetting.setToken(t)},xn.prototype.setUserID=function(t){this.zegoSetting.setUserID(t)},xn.prototype.activePolling=function(){this.zegoSetting.activePolling()},xn.prototype.uninit=function(){var t;null!=(t=this.zegoSetting)&&t.uninit()},xn.prototype.getEnvVariable=function(t){this.zegoSetting.getEnvVariable(t)},xn);function xn(){this.isLoad=!1,this.callBackList=[],this.zegoSetting=new zn.ZegoSetting}var Hn,Gn=function(){return(Gn=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var s in i=arguments[n])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t}).apply(this,arguments)},qn=function(t,i){var n,e,s,r={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},o={next:u(0),throw:u(1),return:u(2)};return"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(u){return function(h){var c=[u,h];if(n)throw new TypeError("Generator is already executing.");for(;r=o&&c[o=0]?0:r;)try{if(n=1,e&&(s=2&c[0]?e.return:c[0]?e.throw||((s=e.return)&&s.call(e),0):e.next)&&!(s=s.call(e,c[1])).done)return s;switch(e=0,(c=s?[2&c[0],s.value]:c)[0]){case 0:case 1:s=c;break;case 4:return r.label++,{value:c[1],done:!1};case 5:r.label++,e=c[1],c=[0];continue;case 7:c=r.ops.pop(),r.trys.pop();continue;default:if(!(s=0<(s=r.trys).length&&s[s.length-1])&&(6===c[0]||2===c[0])){r=0;continue}if(3===c[0]&&(!s||c[1]>s[0]&&c[1]<s[3]))r.label=c[1];else if(6===c[0]&&r.label<s[1])r.label=s[1],s=c;else{if(!(s&&r.label<s[2])){s[2]&&r.ops.pop(),r.trys.pop();continue}r.label=s[2],r.ops.push(c)}}c=i.call(t,r)}catch(h){c=[6,h],e=0}finally{n=s=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}},Bn=((i=Hn=Hn||{})[i.CONNECTING=0]="CONNECTING",i[i.OPEN=1]="OPEN",i[i.CLOSING=2]="CLOSING",i[i.CLOSED=3]="CLOSED",0),$n=(Object.defineProperty(Vn.prototype,"binaryType",{get:function(){return this._binaryType},set:function(t){this._binaryType=t},enumerable:!1,configurable:!0}),Vn.prototype.addEventListener=function(t,i,n){var e;this.eventMap[t]?null!=(e=this.eventMap[t])&&e.push(i):this.eventMap[t]=[i],"open"!==t&&null!=(e=this.socket)&&e.addEventListener(t,i,n)},Vn.prototype.removeEventListener=function(t,i,n){var e;this.eventMap[t]=(this.eventMap[t]||[]).filter((function(t){return t!==i})),"open"!==t&&null!=(e=this.socket)&&e.removeEventListener(t,i,n)},Vn.prototype.dispatchEvent=function(t){throw new Error("Method not implemented.")},Object.defineProperty(Vn.prototype,"readyState",{get:function(){var t;return this.isConnecting?Hn.CONNECTING:(null==(t=null==this?void 0:this.socket)?void 0:t.readyState)||Hn.CLOSED},enumerable:!1,configurable:!0}),Vn.prototype.createSocket=function(){return function(t,i,n,e){return new(n=n||Promise)((function(s,r){function o(t){try{h(e.next(t))}catch(t){r(t)}}function u(t){try{h(e.throw(t))}catch(t){r(t)}}function h(t){var i;t.done?s(t.value):((i=t.value)instanceof n?i:new n((function(t){t(i)}))).then(o,u)}h((e=e.apply(t,i||[])).next())}))}(this,void 0,void 0,(function(){var t,i,n,e,s,r=this;return qn(this,(function(o){switch(o.label){case 0:if(this.socket&&this.socket.readyState!==Hn.CLOSED)return[2];t=null,i=this.activeServer?function(t,i,n){if(n||2===arguments.length)for(var e,s=0,r=i.length;s<r;s++)!e&&s in i||((e=e||Array.prototype.slice.call(i,0,s))[s]=i[s]);return t.concat(e||Array.prototype.slice.call(i))}([this.activeServer],this.servers,!0):this.servers,n=function(n){var s,o,u;return qn(this,(function(h){switch(h.label){case 0:s=i[n],o="wss://".concat(s,"/proxy/ws"),h.label=1;case 1:return h.trys.push([1,3,,4]),[4,new Promise((function(t,i){var n=new WebSocket(o),e=(Object.keys(r.eventMap).forEach((function(t){"open"!==t&&(r.eventMap[t]||[]).forEach((function(i){n.addEventListener(t,i)}))})),n.binaryType="arraybuffer",n.onclose=function(t){r.onclose&&r.onclose(t)},n.onerror=function(t){r.onerror&&r.onerror(t),i(t)},0);n.onmessage=function(t){e++;var i=t.data;if(1===e)i.byteLength;else if(2===e){if(0!==(i=pn.webproxy.WssBindResponse.decode(new Uint8Array(i))).code)throw"zm.prx.1"+" cloud proxy token auth failed. result: ".concat(JSON.stringify(i));r.isConnecting=!1,(r.eventMap.open||[]).forEach((function(i){i(r,t)})),r.onopen&&r.onopen()}else r.onmessage&&r.onmessage(t)},n.onopen=function(i){r.socket=n,t(i),r.authProxy(n)}}))];case 2:return h.sent(),[3,4];case 3:return u=h.sent(),t=u,[2,"continue"];case 4:return e.onActiveServer&&(e.onActiveServer(s),e.onActiveServer=void 0),e.url=o,[2,"break"]}}))},e=this,s=0,o.label=1;case 1:return s<i.length?[5,n(s)]:[3,4];case 2:if("break"===o.sent())return[3,4];o.label=3;case 3:return s++,[3,1];case 4:return this.socket||setTimeout((function(){throw t}),0),[2]}}))}))},Vn.prototype.authProxy=function(t){var i,n,e,s,r=this.socket;r&&(i=(e=this.params).token,n=e.target,s=e.appid,e=e.userID,s=pn.webproxy.WssBindRequest.encode({appid:s,biz_type:0,mode:1,id_name:e,token:i,url:n,ack:!0}).finish(),r.send(s))},Vn.prototype.setParams=function(t){this.params=Gn(Gn({},this.params),t)},Vn.prototype.open=function(){this.isConnecting=!0,this.readyState!==Hn.CLOSED&&this.createSocket()},Vn.prototype.close=function(){var t;null!=(t=this.socket)&&t.close()},Vn.prototype.send=function(t){var i;null!=(i=this.socket)&&i.send(t)},Vn.prototype.onopen=function(){},Vn.prototype.onclose=function(t){},Vn.prototype.onerror=function(t){},Vn.prototype.onmessage=function(t){},Object.defineProperty(Vn.prototype,"bufferedAmount",{get:function(){var t;return(null==(t=this.socket)?void 0:t.bufferedAmount)||0},enumerable:!1,configurable:!0}),Object.defineProperty(Vn.prototype,"extensions",{get:function(){var t;return(null==(t=this.socket)?void 0:t.extensions)||""},enumerable:!1,configurable:!0}),Object.defineProperty(Vn.prototype,"protocol",{get:function(){var t;return(null==(t=this.socket)?void 0:t.protocol)||""},enumerable:!1,configurable:!0}),Vn);function Vn(t,i,n){this.servers=t,this.params=i,this.activeServer=n,this.isConnecting=!1,this._binaryType="blob",this.eventMap={},this.url="",this.CONNECTING=0,this.OPEN=1,this.CLOSING=2,this.CLOSED=3,this.id=Bn++,this.open()}var Jn=function(t,i,n,e){return new(n=n||Promise)((function(s,r){function o(t){try{h(e.next(t))}catch(t){r(t)}}function u(t){try{h(e.throw(t))}catch(t){r(t)}}function h(t){var i;t.done?s(t.value):((i=t.value)instanceof n?i:new n((function(t){t(i)}))).then(o,u)}h((e=e.apply(t,i||[])).next())}))},Yn=function(t,i){var n,e,s,r={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},o={next:u(0),throw:u(1),return:u(2)};return"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(u){return function(h){var c=[u,h];if(n)throw new TypeError("Generator is already executing.");for(;r=o&&c[o=0]?0:r;)try{if(n=1,e&&(s=2&c[0]?e.return:c[0]?e.throw||((s=e.return)&&s.call(e),0):e.next)&&!(s=s.call(e,c[1])).done)return s;switch(e=0,(c=s?[2&c[0],s.value]:c)[0]){case 0:case 1:s=c;break;case 4:return r.label++,{value:c[1],done:!1};case 5:r.label++,e=c[1],c=[0];continue;case 7:c=r.ops.pop(),r.trys.pop();continue;default:if(!(s=0<(s=r.trys).length&&s[s.length-1])&&(6===c[0]||2===c[0])){r=0;continue}if(3===c[0]&&(!s||c[1]>s[0]&&c[1]<s[3]))r.label=c[1];else if(6===c[0]&&r.label<s[1])r.label=s[1],s=c;else{if(!(s&&r.label<s[2])){s[2]&&r.ops.pop(),r.trys.pop();continue}r.label=s[2],r.ops.push(c)}}c=i.call(t,r)}catch(h){c=[6,h],e=0}finally{n=s=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}},Fn=function(t,i,n){if(n||2===arguments.length)for(var e,s=0,r=i.length;s<r;s++)!e&&s in i||((e=e||Array.prototype.slice.call(i,0,s))[s]=i[s]);return t.concat(e||Array.prototype.slice.call(i))},Kn=pn.webproxy;function Wn(t){for(var i=0,n=0;n<t.length;n++)i+=t[n].length;var e=new Uint8Array(i),s=0;for(n=0;n<t.length;n++)e.set(t[n],s),s+=t[n].length;return e}function Zn(t){return Jn(this,void 0,void 0,(function(){var i,n,e;return Yn(this,(function(s){switch(s.label){case 0:for(i="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",n="----WebKitFormBoundary",e=0;e<16;e++)n+=i.charAt(Math.floor(62*Math.random()));return[4,function(t,i){return Jn(this,void 0,void 0,(function(){var n,e,s,r,o,u;return Yn(this,(function(h){switch(h.label){case 0:n=new Uint8Array,e=[],s=Array.from(t),r=function(t){var r,o;return Yn(this,(function(u){switch(u.label){case 0:return r=s[t][0],o=s[t][1],e.push("--"+i),o instanceof Blob?[4,new Promise((function(t){var i=new FileReader;i.onloadend=function(){var s,u=i.result;u&&(e.push('Content-Disposition: form-data; name="'+r+'"; filename="'+((null==o?void 0:o.name)||"blob")+'"',"Content-Type: "+o.type,"\r\n"),s=Nn(e.join("\r\n")),e=[],u=new Uint8Array(u),n=Wn([n,s,u])),t(0)},i.readAsArrayBuffer(o)}))]:[3,2];case 1:return u.sent(),[3,3];case 2:e.push('Content-Disposition: form-data; name="'+r+'"',"",o),u.label=3;case 3:return[2]}}))},o=0,h.label=1;case 1:return o<s.length?[5,r(o)]:[3,4];case 2:h.sent(),h.label=3;case 3:return o++,[3,1];case 4:return e.push("--"+i+"--"),u=Nn(e.join("\r\n")),e=[],[2,n=Wn([n,u])]}}))}))}(t,n)];case 1:return[2,{body:s.sent(),contentType:"multipart/form-data; boundary="+n}]}}))}))}Object.defineProperty(Qn.prototype,"urls",{get:function(){return this.proxyList.map((function(t){var i=t.hostName;t=t.port;return"".concat(i).concat(t?":"+t:"")}))},enumerable:!1,configurable:!0}),Qn.prototype.updateActiveServer=function(t){this.activeServer&&this.activeServer===t||(this.activeServer=t,this.turnInfo=void 0,this.turnExpireTime=void 0)},Qn.prototype.destroy=function(){this.proxyList=[]},Qn.prototype.init=function(t){return Jn(this,void 0,void 0,(function(){return Yn(this,(function(i){return this.appID=t.appID,[2]}))}))},Qn.prototype.createSocket=function(t){var i=this;if(this.appID)return(t=new $n(this.urls,{target:t,appid:this.appID,token:this.token,userID:this.userID},this.activeServer)).onActiveServer=function(t){i.updateActiveServer(t)},t;throw"zego cloud proxy config error. can not init proxy."},Qn.prototype.getTurnInfo=function(){var t;return Jn(this,void 0,void 0,(function(){var i,n;return Yn(this,(function(e){switch(e.label){case 0:return this.turnExpireTime&&this.turnInfo&&Date.now()<this.turnExpireTime?[2,this.turnInfo]:(this.turnExpireTime=void 0,this.turnInfo=void 0,i=Kn.TurnInfoRequest.encode({appid:this.appID,biz_type:0,mode:1,id_name:this.userID,token:this.token}).finish(),[4,this.handleFetch("/turn/info",i)]);case 1:return i=e.sent(),(n=Kn.TurnInfoResponse.decode(new Uint8Array(i))).code||(this.turnInfo=n,this.turnExpireTime=Date.now()+.8*((null==(t=null==n?void 0:n.data)?void 0:t.expiration_in_seconds)||0)*1e3),[2,n]}}))}))},Qn.prototype.handleFetch=function(t,i){return void 0===t&&(t="/"),Jn(this,void 0,void 0,(function(){var n,e,s,r,o,u,h;return Yn(this,(function(c){switch(c.label){case 0:e=n=null,s=this.activeServer?Fn([this.activeServer],this.urls,!0):this.urls,r=0,c.label=1;case 1:if(!(r<s.length))return[3,7];o=s[r],u="https://".concat(o).concat(t),c.label=2;case 2:return c.trys.push([2,4,,5]),[4,fetch(u,{method:"post",body:i})];case 3:return n=c.sent(),this.updateActiveServer(o),[3,5];case 4:return h=c.sent(),e=h,[3,6];case 5:return[3,7];case 6:return r++,[3,1];case 7:if(e)throw e;return[4,null==n?void 0:n.arrayBuffer()];case 8:return[2,c.sent()||[]]}}))}))},Qn.prototype.intranetCheck=function(t,i){return Jn(this,void 0,void 0,(function(){var n;return Yn(this,(function(e){switch(e.label){case 0:return n=Kn.IntranetCheckRequest.encode({appid:this.appID,biz_type:0,mode:1,id_name:this.userID,token:this.token,vrs_ipv4:t,vrs_ipv6:i}).finish(),[4,this.handleFetch("/intranet/check",n)];case 1:return n=e.sent(),[2,Kn.IntranetCheckResponse.decode(new Uint8Array(n))]}}))}))},Qn.prototype.startHttpRequest=function(t,i,n,e){var s=this,r=!1;0<((null==e?void 0:e.timeout)||0)&&setTimeout((function(){r||(r=!0,n&&n({status_code:-1,headers:[],body:Nn("request time out.")}))}),null==e?void 0:e.timeout),new Promise((function(i,n){return Jn(s,void 0,void 0,(function(){var e,s,r,o,u,h,c,a,f,l,_,d;return Yn(this,(function(v){switch(v.label){case 0:return(d=null==(d=t.headers)?void 0:d.find((function(t){return"content-type"===t.name.toLowerCase()&&t.val.toLowerCase().includes("multipart/form-data")})))&&t.body instanceof FormData?[4,Zn(t.body)]:[3,2];case 1:e=v.sent(),c=e.contentType,e=e.body,t.body=e,d.val=c,v.label=2;case 2:e=t.body,"string"==typeof t.body&&(e=Nn(t.body)),s=Kn.HTTPRequest.encode({appid:this.appID,biz_type:0,mode:1,id_name:this.userID,url:t.location,token:this.token,method:t.method_no,headers:t.headers,body:e}).finish(),o=r=null,u=this.activeServer?Fn([this.activeServer],this.urls,!0):this.urls,h=0,v.label=3;case 3:if(!(h<u.length))return[3,9];c=u[h],a="https://".concat(c,"/proxy/http"),v.label=4;case 4:return v.trys.push([4,6,,7]),[4,fetch(a,{method:"post",body:s})];case 5:return r=v.sent(),o=null,[3,7];case 6:return f=v.sent(),o=f,[3,8];case 7:return[3,9];case 8:return h++,[3,3];case 9:return o?(n({status_code:-1,headers:[],body:Nn(JSON.stringify(o))}),[2]):[4,null==r?void 0:r.arrayBuffer()];case 10:if(f=v.sent()||[],l=Kn.HTTPResponse.decode(new Uint8Array(f)),_=null==l?void 0:l.data,0===(null==l?void 0:l.code)&&_){if(!t.origin)try{_.body=JSON.parse(Tn(_.body))}catch(v){_.body=Tn(_.body)}i(_)}else n({status_code:-1,headers:[],body:JSON.parse(Tn(_.body))});return[2]}}))}))})).then((function(t){!r&&i&&(r=!0,i(t))})).catch((function(t){!r&&n&&(r=!0,n)&&n({status_code:-1,headers:[],body:Nn(JSON.stringify(t))})}))};var Xn=Qn;function Qn(t,i){this.proxyList=t,this.token=i,this.enable=!1,this.appID=0,this.userID="web_proxy_"+Date.now()}var te=function(t,i,n,e){return new(n=n||Promise)((function(s,r){function o(t){try{h(e.next(t))}catch(t){r(t)}}function u(t){try{h(e.throw(t))}catch(t){r(t)}}function h(t){var i;t.done?s(t.value):((i=t.value)instanceof n?i:new n((function(t){t(i)}))).then(o,u)}h((e=e.apply(t,i||[])).next())}))},ie=function(t,i){var n,e,s,r={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},o={next:u(0),throw:u(1),return:u(2)};return"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(u){return function(h){var c=[u,h];if(n)throw new TypeError("Generator is already executing.");for(;r=o&&c[o=0]?0:r;)try{if(n=1,e&&(s=2&c[0]?e.return:c[0]?e.throw||((s=e.return)&&s.call(e),0):e.next)&&!(s=s.call(e,c[1])).done)return s;switch(e=0,(c=s?[2&c[0],s.value]:c)[0]){case 0:case 1:s=c;break;case 4:return r.label++,{value:c[1],done:!1};case 5:r.label++,e=c[1],c=[0];continue;case 7:c=r.ops.pop(),r.trys.pop();continue;default:if(!(s=0<(s=r.trys).length&&s[s.length-1])&&(6===c[0]||2===c[0])){r=0;continue}if(3===c[0]&&(!s||c[1]>s[0]&&c[1]<s[3]))r.label=c[1];else if(6===c[0]&&r.label<s[1])r.label=s[1],s=c;else{if(!(s&&r.label<s[2])){s[2]&&r.ops.pop(),r.trys.pop();continue}r.label=s[2],r.ops.push(c)}}c=i.call(t,r)}catch(h){c=[6,h],e=0}finally{n=s=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}},ne=function(t,i,n){if(n||2===arguments.length)for(var e,s=0,r=i.length;s<r;s++)!e&&s in i||((e=e||Array.prototype.slice.call(i,0,s))[s]=i[s]);return t.concat(e||Array.prototype.slice.call(i))},ee=(Object.defineProperty(se.prototype,"logger",{get:function(){return this.$t},enumerable:!1,configurable:!0}),Object.defineProperty(se.prototype,"stateCenter",{get:function(){return this.Zt},enumerable:!1,configurable:!0}),Object.defineProperty(se.prototype,"modules",{get:function(){return{service:this.service}},enumerable:!1,configurable:!0}),Object.defineProperty(se.prototype,"isUseNetAgent",{get:function(){return this.Zt.useNetAgent},enumerable:!1,configurable:!0}),se.prototype.destroyRTM=function(){this.Zt.roomModulesList.some((function(t){return!(null!=t&&t.isLogout()||"DISCONNECTED"===t.roomState)}))&&this.logoutRoom(),this.Qt.setUnloadState(u.I),this.Qt.destroy()},se.prototype.getSettingUnify=function(t){var i=this.Zt.settingConfig.getSetting("unify",t=void 0!==t&&t);return this.$t.info("zm.gsu "+t+" "+JSON.stringify(i)),i?(t=i.enable,i=i.sdk_conn_ver,!!(t&&i<=ot.connectVer)):this.isUseNetAgent},se.prototype._initCallback=function(){this.proxyRes=V,this.actionSuccessCallback=B,this.actionErrorCallback=q,this.getServerError=J,this.generateRandumNumber=W,this.unregisterCallback=Y,this.logReportCallback=$,this.registerCallback=G},se.prototype._initSpans=function(){this.Qt.createSpan(u.H,{key:Yt.event},{key:Ft},Ft,!0).end()},se.prototype._handleZipLogUrl=function(){var t,i="";null!=(t=this.Zt.geoFencing)&&t.detaillog&&""!==(null==(t=this.Zt.geoFencing)?void 0:t.detaillog)?(i="https://".concat(null==(t=this.Zt.geoFencing)?void 0:t.detaillog,"/log/userupload"),this.$t.info(Ot+" set detaillog url by geoFencing "+i),this.$t.setZipLogUploadUrl(i)):(t=this.Zt.settingConfig.getSetting("detaillog_domain"))&&""!==t&&(i="https://".concat(t,"/log/userupload"),this.$t.info(Ot+" set detaillog url by cloudsetting "+i),this.$t.setZipLogUploadUrl(i))},se.prototype.getStoreAppConfig=function(){if(this.$t.info(St+" call"),null!=(t=this.Zt.geoFencing)&&t.logreport&&this.handleLogUpload(),null!=(t=this.Zt.geoFencing)&&t.detaillog&&this._handleZipLogUrl(),localStorage){var t=z(st+"_"+this.getAppID()+"_"+(this.Zt.mode||ot.modeNo));if(t){var i=z(rt+"_"+this.getAppID()+"_"+(this.Zt.mode||ot.modeNo));i||this.$t.info(St+" no store config etag");try{var n,e=U(t,nt);e?(this.Zt.appConfig=JSON.parse(e),this.Qt.spanSetAttributes({key:Yt.event},{is_from_cache:Yt.is_from_cache(!0)}),this.Zt.actionListener("_appConfigRsp"),this.handleLogUpload()):localStorage.removeItem(st+"_"+this.getAppID()+"_"+(this.Zt.mode||ot.modeNo)),i&&(n=U(i,nt),this.Zt.appConfigEtag=parseInt(n))}catch(t){this.$t.warn(St+" "+JSON.stringify(t))}}else this.$t.info(St+" no store config")}else this.$t.warn(St+" no localstorage")},se.prototype._createNetAgent=function(){var t=this,i=(this.$t.info(yt+" call"),this.netAgent.on("disconnected",(function(i){t.$t.info("".concat(yt," netAgent disconnect"))})),this.netAgent.on("connected",(function(){t.$t.info("".concat(yt," netAgent connect")),t.Qt.setNetStateCheck(),t.isUseNetAgent&&(t.fetchAppConfig(),t.Zt.roomModulesList.forEach((function(i){i.roomTryHandler&&t.netAgent.isConnect()&&i.roomTryHandler.active(!0)})))})),this.netAgent.on("broken",(function(i){t.$t.info("".concat(yt," netAgent broken")),i===b.CLOSE&&t.Zt.roomModulesList.forEach((function(t){t.resetSessionInfo()}))})),this.netAgent.on("dispatchEvent",(function(i,n,e){var s;t.$t.info("".concat(yt," dispatch")),"start"===n?(s=t.Qt.createSpan(u.H,{key:wi},{key:""},"/zegoconn/auto_dispatch"),t.Zt.requestList[i]=s):"end"===n&&(s=t.Zt.requestList[i])&&(s.setAttributes({domain_list:e.domains}),s.end())})),this.netAgent.on("dispatchResultUpdate",(function(i){var n,e=i.servers;i=i.domains;t.$t.info("".concat(yt," dispatchResult ").concat(JSON.stringify(e),", ").concat(JSON.stringify(i))),null!=(n=t.Zt.geoFencing)&&n.id?(i&&i[0]&&(t.Zt.netGeoFencing.accesshub=i[0]),t.setLocalGeoFencing()):(n=M(JSON.stringify(e),nt),j(et+"_"+t.Zt.appid+"_"+(t.Zt.mode||ot.modeNo),n))})),this.netAgent.on("connectedEvent",(function(i,n,e){var s;t.$t.info("".concat(yt," connect")),"start"===n?(s=t.Qt.createSpan(u.H,{key:Yt.event},{key:wi},wi,!0),t.Zt.requestList[i]=s):"end"===n&&(s=t.Zt.requestList[i])&&(s.setAttributes({request_count:Ii(e.count),connect_id:Ni(e.connectid),events:Ci(e.connectEvents)}),s.end())})),this.netAgent.on("requestEvent",(function(i,n,e){var s;t.$t.info("".concat(yt," request")),"start"===n?(s=t.Qt.createSpan(u.H,{key:Yt.event},{key:Pi},Pi,!0),t.Zt.requestList[i]=s):"end"===n&&(s=t.Zt.requestList[i])&&(s.setAttributes({req_location:Mi(e.na_req_location),http_code:e.status_code,error:e.err_code}),s.end())})),this.netAgent.on("disConnectedEvent",(function(i){var n=i.duration,e=i.server,s=(i=i.connectid,t.$t.info("".concat(yt," disconnect")),t.Qt.createSpan(u.H,{key:Yt.event},{key:""},"/zegoconn/disconnect"));s.setAttributes({url:Ai(e),connect_duration:Di(n),connect_id:ki(i)}),s.end()})),null!=(i=this.netAgent)&&i.on("clientInfo",(function(i){var n=i.timeOffset;i=i.geofencingID;Object(L.d)(n)&&t.Qt.setTimeOffset(n),t._updateTimeOffsetInterval(),Object(L.d)(i)&&(t.Zt.netGeoFencing.id=i,t.setLocalGeoFencing())})),ot.domains);if(se.geoFenceType&&se.geoFenceAreaList){this.$t.info("".concat(yt," geo type ").concat(se.geoFenceType," area ").concat(se.geoFenceAreaList.join(",")));var n=void 0,e=[],s=this._getGeoFencingIDAndDomain(se.geoFenceType,se.geoFenceAreaList);if(!s)throw this.$t.warn("".concat(yt," geofencing not exist")),I.GEO_SET_ERROR;var r,o=this.getLocalGeoFencing(),h=!1;null!=o&&o.id&&(r=s.find((function(t){return t.id===(null==o?void 0:o.id)})))&&(h=!0,n={id:null==o?void 0:o.id,accesshub:(null==o?void 0:o.accesshub)||(null==r?void 0:r.accesshub),logreport:null==r?void 0:r.logreport,detaillog:null==r?void 0:r.detaillog},null!=o&&o.accesshub&&e.push(null==o?void 0:o.accesshub),e.push(null==r?void 0:r.accesshub)),h||(n={id:(r=s[0]).id,accesshub:h=r.accesshub,logreport:r.logreport,detaillog:r.detaillog},e.push(h)),this.Zt.geoFencing=n,this.$t.info("".concat(yt," use geo ").concat(JSON.stringify(this.Zt.geoFencing))),i=e}this.$t.info("".concat(yt," domains ").concat(JSON.stringify(i))),s=i.map((function(t){return"wss://".concat(t,"/accesshub")})),this.netAgent.setBackupDomains(ot.primaryDomains),this.netAgent.setNetAgentDefaultServers(s),!this.Zt.geoFencing&&null!=(r=this._options)&&r.accessURL&&this.netAgent.setNetAgentSpecifiedServers([null==(h=this._options)?void 0:h.accessURL]),null!=(n=this._options)&&n.customDomain&&(e="wss://accesshub-wss."+this._options.customDomain+"/accesshub",this.Zt.geoFencing&&(this._replaceMainDomain(this._options.customDomain),e="wss://".concat(null==(i=this.Zt.geoFencing)?void 0:i.accesshub,"/accesshub")),this.netAgent.setNetAgentSpecifiedServers([e])),this.dispatchServers=[],this.Zt.geoFencing?this.dispatchServers=s:this.dispatchServers=this._getDispatchUrl(),this.netAgent.setDispatchConnectServers(this.dispatchServers)},se.prototype._getMainDomain=function(t){return(t=t.split("."))[t.length-2]+"."+t[t.length-1]},se.prototype._replaceMainDomain=function(t){var i,n;this.Zt.geoFencing&&(n=this._getMainDomain(null==(n=this.Zt.geoFencing)?void 0:n.accesshub),this.Zt.geoFencing.accesshub=null==(i=this.Zt.geoFencing)?void 0:i.accesshub.replace(n,t),this.Zt.geoFencing.logreport=null==(i=this.Zt.geoFencing)?void 0:i.logreport.replace(n,t),this.Zt.geoFencing.detaillog=null==(i=this.Zt.geoFencing)?void 0:i.detaillog.replace(n,t))},se.prototype._getDispatchUrl=function(){var t=z(et+"_"+this.Zt.appid+"_"+(this.Zt.mode||ot.modeNo));if(t&&(t=U(t,nt)))try{return JSON.parse(t)}catch(t){}return[]},se.prototype._bindWindowListener=function(){var t=this,i=navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPhone/i),n=D(),e="micromessenger"==(s=navigator.userAgent).toLowerCase().match(/MicroMessenger/i),s=-1<s.indexOf("Android")||-1<s.indexOf("Adr"),r=i||e&&s?"pagehide":"Firefox"===n?"beforeunload":"unload";window.addEventListener(r,(function(){return te(t,void 0,void 0,(function(){return ie(this,(function(t){switch(t.label){case 0:return this.$t.info("zm.wl "+r),this.Qt.setUnloadState(u.I),this._onBeforePageUnload?[4,this._onBeforePageUnload()]:[3,2];case 1:t.sent(),t.label=2;case 2:return this.logoutRoom(),[2]}}))}))})),window.addEventListener("offline",(function(){t._netOffLineHandle()})),window.addEventListener("online",(function(){t._netOnLineHandle()}))},se.prototype.retryRoom=function(){var t=this;this.Zt.roomModulesList.forEach((function(i){i.roomTryHandler&&t.netAgent.isConnect()&&(i.resetSessionInfo(),i.roomTryHandler.active(!0))}))},se.prototype._netOnLineHandle=function(){this.$t.info("zm.wl network is online"),this.Zt.networkState=h.online},se.prototype._netOffLineHandle=function(){this.$t.info("zm.wl network is broken"),this.Zt.networkState=h.offline},se.prototype.setLogConfig=function(t){this.$t.info(vt+" call");var i,n=this.Qt.createSpan(u.H,{key:Yt.event},{key:Zt.event},Zt.event);if(t.logLevel&&["debug","info","warn","error","report","disable"].includes(t.logLevel)&&(this.$t.setLogLevel(t.logLevel),n.setAttributes({log_level:Zt.log_level(t.logLevel)})),t.remoteLogLevel&&["debug","info","warn","error","report","disable"].includes(t.remoteLogLevel)&&n.setAttributes({remote_log_level:Zt.remote_log_level(t.remoteLogLevel)}),Object(L.f)(t.logURL)&&(t.logURL.startsWith("wss://")||t.logURL.startsWith("https://")))null!=(i=this.Zt.geoFencing)&&i.logreport?this.$t.info(vt+" geo exist"):(this.$t.setLogServer(t.logURL),0===this.Zt.ENV&&(this.Zt.logDomain=null==(i=this.$t.url)?void 0:i.split("/")[2],this.Qt.setConfig({serverUrl:"wss://"+this.Zt.logDomain+"/zglog/tlog"}))),n.setAttributes({log_url:Zt.log_url(t.logURL)}),n.end();else if(t.logURL)return this.$t.error(vt+"log url must be a wss or https url"),this.Qt.setError(n,Zt.error.kInvalidParamError),!1;return this.$t.info(vt+" call success"),n.end(),!0},se.prototype.setDebugVerbose=function(t){var i=this.Qt.createSpan(u.H,{key:Yt.event},{key:Kt},Kt);Object(L.b)(t)&&(this.Zt.debug=t,this.Zt.debugCustom=!0,i.setAttributes({debug:Wt(t?"true":"false")})),i.end(),this.$t.info("zm.sdv call success")},se.prototype._setDebug=function(t){Object(L.f)(t)&&-1<t.indexOf("wss")?this.Zt.debug=Z(t):Array.isArray(t)&&0<t.length&&t.every((function(t){return Object(L.f)(t)&&-1<t.indexOf("wss")}))?this.Zt.debug=Z(t[0]):this.$t.info("zm.0 server wrong"),this.Zt.testEnvironment=this.Zt.debug},se.prototype.renewToken=function(t,i){var n,e,s,r,o=this,h=this.Qt.createSpan(u.H,{key:ti.event,par:i},{key:""},ri.event);return Object(L.g)(i)||Object(L.f)(i)&&""!=i?(e=this.getRoomModules(i)||this.Zt.roomModulesList[0])?Object(L.f)(t)&&e.roomTryHandler?(t===e.roomTryHandler.token?(this.$t.info(Tt+" token has not changed"),h.setAttributes({error:ri.error.INPUT_PARAM.code,message:"token has not changed"}),h.end()):(h.setAttributes({token:ri.token(t)}),this.Zt.configRoomAuth?(s=function(i){var n;null!=(n=e.roomTryHandler)&&n.renewLocalToken(t,null==(n=null==i?void 0:i.body)?void 0:n.token_remain_time),o.cloudSetting.setToken(t),o.Qt.setReporterInfo(o.Zt.idName||"",t),o.Zt.configCheckToken=!0,h.end(),o.$t.info(Tt+" "+JSON.stringify(i))},r=function(i){var n=null==(n=null==i?void 0:i.body)?void 0:n.err_code;o.Qt.setError(h,i),!n||1000002014!==n&&2014!==n?o.$t.error(Tt+" "+JSON.stringify(i)):(o.Zt.configCheckToken=!1,null!=(n=e.roomTryHandler)&&n.renewLocalToken(t),o.cloudSetting.setToken(t),o.$t.warn(Tt+" "+JSON.stringify(i)))},this.isUseNetAgent?null!=(n=this.liveRoomHandler)&&n.renewToken({token:t},s,r,e):this.service.sendMessage("renew_token",{token:t},s,r,void 0,{sessionID:e.sessionID,roomID:i,roomSessionID:e.roomSessionID})):(null!=(n=e.roomTryHandler)&&n.renewLocalToken(t),this.cloudSetting.setToken(t),this.Qt.setReporterInfo(this.Zt.idName||"",t),h.end())),!0):(Object(L.f)(t)&&!e.roomTryHandler?(this.$t.error(Tt+" calling must after loginRoom"),this.Qt.setError(h,ri.error.NOT_LOGIN)):(this.$t.error(Tt+" token must be string and not empty"),this.Qt.setError(h,ri.error.INPUT_PARAM)),!1):(this.$t.error(Tt+" calling must after loginRoom"),this.Qt.setError(h,ri.error.NOT_LOGIN),!1):(this.$t.error(Tt+" roomID must be string and no empty"),!1)},se.prototype.setCloudSettingURLs=function(t){var i=this;this.$t.info("zm.scsu call "),Array.isArray(t)&&0<t.length&&t.every((function(t){return Object(L.f)(t)&&-1<t.indexOf("http")}))&&this.cloudSetting.init({productNum:1,appID:this.Zt.appid,env:this.Zt.ENV,pollingNotify:function(t,n){i.$t.info("zm.scsu"," setting file changed "+t+" "+JSON.stringify(n)),i.Zt.actionListener("_cloudSettingNotify",t,n)},reportNotify:this._cloudReportNotify.bind(this),online:!this.Zt.testEnvironment,unify:this.isUseNetAgent,connection:this.netAgent})},se.prototype.loginRoom=function(t,i,n,e){var s=this;return this.$t.info(mt+" call by user "+(null==n?void 0:n.userID)+" "+t+" "+this.version),new Promise((function(r,u){return te(s,void 0,void 0,(function(){var s,c,a,f,l;return ie(this,(function(_){switch(_.label){case 0:return 1!==this.Zt.ENV?[3,2]:[4,new Promise((function(t){}))];case 1:_.sent(),_.label=2;case 2:return c=this._loginReport(r,u,t,i,e),f=c.interResolve,s=c.interReject,c=c.loginSpan,(e=e||{}).maxMemberCount||(e.maxMemberCount=0),a=this.getRoomModules(t),l=ti.error,a?(this.$t.setSessionInfo(this.Zt.appid,t,"",n.userID,"",this.Zt.sdKVersion),s(l.REPEATEDLY_LOGIN)):((a=new en(t,this.Zt,this.$t,this._dataReport,this,this.liveRoomHandler,this.service)).roomTryHandler||(a.roomTryHandler=new Bi(this.$t,this.Zt,a)),a.roomTryHandler.init(this.Zt.roomRetryTime),a.roomTryHandler.initRoom(a.roomHandler,t,i,n,this.Zt.server,this.Zt.serverBak,e),a.roomTryHandler.setLoginRoomCallback(f,s),a.roomHandler._roomStateHandle("CONNECTING",O.Logining,{code:0,msg:""}),(f=function(t,i){var n,e,s=[],r={};for(n in t)r[t[n].order]=t[n],t[n].key=n;for(e in r)s.push(r[e]);for(var o=0;o<s.length;o++)for(var u=s[o].rules,h=0;h<u.length;h++){var c={key:s[o].key,value:s[o].value,action:i.action,logger:i.logger},a=c.value,f=u[h].name?""+u[h].name:"";if((void 0===a&&f===qi.NOT_EMPTY||void 0!==a)&&Ji[f]&&(f=Ji[f](c.key,a,c.action,c.logger,u[h]))!=Vi)return f}return Vi}({roomID:{order:0,value:t,rules:[{name:qi.NOT_EMPTY,error:l.ROOM_ID_NULL},{name:qi.TYPE_STRING,error:l.INPUT_PARAM,extMsg:"roomID must be string"},{name:qi.MAX_LENGTH_128,error:l.ROOM_ID_TOO_LONG},{name:qi.ILLEGAL_CHARACTERS,error:l.ROOM_ID_INVALID_CHARACTER}]},token:{order:1,value:i,rules:[{name:qi.NOT_EMPTY,error:l.INPUT_PARAM},{name:qi.TYPE_STRING,error:l.INPUT_PARAM}]},user:{order:2,value:n,rules:[{name:qi.NOT_EMPTY,error:l.INPUT_PARAM,extMsg:" param user error."},{name:qi.TYPE_OBJECT,error:l.INPUT_PARAM,extMsg:" param user error."}]},"user.userID":{order:3,value:n.userID,rules:[{name:qi.NOT_EMPTY,error:l.USER_ID_NULL,extMsg:" param user error."},{name:qi.TYPE_STRING,error:l.INPUT_PARAM,extMsg:" param userID error."},{name:qi.MAX_LENGTH_64,error:l.USER_ID_TOO_LONG},{name:qi.ILLEGAL_CHARACTERS,error:l.USER_ID_INVALID_CHARACTER}]},"user.userName":{order:4,value:n.userName,rules:[{name:qi.TYPE_STRING,error:l.INPUT_PARAM,extMsg:" userName must be string."},{name:qi.MAX_LENGTH_256,error:l.USER_NAME_TOO_LONG}]},config:{order:5,value:e,rules:[]},"config.maxMemberCount":{order:6,value:e.maxMemberCount,rules:[{name:qi.TYPE_INTEGER,error:l.INPUT_PARAM,extMsg:" maxMemberCount must be integer number."}]}},{action:mt,logger:this.$t}))!==Vi?(a.roomHandler._roomStateHandle("DISCONNECTED",O.LoginFailed,f.error,f.extMsg),s(f.error,f.extMsg)):(this.$t.setSessionInfo(this.Zt.appid,"","",n.userID,"",this.version),0<this.Zt.roomModulesList.length&&1==this.Zt.isMultiRoom?a.isMulti=!0:ne([],this.Zt.roomModulesList,!0).forEach((function(t){return t.roomHandler.logout()})),e&&(a.config=e),this.Zt.roomModulesList.push(a),this.netAgent&&(this.Zt.idName=n.userID,this.netAgent.setUserInfo(n.userID),this.Zt.actionListener("_roomLogin",t,i),this.netAgent.isConnect())&&this.fetchAppConfig(i),this.cloudSetting.setUserID(n.userID),this.cloudSetting.setToken(i),this.cloudSetting.activePolling(),c.setAttributes({id_name:n.userID}),this.Qt.setCommonAttributes({id_name:n.userID}),this.Qt.setReporterInfo(n.userID,i),this.$t.setTokenInfo(i,n.userID),this.Qt.setSpanInMap(c,{key:ti.event,par:t}),l=this.Zt.settingConfig.getSetting("room_server",!0),Array.isArray(l)&&0<l.length&&(this.$t.info(mt," setting room_server "+l),this.Zt.server=l[0],this.Zt.serverBak=l[1]||l[0]),this.Zt.setMultiRoom=!0,a.roomTryHandler.startMaxTime(),this.isUseNetAgent&&!this.netAgent.isConnect()?(this.$t.info(mt," us is not connected"),a.roomHandler.setRunState(o.trylogin),this.netAgent.connectUa()):(this.isUseNetAgent&&(this.Zt.networkState=h.online),a.roomTryHandler.active(!0)))),[2]}}))}))}))},se.prototype.handleLogUpload=function(t){var i="";t&&t.app_config?i=t.app_config.domain:this.Zt.appConfig&&this.Zt.appConfig.app_config&&(i=this.Zt.appConfig.app_config.domain),this.$t.info(Et+" call"),this.$t.url?this.$t.info(Et+" log is connected"):(null!=(t=this.Zt.geoFencing)&&t.logreport?(this.Zt.logDomain=null==(t=this.Zt.geoFencing)?void 0:t.logreport,i=this._getMainDomain(null==(t=this.Zt.geoFencing)?void 0:t.logreport)):this.Zt.testEnvironment?(this.Zt.logDomain="weblogger-hk-test.zegocloud.com",i="zegocloud.com"):this.Zt.logDomain="weblogger".concat(this.Zt.appid,"-api.").concat(i),i?(t="",0===this.Zt.ENV?(t="wss://".concat(this.Zt.logDomain,"/log"),this.Qt.setConfig({serverUrl:"wss://".concat(this.Zt.logDomain,"/zglog/tlog")})):t="https://".concat(this.Zt.logDomain,"/httplog"),this.$t.setLogServer(t)):this.$t.warn(Et+" appconfig no domain"))},se.prototype.fetchAppConfigByTargetToken=function(t,i){return te(this,void 0,void 0,(function(){var n,e,s,r,o,u;return ie(this,(function(h){switch(h.label){case 0:if(this.$t.info(bt+" call"),!i)return this.$t.warn(bt+" user not exist"),[2];if(n=this.getUserID(),e="",s=null,t)e=t;else{if(!(0<this.Zt.roomModulesList.length))return this.$t.warn(bt+" token not exist"),[2];e=this.getToken()}this.$t.roomid||this.$t.setSessionInfo(this.Zt.appid,"player-no-room","",i,"",this.Zt.sdKVersion),h.label=1;case 1:return h.trys.push([1,3,4,5]),this.netAgent.setUserInfo(i),[4,this.netAgent.getAppConfigByAgent("init",e,5e3)];case 2:return r=h.sent(),o=r.code,u=r.data,r.retryCount,0===o&&(this.handleLogUpload(u),s=u),[3,5];case 3:return h.sent(),this.$t.error(bt+" token not validated"),[3,5];case 4:return n&&this.netAgent.setUserInfo(n),this.$t.info(bt+" call success"),[2,s];case 5:return[2]}}))}))},se.prototype.fetchAppConfig=function(t){return te(this,void 0,void 0,(function(){var i,n,e,s,r,o,h,c;return ie(this,(function(a){switch(a.label){case 0:if(this.Zt.appConfigFetched)return this.$t.warn(pt+" config fetched"),[2];if(!this.getUserID())return this.$t.warn(pt+" user not exist"),[2];if(i="",t)i=t;else{if(!(0<this.Zt.roomModulesList.length))return this.$t.warn(pt+" token not exist"),[2];i=this.getToken()}n=this.Qt.createSpan(u.H,{key:Yt.event},{key:""},"/sdk_config/init"),this.$t.info(mt+" initConfig etag: "+this.Zt.appConfigEtag),e=!!this.Zt.appConfig,a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.netAgent.getAppConfigByAgent("init",i,5e3,this.Zt.appConfigEtag)];case 2:if(r=a.sent(),h=r.code,c=r.data,s=r.etag,r=r.retryCount,n.setAttributes({trigger_reason:Ui(this.Zt.appConfig?"refresh":"normal"),try_count:ji(r||0)}),n.end(),this.Zt.appConfigFetched=!0,this.$t.info(mt+" initConfig code:"+h+" data: "+JSON.stringify(c)+" etag: "+s),this.Zt.appConfigEtag!==s){if(0==Object.keys(c).length)return this.$t.info(mt+" initConfig data null"),[2];r=c.app_config,h=c.media_config,o=h.publish_config,h=h.play_config,c=c.speedlog_config.charge_info_report_no_playing,this.Zt.appConfig={app_config:r,media_config:{publish_config:o,play_config:h},speedlog_config:{charge_info_report_no_playing:c||0}},this.Zt.appConfigEtag=s,r=JSON.stringify(this.Zt.appConfig),o=M(r,nt),j(st+"_"+this.getAppID()+"_"+(this.Zt.mode||ot.modeNo),o),h=M(this.Zt.appConfigEtag+"",nt),j(rt+"_"+this.getAppID()+"_"+(this.Zt.mode||ot.modeNo),h)}return this.handleLogUpload(),!e&&this.Zt.appConfig&&this.Zt.actionListener("_appConfigRsp"),!this.Zt.netAppConfig&&this.Zt.appConfig&&(this.Zt.netAppConfig=Object.assign(this.Zt.appConfig),this.Zt.actionListener("_netAppConfigRsp",this.Zt.netAppConfig),this._onAppConfigUpdate)&&this._onAppConfigUpdate(this.Zt.netAppConfig),[3,4];case 3:return c=a.sent(),this.$t.error(mt+" fail "+JSON.stringify(c)),n.setAttributes({error:null==c?void 0:c.code}),n.end(),[20012,20008].includes(null==c?void 0:c.code)&&this.Zt.roomModulesList.forEach((function(t){t.roomTryHandler&&t.roomTryHandler.loginFail(I.APPID_INVALID)})),[3,4];case 4:return[2]}}))}))},se.prototype._getCloudSetting=function(){var t,i=this;null!=(t=this.cloudSetting)&&t.fetchMultiSetting([it,"room","rtc"]).then((function(t){var n,e;i.$t.info(mt," settingConfig "+JSON.stringify(t)),t&&(i.Zt.settingConfig.setSetting(null==(e=null==t?void 0:t.init)?void 0:e.setting,["remote_log_level","zip_log","detaillog_domain"]),i.Zt.actionListener("_settingCanFetch",null==t?void 0:t.rtc),(e=i.Zt.settingConfig.getSetting("remote_log_level",!0))&&(i.$t.info("".concat(mt,"  setting remote_log_level ").concat(e)),i.$t.setRemoteLogLevel(e)),t=i.Zt.settingConfig.getSetting("zip_log"),Object(L.g)(t)||(i.$t.info("".concat(dt," force setting zip_log ").concat(t)),i.$t.setZipLogConfig(t,!0)),i._handleZipLogUrl(),(e=i.Zt.settingConfig.getSetting("unify",i.Zt.netHasSet))&&(i.$t.info("".concat(mt," unify ").concat(JSON.stringify(e))),t=e.enable,e=e.sdk_conn_ver,n=!0,n=!!(t&&e<=ot.connectVer),!0===i.isUseNetAgent)&&!1===n&&(i.cloudSetting.setOptions({unify:!1}),"connecting"!==i.Zt.connectState&&(i.Zt.connectState="connecting",i.Zt.actionListener("_connectChanged","connecting")),t=ne([],i.Zt.roomModulesList,!0),ne([],i.Zt.roomModulesList,!0).forEach((function(t){t.roomHandler.logout(!0,!0)})),i.Zt.useNetAgent=n,t.forEach((function(t){var n;i.Zt.roomModulesList.push(t),t.roomTryHandler||(t.roomTryHandler=new Bi(i.$t,i.Zt,t)),t.roomTryHandler.init(i.Zt.roomRetryTime),t.roomTryHandler.initRoom(t.roomHandler,t.roomID,t.token,{userID:i.Zt.idName,userName:i.Zt.nickName},i.Zt.server,i.Zt.serverBak,t.config),null!=(n=t.roomTryHandler)&&n.startMaxTime(),t.roomTryHandler.onactive=function(n,e){n?"connected"!==i.Zt.connectState&&(i.Zt.connectState="connected",i.Zt.actionListener("_connectChanged","connected",{roomID:t.roomID})):(i.$t.info(mt," onactive"),t.roomHandler.transError(e),t.roomHandler.disconnectedHandle(e))},null!=(n=t.roomTryHandler)&&n.active()}))),e=i.Zt.settingConfig.getSetting("report_script"))&&(n=e.url,t=e.key,e=e.hash,i.$t.info("".concat(mt," report script ").concat(n," ").concat(t," ").concat(e)),i.Qt.loadScript(!0,n,t,e))})).catch((function(t){i.$t.warn(mt," settingConfig "+JSON.stringify(t))})),this.Zt.onListener("_cloudSettingNotify",(function(t,n){var e=i.cloudSetting.getEnvVariables()||{},s=i.Qt.createSpan(u.H,{key:Yt.event},{key:""},"/cloud_setting/refresh");s.setAttributes({request_kv:Ei(e),files:yi([{name:t,content:n.setting,versions:n.versions,code:null==n?void 0:n.code,message:null==n?void 0:n.message}])}),s.end(),t===it&&(i.Zt.settingConfig.setSetting(null==n?void 0:n.setting,["remote_log_level"]),e=i.Zt.settingConfig.getSetting("remote_log_level"))&&(i.$t.info(mt," setting remote_log_level "+e),i.$t.setRemoteLogLevel(e))}))},se.prototype._cloudReportNotify=function(t,i,n){0!==(null==n?void 0:n.code)||!1===(null==n?void 0:n.polling)?"request_start"===i?this.Qt.createSpan(u.H,{key:Yt.event},{key:Si,par:t+""},Si,!0):"request_end"===i&&this.Qt.spanEnd({key:Si,par:t+""},{request_detail:Oi(null==n?void 0:n.reportData),files:Ri(null==n?void 0:n.files),code:null==n?void 0:n.code,request_params:null==n?void 0:n.params,request_kv:null==n?void 0:n.requestKV}):this.$t.info("zm.crn not report")},se.prototype._loginReport=function(t,i,n,e,s){var r=this,o=ti,h=this.Qt.createSpan(u.I,{key:Yt.event},{key:""},o.event);return h.setAttributes({svr_env:o.svr_env(this.Zt.testEnvironment?"test":"online"),token:o.token(e)}),s&&(Object(L.b)(s.userUpdate)&&h.setAttribute("user_state_update",o.user_state_update(s.userUpdate?1:0)),Object(L.d)(s.maxMemberCount))&&h.setAttributes({max_member_cnt:o.max_member_cnt(s.maxMemberCount)}),{interResolve:function(i){var e=r.getRoomSessionID(n),s=r.getRoomModules(n),u=r.getSessionId(n);h.setAttributes({room_id:o.room_id(n),room_sid_string:o.room_sid_string(e),liveroom_sid_string:o.liveroom_sid_string(u),try_cnt:o.try_cnt(null==(e=null==s?void 0:s.roomTryHandler)?void 0:e.retryActiveCount),server:o.server(null==(u=null==s?void 0:s.roomHandler)?void 0:u.server),room_mode:o.room_mode(r.Zt.isMultiRoom?1:0),role:o.role(r.Zt.role),audience_create_room:o.audience_create_room(r.Zt.roomCreateFlag?1:0),max_member_cnt:o.max_member_cnt((null==s?void 0:s.maxMemberCount)||0)}),h.end(),t(i)},interReject:function(t,e){var s,u;void 0===e&&(e=""),h.setAttributes({room_id:o.room_id(n)}),t.code<2e9&&1e9<t.code||t.code<1e6?(s=F(t.code,t.msg),u=K(t.code,r.isUseNetAgent)):s={code:t.code,message:t.msg},s&&r.Qt.setError(h,{code:s.code,msg:s.message+e}),u&&I[u]&&(t.code=I[u].code,t.msg.includes("unknown"))&&(t.msg=I[u].msg),t.code&&t.msg&&""!==e?i({code:t.code,msg:t.msg+e}):i(t)},loginSpan:h}},se.prototype.logoutRoom=function(t){var i=this,n=(this.$t.info(gt+" call by user "+t),[]);if(this.Zt.roomModulesList.length){if(void 0===t)ne([],this.Zt.roomModulesList,!0).forEach((function(t){i._logoutSpan(t),n.push(t.roomID),t.roomHandler.logout(!0)})),this.cloudSetting.uninit();else{if(!Object(L.f)(t)||""==t)return this.$t.error(gt+" roomID must be string and not empty"),void this._logoutSpan(void 0,oi.error.INPUT_PARAM);var e=this.getRoomModules(t);e?(this._logoutSpan(e),n.push(t),e.roomHandler.logout(),0===this.Zt.roomModulesList.length&&this.cloudSetting.uninit()):(this.$t.error(gt+" room not exist"),this._logoutSpan(void 0,oi.error.ROOM_NOT_EXIST,t))}this.Qt.deleteCommonAttributes(["id_name"]),this.Qt.clearRoomSpans(n)}else this.$t.warn(gt+" no room")},se.prototype.uploadLog=function(){var t=this;return new Promise((function(i,n){t.$t.info("zm.zip.udlg call"),t.$t.uploadStorageLog().then((function(){t.$t.info("zm.zip.udlg call success"),i({errorCode:0,extendedData:"upload logs success!"})})).catch((function(i){t.$t.error("zm.zip.udlg upload zip log failed, result: "+((null==i?void 0:i.message)||"unknown")),n({errorCode:I.UPLOAD_LOG_ERROR.code,extendedData:I.UPLOAD_LOG_ERROR.msg+", result: "+((null==i?void 0:i.message)||"unknown")})}))}))},se.prototype.sendCustomCommand=function(t,i,n){return new Promise((function(t,i){console.error(R),i()}))},se.prototype._sendCustomCommand=function(t,i,n){return new Promise((function(t,i){console.error(R),i()}))},se.prototype.sendBroadcastMessage=function(t,i){return new Promise((function(t,i){console.error(R),i()}))},se.prototype._sendBroadcastMessage=function(t,i,n,e){return void 0===n&&(n=1),void 0===e&&(e=1),new Promise((function(t,i){console.error(R),i()}))},se.prototype.setRoomExtraInfo=function(t,i,n){return new Promise((function(t,i){console.error(R),i()}))},se.prototype._setRoomExtraInfo=function(t,i,n){return new Promise((function(t,i){console.error(R),i()}))},se.prototype.sendBarrageMessage=function(t,i){return new Promise((function(t,i){console.error(R),i()}))},se.prototype._sendBarrageMessage=function(t,i,n,e){return void 0===n&&(n=1),void 0===e&&(e=1),new Promise((function(t,i){console.error(R),i()}))},se.prototype.sendRelayMessage=function(t,i,n,e,s){console.error(R)},se.prototype.requestJoinLive=function(t,i,n,e,s){return console.error(R),!1},se.prototype.inviteJoinLive=function(t,i,n,e,s){return console.error(R),!1},se.prototype.endJoinLive=function(t,i,n,e){return console.error(R),!1},se.prototype.respondJoinLive=function(t,i,n,e,s){return console.error(R),!1},se.prototype.getVersion=function(){return this.version},se.prototype.setSdkBizVersion=function(t){Object(L.f)(t)&&""!==t&&(this.Zt.bizVersion=t)},se.prototype.on=function(t,i){var n=this.Qt.createSpan(u.H,{key:Ft},{key:""},Xt.event);return n.setAttributes({listener:Xt.listener(t)}),this.Zt.listenerList[t]?Object(L.c)(i)?(-1==this.Zt.listenerList[t].indexOf(i)&&this.Zt.listenerList[t].push(i),n.end(),!0):(this.$t.error(Rt+" listener callBack must be funciton"),this.Qt.setError(n,Xt.error.INPUT_PARAM," listener callBack must be function"),!1):(this.$t.error(Rt+" event "+t+" no found"),this.Qt.setError(n,Xt.error.INPUT_PARAM," event "+t+" no found"),!1)},se.prototype.off=function(t,i){var n,e=this.Qt.createSpan(u.H,{key:Ft},{key:""},"/sdk/off_listener");return e.setAttributes({listener:Qt(t)}),this.Zt.listenerList[t]?(n=this.Zt.listenerList[t],i?0<=(i=n.indexOf(i))&&n.splice(i,1):this.Zt.listenerList[t]=[],e.end(),!0):(this.$t.error("zm.off listener no found"),this.Qt.setError(e,Xt.error.INPUT_PARAM," event "+t+" no found"),!1)},se.prototype._on=function(t,i){return this.Zt.listenerList[t]?Object(L.c)(i)?(-1==this.Zt.listenerList[t].indexOf(i)&&this.Zt.listenerList[t].push(i),!0):(this.$t.error(Rt+" listener callBack must be funciton"),!1):(this.$t.error(Rt+" event "+t+" no found"),!1)},se.prototype._off=function(t,i){var n;return this.Zt.listenerList[t]?(n=this.Zt.listenerList[t],i?n.splice(n.indexOf(i),1):this.Zt.listenerList[t]=[],!0):(this.$t.error("zm.off listener no found"),!1)},se.prototype.isTestEnvironment=function(){return this.Zt.testEnvironment},se.prototype.isLogin=function(t){return!!(t=this.getRoomModules(t)||this.Zt.roomModulesList[0])&&t.isLogin()},se.prototype.getMultiRoom=function(){return this.Zt.isMultiRoom},se.prototype.getAppID=function(){return this.Zt.appid},se.prototype.getUserID=function(){return this.Zt.idName},se.prototype.getUserName=function(){return this.Zt.nickName},se.prototype.getToken=function(t){return(this.getRoomModules(t)||this.Zt.roomModulesList[0]).token},se.prototype.setRoomCreateFlag=function(t){this.Zt.roomCreateFlag=t},se.prototype.setRole=function(t){this.Zt.role=t},se.prototype.getSessionId=function(t){return(t=this.getRoomModules(t)||this.Zt.roomModulesList[0])?t.userSidString:"0"},se.prototype.getRoomSessionID=function(t){return(t=this.getRoomModules(t)||this.Zt.roomModulesList[0])?t.roomSidString:"0"},se.prototype.getAppConfig=function(){return this.Zt.appConfig},se.prototype.setTestPackageSize=function(t){this.cloudSetting.zegoSetting.settingFetchHandler.testNetPackageSize=t,this.Zt.testNetPackageSize=t},se.prototype.setCloudEnv=function(t){this.cloudSetting&&(this.cloudSetting.zegoSetting.options.online="online"===t)},se.prototype.setAccess=function(t){this.Zt.configOK&&(this.Zt.netHasSet=!0,this.Zt.useNetAgent=t,this.Zt.useNetAgent=this.getSettingUnify(!0),this.netAgent.setAccess(this.isUseNetAgent),this.cloudSetting.setOptions({unify:this.isUseNetAgent}))},se.prototype.enableMultiRoom=function(t){var i=this.Qt.createSpan(u.H,{key:Yt.event},{key:""},pi.event);return Object(L.b)(t)?(i.setAttribute("is_multi",pi.is_multi(t)),0<this.Zt.roomModulesList.length||this.Zt.setMultiRoom?(this.$t.error("zm.emr multi room can only be set once before first login"),this.Qt.setError(i,pi.error.kInvalidParamError),!1):(i.end(),this.Zt.isMultiRoom=t,this.Zt.setMultiRoom=!0)):(this.$t.error("zm.emr param must be boolean"),this.Qt.setError(i,pi.error.kAlreadyLoginError),!1)},se.prototype.getRoomModules=function(t){return this.Zt.roomModulesList.find((function(i){return i.roomID==t}))},se.prototype._onAppConfigUpdate=function(t){},se.prototype._onBeforePageUnload=function(){},se.use=function(t){switch(t.type){case"message":case"live":t.install(se,en,on,Un)}},se.setGeoFence=function(t,i){if(![0,1,2].includes(t))throw new Error("GeoFencing set Error");if(!i.every((function(t){return ht.find((function(i){return i===t}))})))throw new Error("GeoFencing set Error");se.geoFenceType=t,se.geoFenceAreaList=i},se.setEngineOptions=function(t){if(t.geoFenceType){if(![0,1,2].includes(t.geoFenceType))throw new Error("GeoFencing set Error");se.geoFenceType=t.geoFenceType}if(t.geoFenceAreaList){if(!t.geoFenceAreaList.every((function(t){return ut.find((function(i){return i.id===t}))})))throw new Error("GeoFencing set Error");se.geoFenceAreaList=t.geoFenceAreaList}se.engineOptions=t},se.prototype.resetRoomTokenTimer=function(t,i){(t=this.getRoomModules(t)||this.Zt.roomModulesList[0])&&i&&0<i&&t.roomHandler.resetTokenTimer(1e3*i)},se.prototype.isDisConnect=function(){return(this.isUseNetAgent?this.liveRoomHandler:this.service).isDisConnect()},se.prototype.sendMessage=function(t,i,n,e){this.liveRoomHandler.sendMessage(t,i,n,e)},se.prototype.getNetworkInfo=function(){return this.netAgent.getNTP()},se.prototype.setProtoFormat=function(t){if(!["json","pb"].includes(t=void 0===t?"json":t))throw new Error("Failed to execute 'setProtoFormat': Arguments 'format' must be 'json' or 'pb'.");this.Zt.protoFormat=t},se.prototype.setSdkLoginRelateService=function(t){Array.isArray(t)&&t.every((function(t){return Object(L.f)(t)}))&&(this.Zt.relateService=t)},se.prototype.getRoomID=function(){return this.Zt.roomid},se.prototype.getServerTimeOffset=function(){return this.Zt.serverTimeOffset},se.prototype.getReqHead=function(t){return t=Object(L.f)(t)&&""!==t&&this.getRoomModules(t)||this.Zt.roomModulesList[0],this.liveRoomHandler.getReqHead(t)},se.prototype.sendSwitchMessage=function(t,i){throw this.$t.error("".concat("zm.ssm"," ").concat(I.WHITE_BOARD_VERSION_ERROR.msg)),I.WHITE_BOARD_VERSION_ERROR},se.prototype.onSwitchMessage=function(t){t&&this.liveRoomHandler&&(this.liveRoomHandler.onSwitchMessage=t)},se.prototype.onAppConfigUpdate=function(t){t&&(this._onAppConfigUpdate=t)},se.prototype.onBeforePageUnload=function(t){t&&(this._onBeforePageUnload=t)},se.prototype.getProtoVer=function(){return e.SWITCH_TWO},se.prototype.sendBusinessMessage=function(t,i,n){return Object(L.d)(t)&&i?this.liveRoomHandler.sendMessage(t,i,void 0,void 0,n,void 0,!1):-1},se.prototype._logoutSpan=function(t,i,n){var e=this,s=this.Qt.createSpan(u.I,{key:Yt.event},{key:oi.event,par:null==t?void 0:t.roomID},oi.event,!0);s.setAttributes({is_multi:oi.is_multi(this.Zt.isMultiRoom),is_send_cmd_net:oi.is_send_cmd_net(!0)}),t?s.setAttributes({room_id:oi.room_id(null==t?void 0:t.roomID),room_sid_string:oi.room_sid_string(null==t?void 0:t.roomSidString),liveroom_sid_string:oi.liveroom_sid_string(null==t?void 0:t.userSidString)}):Object(L.f)(n)&&s.setAttributes({room_id:oi.room_id(n)}),i?this.Qt.setError(s,i):s.end(),setTimeout((function(){e.Qt.flush()}),200)},se.prototype.getMsgSpan=function(t,i,n){return this.Qt.createSpan(u.H,{key:ti.event,par:i},{key:t,par:i},t,n=void 0!==n&&n)},se.prototype._updateTimeOffsetInterval=function(){var t=this;Object(L.d)(this.netAgent.timeOffset)&&this.Qt.setTimeOffset(this.netAgent.timeOffset),this.timeOffsetUpdateTimer=setTimeout((function(){t._updateTimeOffsetInterval()}),9e5)},se.prototype.setLocalGeoFencing=function(){var t;null!=(t=this.Zt.netGeoFencing)&&t.id&&null!=(t=this.Zt.netGeoFencing)&&t.accesshub&&(t=M(JSON.stringify(this.Zt.netGeoFencing),nt),j("z_geos_"+this.Zt.appid+"_"+(this.Zt.mode||ot.modeNo),t),this.Zt.netGeoFencing={})},se.prototype.getLocalGeoFencing=function(){var t=z("z_geos_"+this.Zt.appid+"_"+(this.Zt.mode||ot.modeNo));if(t){if(t=U(t,nt))try{return JSON.parse(t)}catch(t){this.$t.warn("zm.glgf local geo descrypt fail")}}else this.$t.info("zm.glgf no local geo");return null},se.prototype._getGeoFencingIDAndDomain=function(t,i){var n=[];return 1===t?i.forEach((function(t){var i=ut.find((function(i){return i.id===t}));i&&n.push(i)})):2===t&&(n=JSON.parse(JSON.stringify(ut)),i.forEach((function(t){var i=ut.find((function(i){return i.id===t}));i&&(n=n.filter((function(t){return t.id!==(null==i?void 0:i.id)})),i.relative_geofencings.forEach((function(t){n=n.filter((function(i){return i.id!==t}))})))}))),0<n.length?n:null},se.setCloudProxyConfig=function(t,i,n){n?this.proxyCtrl||(this.proxyCtrl=new Xn(t,i)):(null!=(n=this.proxyCtrl)&&n.destroy(),this.proxyCtrl=null)},se.rtmVersion="2.1.0",se.pageID="",se.proxyCtrl=null,se);function se(t,i,n,e,r,o,c,a){var f,d,v,m=this,g=(r=(this.$t=n,this._dataReport=e,this.Qt=r,this.version=o,this._options=a,this.service={},this.id="",this._roomLoginResponseListener=function(){clearTimeout(m.cloudSettingTimer),m.cloudSettingTimer=setTimeout((function(){m.$t.info(mt+" fetch cloud setting"),m._getCloudSetting()}),100)},this.Zt=new Yi(this.$t,this._dataReport),this.Zt.ENV=c,this.Zt.product=tt.product,this.cloudSetting=new Ln,this.getReportSeq=_,this.getSeq=l,this._initCallback(),this.Zt.deviceID=(void 0===(n=c)&&(n=0),(e=z("z_deviceID"))||((new Date).getTime(),j("z_deviceID",e=Q(n)),e)),se.pageID||(se.pageID=Q(c)),this.Zt.id=Q(c)),this.logger.info("".concat(dt," deviceID: ").concat(this.Zt.deviceID," , pageID: ").concat(se.pageID," , instID: ").concat(r)),this.Qt.init(t,c,this.Zt.deviceID),this.Qt.setLogger(this.$t),this.Zt.reporter=this.Qt,Yt),p=this.Qt.createSpan(u.H,{key:""},{key:g.event},g.event,!0);0!=c&&1!=c||this._setDebug(i),o="Express";null!=(a=this._options)&&a.reportData&&(f=null==(e=null==(n=this._options)?void 0:n.reportData)?void 0:e.version,o=(null==(a=null==(r=this._options)?void 0:r.reportData)?void 0:a.project)||o),p.setAttributes({biz_type:g.biz_type(0),project:g.project(o),servers:g.servers(Object(L.f)(i)?[i]:i),liveroom_version:g.liveroom_version(f),is_from_cache:g.is_from_cache(!1),sev_env:g.sev_env(this.Zt.testEnvironment?"test":"online")}),function(t,i,n){if(t&&Object(L.d)(t)&&H(t)){if(i&&(Object(L.f)(i)||Array.isArray(i))&&""!=i)return 1;n.error("ccp.0 server must be string or string array and not empty")}else n.error("ccp.0 appid must be positive integer number and not empty")}(t,i,this.$t)?(this.Zt.appid=t,this.Zt.configOK=!0,this.Zt.sdKVersion=this.version,this.Zt.testEnvironment&&(this.Zt.mode=E.MODE_TEST),this.netAgent=new w,this.$t.setSessionInfo(this.Zt.appid,"","","","",this.version),this.netAgent.init(),this.netAgent.setLogger(this.$t),n={appID:this.Zt.appid,env:this.Zt.ENV,mode:this.Zt.mode},se.geoFenceType&&se.geoFenceAreaList&&(n.geoFencing={type:se.geoFenceType,list:se.geoFenceAreaList}),this.netAgent.setAppInfo(n),this.liveRoomHandler=new Un(this.$t,this.Zt,this.netAgent,this._dataReport,this),this.service=new on(this.Zt,this.$t,this),e="",0===c?e="rtc":1===c&&(e="ali"),this.Zt.settingConfig=new hn,this.cloudSetting.setLog(this.$t),this.cloudSetting.init({productNum:1,appID:t,env:c,pollingNotify:function(t,i){m.$t.info(dt," setting file changed "+t+" "+JSON.stringify(i)),m.Zt.actionListener("_cloudSettingNotify",t,i)},reportNotify:this._cloudReportNotify.bind(this),online:!this.Zt.testEnvironment,unify:this.isUseNetAgent,connection:this.netAgent}),(r=this.Zt.settingConfig.getSetting("remote_log_level"))&&(this.$t.info("".concat(dt," setting remote_log_level default ").concat(r)),this.$t.setRemoteLogLevel(r)),a=this.Zt.settingConfig.getSetting("zip_log"),Object(L.g)(a)||(this.$t.info("".concat(dt," setting zip_log default ").concat(a)),this.$t.setZipLogConfig(a)),this.cloudSetting.setEnvVariable("environment",e),o=this.cloudSetting.getSettingCache(it),f=this.cloudSetting.getSettingCache("room"),d=!1,v=setTimeout((function(){m.$t.warn("".concat(dt," time out, get cache settings failed!")),m.isUseNetAgent&&(d=!0,m._createNetAgent(),m.getStoreAppConfig()),p.setAttributes({use_na:g.use_na(m.isUseNetAgent?1:0)}),p.end()}),3e3),Promise.all([o,f]).then((function(n){v&&clearTimeout(v);var e=null==n?void 0:n[0],s=((s=(m.Zt.settingConfig.setSetting(null==e?void 0:e.setting),m.Zt.useNetAgent=m.getSettingUnify(m.Zt.netHasSet),m.cloudSetting.setOptions({unify:m.isUseNetAgent}),m.isUseNetAgent&&!d&&(m._createNetAgent(),m.getStoreAppConfig()),m.Zt.settingConfig.getSetting("remote_log_level",!0)))&&(m.$t.info("".concat(dt,"  setting remote_log_level ").concat(s)),m.$t.setRemoteLogLevel(s)),m._handleZipLogUrl(),m.Zt.settingConfig.getSetting("zip_log")),r=((s=(Object(L.g)(s)||(m.$t.info("".concat(dt," setting zip_log ").concat(s)),m.$t.setZipLogConfig(s)),m.Zt.settingConfig.getSetting("report_script")))?(r=s.url,o=s.key,s=s.hash,m.$t.info("".concat(dt," report script ").concat(r," ").concat(o," ").concat(s)),m.Qt.loadScript(!1,r,o,s),p.setAttributes({lua_md5:g.lua_md5(s)})):m.Qt.loadScript(!1,"","",""),null==n?void 0:n[1]),o=(m.Zt.settingConfig.setSetting(null==r?void 0:r.setting),m.Qt.createSpan(u.H,{key:g.event},{key:""},"/cloud_setting/cache"));o.setAttributes({files:bi([{name:it,content:JSON.stringify(null==e?void 0:e.setting),versions:JSON.stringify(null==e?void 0:e.versions),code:0,message:""},{name:"room",content:JSON.stringify(null==r?void 0:r.setting),versions:JSON.stringify(null==r?void 0:r.versions),code:0,message:""}])}),o.end(),p.setAttributes({use_na:g.use_na(m.isUseNetAgent?1:0)}),p.end(),s=Array.isArray(i)?i[0]:i;if(!m.isUseNetAgent&&(n=t,(e=((null==(e=s)?void 0:e.replace("webliveroom","-"))||"").split("-")||[])[1])&&/\d*/i.test(e[1])&&+e[1]!=n)throw m.$t.error("".concat(dt," the server does not match the appID")),new Error("The server does not match the appID")})).catch((function(t){if(v&&clearTimeout(v),p.setAttributes({use_na:g.use_na(m.isUseNetAgent?1:0)}),p.end(),m.$t.warn("".concat(dt,"  initConfig ").concat(JSON.stringify(t))),(null==t?void 0:t.code)===I.GEO_SET_ERROR.code)throw Error("GeoFencing set Error")})),Object(L.f)(i)?(this.Zt.server=i,this.Zt.serverBak=i):Array.isArray(i)&&0<i.length&&(this.Zt.server=i[0],this.Zt.serverBak=i[1]||i[0]),this.$t.info("".concat(dt,"  ").concat(null===navigator||void 0===navigator?void 0:navigator.appVersion," ").concat(this.version," rtmVersion: ").concat(se.rtmVersion," logVersion:").concat(s.ZegoLogger.logVersion)),this._bindWindowListener(),this.Zt.networkState=!navigator||navigator.onLine?h.online:h.offline,n="Firefox"===D()?null===navigator||void 0===navigator?void 0:navigator.userAgent:null===navigator||void 0===navigator?void 0:navigator.appVersion,p.setAttribute("sys_info",n||""),this._initSpans(),this.$t.setSessionInfo(this.Zt.appid,"","","","",this.version)):(this.$t.error("".concat(dt," init sdk error")),this.Qt.setError(p,g.error.kInvalidParamError)),this.Zt.onListener("roomLoginResponse",this._roomLoginResponseListener)}var re=n(8),oe=function(){return(oe=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var s in i=arguments[n])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t}).apply(this,arguments)},ue=(he.prototype.init=function(t,i,n){var e=this,s=0==i?"rtc":"ali";this._tracer.init({product:this._product,version:"1.0.0",env:i,appID:t,deviceID:n,importantLevel:tt.importLevel,levels:tt.levels,bps:tt.bps,spanStart:function(t){try{Object(L.c)(window.scriptSpanStart)&&scriptSpanStart(e.commonStates,e._tracer,t)}catch(t){e.$t.warn("zm.tc.ii dy span start "+t)}},spanBeforeEnd:function(t){t.setAttribute("ntype_end",P())},spanEnd:function(t,i){try{Object(L.c)(window.scriptSpanEnd)&&scriptSpanEnd(e.commonStates,e._tracer,t)}catch(t){e.$t.warn("zm.tc.ii dy span end ",JSON.stringify(t))}},resources:{product:this._product,appid:t,device_id:n,console:s}})},he.prototype.setConfig=function(t){this._tracer.setConfig(t)},he.prototype.loadScript=function(t,i,n,e){return function(t,i,n,e){return new(n=n||Promise)((function(s,r){function o(t){try{h(e.next(t))}catch(t){r(t)}}function u(t){try{h(e.throw(t))}catch(t){r(t)}}function h(t){var i;t.done?s(t.value):((i=t.value)instanceof n?i:new n((function(t){t(i)}))).then(o,u)}h((e=e.apply(t,i||[])).next())}))}(this,void 0,void 0,(function(){var s;return function(t,i){var n,e,s,r={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},o={next:u(0),throw:u(1),return:u(2)};return"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(u){return function(h){var c=[u,h];if(n)throw new TypeError("Generator is already executing.");for(;r=o&&c[o=0]?0:r;)try{if(n=1,e&&(s=2&c[0]?e.return:c[0]?e.throw||((s=e.return)&&s.call(e),0):e.next)&&!(s=s.call(e,c[1])).done)return s;switch(e=0,(c=s?[2&c[0],s.value]:c)[0]){case 0:case 1:s=c;break;case 4:return r.label++,{value:c[1],done:!1};case 5:r.label++,e=c[1],c=[0];continue;case 7:c=r.ops.pop(),r.trys.pop();continue;default:if(!(s=0<(s=r.trys).length&&s[s.length-1])&&(6===c[0]||2===c[0])){r=0;continue}if(3===c[0]&&(!s||c[1]>s[0]&&c[1]<s[3]))r.label=c[1];else if(6===c[0]&&r.label<s[1])r.label=s[1],s=c;else{if(!(s&&r.label<s[2])){s[2]&&r.ops.pop(),r.trys.pop();continue}r.label=s[2],r.ops.push(c)}}c=i.call(t,r)}catch(h){c=[6,h],e=0}finally{n=s=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this._tracer.loadJs(t,i,n,e,"\nfunction scriptSpanStart(states, tracer, span) {\n    \n}\nfunction scriptSpanEnd(states, tracer, span) {\n    if (span['tags']['msg_content']) {\n        span['tags']['msg_content_size'] = span['tags']['msg_content'].length;\n        delete span['tags']['msg_content'];\n    }\n    delete span['tags']['resp'];\n    const filterSpans = ['/rtc/login', '/rtc/hb', '/rtc/recv_remote_stream'];\n    if (filterSpans.includes(span.name)) {\n        console.log(span.name + ' do not report');\n        span.droped = true;\n    }\n}\nfunction scriptInit(states, tracer) {\n\n}\n\n",{})];case 1:return r.sent(),Object(L.c)(window.scriptInit)&&scriptInit(this.commonStates,this._tracer),[3,3];case 2:return s=r.sent(),this.$t.warn("zm.tc.ls"," load script fail "+JSON.stringify(s)),[3,3];case 3:return[2]}}))}))},he.prototype.setReporterInfo=function(t,i){var n=new Map;n.set("userID",t),n.set("token",i),this._tracer.startReport(n)},he.prototype.flush=function(t){this._tracer.flush(t)},he.prototype.destroy=function(){this._tracer.destroy()},he.prototype.setCommonStates=function(t){this.commonStates=t},he.prototype.setResource=function(t){this._tracer.setResource(t)},he.prototype.setCommonAttributes=function(t){this._commonAttrs=Object.assign({},this._commonAttrs,t)},he.prototype.deleteCommonAttributes=function(t){var i=this;t.forEach((function(t){delete i._commonAttrs[t]}))},he.prototype.createSpan=function(t,i,n){return(t=this._tracer.createSpan(t,i,{parent:n})).setAttributes(oe({ntype:P(),error:0,message:""},this._commonAttrs)),t},he.prototype.spanEnd=function(t,i){t&&i&&t.setAttributes(oe({},i)),t&&t.end()},he.prototype.spanSetAttributes=function(t,i){t&&t.setAttributes(i)},he.prototype.spanAppendAttribute=function(t,i,n){t&&t.appendAttribute(i,n)},he.prototype.setError=function(t,i,n){t.setAttributes({error:i.code||i.errorCode,message:(i.msg||i.message||i.extendedData)+" "+(n=void 0===n?"":n)}),t.end()},he.prototype.setLogger=function(t){this._tracer.setLogger(t)},he.prototype.setTimeOffset=function(t){this._tracer.setTimeOffset(t)},he.prototype.setUnloadState=function(t){this.isUnload=!0,this._tracer.setUnloadState(t)},he.prototype.setNetStateCheck=function(){this._tracer.setNetStateCheck()},he);function he(t){this.$t=t,this._product=tt.product,this._commonAttrs={},this.commonStates={},this.isUnload=!1,new re.DynamicCode,this._tracer=new re.ZegoTracer(ee.proxyCtrl),this._tracer.setSampleConfig({level:u.L})}var ce=["/sdk/start_publish","/publish/start","/publish/restart"],ae=["/sdk/start_play","/play/start","/play/restart"],fe=(le.prototype.init=function(t,i,n){this.tracerHandler.init(t,i,n)},le.prototype.setConfig=function(t){this.tracerHandler.setConfig(t)},le.prototype.loadScript=function(t,i,n,e){return this.tracerHandler.loadScript(t,i,n,e)},le.prototype.setReporterInfo=function(t,i){this.tracerHandler.setReporterInfo(t,i)},le.prototype.flush=function(t){this.tracerHandler.flush(t)},le.prototype.destroy=function(){this.tracerHandler.destroy()},le.prototype.setCommonStates=function(t){this.tracerHandler.setCommonStates(t)},le.prototype.setResource=function(t){this.tracerHandler.setResource(t)},le.prototype.setCommonAttributes=function(t){this.tracerHandler.setCommonAttributes(t)},le.prototype.deleteCommonAttributes=function(t){this.tracerHandler.deleteCommonAttributes(t)},le.prototype.clearRoomSpans=function(t){var i=this;t.forEach((function(t){for(var n in i._reportList)null==i._reportList[n].span&&delete i._reportList[n][t]}))},le.prototype.setPublicPros=function(t){this._publicPros=Object.assign({},this._publicPros,t)},le.prototype.createSpan=function(t,i,n,e,s){var r;i&&i.key&&i.par?(o=i.par1?"_"+i.par1:"",!(r=null==(r=this._reportList[i.key])?void 0:r[i.par+o])&&i.bak_key&&(r=null==(u=this._reportList[i.bak_key])?void 0:u[i.par+o])):i&&!(r=this._reportList[i.key])&&i.bak_key&&(r=this._reportList[i.bak_key]),r=r||this._reportList[Yt.event];var o,u=this.tracerHandler.createSpan(t,e,r);return"/sdk/login"===i.key&&(u.setAttribute("room_id",i.par),this._publicPros[i.par])&&u.setAttributes(this._publicPros[i.par]),(ce.includes(i.key)||ae.includes(i.key))&&u.setAttribute("stream_id",i.par),ce.includes(i.key)&&this._publicPros["_publish_"+i.par]&&u.setAttributes(this._publicPros["_publish_"+i.par]),ae.includes(i.key)&&this._publicPros["_play_"+i.par]&&u.setAttributes(this._publicPros["_play_"+i.par]),s&&(n.par?(this._reportList[n.key]||(this._reportList[n.key]={}),o=n.par1?"_"+n.par1:"",this._reportList[n.key][n.par+o]=u):this._reportList[n.key]=u),u},le.prototype.setSpanInMap=function(t,i){var n;i.par?(this._reportList[i.key]||(this._reportList[i.key]={}),n=i.par2?"_"+i.par2:"",this._reportList[i.key][i.par+n]=t):this._reportList[i.key]=t},le.prototype.spanEnd=function(t,i,n){var e;t.par?(e=t.par1?"_"+t.par1:"",e=this._reportList[t.key]&&this._reportList[t.key][t.par+e],this._reportList[t.key]&&!n&&delete this._reportList[t.key][t.par]):(e=this._reportList[t.key],n||delete this._reportList[t.key]),this.tracerHandler.spanEnd(e,i)},le.prototype.spanSetAttributes=function(t,i){var n,e;t.par?(n=t.par1?"_"+t.par1:"",!(e=this._reportList[t.key]&&this._reportList[t.key][t.par+n])&&t.bak_key&&(e=this._reportList[t.bak_key]&&this._reportList[t.bak_key][t.par+n])):!(e=this._reportList[t.key])&&t.bak_key&&(e=this._reportList[t.key]),this.tracerHandler.spanSetAttributes(e,i)},le.prototype.spanAppendAttribute=function(t,i,n){var e,s;t.par?(e=t.par1?"_"+t.par1:"",!(s=this._reportList[t.key]&&this._reportList[t.key][t.par+e])&&t.bak_key&&(s=this._reportList[t.bak_key]&&this._reportList[t.bak_key][t.par+e])):!(s=this._reportList[t.key])&&t.bak_key&&(s=this._reportList[t.key]),this.tracerHandler.spanAppendAttribute(s,i,n)},le.prototype.setError=function(t,i,n){this.tracerHandler.setError(t,i,n)},le.prototype.setLogger=function(t){this.tracerHandler.setLogger(t)},le.prototype.setTimeOffset=function(t){this.tracerHandler.setTimeOffset(t)},le.prototype.setUnloadState=function(t){this.tracerHandler.setUnloadState(t)},le.prototype.setNetStateCheck=function(){this.tracerHandler.setNetStateCheck()},le);function le(t){this.$t=t,this._reportList={},this._publicPros={},this.tracerHandler=new ue(t)}de.prototype.enableMultiRoom=function(t){return this.zegoWebRTM.enableMultiRoom(t)},de.prototype.loginRoom=function(t,i,n,e){return this.zegoWebRTM.loginRoom(t,i,n,e)},de.prototype.logoutRoom=function(t){return this.zegoWebRTM.logoutRoom(t)},de.prototype.renewToken=function(t,i){return this.zegoWebRTM.renewToken(t,i)},de.prototype.sendBarrageMessage=function(t,i){return this.zegoWebRTM.sendBarrageMessage(t,i)},de.prototype.sendBroadcastMessage=function(t,i){return this.zegoWebRTM.sendBroadcastMessage(t,i)},de.prototype.sendCustomCommand=function(t,i,n){return this.zegoWebRTM.sendCustomCommand(t,i,n)},de.prototype.setRoomExtraInfo=function(t,i,n){return this.zegoWebRTM.setRoomExtraInfo(t,i,n)},de.prototype.setLogConfig=function(t){return this.zegoWebRTM.setLogConfig(t)},de.prototype.setDebugVerbose=function(t){return this.zegoWebRTM.setDebugVerbose(t)},de.prototype.on=function(t,i){return this.zegoWebRTM.on(t,i)},de.prototype.getVersion=function(){return this.zegoWebRTM.getVersion()},de.prototype.off=function(t,i){return this.zegoWebRTM.off(t,i)},de.use=function(t){ee.use(t)},de.setGeoFence=function(t,i){ee.setGeoFence(t,i)},de.setEngineOptions=function(t){ee.setEngineOptions(t)},de.setCloudProxyConfig=function(t,i,n){ee.setCloudProxyConfig(t,i,n)},de.version="2.1.0";var _e=de;function de(t,i,n,e){var r;void 0===n&&(n=0),null!=(r=ee.proxyCtrl)&&r.init({appID:t}),this.logger=new s.ZegoLogger(n,ee.proxyCtrl||void 0),this.dataReport=new s.ZegoDataReport(this.logger),this.reporter=new fe(this.logger),this.zegoWebRTM=new ee(t,i,this.logger,this.dataReport,this.reporter,de.version,n,e)}}],u={},r.m=o,r.c=u,r.d=function(t,i,n){r.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,i){if(1&i&&(t=r(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var e in t)r.d(n,e,function(i){return t[i]}.bind(null,e));return n},r.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(i,"a",i),i},r.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},r.p="",r(r.s=21);function r(t){var i;return(u[t]||(i=u[t]={i:t,l:!1,exports:{}},o[t].call(i.exports,i,i.exports,r),i.l=!0,i)).exports}var o,u}));